function Kw(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function Gw(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var E0={exports:{}},Uc={},P0={exports:{}},Se={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ea=Symbol.for("react.element"),Jw=Symbol.for("react.portal"),Qw=Symbol.for("react.fragment"),Yw=Symbol.for("react.strict_mode"),Xw=Symbol.for("react.profiler"),Zw=Symbol.for("react.provider"),ex=Symbol.for("react.context"),tx=Symbol.for("react.forward_ref"),nx=Symbol.for("react.suspense"),ix=Symbol.for("react.memo"),rx=Symbol.for("react.lazy"),Mm=Symbol.iterator;function sx(t){return t===null||typeof t!="object"?null:(t=Mm&&t[Mm]||t["@@iterator"],typeof t=="function"?t:null)}var R0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_0=Object.assign,I0={};function Ys(t,e,n){this.props=t,this.context=e,this.refs=I0,this.updater=n||R0}Ys.prototype.isReactComponent={};Ys.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ys.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function A0(){}A0.prototype=Ys.prototype;function Ef(t,e,n){this.props=t,this.context=e,this.refs=I0,this.updater=n||R0}var Pf=Ef.prototype=new A0;Pf.constructor=Ef;_0(Pf,Ys.prototype);Pf.isPureReactComponent=!0;var Lm=Array.isArray,N0=Object.prototype.hasOwnProperty,Rf={current:null},O0={key:!0,ref:!0,__self:!0,__source:!0};function D0(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)N0.call(e,i)&&!O0.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:Ea,type:t,key:s,ref:o,props:r,_owner:Rf.current}}function ox(t,e){return{$$typeof:Ea,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function _f(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ea}function ax(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var jm=/\/+/g;function _u(t,e){return typeof t=="object"&&t!==null&&t.key!=null?ax(""+t.key):e.toString(36)}function vl(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ea:case Jw:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+_u(o,0):i,Lm(r)?(n="",t!=null&&(n=t.replace(jm,"$&/")+"/"),vl(r,e,n,"",function(c){return c})):r!=null&&(_f(r)&&(r=ox(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(jm,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Lm(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+_u(s,a);o+=vl(s,e,n,l,r)}else if(l=sx(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+_u(s,a++),o+=vl(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function qa(t,e,n){if(t==null)return t;var i=[],r=0;return vl(t,i,"","",function(s){return e.call(n,s,r++)}),i}function lx(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Vt={current:null},yl={transition:null},cx={ReactCurrentDispatcher:Vt,ReactCurrentBatchConfig:yl,ReactCurrentOwner:Rf};function M0(){throw Error("act(...) is not supported in production builds of React.")}Se.Children={map:qa,forEach:function(t,e,n){qa(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return qa(t,function(){e++}),e},toArray:function(t){return qa(t,function(e){return e})||[]},only:function(t){if(!_f(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Se.Component=Ys;Se.Fragment=Qw;Se.Profiler=Xw;Se.PureComponent=Ef;Se.StrictMode=Yw;Se.Suspense=nx;Se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cx;Se.act=M0;Se.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=_0({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Rf.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)N0.call(e,l)&&!O0.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:Ea,type:t.type,key:r,ref:s,props:i,_owner:o}};Se.createContext=function(t){return t={$$typeof:ex,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Zw,_context:t},t.Consumer=t};Se.createElement=D0;Se.createFactory=function(t){var e=D0.bind(null,t);return e.type=t,e};Se.createRef=function(){return{current:null}};Se.forwardRef=function(t){return{$$typeof:tx,render:t}};Se.isValidElement=_f;Se.lazy=function(t){return{$$typeof:rx,_payload:{_status:-1,_result:t},_init:lx}};Se.memo=function(t,e){return{$$typeof:ix,type:t,compare:e===void 0?null:e}};Se.startTransition=function(t){var e=yl.transition;yl.transition={};try{t()}finally{yl.transition=e}};Se.unstable_act=M0;Se.useCallback=function(t,e){return Vt.current.useCallback(t,e)};Se.useContext=function(t){return Vt.current.useContext(t)};Se.useDebugValue=function(){};Se.useDeferredValue=function(t){return Vt.current.useDeferredValue(t)};Se.useEffect=function(t,e){return Vt.current.useEffect(t,e)};Se.useId=function(){return Vt.current.useId()};Se.useImperativeHandle=function(t,e,n){return Vt.current.useImperativeHandle(t,e,n)};Se.useInsertionEffect=function(t,e){return Vt.current.useInsertionEffect(t,e)};Se.useLayoutEffect=function(t,e){return Vt.current.useLayoutEffect(t,e)};Se.useMemo=function(t,e){return Vt.current.useMemo(t,e)};Se.useReducer=function(t,e,n){return Vt.current.useReducer(t,e,n)};Se.useRef=function(t){return Vt.current.useRef(t)};Se.useState=function(t){return Vt.current.useState(t)};Se.useSyncExternalStore=function(t,e,n){return Vt.current.useSyncExternalStore(t,e,n)};Se.useTransition=function(){return Vt.current.useTransition()};Se.version="18.3.1";P0.exports=Se;var C=P0.exports;const Fc=Gw(C),ux=Kw({__proto__:null,default:Fc},[C]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dx=C,hx=Symbol.for("react.element"),fx=Symbol.for("react.fragment"),px=Object.prototype.hasOwnProperty,mx=dx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gx={key:!0,ref:!0,__self:!0,__source:!0};function L0(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)px.call(e,i)&&!gx.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:hx,type:t,key:s,ref:o,props:r,_owner:mx.current}}Uc.Fragment=fx;Uc.jsx=L0;Uc.jsxs=L0;E0.exports=Uc;var f=E0.exports,Bd={},j0={exports:{}},cn={},U0={exports:{}},F0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(D,N){var j=D.length;D.push(N);e:for(;0<j;){var $=j-1>>>1,ee=D[$];if(0<r(ee,N))D[$]=N,D[j]=ee,j=$;else break e}}function n(D){return D.length===0?null:D[0]}function i(D){if(D.length===0)return null;var N=D[0],j=D.pop();if(j!==N){D[0]=j;e:for(var $=0,ee=D.length,De=ee>>>1;$<De;){var pe=2*($+1)-1,Xe=D[pe],le=pe+1,ct=D[le];if(0>r(Xe,j))le<ee&&0>r(ct,Xe)?(D[$]=ct,D[le]=j,$=le):(D[$]=Xe,D[pe]=j,$=pe);else if(le<ee&&0>r(ct,j))D[$]=ct,D[le]=j,$=le;else break e}}return N}function r(D,N){var j=D.sortIndex-N.sortIndex;return j!==0?j:D.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,p=!1,m=!1,v=!1,T=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(D){for(var N=n(c);N!==null;){if(N.callback===null)i(c);else if(N.startTime<=D)i(c),N.sortIndex=N.expirationTime,e(l,N);else break;N=n(c)}}function k(D){if(v=!1,S(D),!m)if(n(l)!==null)m=!0,q(b);else{var N=n(c);N!==null&&Re(k,N.startTime-D)}}function b(D,N){m=!1,v&&(v=!1,g(P),P=-1),p=!0;var j=h;try{for(S(N),d=n(l);d!==null&&(!(d.expirationTime>N)||D&&!W());){var $=d.callback;if(typeof $=="function"){d.callback=null,h=d.priorityLevel;var ee=$(d.expirationTime<=N);N=t.unstable_now(),typeof ee=="function"?d.callback=ee:d===n(l)&&i(l),S(N)}else i(l);d=n(l)}if(d!==null)var De=!0;else{var pe=n(c);pe!==null&&Re(k,pe.startTime-N),De=!1}return De}finally{d=null,h=j,p=!1}}var x=!1,E=null,P=-1,A=5,O=-1;function W(){return!(t.unstable_now()-O<A)}function J(){if(E!==null){var D=t.unstable_now();O=D;var N=!0;try{N=E(!0,D)}finally{N?se():(x=!1,E=null)}}else x=!1}var se;if(typeof y=="function")se=function(){y(J)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,xe=te.port2;te.port1.onmessage=J,se=function(){xe.postMessage(null)}}else se=function(){T(J,0)};function q(D){E=D,x||(x=!0,se())}function Re(D,N){P=T(function(){D(t.unstable_now())},N)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,q(b))},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(D){switch(h){case 1:case 2:case 3:var N=3;break;default:N=h}var j=h;h=N;try{return D()}finally{h=j}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(D,N){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var j=h;h=D;try{return N()}finally{h=j}},t.unstable_scheduleCallback=function(D,N,j){var $=t.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?$+j:$):j=$,D){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=j+ee,D={id:u++,callback:N,priorityLevel:D,startTime:j,expirationTime:ee,sortIndex:-1},j>$?(D.sortIndex=j,e(c,D),n(l)===null&&D===n(c)&&(v?(g(P),P=-1):v=!0,Re(k,j-$))):(D.sortIndex=ee,e(l,D),m||p||(m=!0,q(b))),D},t.unstable_shouldYield=W,t.unstable_wrapCallback=function(D){var N=h;return function(){var j=h;h=N;try{return D.apply(this,arguments)}finally{h=j}}}})(F0);U0.exports=F0;var vx=U0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yx=C,an=vx;function F(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var B0=new Set,Xo={};function $r(t,e){Fs(t,e),Fs(t+"Capture",e)}function Fs(t,e){for(Xo[t]=e,t=0;t<e.length;t++)B0.add(e[t])}var bi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vd=Object.prototype.hasOwnProperty,kx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Um={},Fm={};function Sx(t){return Vd.call(Fm,t)?!0:Vd.call(Um,t)?!1:kx.test(t)?Fm[t]=!0:(Um[t]=!0,!1)}function bx(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Tx(t,e,n,i){if(e===null||typeof e>"u"||bx(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function zt(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Pt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Pt[t]=new zt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Pt[e]=new zt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Pt[t]=new zt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Pt[t]=new zt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Pt[t]=new zt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Pt[t]=new zt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Pt[t]=new zt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Pt[t]=new zt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Pt[t]=new zt(t,5,!1,t.toLowerCase(),null,!1,!1)});var If=/[\-:]([a-z])/g;function Af(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(If,Af);Pt[e]=new zt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(If,Af);Pt[e]=new zt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(If,Af);Pt[e]=new zt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Pt[t]=new zt(t,1,!1,t.toLowerCase(),null,!1,!1)});Pt.xlinkHref=new zt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Pt[t]=new zt(t,1,!1,t.toLowerCase(),null,!0,!0)});function Nf(t,e,n,i){var r=Pt.hasOwnProperty(e)?Pt[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Tx(e,n,r,i)&&(n=null),i||r===null?Sx(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Pi=yx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ha=Symbol.for("react.element"),as=Symbol.for("react.portal"),ls=Symbol.for("react.fragment"),Of=Symbol.for("react.strict_mode"),zd=Symbol.for("react.profiler"),V0=Symbol.for("react.provider"),z0=Symbol.for("react.context"),Df=Symbol.for("react.forward_ref"),Wd=Symbol.for("react.suspense"),qd=Symbol.for("react.suspense_list"),Mf=Symbol.for("react.memo"),Mi=Symbol.for("react.lazy"),W0=Symbol.for("react.offscreen"),Bm=Symbol.iterator;function lo(t){return t===null||typeof t!="object"?null:(t=Bm&&t[Bm]||t["@@iterator"],typeof t=="function"?t:null)}var Ke=Object.assign,Iu;function Eo(t){if(Iu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Iu=e&&e[1]||""}return`
`+Iu+t}var Au=!1;function Nu(t,e){if(!t||Au)return"";Au=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Au=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Eo(t):""}function Cx(t){switch(t.tag){case 5:return Eo(t.type);case 16:return Eo("Lazy");case 13:return Eo("Suspense");case 19:return Eo("SuspenseList");case 0:case 2:case 15:return t=Nu(t.type,!1),t;case 11:return t=Nu(t.type.render,!1),t;case 1:return t=Nu(t.type,!0),t;default:return""}}function Hd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ls:return"Fragment";case as:return"Portal";case zd:return"Profiler";case Of:return"StrictMode";case Wd:return"Suspense";case qd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case z0:return(t.displayName||"Context")+".Consumer";case V0:return(t._context.displayName||"Context")+".Provider";case Df:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Mf:return e=t.displayName||null,e!==null?e:Hd(t.type)||"Memo";case Mi:e=t._payload,t=t._init;try{return Hd(t(e))}catch{}}return null}function wx(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Hd(e);case 8:return e===Of?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function rr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function q0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function xx(t){var e=q0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function $a(t){t._valueTracker||(t._valueTracker=xx(t))}function H0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=q0(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Kl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function $d(t,e){var n=e.checked;return Ke({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Vm(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=rr(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function $0(t,e){e=e.checked,e!=null&&Nf(t,"checked",e,!1)}function Kd(t,e){$0(t,e);var n=rr(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Gd(t,e.type,n):e.hasOwnProperty("defaultValue")&&Gd(t,e.type,rr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function zm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Gd(t,e,n){(e!=="number"||Kl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Po=Array.isArray;function Es(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+rr(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Jd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(F(91));return Ke({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Wm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(F(92));if(Po(n)){if(1<n.length)throw Error(F(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:rr(n)}}function K0(t,e){var n=rr(e.value),i=rr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function qm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function G0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qd(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?G0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ka,J0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ka=Ka||document.createElement("div"),Ka.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ka.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Zo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Do={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ex=["Webkit","ms","Moz","O"];Object.keys(Do).forEach(function(t){Ex.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Do[e]=Do[t]})});function Q0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Do.hasOwnProperty(t)&&Do[t]?(""+e).trim():e+"px"}function Y0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Q0(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var Px=Ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yd(t,e){if(e){if(Px[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(F(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(F(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(F(61))}if(e.style!=null&&typeof e.style!="object")throw Error(F(62))}}function Xd(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zd=null;function Lf(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var eh=null,Ps=null,Rs=null;function Hm(t){if(t=_a(t)){if(typeof eh!="function")throw Error(F(280));var e=t.stateNode;e&&(e=qc(e),eh(t.stateNode,t.type,e))}}function X0(t){Ps?Rs?Rs.push(t):Rs=[t]:Ps=t}function Z0(){if(Ps){var t=Ps,e=Rs;if(Rs=Ps=null,Hm(t),e)for(t=0;t<e.length;t++)Hm(e[t])}}function ek(t,e){return t(e)}function tk(){}var Ou=!1;function nk(t,e,n){if(Ou)return t(e,n);Ou=!0;try{return ek(t,e,n)}finally{Ou=!1,(Ps!==null||Rs!==null)&&(tk(),Z0())}}function ea(t,e){var n=t.stateNode;if(n===null)return null;var i=qc(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(F(231,e,typeof n));return n}var th=!1;if(bi)try{var co={};Object.defineProperty(co,"passive",{get:function(){th=!0}}),window.addEventListener("test",co,co),window.removeEventListener("test",co,co)}catch{th=!1}function Rx(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Mo=!1,Gl=null,Jl=!1,nh=null,_x={onError:function(t){Mo=!0,Gl=t}};function Ix(t,e,n,i,r,s,o,a,l){Mo=!1,Gl=null,Rx.apply(_x,arguments)}function Ax(t,e,n,i,r,s,o,a,l){if(Ix.apply(this,arguments),Mo){if(Mo){var c=Gl;Mo=!1,Gl=null}else throw Error(F(198));Jl||(Jl=!0,nh=c)}}function Kr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function ik(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function $m(t){if(Kr(t)!==t)throw Error(F(188))}function Nx(t){var e=t.alternate;if(!e){if(e=Kr(t),e===null)throw Error(F(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return $m(r),t;if(s===i)return $m(r),e;s=s.sibling}throw Error(F(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(F(189))}}if(n.alternate!==i)throw Error(F(190))}if(n.tag!==3)throw Error(F(188));return n.stateNode.current===n?t:e}function rk(t){return t=Nx(t),t!==null?sk(t):null}function sk(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=sk(t);if(e!==null)return e;t=t.sibling}return null}var ok=an.unstable_scheduleCallback,Km=an.unstable_cancelCallback,Ox=an.unstable_shouldYield,Dx=an.unstable_requestPaint,et=an.unstable_now,Mx=an.unstable_getCurrentPriorityLevel,jf=an.unstable_ImmediatePriority,ak=an.unstable_UserBlockingPriority,Ql=an.unstable_NormalPriority,Lx=an.unstable_LowPriority,lk=an.unstable_IdlePriority,Bc=null,Xn=null;function jx(t){if(Xn&&typeof Xn.onCommitFiberRoot=="function")try{Xn.onCommitFiberRoot(Bc,t,void 0,(t.current.flags&128)===128)}catch{}}var jn=Math.clz32?Math.clz32:Bx,Ux=Math.log,Fx=Math.LN2;function Bx(t){return t>>>=0,t===0?32:31-(Ux(t)/Fx|0)|0}var Ga=64,Ja=4194304;function Ro(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Yl(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Ro(a):(s&=o,s!==0&&(i=Ro(s)))}else o=n&~r,o!==0?i=Ro(o):s!==0&&(i=Ro(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-jn(e),r=1<<n,i|=t[n],e&=~r;return i}function Vx(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zx(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-jn(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=Vx(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function ih(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ck(){var t=Ga;return Ga<<=1,!(Ga&4194240)&&(Ga=64),t}function Du(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Pa(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-jn(e),t[e]=n}function Wx(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-jn(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Uf(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-jn(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var _e=0;function uk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var dk,Ff,hk,fk,pk,rh=!1,Qa=[],Hi=null,$i=null,Ki=null,ta=new Map,na=new Map,Ui=[],qx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gm(t,e){switch(t){case"focusin":case"focusout":Hi=null;break;case"dragenter":case"dragleave":$i=null;break;case"mouseover":case"mouseout":Ki=null;break;case"pointerover":case"pointerout":ta.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":na.delete(e.pointerId)}}function uo(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=_a(e),e!==null&&Ff(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function Hx(t,e,n,i,r){switch(e){case"focusin":return Hi=uo(Hi,t,e,n,i,r),!0;case"dragenter":return $i=uo($i,t,e,n,i,r),!0;case"mouseover":return Ki=uo(Ki,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return ta.set(s,uo(ta.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,na.set(s,uo(na.get(s)||null,t,e,n,i,r)),!0}return!1}function mk(t){var e=Pr(t.target);if(e!==null){var n=Kr(e);if(n!==null){if(e=n.tag,e===13){if(e=ik(n),e!==null){t.blockedOn=e,pk(t.priority,function(){hk(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function kl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=sh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Zd=i,n.target.dispatchEvent(i),Zd=null}else return e=_a(n),e!==null&&Ff(e),t.blockedOn=n,!1;e.shift()}return!0}function Jm(t,e,n){kl(t)&&n.delete(e)}function $x(){rh=!1,Hi!==null&&kl(Hi)&&(Hi=null),$i!==null&&kl($i)&&($i=null),Ki!==null&&kl(Ki)&&(Ki=null),ta.forEach(Jm),na.forEach(Jm)}function ho(t,e){t.blockedOn===e&&(t.blockedOn=null,rh||(rh=!0,an.unstable_scheduleCallback(an.unstable_NormalPriority,$x)))}function ia(t){function e(r){return ho(r,t)}if(0<Qa.length){ho(Qa[0],t);for(var n=1;n<Qa.length;n++){var i=Qa[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Hi!==null&&ho(Hi,t),$i!==null&&ho($i,t),Ki!==null&&ho(Ki,t),ta.forEach(e),na.forEach(e),n=0;n<Ui.length;n++)i=Ui[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Ui.length&&(n=Ui[0],n.blockedOn===null);)mk(n),n.blockedOn===null&&Ui.shift()}var _s=Pi.ReactCurrentBatchConfig,Xl=!0;function Kx(t,e,n,i){var r=_e,s=_s.transition;_s.transition=null;try{_e=1,Bf(t,e,n,i)}finally{_e=r,_s.transition=s}}function Gx(t,e,n,i){var r=_e,s=_s.transition;_s.transition=null;try{_e=4,Bf(t,e,n,i)}finally{_e=r,_s.transition=s}}function Bf(t,e,n,i){if(Xl){var r=sh(t,e,n,i);if(r===null)qu(t,e,i,Zl,n),Gm(t,i);else if(Hx(r,t,e,n,i))i.stopPropagation();else if(Gm(t,i),e&4&&-1<qx.indexOf(t)){for(;r!==null;){var s=_a(r);if(s!==null&&dk(s),s=sh(t,e,n,i),s===null&&qu(t,e,i,Zl,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else qu(t,e,i,null,n)}}var Zl=null;function sh(t,e,n,i){if(Zl=null,t=Lf(i),t=Pr(t),t!==null)if(e=Kr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=ik(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Zl=t,null}function gk(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Mx()){case jf:return 1;case ak:return 4;case Ql:case Lx:return 16;case lk:return 536870912;default:return 16}default:return 16}}var Vi=null,Vf=null,Sl=null;function vk(){if(Sl)return Sl;var t,e=Vf,n=e.length,i,r="value"in Vi?Vi.value:Vi.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Sl=r.slice(t,1<i?1-i:void 0)}function bl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ya(){return!0}function Qm(){return!1}function un(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Ya:Qm,this.isPropagationStopped=Qm,this}return Ke(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ya)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ya)},persist:function(){},isPersistent:Ya}),e}var Xs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zf=un(Xs),Ra=Ke({},Xs,{view:0,detail:0}),Jx=un(Ra),Mu,Lu,fo,Vc=Ke({},Ra,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wf,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==fo&&(fo&&t.type==="mousemove"?(Mu=t.screenX-fo.screenX,Lu=t.screenY-fo.screenY):Lu=Mu=0,fo=t),Mu)},movementY:function(t){return"movementY"in t?t.movementY:Lu}}),Ym=un(Vc),Qx=Ke({},Vc,{dataTransfer:0}),Yx=un(Qx),Xx=Ke({},Ra,{relatedTarget:0}),ju=un(Xx),Zx=Ke({},Xs,{animationName:0,elapsedTime:0,pseudoElement:0}),eE=un(Zx),tE=Ke({},Xs,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),nE=un(tE),iE=Ke({},Xs,{data:0}),Xm=un(iE),rE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function aE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=oE[t])?!!e[t]:!1}function Wf(){return aE}var lE=Ke({},Ra,{key:function(t){if(t.key){var e=rE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=bl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?sE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wf,charCode:function(t){return t.type==="keypress"?bl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?bl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),cE=un(lE),uE=Ke({},Vc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zm=un(uE),dE=Ke({},Ra,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wf}),hE=un(dE),fE=Ke({},Xs,{propertyName:0,elapsedTime:0,pseudoElement:0}),pE=un(fE),mE=Ke({},Vc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),gE=un(mE),vE=[9,13,27,32],qf=bi&&"CompositionEvent"in window,Lo=null;bi&&"documentMode"in document&&(Lo=document.documentMode);var yE=bi&&"TextEvent"in window&&!Lo,yk=bi&&(!qf||Lo&&8<Lo&&11>=Lo),eg=" ",tg=!1;function kk(t,e){switch(t){case"keyup":return vE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sk(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var cs=!1;function kE(t,e){switch(t){case"compositionend":return Sk(e);case"keypress":return e.which!==32?null:(tg=!0,eg);case"textInput":return t=e.data,t===eg&&tg?null:t;default:return null}}function SE(t,e){if(cs)return t==="compositionend"||!qf&&kk(t,e)?(t=vk(),Sl=Vf=Vi=null,cs=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yk&&e.locale!=="ko"?null:e.data;default:return null}}var bE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ng(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!bE[t.type]:e==="textarea"}function bk(t,e,n,i){X0(i),e=ec(e,"onChange"),0<e.length&&(n=new zf("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var jo=null,ra=null;function TE(t){Nk(t,0)}function zc(t){var e=hs(t);if(H0(e))return t}function CE(t,e){if(t==="change")return e}var Tk=!1;if(bi){var Uu;if(bi){var Fu="oninput"in document;if(!Fu){var ig=document.createElement("div");ig.setAttribute("oninput","return;"),Fu=typeof ig.oninput=="function"}Uu=Fu}else Uu=!1;Tk=Uu&&(!document.documentMode||9<document.documentMode)}function rg(){jo&&(jo.detachEvent("onpropertychange",Ck),ra=jo=null)}function Ck(t){if(t.propertyName==="value"&&zc(ra)){var e=[];bk(e,ra,t,Lf(t)),nk(TE,e)}}function wE(t,e,n){t==="focusin"?(rg(),jo=e,ra=n,jo.attachEvent("onpropertychange",Ck)):t==="focusout"&&rg()}function xE(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return zc(ra)}function EE(t,e){if(t==="click")return zc(e)}function PE(t,e){if(t==="input"||t==="change")return zc(e)}function RE(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Fn=typeof Object.is=="function"?Object.is:RE;function sa(t,e){if(Fn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Vd.call(e,r)||!Fn(t[r],e[r]))return!1}return!0}function sg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function og(t,e){var n=sg(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=sg(n)}}function wk(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?wk(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function xk(){for(var t=window,e=Kl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Kl(t.document)}return e}function Hf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function _E(t){var e=xk(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&wk(n.ownerDocument.documentElement,n)){if(i!==null&&Hf(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=og(n,s);var o=og(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var IE=bi&&"documentMode"in document&&11>=document.documentMode,us=null,oh=null,Uo=null,ah=!1;function ag(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ah||us==null||us!==Kl(i)||(i=us,"selectionStart"in i&&Hf(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Uo&&sa(Uo,i)||(Uo=i,i=ec(oh,"onSelect"),0<i.length&&(e=new zf("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=us)))}function Xa(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ds={animationend:Xa("Animation","AnimationEnd"),animationiteration:Xa("Animation","AnimationIteration"),animationstart:Xa("Animation","AnimationStart"),transitionend:Xa("Transition","TransitionEnd")},Bu={},Ek={};bi&&(Ek=document.createElement("div").style,"AnimationEvent"in window||(delete ds.animationend.animation,delete ds.animationiteration.animation,delete ds.animationstart.animation),"TransitionEvent"in window||delete ds.transitionend.transition);function Wc(t){if(Bu[t])return Bu[t];if(!ds[t])return t;var e=ds[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Ek)return Bu[t]=e[n];return t}var Pk=Wc("animationend"),Rk=Wc("animationiteration"),_k=Wc("animationstart"),Ik=Wc("transitionend"),Ak=new Map,lg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ur(t,e){Ak.set(t,e),$r(e,[t])}for(var Vu=0;Vu<lg.length;Vu++){var zu=lg[Vu],AE=zu.toLowerCase(),NE=zu[0].toUpperCase()+zu.slice(1);ur(AE,"on"+NE)}ur(Pk,"onAnimationEnd");ur(Rk,"onAnimationIteration");ur(_k,"onAnimationStart");ur("dblclick","onDoubleClick");ur("focusin","onFocus");ur("focusout","onBlur");ur(Ik,"onTransitionEnd");Fs("onMouseEnter",["mouseout","mouseover"]);Fs("onMouseLeave",["mouseout","mouseover"]);Fs("onPointerEnter",["pointerout","pointerover"]);Fs("onPointerLeave",["pointerout","pointerover"]);$r("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));$r("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));$r("onBeforeInput",["compositionend","keypress","textInput","paste"]);$r("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));$r("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));$r("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _o="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),OE=new Set("cancel close invalid load scroll toggle".split(" ").concat(_o));function cg(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,Ax(i,e,void 0,t),t.currentTarget=null}function Nk(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;cg(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;cg(r,a,c),s=l}}}if(Jl)throw t=nh,Jl=!1,nh=null,t}function Ue(t,e){var n=e[hh];n===void 0&&(n=e[hh]=new Set);var i=t+"__bubble";n.has(i)||(Ok(e,t,2,!1),n.add(i))}function Wu(t,e,n){var i=0;e&&(i|=4),Ok(n,t,i,e)}var Za="_reactListening"+Math.random().toString(36).slice(2);function oa(t){if(!t[Za]){t[Za]=!0,B0.forEach(function(n){n!=="selectionchange"&&(OE.has(n)||Wu(n,!1,t),Wu(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Za]||(e[Za]=!0,Wu("selectionchange",!1,e))}}function Ok(t,e,n,i){switch(gk(e)){case 1:var r=Kx;break;case 4:r=Gx;break;default:r=Bf}n=r.bind(null,e,n,t),r=void 0,!th||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function qu(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Pr(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}nk(function(){var c=s,u=Lf(n),d=[];e:{var h=Ak.get(t);if(h!==void 0){var p=zf,m=t;switch(t){case"keypress":if(bl(n)===0)break e;case"keydown":case"keyup":p=cE;break;case"focusin":m="focus",p=ju;break;case"focusout":m="blur",p=ju;break;case"beforeblur":case"afterblur":p=ju;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Ym;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Yx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=hE;break;case Pk:case Rk:case _k:p=eE;break;case Ik:p=pE;break;case"scroll":p=Jx;break;case"wheel":p=gE;break;case"copy":case"cut":case"paste":p=nE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Zm}var v=(e&4)!==0,T=!v&&t==="scroll",g=v?h!==null?h+"Capture":null:h;v=[];for(var y=c,S;y!==null;){S=y;var k=S.stateNode;if(S.tag===5&&k!==null&&(S=k,g!==null&&(k=ea(y,g),k!=null&&v.push(aa(y,k,S)))),T)break;y=y.return}0<v.length&&(h=new p(h,m,null,n,u),d.push({event:h,listeners:v}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==Zd&&(m=n.relatedTarget||n.fromElement)&&(Pr(m)||m[Ti]))break e;if((p||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=c,m=m?Pr(m):null,m!==null&&(T=Kr(m),m!==T||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=c),p!==m)){if(v=Ym,k="onMouseLeave",g="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(v=Zm,k="onPointerLeave",g="onPointerEnter",y="pointer"),T=p==null?h:hs(p),S=m==null?h:hs(m),h=new v(k,y+"leave",p,n,u),h.target=T,h.relatedTarget=S,k=null,Pr(u)===c&&(v=new v(g,y+"enter",m,n,u),v.target=S,v.relatedTarget=T,k=v),T=k,p&&m)t:{for(v=p,g=m,y=0,S=v;S;S=is(S))y++;for(S=0,k=g;k;k=is(k))S++;for(;0<y-S;)v=is(v),y--;for(;0<S-y;)g=is(g),S--;for(;y--;){if(v===g||g!==null&&v===g.alternate)break t;v=is(v),g=is(g)}v=null}else v=null;p!==null&&ug(d,h,p,v,!1),m!==null&&T!==null&&ug(d,T,m,v,!0)}}e:{if(h=c?hs(c):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var b=CE;else if(ng(h))if(Tk)b=PE;else{b=xE;var x=wE}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(b=EE);if(b&&(b=b(t,c))){bk(d,b,n,u);break e}x&&x(t,h,c),t==="focusout"&&(x=h._wrapperState)&&x.controlled&&h.type==="number"&&Gd(h,"number",h.value)}switch(x=c?hs(c):window,t){case"focusin":(ng(x)||x.contentEditable==="true")&&(us=x,oh=c,Uo=null);break;case"focusout":Uo=oh=us=null;break;case"mousedown":ah=!0;break;case"contextmenu":case"mouseup":case"dragend":ah=!1,ag(d,n,u);break;case"selectionchange":if(IE)break;case"keydown":case"keyup":ag(d,n,u)}var E;if(qf)e:{switch(t){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else cs?kk(t,n)&&(P="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(P="onCompositionStart");P&&(yk&&n.locale!=="ko"&&(cs||P!=="onCompositionStart"?P==="onCompositionEnd"&&cs&&(E=vk()):(Vi=u,Vf="value"in Vi?Vi.value:Vi.textContent,cs=!0)),x=ec(c,P),0<x.length&&(P=new Xm(P,t,null,n,u),d.push({event:P,listeners:x}),E?P.data=E:(E=Sk(n),E!==null&&(P.data=E)))),(E=yE?kE(t,n):SE(t,n))&&(c=ec(c,"onBeforeInput"),0<c.length&&(u=new Xm("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:c}),u.data=E))}Nk(d,e)})}function aa(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ec(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=ea(t,n),s!=null&&i.unshift(aa(t,s,r)),s=ea(t,e),s!=null&&i.push(aa(t,s,r))),t=t.return}return i}function is(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ug(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=ea(n,s),l!=null&&o.unshift(aa(n,l,a))):r||(l=ea(n,s),l!=null&&o.push(aa(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var DE=/\r\n?/g,ME=/\u0000|\uFFFD/g;function dg(t){return(typeof t=="string"?t:""+t).replace(DE,`
`).replace(ME,"")}function el(t,e,n){if(e=dg(e),dg(t)!==e&&n)throw Error(F(425))}function tc(){}var lh=null,ch=null;function uh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var dh=typeof setTimeout=="function"?setTimeout:void 0,LE=typeof clearTimeout=="function"?clearTimeout:void 0,hg=typeof Promise=="function"?Promise:void 0,jE=typeof queueMicrotask=="function"?queueMicrotask:typeof hg<"u"?function(t){return hg.resolve(null).then(t).catch(UE)}:dh;function UE(t){setTimeout(function(){throw t})}function Hu(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),ia(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);ia(e)}function Gi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function fg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Zs=Math.random().toString(36).slice(2),Yn="__reactFiber$"+Zs,la="__reactProps$"+Zs,Ti="__reactContainer$"+Zs,hh="__reactEvents$"+Zs,FE="__reactListeners$"+Zs,BE="__reactHandles$"+Zs;function Pr(t){var e=t[Yn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ti]||n[Yn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=fg(t);t!==null;){if(n=t[Yn])return n;t=fg(t)}return e}t=n,n=t.parentNode}return null}function _a(t){return t=t[Yn]||t[Ti],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function hs(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(F(33))}function qc(t){return t[la]||null}var fh=[],fs=-1;function dr(t){return{current:t}}function Be(t){0>fs||(t.current=fh[fs],fh[fs]=null,fs--)}function Le(t,e){fs++,fh[fs]=t.current,t.current=e}var sr={},Dt=dr(sr),Jt=dr(!1),Lr=sr;function Bs(t,e){var n=t.type.contextTypes;if(!n)return sr;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Qt(t){return t=t.childContextTypes,t!=null}function nc(){Be(Jt),Be(Dt)}function pg(t,e,n){if(Dt.current!==sr)throw Error(F(168));Le(Dt,e),Le(Jt,n)}function Dk(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(F(108,wx(t)||"Unknown",r));return Ke({},n,i)}function ic(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||sr,Lr=Dt.current,Le(Dt,t),Le(Jt,Jt.current),!0}function mg(t,e,n){var i=t.stateNode;if(!i)throw Error(F(169));n?(t=Dk(t,e,Lr),i.__reactInternalMemoizedMergedChildContext=t,Be(Jt),Be(Dt),Le(Dt,t)):Be(Jt),Le(Jt,n)}var ci=null,Hc=!1,$u=!1;function Mk(t){ci===null?ci=[t]:ci.push(t)}function VE(t){Hc=!0,Mk(t)}function hr(){if(!$u&&ci!==null){$u=!0;var t=0,e=_e;try{var n=ci;for(_e=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}ci=null,Hc=!1}catch(r){throw ci!==null&&(ci=ci.slice(t+1)),ok(jf,hr),r}finally{_e=e,$u=!1}}return null}var ps=[],ms=0,rc=null,sc=0,vn=[],yn=0,jr=null,mi=1,gi="";function Sr(t,e){ps[ms++]=sc,ps[ms++]=rc,rc=t,sc=e}function Lk(t,e,n){vn[yn++]=mi,vn[yn++]=gi,vn[yn++]=jr,jr=t;var i=mi;t=gi;var r=32-jn(i)-1;i&=~(1<<r),n+=1;var s=32-jn(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,mi=1<<32-jn(e)+r|n<<r|i,gi=s+t}else mi=1<<s|n<<r|i,gi=t}function $f(t){t.return!==null&&(Sr(t,1),Lk(t,1,0))}function Kf(t){for(;t===rc;)rc=ps[--ms],ps[ms]=null,sc=ps[--ms],ps[ms]=null;for(;t===jr;)jr=vn[--yn],vn[yn]=null,gi=vn[--yn],vn[yn]=null,mi=vn[--yn],vn[yn]=null}var on=null,rn=null,Ve=!1,Nn=null;function jk(t,e){var n=kn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function gg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,on=t,rn=Gi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,on=t,rn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=jr!==null?{id:mi,overflow:gi}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=kn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,on=t,rn=null,!0):!1;default:return!1}}function ph(t){return(t.mode&1)!==0&&(t.flags&128)===0}function mh(t){if(Ve){var e=rn;if(e){var n=e;if(!gg(t,e)){if(ph(t))throw Error(F(418));e=Gi(n.nextSibling);var i=on;e&&gg(t,e)?jk(i,n):(t.flags=t.flags&-4097|2,Ve=!1,on=t)}}else{if(ph(t))throw Error(F(418));t.flags=t.flags&-4097|2,Ve=!1,on=t}}}function vg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;on=t}function tl(t){if(t!==on)return!1;if(!Ve)return vg(t),Ve=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!uh(t.type,t.memoizedProps)),e&&(e=rn)){if(ph(t))throw Uk(),Error(F(418));for(;e;)jk(t,e),e=Gi(e.nextSibling)}if(vg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(F(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){rn=Gi(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}rn=null}}else rn=on?Gi(t.stateNode.nextSibling):null;return!0}function Uk(){for(var t=rn;t;)t=Gi(t.nextSibling)}function Vs(){rn=on=null,Ve=!1}function Gf(t){Nn===null?Nn=[t]:Nn.push(t)}var zE=Pi.ReactCurrentBatchConfig;function po(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(F(309));var i=n.stateNode}if(!i)throw Error(F(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(F(284));if(!n._owner)throw Error(F(290,t))}return t}function nl(t,e){throw t=Object.prototype.toString.call(e),Error(F(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function yg(t){var e=t._init;return e(t._payload)}function Fk(t){function e(g,y){if(t){var S=g.deletions;S===null?(g.deletions=[y],g.flags|=16):S.push(y)}}function n(g,y){if(!t)return null;for(;y!==null;)e(g,y),y=y.sibling;return null}function i(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function r(g,y){return g=Xi(g,y),g.index=0,g.sibling=null,g}function s(g,y,S){return g.index=S,t?(S=g.alternate,S!==null?(S=S.index,S<y?(g.flags|=2,y):S):(g.flags|=2,y)):(g.flags|=1048576,y)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,y,S,k){return y===null||y.tag!==6?(y=Zu(S,g.mode,k),y.return=g,y):(y=r(y,S),y.return=g,y)}function l(g,y,S,k){var b=S.type;return b===ls?u(g,y,S.props.children,k,S.key):y!==null&&(y.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Mi&&yg(b)===y.type)?(k=r(y,S.props),k.ref=po(g,y,S),k.return=g,k):(k=Rl(S.type,S.key,S.props,null,g.mode,k),k.ref=po(g,y,S),k.return=g,k)}function c(g,y,S,k){return y===null||y.tag!==4||y.stateNode.containerInfo!==S.containerInfo||y.stateNode.implementation!==S.implementation?(y=ed(S,g.mode,k),y.return=g,y):(y=r(y,S.children||[]),y.return=g,y)}function u(g,y,S,k,b){return y===null||y.tag!==7?(y=Or(S,g.mode,k,b),y.return=g,y):(y=r(y,S),y.return=g,y)}function d(g,y,S){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Zu(""+y,g.mode,S),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Ha:return S=Rl(y.type,y.key,y.props,null,g.mode,S),S.ref=po(g,null,y),S.return=g,S;case as:return y=ed(y,g.mode,S),y.return=g,y;case Mi:var k=y._init;return d(g,k(y._payload),S)}if(Po(y)||lo(y))return y=Or(y,g.mode,S,null),y.return=g,y;nl(g,y)}return null}function h(g,y,S,k){var b=y!==null?y.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return b!==null?null:a(g,y,""+S,k);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Ha:return S.key===b?l(g,y,S,k):null;case as:return S.key===b?c(g,y,S,k):null;case Mi:return b=S._init,h(g,y,b(S._payload),k)}if(Po(S)||lo(S))return b!==null?null:u(g,y,S,k,null);nl(g,S)}return null}function p(g,y,S,k,b){if(typeof k=="string"&&k!==""||typeof k=="number")return g=g.get(S)||null,a(y,g,""+k,b);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Ha:return g=g.get(k.key===null?S:k.key)||null,l(y,g,k,b);case as:return g=g.get(k.key===null?S:k.key)||null,c(y,g,k,b);case Mi:var x=k._init;return p(g,y,S,x(k._payload),b)}if(Po(k)||lo(k))return g=g.get(S)||null,u(y,g,k,b,null);nl(y,k)}return null}function m(g,y,S,k){for(var b=null,x=null,E=y,P=y=0,A=null;E!==null&&P<S.length;P++){E.index>P?(A=E,E=null):A=E.sibling;var O=h(g,E,S[P],k);if(O===null){E===null&&(E=A);break}t&&E&&O.alternate===null&&e(g,E),y=s(O,y,P),x===null?b=O:x.sibling=O,x=O,E=A}if(P===S.length)return n(g,E),Ve&&Sr(g,P),b;if(E===null){for(;P<S.length;P++)E=d(g,S[P],k),E!==null&&(y=s(E,y,P),x===null?b=E:x.sibling=E,x=E);return Ve&&Sr(g,P),b}for(E=i(g,E);P<S.length;P++)A=p(E,g,P,S[P],k),A!==null&&(t&&A.alternate!==null&&E.delete(A.key===null?P:A.key),y=s(A,y,P),x===null?b=A:x.sibling=A,x=A);return t&&E.forEach(function(W){return e(g,W)}),Ve&&Sr(g,P),b}function v(g,y,S,k){var b=lo(S);if(typeof b!="function")throw Error(F(150));if(S=b.call(S),S==null)throw Error(F(151));for(var x=b=null,E=y,P=y=0,A=null,O=S.next();E!==null&&!O.done;P++,O=S.next()){E.index>P?(A=E,E=null):A=E.sibling;var W=h(g,E,O.value,k);if(W===null){E===null&&(E=A);break}t&&E&&W.alternate===null&&e(g,E),y=s(W,y,P),x===null?b=W:x.sibling=W,x=W,E=A}if(O.done)return n(g,E),Ve&&Sr(g,P),b;if(E===null){for(;!O.done;P++,O=S.next())O=d(g,O.value,k),O!==null&&(y=s(O,y,P),x===null?b=O:x.sibling=O,x=O);return Ve&&Sr(g,P),b}for(E=i(g,E);!O.done;P++,O=S.next())O=p(E,g,P,O.value,k),O!==null&&(t&&O.alternate!==null&&E.delete(O.key===null?P:O.key),y=s(O,y,P),x===null?b=O:x.sibling=O,x=O);return t&&E.forEach(function(J){return e(g,J)}),Ve&&Sr(g,P),b}function T(g,y,S,k){if(typeof S=="object"&&S!==null&&S.type===ls&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Ha:e:{for(var b=S.key,x=y;x!==null;){if(x.key===b){if(b=S.type,b===ls){if(x.tag===7){n(g,x.sibling),y=r(x,S.props.children),y.return=g,g=y;break e}}else if(x.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Mi&&yg(b)===x.type){n(g,x.sibling),y=r(x,S.props),y.ref=po(g,x,S),y.return=g,g=y;break e}n(g,x);break}else e(g,x);x=x.sibling}S.type===ls?(y=Or(S.props.children,g.mode,k,S.key),y.return=g,g=y):(k=Rl(S.type,S.key,S.props,null,g.mode,k),k.ref=po(g,y,S),k.return=g,g=k)}return o(g);case as:e:{for(x=S.key;y!==null;){if(y.key===x)if(y.tag===4&&y.stateNode.containerInfo===S.containerInfo&&y.stateNode.implementation===S.implementation){n(g,y.sibling),y=r(y,S.children||[]),y.return=g,g=y;break e}else{n(g,y);break}else e(g,y);y=y.sibling}y=ed(S,g.mode,k),y.return=g,g=y}return o(g);case Mi:return x=S._init,T(g,y,x(S._payload),k)}if(Po(S))return m(g,y,S,k);if(lo(S))return v(g,y,S,k);nl(g,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,y!==null&&y.tag===6?(n(g,y.sibling),y=r(y,S),y.return=g,g=y):(n(g,y),y=Zu(S,g.mode,k),y.return=g,g=y),o(g)):n(g,y)}return T}var zs=Fk(!0),Bk=Fk(!1),oc=dr(null),ac=null,gs=null,Jf=null;function Qf(){Jf=gs=ac=null}function Yf(t){var e=oc.current;Be(oc),t._currentValue=e}function gh(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Is(t,e){ac=t,Jf=gs=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Kt=!0),t.firstContext=null)}function Tn(t){var e=t._currentValue;if(Jf!==t)if(t={context:t,memoizedValue:e,next:null},gs===null){if(ac===null)throw Error(F(308));gs=t,ac.dependencies={lanes:0,firstContext:t}}else gs=gs.next=t;return e}var Rr=null;function Xf(t){Rr===null?Rr=[t]:Rr.push(t)}function Vk(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Xf(e)):(n.next=r.next,r.next=n),e.interleaved=n,Ci(t,i)}function Ci(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Li=!1;function Zf(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zk(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function yi(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ji(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Ce&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Ci(t,n)}return r=i.interleaved,r===null?(e.next=e,Xf(i)):(e.next=r.next,r.next=e),i.interleaved=e,Ci(t,n)}function Tl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Uf(t,n)}}function kg(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function lc(t,e,n,i){var r=t.updateQueue;Li=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=r.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,p=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,v=a;switch(h=e,p=n,v.tag){case 1:if(m=v.payload,typeof m=="function"){d=m.call(p,d,h);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=v.payload,h=typeof m=="function"?m.call(p,d,h):m,h==null)break e;d=Ke({},d,h);break e;case 2:Li=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=d):u=u.next=p,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Fr|=o,t.lanes=o,t.memoizedState=d}}function Sg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(F(191,r));r.call(i)}}}var Ia={},Zn=dr(Ia),ca=dr(Ia),ua=dr(Ia);function _r(t){if(t===Ia)throw Error(F(174));return t}function ep(t,e){switch(Le(ua,e),Le(ca,t),Le(Zn,Ia),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Qd(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Qd(e,t)}Be(Zn),Le(Zn,e)}function Ws(){Be(Zn),Be(ca),Be(ua)}function Wk(t){_r(ua.current);var e=_r(Zn.current),n=Qd(e,t.type);e!==n&&(Le(ca,t),Le(Zn,n))}function tp(t){ca.current===t&&(Be(Zn),Be(ca))}var qe=dr(0);function cc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ku=[];function np(){for(var t=0;t<Ku.length;t++)Ku[t]._workInProgressVersionPrimary=null;Ku.length=0}var Cl=Pi.ReactCurrentDispatcher,Gu=Pi.ReactCurrentBatchConfig,Ur=0,$e=null,ht=null,gt=null,uc=!1,Fo=!1,da=0,WE=0;function _t(){throw Error(F(321))}function ip(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Fn(t[n],e[n]))return!1;return!0}function rp(t,e,n,i,r,s){if(Ur=s,$e=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Cl.current=t===null||t.memoizedState===null?KE:GE,t=n(i,r),Fo){s=0;do{if(Fo=!1,da=0,25<=s)throw Error(F(301));s+=1,gt=ht=null,e.updateQueue=null,Cl.current=JE,t=n(i,r)}while(Fo)}if(Cl.current=dc,e=ht!==null&&ht.next!==null,Ur=0,gt=ht=$e=null,uc=!1,e)throw Error(F(300));return t}function sp(){var t=da!==0;return da=0,t}function Jn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?$e.memoizedState=gt=t:gt=gt.next=t,gt}function Cn(){if(ht===null){var t=$e.alternate;t=t!==null?t.memoizedState:null}else t=ht.next;var e=gt===null?$e.memoizedState:gt.next;if(e!==null)gt=e,ht=t;else{if(t===null)throw Error(F(310));ht=t,t={memoizedState:ht.memoizedState,baseState:ht.baseState,baseQueue:ht.baseQueue,queue:ht.queue,next:null},gt===null?$e.memoizedState=gt=t:gt=gt.next=t}return gt}function ha(t,e){return typeof e=="function"?e(t):e}function Ju(t){var e=Cn(),n=e.queue;if(n===null)throw Error(F(311));n.lastRenderedReducer=t;var i=ht,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Ur&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=i):l=l.next=d,$e.lanes|=u,Fr|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,Fn(i,e.memoizedState)||(Kt=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,$e.lanes|=s,Fr|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Qu(t){var e=Cn(),n=e.queue;if(n===null)throw Error(F(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Fn(s,e.memoizedState)||(Kt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function qk(){}function Hk(t,e){var n=$e,i=Cn(),r=e(),s=!Fn(i.memoizedState,r);if(s&&(i.memoizedState=r,Kt=!0),i=i.queue,op(Gk.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||gt!==null&&gt.memoizedState.tag&1){if(n.flags|=2048,fa(9,Kk.bind(null,n,i,r,e),void 0,null),kt===null)throw Error(F(349));Ur&30||$k(n,e,r)}return r}function $k(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=$e.updateQueue,e===null?(e={lastEffect:null,stores:null},$e.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Kk(t,e,n,i){e.value=n,e.getSnapshot=i,Jk(e)&&Qk(t)}function Gk(t,e,n){return n(function(){Jk(e)&&Qk(t)})}function Jk(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Fn(t,n)}catch{return!0}}function Qk(t){var e=Ci(t,1);e!==null&&Un(e,t,1,-1)}function bg(t){var e=Jn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ha,lastRenderedState:t},e.queue=t,t=t.dispatch=$E.bind(null,$e,t),[e.memoizedState,t]}function fa(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=$e.updateQueue,e===null?(e={lastEffect:null,stores:null},$e.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Yk(){return Cn().memoizedState}function wl(t,e,n,i){var r=Jn();$e.flags|=t,r.memoizedState=fa(1|e,n,void 0,i===void 0?null:i)}function $c(t,e,n,i){var r=Cn();i=i===void 0?null:i;var s=void 0;if(ht!==null){var o=ht.memoizedState;if(s=o.destroy,i!==null&&ip(i,o.deps)){r.memoizedState=fa(e,n,s,i);return}}$e.flags|=t,r.memoizedState=fa(1|e,n,s,i)}function Tg(t,e){return wl(8390656,8,t,e)}function op(t,e){return $c(2048,8,t,e)}function Xk(t,e){return $c(4,2,t,e)}function Zk(t,e){return $c(4,4,t,e)}function eS(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function tS(t,e,n){return n=n!=null?n.concat([t]):null,$c(4,4,eS.bind(null,e,t),n)}function ap(){}function nS(t,e){var n=Cn();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&ip(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function iS(t,e){var n=Cn();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&ip(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function rS(t,e,n){return Ur&21?(Fn(n,e)||(n=ck(),$e.lanes|=n,Fr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Kt=!0),t.memoizedState=n)}function qE(t,e){var n=_e;_e=n!==0&&4>n?n:4,t(!0);var i=Gu.transition;Gu.transition={};try{t(!1),e()}finally{_e=n,Gu.transition=i}}function sS(){return Cn().memoizedState}function HE(t,e,n){var i=Yi(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},oS(t))aS(e,n);else if(n=Vk(t,e,n,i),n!==null){var r=Ft();Un(n,t,i,r),lS(n,e,i)}}function $E(t,e,n){var i=Yi(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(oS(t))aS(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Fn(a,o)){var l=e.interleaved;l===null?(r.next=r,Xf(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=Vk(t,e,r,i),n!==null&&(r=Ft(),Un(n,t,i,r),lS(n,e,i))}}function oS(t){var e=t.alternate;return t===$e||e!==null&&e===$e}function aS(t,e){Fo=uc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function lS(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Uf(t,n)}}var dc={readContext:Tn,useCallback:_t,useContext:_t,useEffect:_t,useImperativeHandle:_t,useInsertionEffect:_t,useLayoutEffect:_t,useMemo:_t,useReducer:_t,useRef:_t,useState:_t,useDebugValue:_t,useDeferredValue:_t,useTransition:_t,useMutableSource:_t,useSyncExternalStore:_t,useId:_t,unstable_isNewReconciler:!1},KE={readContext:Tn,useCallback:function(t,e){return Jn().memoizedState=[t,e===void 0?null:e],t},useContext:Tn,useEffect:Tg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,wl(4194308,4,eS.bind(null,e,t),n)},useLayoutEffect:function(t,e){return wl(4194308,4,t,e)},useInsertionEffect:function(t,e){return wl(4,2,t,e)},useMemo:function(t,e){var n=Jn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Jn();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=HE.bind(null,$e,t),[i.memoizedState,t]},useRef:function(t){var e=Jn();return t={current:t},e.memoizedState=t},useState:bg,useDebugValue:ap,useDeferredValue:function(t){return Jn().memoizedState=t},useTransition:function(){var t=bg(!1),e=t[0];return t=qE.bind(null,t[1]),Jn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=$e,r=Jn();if(Ve){if(n===void 0)throw Error(F(407));n=n()}else{if(n=e(),kt===null)throw Error(F(349));Ur&30||$k(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,Tg(Gk.bind(null,i,s,t),[t]),i.flags|=2048,fa(9,Kk.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Jn(),e=kt.identifierPrefix;if(Ve){var n=gi,i=mi;n=(i&~(1<<32-jn(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=da++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=WE++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},GE={readContext:Tn,useCallback:nS,useContext:Tn,useEffect:op,useImperativeHandle:tS,useInsertionEffect:Xk,useLayoutEffect:Zk,useMemo:iS,useReducer:Ju,useRef:Yk,useState:function(){return Ju(ha)},useDebugValue:ap,useDeferredValue:function(t){var e=Cn();return rS(e,ht.memoizedState,t)},useTransition:function(){var t=Ju(ha)[0],e=Cn().memoizedState;return[t,e]},useMutableSource:qk,useSyncExternalStore:Hk,useId:sS,unstable_isNewReconciler:!1},JE={readContext:Tn,useCallback:nS,useContext:Tn,useEffect:op,useImperativeHandle:tS,useInsertionEffect:Xk,useLayoutEffect:Zk,useMemo:iS,useReducer:Qu,useRef:Yk,useState:function(){return Qu(ha)},useDebugValue:ap,useDeferredValue:function(t){var e=Cn();return ht===null?e.memoizedState=t:rS(e,ht.memoizedState,t)},useTransition:function(){var t=Qu(ha)[0],e=Cn().memoizedState;return[t,e]},useMutableSource:qk,useSyncExternalStore:Hk,useId:sS,unstable_isNewReconciler:!1};function _n(t,e){if(t&&t.defaultProps){e=Ke({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function vh(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Ke({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Kc={isMounted:function(t){return(t=t._reactInternals)?Kr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ft(),r=Yi(t),s=yi(i,r);s.payload=e,n!=null&&(s.callback=n),e=Ji(t,s,r),e!==null&&(Un(e,t,r,i),Tl(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ft(),r=Yi(t),s=yi(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Ji(t,s,r),e!==null&&(Un(e,t,r,i),Tl(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ft(),i=Yi(t),r=yi(n,i);r.tag=2,e!=null&&(r.callback=e),e=Ji(t,r,i),e!==null&&(Un(e,t,i,n),Tl(e,t,i))}};function Cg(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!sa(n,i)||!sa(r,s):!0}function cS(t,e,n){var i=!1,r=sr,s=e.contextType;return typeof s=="object"&&s!==null?s=Tn(s):(r=Qt(e)?Lr:Dt.current,i=e.contextTypes,s=(i=i!=null)?Bs(t,r):sr),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Kc,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function wg(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Kc.enqueueReplaceState(e,e.state,null)}function yh(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Zf(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Tn(s):(s=Qt(e)?Lr:Dt.current,r.context=Bs(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(vh(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Kc.enqueueReplaceState(r,r.state,null),lc(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function qs(t,e){try{var n="",i=e;do n+=Cx(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Yu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function kh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var QE=typeof WeakMap=="function"?WeakMap:Map;function uS(t,e,n){n=yi(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){fc||(fc=!0,_h=i),kh(t,e)},n}function dS(t,e,n){n=yi(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){kh(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){kh(t,e),typeof i!="function"&&(Qi===null?Qi=new Set([this]):Qi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function xg(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new QE;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=uP.bind(null,t,e,n),e.then(t,t))}function Eg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Pg(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=yi(-1,1),e.tag=2,Ji(n,e,1))),n.lanes|=1),t)}var YE=Pi.ReactCurrentOwner,Kt=!1;function Lt(t,e,n,i){e.child=t===null?Bk(e,null,n,i):zs(e,t.child,n,i)}function Rg(t,e,n,i,r){n=n.render;var s=e.ref;return Is(e,r),i=rp(t,e,n,i,s,r),n=sp(),t!==null&&!Kt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wi(t,e,r)):(Ve&&n&&$f(e),e.flags|=1,Lt(t,e,i,r),e.child)}function _g(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!mp(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,hS(t,e,s,i,r)):(t=Rl(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:sa,n(o,i)&&t.ref===e.ref)return wi(t,e,r)}return e.flags|=1,t=Xi(s,i),t.ref=e.ref,t.return=e,e.child=t}function hS(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(sa(s,i)&&t.ref===e.ref)if(Kt=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(Kt=!0);else return e.lanes=t.lanes,wi(t,e,r)}return Sh(t,e,n,i,r)}function fS(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Le(ys,nn),nn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Le(ys,nn),nn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,Le(ys,nn),nn|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,Le(ys,nn),nn|=i;return Lt(t,e,r,n),e.child}function pS(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Sh(t,e,n,i,r){var s=Qt(n)?Lr:Dt.current;return s=Bs(e,s),Is(e,r),n=rp(t,e,n,i,s,r),i=sp(),t!==null&&!Kt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wi(t,e,r)):(Ve&&i&&$f(e),e.flags|=1,Lt(t,e,n,r),e.child)}function Ig(t,e,n,i,r){if(Qt(n)){var s=!0;ic(e)}else s=!1;if(Is(e,r),e.stateNode===null)xl(t,e),cS(e,n,i),yh(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=Tn(c):(c=Qt(n)?Lr:Dt.current,c=Bs(e,c));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&wg(e,o,i,c),Li=!1;var h=e.memoizedState;o.state=h,lc(e,i,o,r),l=e.memoizedState,a!==i||h!==l||Jt.current||Li?(typeof u=="function"&&(vh(e,n,u,i),l=e.memoizedState),(a=Li||Cg(e,n,a,i,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,zk(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:_n(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Tn(l):(l=Qt(n)?Lr:Dt.current,l=Bs(e,l));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&wg(e,o,i,l),Li=!1,h=e.memoizedState,o.state=h,lc(e,i,o,r);var m=e.memoizedState;a!==d||h!==m||Jt.current||Li?(typeof p=="function"&&(vh(e,n,p,i),m=e.memoizedState),(c=Li||Cg(e,n,c,i,h,m,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=m),o.props=i,o.state=m,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return bh(t,e,n,i,s,r)}function bh(t,e,n,i,r,s){pS(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&mg(e,n,!1),wi(t,e,s);i=e.stateNode,YE.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=zs(e,t.child,null,s),e.child=zs(e,null,a,s)):Lt(t,e,a,s),e.memoizedState=i.state,r&&mg(e,n,!0),e.child}function mS(t){var e=t.stateNode;e.pendingContext?pg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&pg(t,e.context,!1),ep(t,e.containerInfo)}function Ag(t,e,n,i,r){return Vs(),Gf(r),e.flags|=256,Lt(t,e,n,i),e.child}var Th={dehydrated:null,treeContext:null,retryLane:0};function Ch(t){return{baseLanes:t,cachePool:null,transitions:null}}function gS(t,e,n){var i=e.pendingProps,r=qe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Le(qe,r&1),t===null)return mh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Qc(o,i,0,null),t=Or(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Ch(n),e.memoizedState=Th,t):lp(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return XE(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Xi(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Xi(a,s):(s=Or(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Ch(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Th,i}return s=t.child,t=s.sibling,i=Xi(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function lp(t,e){return e=Qc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function il(t,e,n,i){return i!==null&&Gf(i),zs(e,t.child,null,n),t=lp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function XE(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Yu(Error(F(422))),il(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Qc({mode:"visible",children:i.children},r,0,null),s=Or(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&zs(e,t.child,null,o),e.child.memoizedState=Ch(o),e.memoizedState=Th,s);if(!(e.mode&1))return il(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(F(419)),i=Yu(s,i,void 0),il(t,e,o,i)}if(a=(o&t.childLanes)!==0,Kt||a){if(i=kt,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Ci(t,r),Un(i,t,r,-1))}return pp(),i=Yu(Error(F(421))),il(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=dP.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,rn=Gi(r.nextSibling),on=e,Ve=!0,Nn=null,t!==null&&(vn[yn++]=mi,vn[yn++]=gi,vn[yn++]=jr,mi=t.id,gi=t.overflow,jr=e),e=lp(e,i.children),e.flags|=4096,e)}function Ng(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),gh(t.return,e,n)}function Xu(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function vS(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Lt(t,e,i.children,n),i=qe.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ng(t,n,e);else if(t.tag===19)Ng(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Le(qe,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&cc(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Xu(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&cc(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Xu(e,!0,n,null,s);break;case"together":Xu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function xl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function wi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Fr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(F(153));if(e.child!==null){for(t=e.child,n=Xi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Xi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function ZE(t,e,n){switch(e.tag){case 3:mS(e),Vs();break;case 5:Wk(e);break;case 1:Qt(e.type)&&ic(e);break;case 4:ep(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Le(oc,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Le(qe,qe.current&1),e.flags|=128,null):n&e.child.childLanes?gS(t,e,n):(Le(qe,qe.current&1),t=wi(t,e,n),t!==null?t.sibling:null);Le(qe,qe.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return vS(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Le(qe,qe.current),i)break;return null;case 22:case 23:return e.lanes=0,fS(t,e,n)}return wi(t,e,n)}var yS,wh,kS,SS;yS=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};wh=function(){};kS=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,_r(Zn.current);var s=null;switch(n){case"input":r=$d(t,r),i=$d(t,i),s=[];break;case"select":r=Ke({},r,{value:void 0}),i=Ke({},i,{value:void 0}),s=[];break;case"textarea":r=Jd(t,r),i=Jd(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=tc)}Yd(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Xo.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Xo.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Ue("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};SS=function(t,e,n,i){n!==i&&(e.flags|=4)};function mo(t,e){if(!Ve)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function It(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function eP(t,e,n){var i=e.pendingProps;switch(Kf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return It(e),null;case 1:return Qt(e.type)&&nc(),It(e),null;case 3:return i=e.stateNode,Ws(),Be(Jt),Be(Dt),np(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(tl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Nn!==null&&(Nh(Nn),Nn=null))),wh(t,e),It(e),null;case 5:tp(e);var r=_r(ua.current);if(n=e.type,t!==null&&e.stateNode!=null)kS(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(F(166));return It(e),null}if(t=_r(Zn.current),tl(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Yn]=e,i[la]=s,t=(e.mode&1)!==0,n){case"dialog":Ue("cancel",i),Ue("close",i);break;case"iframe":case"object":case"embed":Ue("load",i);break;case"video":case"audio":for(r=0;r<_o.length;r++)Ue(_o[r],i);break;case"source":Ue("error",i);break;case"img":case"image":case"link":Ue("error",i),Ue("load",i);break;case"details":Ue("toggle",i);break;case"input":Vm(i,s),Ue("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Ue("invalid",i);break;case"textarea":Wm(i,s),Ue("invalid",i)}Yd(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&el(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&el(i.textContent,a,t),r=["children",""+a]):Xo.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ue("scroll",i)}switch(n){case"input":$a(i),zm(i,s,!0);break;case"textarea":$a(i),qm(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=tc)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=G0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Yn]=e,t[la]=i,yS(t,e,!1,!1),e.stateNode=t;e:{switch(o=Xd(n,i),n){case"dialog":Ue("cancel",t),Ue("close",t),r=i;break;case"iframe":case"object":case"embed":Ue("load",t),r=i;break;case"video":case"audio":for(r=0;r<_o.length;r++)Ue(_o[r],t);r=i;break;case"source":Ue("error",t),r=i;break;case"img":case"image":case"link":Ue("error",t),Ue("load",t),r=i;break;case"details":Ue("toggle",t),r=i;break;case"input":Vm(t,i),r=$d(t,i),Ue("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=Ke({},i,{value:void 0}),Ue("invalid",t);break;case"textarea":Wm(t,i),r=Jd(t,i),Ue("invalid",t);break;default:r=i}Yd(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Y0(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&J0(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Zo(t,l):typeof l=="number"&&Zo(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Xo.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Ue("scroll",t):l!=null&&Nf(t,s,l,o))}switch(n){case"input":$a(t),zm(t,i,!1);break;case"textarea":$a(t),qm(t);break;case"option":i.value!=null&&t.setAttribute("value",""+rr(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Es(t,!!i.multiple,s,!1):i.defaultValue!=null&&Es(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=tc)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return It(e),null;case 6:if(t&&e.stateNode!=null)SS(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(F(166));if(n=_r(ua.current),_r(Zn.current),tl(e)){if(i=e.stateNode,n=e.memoizedProps,i[Yn]=e,(s=i.nodeValue!==n)&&(t=on,t!==null))switch(t.tag){case 3:el(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&el(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Yn]=e,e.stateNode=i}return It(e),null;case 13:if(Be(qe),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ve&&rn!==null&&e.mode&1&&!(e.flags&128))Uk(),Vs(),e.flags|=98560,s=!1;else if(s=tl(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(F(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(F(317));s[Yn]=e}else Vs(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;It(e),s=!1}else Nn!==null&&(Nh(Nn),Nn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||qe.current&1?pt===0&&(pt=3):pp())),e.updateQueue!==null&&(e.flags|=4),It(e),null);case 4:return Ws(),wh(t,e),t===null&&oa(e.stateNode.containerInfo),It(e),null;case 10:return Yf(e.type._context),It(e),null;case 17:return Qt(e.type)&&nc(),It(e),null;case 19:if(Be(qe),s=e.memoizedState,s===null)return It(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)mo(s,!1);else{if(pt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=cc(t),o!==null){for(e.flags|=128,mo(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Le(qe,qe.current&1|2),e.child}t=t.sibling}s.tail!==null&&et()>Hs&&(e.flags|=128,i=!0,mo(s,!1),e.lanes=4194304)}else{if(!i)if(t=cc(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),mo(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Ve)return It(e),null}else 2*et()-s.renderingStartTime>Hs&&n!==1073741824&&(e.flags|=128,i=!0,mo(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=et(),e.sibling=null,n=qe.current,Le(qe,i?n&1|2:n&1),e):(It(e),null);case 22:case 23:return fp(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?nn&1073741824&&(It(e),e.subtreeFlags&6&&(e.flags|=8192)):It(e),null;case 24:return null;case 25:return null}throw Error(F(156,e.tag))}function tP(t,e){switch(Kf(e),e.tag){case 1:return Qt(e.type)&&nc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ws(),Be(Jt),Be(Dt),np(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return tp(e),null;case 13:if(Be(qe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(F(340));Vs()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Be(qe),null;case 4:return Ws(),null;case 10:return Yf(e.type._context),null;case 22:case 23:return fp(),null;case 24:return null;default:return null}}var rl=!1,Nt=!1,nP=typeof WeakSet=="function"?WeakSet:Set,Y=null;function vs(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Je(t,e,i)}else n.current=null}function xh(t,e,n){try{n()}catch(i){Je(t,e,i)}}var Og=!1;function iP(t,e){if(lh=Xl,t=xk(),Hf(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,h=null;t:for(;;){for(var p;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(l=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)h=d,d=p;for(;;){if(d===t)break t;if(h===n&&++c===r&&(a=o),h===s&&++u===i&&(l=o),(p=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ch={focusedElem:t,selectionRange:n},Xl=!1,Y=e;Y!==null;)if(e=Y,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Y=t;else for(;Y!==null;){e=Y;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var v=m.memoizedProps,T=m.memoizedState,g=e.stateNode,y=g.getSnapshotBeforeUpdate(e.elementType===e.type?v:_n(e.type,v),T);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(F(163))}}catch(k){Je(e,e.return,k)}if(t=e.sibling,t!==null){t.return=e.return,Y=t;break}Y=e.return}return m=Og,Og=!1,m}function Bo(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&xh(e,n,s)}r=r.next}while(r!==i)}}function Gc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Eh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function bS(t){var e=t.alternate;e!==null&&(t.alternate=null,bS(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Yn],delete e[la],delete e[hh],delete e[FE],delete e[BE])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function TS(t){return t.tag===5||t.tag===3||t.tag===4}function Dg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||TS(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ph(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=tc));else if(i!==4&&(t=t.child,t!==null))for(Ph(t,e,n),t=t.sibling;t!==null;)Ph(t,e,n),t=t.sibling}function Rh(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Rh(t,e,n),t=t.sibling;t!==null;)Rh(t,e,n),t=t.sibling}var Ct=null,In=!1;function Ii(t,e,n){for(n=n.child;n!==null;)CS(t,e,n),n=n.sibling}function CS(t,e,n){if(Xn&&typeof Xn.onCommitFiberUnmount=="function")try{Xn.onCommitFiberUnmount(Bc,n)}catch{}switch(n.tag){case 5:Nt||vs(n,e);case 6:var i=Ct,r=In;Ct=null,Ii(t,e,n),Ct=i,In=r,Ct!==null&&(In?(t=Ct,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ct.removeChild(n.stateNode));break;case 18:Ct!==null&&(In?(t=Ct,n=n.stateNode,t.nodeType===8?Hu(t.parentNode,n):t.nodeType===1&&Hu(t,n),ia(t)):Hu(Ct,n.stateNode));break;case 4:i=Ct,r=In,Ct=n.stateNode.containerInfo,In=!0,Ii(t,e,n),Ct=i,In=r;break;case 0:case 11:case 14:case 15:if(!Nt&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&xh(n,e,o),r=r.next}while(r!==i)}Ii(t,e,n);break;case 1:if(!Nt&&(vs(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Je(n,e,a)}Ii(t,e,n);break;case 21:Ii(t,e,n);break;case 22:n.mode&1?(Nt=(i=Nt)||n.memoizedState!==null,Ii(t,e,n),Nt=i):Ii(t,e,n);break;default:Ii(t,e,n)}}function Mg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new nP),e.forEach(function(i){var r=hP.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Pn(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ct=a.stateNode,In=!1;break e;case 3:Ct=a.stateNode.containerInfo,In=!0;break e;case 4:Ct=a.stateNode.containerInfo,In=!0;break e}a=a.return}if(Ct===null)throw Error(F(160));CS(s,o,r),Ct=null,In=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Je(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)wS(e,t),e=e.sibling}function wS(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Pn(e,t),Hn(t),i&4){try{Bo(3,t,t.return),Gc(3,t)}catch(v){Je(t,t.return,v)}try{Bo(5,t,t.return)}catch(v){Je(t,t.return,v)}}break;case 1:Pn(e,t),Hn(t),i&512&&n!==null&&vs(n,n.return);break;case 5:if(Pn(e,t),Hn(t),i&512&&n!==null&&vs(n,n.return),t.flags&32){var r=t.stateNode;try{Zo(r,"")}catch(v){Je(t,t.return,v)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&$0(r,s),Xd(a,o);var c=Xd(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?Y0(r,d):u==="dangerouslySetInnerHTML"?J0(r,d):u==="children"?Zo(r,d):Nf(r,u,d,c)}switch(a){case"input":Kd(r,s);break;case"textarea":K0(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Es(r,!!s.multiple,p,!1):h!==!!s.multiple&&(s.defaultValue!=null?Es(r,!!s.multiple,s.defaultValue,!0):Es(r,!!s.multiple,s.multiple?[]:"",!1))}r[la]=s}catch(v){Je(t,t.return,v)}}break;case 6:if(Pn(e,t),Hn(t),i&4){if(t.stateNode===null)throw Error(F(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(v){Je(t,t.return,v)}}break;case 3:if(Pn(e,t),Hn(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{ia(e.containerInfo)}catch(v){Je(t,t.return,v)}break;case 4:Pn(e,t),Hn(t);break;case 13:Pn(e,t),Hn(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(dp=et())),i&4&&Mg(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Nt=(c=Nt)||u,Pn(e,t),Nt=c):Pn(e,t),Hn(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(Y=t,u=t.child;u!==null;){for(d=Y=u;Y!==null;){switch(h=Y,p=h.child,h.tag){case 0:case 11:case 14:case 15:Bo(4,h,h.return);break;case 1:vs(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(v){Je(i,n,v)}}break;case 5:vs(h,h.return);break;case 22:if(h.memoizedState!==null){jg(d);continue}}p!==null?(p.return=h,Y=p):jg(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Q0("display",o))}catch(v){Je(t,t.return,v)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(v){Je(t,t.return,v)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Pn(e,t),Hn(t),i&4&&Mg(t);break;case 21:break;default:Pn(e,t),Hn(t)}}function Hn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(TS(n)){var i=n;break e}n=n.return}throw Error(F(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Zo(r,""),i.flags&=-33);var s=Dg(t);Rh(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Dg(t);Ph(t,a,o);break;default:throw Error(F(161))}}catch(l){Je(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function rP(t,e,n){Y=t,xS(t)}function xS(t,e,n){for(var i=(t.mode&1)!==0;Y!==null;){var r=Y,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||rl;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Nt;a=rl;var c=Nt;if(rl=o,(Nt=l)&&!c)for(Y=r;Y!==null;)o=Y,l=o.child,o.tag===22&&o.memoizedState!==null?Ug(r):l!==null?(l.return=o,Y=l):Ug(r);for(;s!==null;)Y=s,xS(s),s=s.sibling;Y=r,rl=a,Nt=c}Lg(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Y=s):Lg(t)}}function Lg(t){for(;Y!==null;){var e=Y;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Nt||Gc(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Nt)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:_n(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Sg(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Sg(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&ia(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(F(163))}Nt||e.flags&512&&Eh(e)}catch(h){Je(e,e.return,h)}}if(e===t){Y=null;break}if(n=e.sibling,n!==null){n.return=e.return,Y=n;break}Y=e.return}}function jg(t){for(;Y!==null;){var e=Y;if(e===t){Y=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Y=n;break}Y=e.return}}function Ug(t){for(;Y!==null;){var e=Y;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Gc(4,e)}catch(l){Je(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){Je(e,r,l)}}var s=e.return;try{Eh(e)}catch(l){Je(e,s,l)}break;case 5:var o=e.return;try{Eh(e)}catch(l){Je(e,o,l)}}}catch(l){Je(e,e.return,l)}if(e===t){Y=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Y=a;break}Y=e.return}}var sP=Math.ceil,hc=Pi.ReactCurrentDispatcher,cp=Pi.ReactCurrentOwner,bn=Pi.ReactCurrentBatchConfig,Ce=0,kt=null,lt=null,Et=0,nn=0,ys=dr(0),pt=0,pa=null,Fr=0,Jc=0,up=0,Vo=null,Ht=null,dp=0,Hs=1/0,li=null,fc=!1,_h=null,Qi=null,sl=!1,zi=null,pc=0,zo=0,Ih=null,El=-1,Pl=0;function Ft(){return Ce&6?et():El!==-1?El:El=et()}function Yi(t){return t.mode&1?Ce&2&&Et!==0?Et&-Et:zE.transition!==null?(Pl===0&&(Pl=ck()),Pl):(t=_e,t!==0||(t=window.event,t=t===void 0?16:gk(t.type)),t):1}function Un(t,e,n,i){if(50<zo)throw zo=0,Ih=null,Error(F(185));Pa(t,n,i),(!(Ce&2)||t!==kt)&&(t===kt&&(!(Ce&2)&&(Jc|=n),pt===4&&Fi(t,Et)),Yt(t,i),n===1&&Ce===0&&!(e.mode&1)&&(Hs=et()+500,Hc&&hr()))}function Yt(t,e){var n=t.callbackNode;zx(t,e);var i=Yl(t,t===kt?Et:0);if(i===0)n!==null&&Km(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Km(n),e===1)t.tag===0?VE(Fg.bind(null,t)):Mk(Fg.bind(null,t)),jE(function(){!(Ce&6)&&hr()}),n=null;else{switch(uk(i)){case 1:n=jf;break;case 4:n=ak;break;case 16:n=Ql;break;case 536870912:n=lk;break;default:n=Ql}n=OS(n,ES.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function ES(t,e){if(El=-1,Pl=0,Ce&6)throw Error(F(327));var n=t.callbackNode;if(As()&&t.callbackNode!==n)return null;var i=Yl(t,t===kt?Et:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=mc(t,i);else{e=i;var r=Ce;Ce|=2;var s=RS();(kt!==t||Et!==e)&&(li=null,Hs=et()+500,Nr(t,e));do try{lP();break}catch(a){PS(t,a)}while(!0);Qf(),hc.current=s,Ce=r,lt!==null?e=0:(kt=null,Et=0,e=pt)}if(e!==0){if(e===2&&(r=ih(t),r!==0&&(i=r,e=Ah(t,r))),e===1)throw n=pa,Nr(t,0),Fi(t,i),Yt(t,et()),n;if(e===6)Fi(t,i);else{if(r=t.current.alternate,!(i&30)&&!oP(r)&&(e=mc(t,i),e===2&&(s=ih(t),s!==0&&(i=s,e=Ah(t,s))),e===1))throw n=pa,Nr(t,0),Fi(t,i),Yt(t,et()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(F(345));case 2:br(t,Ht,li);break;case 3:if(Fi(t,i),(i&130023424)===i&&(e=dp+500-et(),10<e)){if(Yl(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Ft(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=dh(br.bind(null,t,Ht,li),e);break}br(t,Ht,li);break;case 4:if(Fi(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-jn(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=et()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*sP(i/1960))-i,10<i){t.timeoutHandle=dh(br.bind(null,t,Ht,li),i);break}br(t,Ht,li);break;case 5:br(t,Ht,li);break;default:throw Error(F(329))}}}return Yt(t,et()),t.callbackNode===n?ES.bind(null,t):null}function Ah(t,e){var n=Vo;return t.current.memoizedState.isDehydrated&&(Nr(t,e).flags|=256),t=mc(t,e),t!==2&&(e=Ht,Ht=n,e!==null&&Nh(e)),t}function Nh(t){Ht===null?Ht=t:Ht.push.apply(Ht,t)}function oP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Fn(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fi(t,e){for(e&=~up,e&=~Jc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-jn(e),i=1<<n;t[n]=-1,e&=~i}}function Fg(t){if(Ce&6)throw Error(F(327));As();var e=Yl(t,0);if(!(e&1))return Yt(t,et()),null;var n=mc(t,e);if(t.tag!==0&&n===2){var i=ih(t);i!==0&&(e=i,n=Ah(t,i))}if(n===1)throw n=pa,Nr(t,0),Fi(t,e),Yt(t,et()),n;if(n===6)throw Error(F(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,br(t,Ht,li),Yt(t,et()),null}function hp(t,e){var n=Ce;Ce|=1;try{return t(e)}finally{Ce=n,Ce===0&&(Hs=et()+500,Hc&&hr())}}function Br(t){zi!==null&&zi.tag===0&&!(Ce&6)&&As();var e=Ce;Ce|=1;var n=bn.transition,i=_e;try{if(bn.transition=null,_e=1,t)return t()}finally{_e=i,bn.transition=n,Ce=e,!(Ce&6)&&hr()}}function fp(){nn=ys.current,Be(ys)}function Nr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,LE(n)),lt!==null)for(n=lt.return;n!==null;){var i=n;switch(Kf(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&nc();break;case 3:Ws(),Be(Jt),Be(Dt),np();break;case 5:tp(i);break;case 4:Ws();break;case 13:Be(qe);break;case 19:Be(qe);break;case 10:Yf(i.type._context);break;case 22:case 23:fp()}n=n.return}if(kt=t,lt=t=Xi(t.current,null),Et=nn=e,pt=0,pa=null,up=Jc=Fr=0,Ht=Vo=null,Rr!==null){for(e=0;e<Rr.length;e++)if(n=Rr[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Rr=null}return t}function PS(t,e){do{var n=lt;try{if(Qf(),Cl.current=dc,uc){for(var i=$e.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}uc=!1}if(Ur=0,gt=ht=$e=null,Fo=!1,da=0,cp.current=null,n===null||n.return===null){pt=1,pa=e,lt=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Et,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=Eg(o);if(p!==null){p.flags&=-257,Pg(p,o,a,s,e),p.mode&1&&xg(s,c,e),e=p,l=c;var m=e.updateQueue;if(m===null){var v=new Set;v.add(l),e.updateQueue=v}else m.add(l);break e}else{if(!(e&1)){xg(s,c,e),pp();break e}l=Error(F(426))}}else if(Ve&&a.mode&1){var T=Eg(o);if(T!==null){!(T.flags&65536)&&(T.flags|=256),Pg(T,o,a,s,e),Gf(qs(l,a));break e}}s=l=qs(l,a),pt!==4&&(pt=2),Vo===null?Vo=[s]:Vo.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=uS(s,l,e);kg(s,g);break e;case 1:a=l;var y=s.type,S=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Qi===null||!Qi.has(S)))){s.flags|=65536,e&=-e,s.lanes|=e;var k=dS(s,a,e);kg(s,k);break e}}s=s.return}while(s!==null)}IS(n)}catch(b){e=b,lt===n&&n!==null&&(lt=n=n.return);continue}break}while(!0)}function RS(){var t=hc.current;return hc.current=dc,t===null?dc:t}function pp(){(pt===0||pt===3||pt===2)&&(pt=4),kt===null||!(Fr&268435455)&&!(Jc&268435455)||Fi(kt,Et)}function mc(t,e){var n=Ce;Ce|=2;var i=RS();(kt!==t||Et!==e)&&(li=null,Nr(t,e));do try{aP();break}catch(r){PS(t,r)}while(!0);if(Qf(),Ce=n,hc.current=i,lt!==null)throw Error(F(261));return kt=null,Et=0,pt}function aP(){for(;lt!==null;)_S(lt)}function lP(){for(;lt!==null&&!Ox();)_S(lt)}function _S(t){var e=NS(t.alternate,t,nn);t.memoizedProps=t.pendingProps,e===null?IS(t):lt=e,cp.current=null}function IS(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=tP(n,e),n!==null){n.flags&=32767,lt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{pt=6,lt=null;return}}else if(n=eP(n,e,nn),n!==null){lt=n;return}if(e=e.sibling,e!==null){lt=e;return}lt=e=t}while(e!==null);pt===0&&(pt=5)}function br(t,e,n){var i=_e,r=bn.transition;try{bn.transition=null,_e=1,cP(t,e,n,i)}finally{bn.transition=r,_e=i}return null}function cP(t,e,n,i){do As();while(zi!==null);if(Ce&6)throw Error(F(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(F(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(Wx(t,s),t===kt&&(lt=kt=null,Et=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||sl||(sl=!0,OS(Ql,function(){return As(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=bn.transition,bn.transition=null;var o=_e;_e=1;var a=Ce;Ce|=4,cp.current=null,iP(t,n),wS(n,t),_E(ch),Xl=!!lh,ch=lh=null,t.current=n,rP(n),Dx(),Ce=a,_e=o,bn.transition=s}else t.current=n;if(sl&&(sl=!1,zi=t,pc=r),s=t.pendingLanes,s===0&&(Qi=null),jx(n.stateNode),Yt(t,et()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(fc)throw fc=!1,t=_h,_h=null,t;return pc&1&&t.tag!==0&&As(),s=t.pendingLanes,s&1?t===Ih?zo++:(zo=0,Ih=t):zo=0,hr(),null}function As(){if(zi!==null){var t=uk(pc),e=bn.transition,n=_e;try{if(bn.transition=null,_e=16>t?16:t,zi===null)var i=!1;else{if(t=zi,zi=null,pc=0,Ce&6)throw Error(F(331));var r=Ce;for(Ce|=4,Y=t.current;Y!==null;){var s=Y,o=s.child;if(Y.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Y=c;Y!==null;){var u=Y;switch(u.tag){case 0:case 11:case 15:Bo(8,u,s)}var d=u.child;if(d!==null)d.return=u,Y=d;else for(;Y!==null;){u=Y;var h=u.sibling,p=u.return;if(bS(u),u===c){Y=null;break}if(h!==null){h.return=p,Y=h;break}Y=p}}}var m=s.alternate;if(m!==null){var v=m.child;if(v!==null){m.child=null;do{var T=v.sibling;v.sibling=null,v=T}while(v!==null)}}Y=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Y=o;else e:for(;Y!==null;){if(s=Y,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Bo(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,Y=g;break e}Y=s.return}}var y=t.current;for(Y=y;Y!==null;){o=Y;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,Y=S;else e:for(o=y;Y!==null;){if(a=Y,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Gc(9,a)}}catch(b){Je(a,a.return,b)}if(a===o){Y=null;break e}var k=a.sibling;if(k!==null){k.return=a.return,Y=k;break e}Y=a.return}}if(Ce=r,hr(),Xn&&typeof Xn.onPostCommitFiberRoot=="function")try{Xn.onPostCommitFiberRoot(Bc,t)}catch{}i=!0}return i}finally{_e=n,bn.transition=e}}return!1}function Bg(t,e,n){e=qs(n,e),e=uS(t,e,1),t=Ji(t,e,1),e=Ft(),t!==null&&(Pa(t,1,e),Yt(t,e))}function Je(t,e,n){if(t.tag===3)Bg(t,t,n);else for(;e!==null;){if(e.tag===3){Bg(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Qi===null||!Qi.has(i))){t=qs(n,t),t=dS(e,t,1),e=Ji(e,t,1),t=Ft(),e!==null&&(Pa(e,1,t),Yt(e,t));break}}e=e.return}}function uP(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Ft(),t.pingedLanes|=t.suspendedLanes&n,kt===t&&(Et&n)===n&&(pt===4||pt===3&&(Et&130023424)===Et&&500>et()-dp?Nr(t,0):up|=n),Yt(t,e)}function AS(t,e){e===0&&(t.mode&1?(e=Ja,Ja<<=1,!(Ja&130023424)&&(Ja=4194304)):e=1);var n=Ft();t=Ci(t,e),t!==null&&(Pa(t,e,n),Yt(t,n))}function dP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),AS(t,n)}function hP(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(F(314))}i!==null&&i.delete(e),AS(t,n)}var NS;NS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Jt.current)Kt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Kt=!1,ZE(t,e,n);Kt=!!(t.flags&131072)}else Kt=!1,Ve&&e.flags&1048576&&Lk(e,sc,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;xl(t,e),t=e.pendingProps;var r=Bs(e,Dt.current);Is(e,n),r=rp(null,e,i,t,r,n);var s=sp();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qt(i)?(s=!0,ic(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Zf(e),r.updater=Kc,e.stateNode=r,r._reactInternals=e,yh(e,i,t,n),e=bh(null,e,i,!0,s,n)):(e.tag=0,Ve&&s&&$f(e),Lt(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(xl(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=pP(i),t=_n(i,t),r){case 0:e=Sh(null,e,i,t,n);break e;case 1:e=Ig(null,e,i,t,n);break e;case 11:e=Rg(null,e,i,t,n);break e;case 14:e=_g(null,e,i,_n(i.type,t),n);break e}throw Error(F(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:_n(i,r),Sh(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:_n(i,r),Ig(t,e,i,r,n);case 3:e:{if(mS(e),t===null)throw Error(F(387));i=e.pendingProps,s=e.memoizedState,r=s.element,zk(t,e),lc(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=qs(Error(F(423)),e),e=Ag(t,e,i,n,r);break e}else if(i!==r){r=qs(Error(F(424)),e),e=Ag(t,e,i,n,r);break e}else for(rn=Gi(e.stateNode.containerInfo.firstChild),on=e,Ve=!0,Nn=null,n=Bk(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Vs(),i===r){e=wi(t,e,n);break e}Lt(t,e,i,n)}e=e.child}return e;case 5:return Wk(e),t===null&&mh(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,uh(i,r)?o=null:s!==null&&uh(i,s)&&(e.flags|=32),pS(t,e),Lt(t,e,o,n),e.child;case 6:return t===null&&mh(e),null;case 13:return gS(t,e,n);case 4:return ep(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=zs(e,null,i,n):Lt(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:_n(i,r),Rg(t,e,i,r,n);case 7:return Lt(t,e,e.pendingProps,n),e.child;case 8:return Lt(t,e,e.pendingProps.children,n),e.child;case 12:return Lt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Le(oc,i._currentValue),i._currentValue=o,s!==null)if(Fn(s.value,o)){if(s.children===r.children&&!Jt.current){e=wi(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=yi(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),gh(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(F(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),gh(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Lt(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Is(e,n),r=Tn(r),i=i(r),e.flags|=1,Lt(t,e,i,n),e.child;case 14:return i=e.type,r=_n(i,e.pendingProps),r=_n(i.type,r),_g(t,e,i,r,n);case 15:return hS(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:_n(i,r),xl(t,e),e.tag=1,Qt(i)?(t=!0,ic(e)):t=!1,Is(e,n),cS(e,i,r),yh(e,i,r,n),bh(null,e,i,!0,t,n);case 19:return vS(t,e,n);case 22:return fS(t,e,n)}throw Error(F(156,e.tag))};function OS(t,e){return ok(t,e)}function fP(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kn(t,e,n,i){return new fP(t,e,n,i)}function mp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function pP(t){if(typeof t=="function")return mp(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Df)return 11;if(t===Mf)return 14}return 2}function Xi(t,e){var n=t.alternate;return n===null?(n=kn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Rl(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")mp(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case ls:return Or(n.children,r,s,e);case Of:o=8,r|=8;break;case zd:return t=kn(12,n,e,r|2),t.elementType=zd,t.lanes=s,t;case Wd:return t=kn(13,n,e,r),t.elementType=Wd,t.lanes=s,t;case qd:return t=kn(19,n,e,r),t.elementType=qd,t.lanes=s,t;case W0:return Qc(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case V0:o=10;break e;case z0:o=9;break e;case Df:o=11;break e;case Mf:o=14;break e;case Mi:o=16,i=null;break e}throw Error(F(130,t==null?t:typeof t,""))}return e=kn(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Or(t,e,n,i){return t=kn(7,t,i,e),t.lanes=n,t}function Qc(t,e,n,i){return t=kn(22,t,i,e),t.elementType=W0,t.lanes=n,t.stateNode={isHidden:!1},t}function Zu(t,e,n){return t=kn(6,t,null,e),t.lanes=n,t}function ed(t,e,n){return e=kn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function mP(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Du(0),this.expirationTimes=Du(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Du(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function gp(t,e,n,i,r,s,o,a,l){return t=new mP(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=kn(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Zf(s),t}function gP(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:as,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function DS(t){if(!t)return sr;t=t._reactInternals;e:{if(Kr(t)!==t||t.tag!==1)throw Error(F(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(F(171))}if(t.tag===1){var n=t.type;if(Qt(n))return Dk(t,n,e)}return e}function MS(t,e,n,i,r,s,o,a,l){return t=gp(n,i,!0,t,r,s,o,a,l),t.context=DS(null),n=t.current,i=Ft(),r=Yi(n),s=yi(i,r),s.callback=e??null,Ji(n,s,r),t.current.lanes=r,Pa(t,r,i),Yt(t,i),t}function Yc(t,e,n,i){var r=e.current,s=Ft(),o=Yi(r);return n=DS(n),e.context===null?e.context=n:e.pendingContext=n,e=yi(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Ji(r,e,o),t!==null&&(Un(t,r,o,s),Tl(t,r,o)),o}function gc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Vg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function vp(t,e){Vg(t,e),(t=t.alternate)&&Vg(t,e)}function vP(){return null}var LS=typeof reportError=="function"?reportError:function(t){console.error(t)};function yp(t){this._internalRoot=t}Xc.prototype.render=yp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(F(409));Yc(t,e,null,null)};Xc.prototype.unmount=yp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Br(function(){Yc(null,t,null,null)}),e[Ti]=null}};function Xc(t){this._internalRoot=t}Xc.prototype.unstable_scheduleHydration=function(t){if(t){var e=fk();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ui.length&&e!==0&&e<Ui[n].priority;n++);Ui.splice(n,0,t),n===0&&mk(t)}};function kp(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Zc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function zg(){}function yP(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=gc(o);s.call(c)}}var o=MS(e,i,t,0,null,!1,!1,"",zg);return t._reactRootContainer=o,t[Ti]=o.current,oa(t.nodeType===8?t.parentNode:t),Br(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=gc(l);a.call(c)}}var l=gp(t,0,!1,null,null,!1,!1,"",zg);return t._reactRootContainer=l,t[Ti]=l.current,oa(t.nodeType===8?t.parentNode:t),Br(function(){Yc(e,l,n,i)}),l}function eu(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=gc(o);a.call(l)}}Yc(e,o,t,r)}else o=yP(n,e,t,r,i);return gc(o)}dk=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ro(e.pendingLanes);n!==0&&(Uf(e,n|1),Yt(e,et()),!(Ce&6)&&(Hs=et()+500,hr()))}break;case 13:Br(function(){var i=Ci(t,1);if(i!==null){var r=Ft();Un(i,t,1,r)}}),vp(t,1)}};Ff=function(t){if(t.tag===13){var e=Ci(t,134217728);if(e!==null){var n=Ft();Un(e,t,134217728,n)}vp(t,134217728)}};hk=function(t){if(t.tag===13){var e=Yi(t),n=Ci(t,e);if(n!==null){var i=Ft();Un(n,t,e,i)}vp(t,e)}};fk=function(){return _e};pk=function(t,e){var n=_e;try{return _e=t,e()}finally{_e=n}};eh=function(t,e,n){switch(e){case"input":if(Kd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=qc(i);if(!r)throw Error(F(90));H0(i),Kd(i,r)}}}break;case"textarea":K0(t,n);break;case"select":e=n.value,e!=null&&Es(t,!!n.multiple,e,!1)}};ek=hp;tk=Br;var kP={usingClientEntryPoint:!1,Events:[_a,hs,qc,X0,Z0,hp]},go={findFiberByHostInstance:Pr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},SP={bundleType:go.bundleType,version:go.version,rendererPackageName:go.rendererPackageName,rendererConfig:go.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Pi.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=rk(t),t===null?null:t.stateNode},findFiberByHostInstance:go.findFiberByHostInstance||vP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ol=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ol.isDisabled&&ol.supportsFiber)try{Bc=ol.inject(SP),Xn=ol}catch{}}cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kP;cn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!kp(e))throw Error(F(200));return gP(t,e,null,n)};cn.createRoot=function(t,e){if(!kp(t))throw Error(F(299));var n=!1,i="",r=LS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=gp(t,1,!1,null,null,n,!1,i,r),t[Ti]=e.current,oa(t.nodeType===8?t.parentNode:t),new yp(e)};cn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(F(188)):(t=Object.keys(t).join(","),Error(F(268,t)));return t=rk(e),t=t===null?null:t.stateNode,t};cn.flushSync=function(t){return Br(t)};cn.hydrate=function(t,e,n){if(!Zc(e))throw Error(F(200));return eu(null,t,e,!0,n)};cn.hydrateRoot=function(t,e,n){if(!kp(t))throw Error(F(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=LS;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=MS(e,null,t,1,n??null,r,!1,s,o),t[Ti]=e.current,oa(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Xc(e)};cn.render=function(t,e,n){if(!Zc(e))throw Error(F(200));return eu(null,t,e,!1,n)};cn.unmountComponentAtNode=function(t){if(!Zc(t))throw Error(F(40));return t._reactRootContainer?(Br(function(){eu(null,null,t,!1,function(){t._reactRootContainer=null,t[Ti]=null})}),!0):!1};cn.unstable_batchedUpdates=hp;cn.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Zc(n))throw Error(F(200));if(t==null||t._reactInternals===void 0)throw Error(F(38));return eu(t,e,n,!1,i)};cn.version="18.3.1-next-f1338f8080-20240426";function jS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jS)}catch(t){console.error(t)}}jS(),j0.exports=cn;var bP=j0.exports,Wg=bP;Bd.createRoot=Wg.createRoot,Bd.hydrateRoot=Wg.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ma(){return ma=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},ma.apply(this,arguments)}var Wi;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Wi||(Wi={}));const qg="popstate";function TP(t){t===void 0&&(t={});function e(i,r){let{pathname:s,search:o,hash:a}=i.location;return Oh("",{pathname:s,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:vc(r)}return wP(e,n,null,t)}function it(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Sp(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function CP(){return Math.random().toString(36).substr(2,8)}function Hg(t,e){return{usr:t.state,key:t.key,idx:e}}function Oh(t,e,n,i){return n===void 0&&(n=null),ma({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?eo(e):e,{state:n,key:e&&e.key||i||CP()})}function vc(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function eo(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function wP(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,o=r.history,a=Wi.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(ma({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=Wi.Pop;let T=u(),g=T==null?null:T-c;c=T,l&&l({action:a,location:v.location,delta:g})}function h(T,g){a=Wi.Push;let y=Oh(v.location,T,g);c=u()+1;let S=Hg(y,c),k=v.createHref(y);try{o.pushState(S,"",k)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;r.location.assign(k)}s&&l&&l({action:a,location:v.location,delta:1})}function p(T,g){a=Wi.Replace;let y=Oh(v.location,T,g);c=u();let S=Hg(y,c),k=v.createHref(y);o.replaceState(S,"",k),s&&l&&l({action:a,location:v.location,delta:0})}function m(T){let g=r.location.origin!=="null"?r.location.origin:r.location.href,y=typeof T=="string"?T:vc(T);return y=y.replace(/ $/,"%20"),it(g,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,g)}let v={get action(){return a},get location(){return t(r,o)},listen(T){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(qg,d),l=T,()=>{r.removeEventListener(qg,d),l=null}},createHref(T){return e(r,T)},createURL:m,encodeLocation(T){let g=m(T);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:p,go(T){return o.go(T)}};return v}var $g;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})($g||($g={}));function xP(t,e,n){return n===void 0&&(n="/"),EP(t,e,n)}function EP(t,e,n,i){let r=typeof e=="string"?eo(e):e,s=bp(r.pathname||"/",n);if(s==null)return null;let o=US(t);PP(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=FP(s);a=LP(o[l],c)}return a}function US(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(it(l.relativePath.startsWith(i),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(i.length));let c=Zi([i,l.relativePath]),u=n.concat(l);s.children&&s.children.length>0&&(it(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),US(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:DP(c,s.index),routesMeta:u})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))r(s,o);else for(let l of FS(s.path))r(s,o,l)}),e}function FS(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let o=FS(i.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),r&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function PP(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:MP(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const RP=/^:[\w-]+$/,_P=3,IP=2,AP=1,NP=10,OP=-2,Kg=t=>t==="*";function DP(t,e){let n=t.split("/"),i=n.length;return n.some(Kg)&&(i+=OP),e&&(i+=IP),n.filter(r=>!Kg(r)).reduce((r,s)=>r+(RP.test(s)?_P:s===""?AP:NP),i)}function MP(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function LP(t,e,n){let{routesMeta:i}=t,r={},s="/",o=[];for(let a=0;a<i.length;++a){let l=i[a],c=a===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",d=jP({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d)return null;Object.assign(r,d.params),o.push({params:r,pathname:Zi([s,d.pathname]),pathnameBase:qP(Zi([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=Zi([s,d.pathnameBase]))}return o}function jP(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=UP(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce((c,u,d)=>{let{paramName:h,isOptional:p}=u;if(h==="*"){let v=a[d]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const m=a[d];return p&&!m?c[h]=void 0:c[h]=(m||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:o,pattern:t}}function UP(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Sp(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(i.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function FP(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Sp(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function bp(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}const BP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,VP=t=>BP.test(t);function zP(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?eo(t):t,s;if(n)if(VP(n))s=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Sp(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+n))}n.startsWith("/")?s=Gg(n.substring(1),"/"):s=Gg(n,e)}else s=e;return{pathname:s,search:HP(i),hash:$P(r)}}function Gg(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function td(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function WP(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Tp(t,e){let n=WP(t);return e?n.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):n.map(i=>i.pathnameBase)}function Cp(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=eo(t):(r=ma({},t),it(!r.pathname||!r.pathname.includes("?"),td("?","pathname","search",r)),it(!r.pathname||!r.pathname.includes("#"),td("#","pathname","hash",r)),it(!r.search||!r.search.includes("#"),td("#","search","hash",r)));let s=t===""||r.pathname==="",o=s?"/":r.pathname,a;if(o==null)a=n;else{let d=e.length-1;if(!i&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),d-=1;r.pathname=h.join("/")}a=d>=0?e[d]:"/"}let l=zP(r,a),c=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const Zi=t=>t.join("/").replace(/\/\/+/g,"/"),qP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),HP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,$P=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function KP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const BS=["post","put","patch","delete"];new Set(BS);const GP=["get",...BS];new Set(GP);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ga(){return ga=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},ga.apply(this,arguments)}const wp=C.createContext(null),JP=C.createContext(null),fr=C.createContext(null),tu=C.createContext(null),Ri=C.createContext({outlet:null,matches:[],isDataRoute:!1}),VS=C.createContext(null);function QP(t,e){let{relative:n}=e===void 0?{}:e;to()||it(!1);let{basename:i,navigator:r}=C.useContext(fr),{hash:s,pathname:o,search:a}=qS(t,{relative:n}),l=o;return i!=="/"&&(l=o==="/"?i:Zi([i,o])),r.createHref({pathname:l,search:a,hash:s})}function to(){return C.useContext(tu)!=null}function Gr(){return to()||it(!1),C.useContext(tu).location}function zS(t){C.useContext(fr).static||C.useLayoutEffect(t)}function Jr(){let{isDataRoute:t}=C.useContext(Ri);return t?cR():YP()}function YP(){to()||it(!1);let t=C.useContext(wp),{basename:e,future:n,navigator:i}=C.useContext(fr),{matches:r}=C.useContext(Ri),{pathname:s}=Gr(),o=JSON.stringify(Tp(r,n.v7_relativeSplatPath)),a=C.useRef(!1);return zS(()=>{a.current=!0}),C.useCallback(function(c,u){if(u===void 0&&(u={}),!a.current)return;if(typeof c=="number"){i.go(c);return}let d=Cp(c,JSON.parse(o),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Zi([e,d.pathname])),(u.replace?i.replace:i.push)(d,u.state,u)},[e,i,o,s,t])}function WS(){let{matches:t}=C.useContext(Ri),e=t[t.length-1];return e?e.params:{}}function qS(t,e){let{relative:n}=e===void 0?{}:e,{future:i}=C.useContext(fr),{matches:r}=C.useContext(Ri),{pathname:s}=Gr(),o=JSON.stringify(Tp(r,i.v7_relativeSplatPath));return C.useMemo(()=>Cp(t,JSON.parse(o),s,n==="path"),[t,o,s,n])}function XP(t,e){return ZP(t,e)}function ZP(t,e,n,i){to()||it(!1);let{navigator:r}=C.useContext(fr),{matches:s}=C.useContext(Ri),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=Gr(),u;if(e){var d;let T=typeof e=="string"?eo(e):e;l==="/"||(d=T.pathname)!=null&&d.startsWith(l)||it(!1),u=T}else u=c;let h=u.pathname||"/",p=h;if(l!=="/"){let T=l.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(T.length).join("/")}let m=xP(t,{pathname:p}),v=rR(m&&m.map(T=>Object.assign({},T,{params:Object.assign({},a,T.params),pathname:Zi([l,r.encodeLocation?r.encodeLocation(T.pathname).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?l:Zi([l,r.encodeLocation?r.encodeLocation(T.pathnameBase).pathname:T.pathnameBase])})),s,n,i);return e&&v?C.createElement(tu.Provider,{value:{location:ga({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Wi.Pop}},v):v}function eR(){let t=lR(),e=KP(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},e),n?C.createElement("pre",{style:r},n):null,null)}const tR=C.createElement(eR,null);class nR extends C.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?C.createElement(Ri.Provider,{value:this.props.routeContext},C.createElement(VS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function iR(t){let{routeContext:e,match:n,children:i}=t,r=C.useContext(wp);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),C.createElement(Ri.Provider,{value:e},i)}function rR(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=i)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||it(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(n&&i&&i.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:h,errors:p}=n,m=d.route.loader&&h[d.route.id]===void 0&&(!p||p[d.route.id]===void 0);if(d.route.lazy||m){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,d,h)=>{let p,m=!1,v=null,T=null;n&&(p=a&&d.route.id?a[d.route.id]:void 0,v=d.route.errorElement||tR,l&&(c<0&&h===0?(uR("route-fallback"),m=!0,T=null):c===h&&(m=!0,T=d.route.hydrateFallbackElement||null)));let g=e.concat(o.slice(0,h+1)),y=()=>{let S;return p?S=v:m?S=T:d.route.Component?S=C.createElement(d.route.Component,null):d.route.element?S=d.route.element:S=u,C.createElement(iR,{match:d,routeContext:{outlet:u,matches:g,isDataRoute:n!=null},children:S})};return n&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?C.createElement(nR,{location:n.location,revalidation:n.revalidation,component:v,error:p,children:y(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):y()},null)}var HS=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(HS||{}),$S=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}($S||{});function sR(t){let e=C.useContext(wp);return e||it(!1),e}function oR(t){let e=C.useContext(JP);return e||it(!1),e}function aR(t){let e=C.useContext(Ri);return e||it(!1),e}function KS(t){let e=aR(),n=e.matches[e.matches.length-1];return n.route.id||it(!1),n.route.id}function lR(){var t;let e=C.useContext(VS),n=oR(),i=KS();return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}function cR(){let{router:t}=sR(HS.UseNavigateStable),e=KS($S.UseNavigateStable),n=C.useRef(!1);return zS(()=>{n.current=!0}),C.useCallback(function(r,s){s===void 0&&(s={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,ga({fromRouteId:e},s)))},[t,e])}const Jg={};function uR(t,e,n){Jg[t]||(Jg[t]=!0)}function dR(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function xp(t){let{to:e,replace:n,state:i,relative:r}=t;to()||it(!1);let{future:s,static:o}=C.useContext(fr),{matches:a}=C.useContext(Ri),{pathname:l}=Gr(),c=Jr(),u=Cp(e,Tp(a,s.v7_relativeSplatPath),l,r==="path"),d=JSON.stringify(u);return C.useEffect(()=>c(JSON.parse(d),{replace:n,state:i,relative:r}),[c,d,r,n,i]),null}function oi(t){it(!1)}function hR(t){let{basename:e="/",children:n=null,location:i,navigationType:r=Wi.Pop,navigator:s,static:o=!1,future:a}=t;to()&&it(!1);let l=e.replace(/^\/*/,"/"),c=C.useMemo(()=>({basename:l,navigator:s,static:o,future:ga({v7_relativeSplatPath:!1},a)}),[l,a,s,o]);typeof i=="string"&&(i=eo(i));let{pathname:u="/",search:d="",hash:h="",state:p=null,key:m="default"}=i,v=C.useMemo(()=>{let T=bp(u,l);return T==null?null:{location:{pathname:T,search:d,hash:h,state:p,key:m},navigationType:r}},[l,u,d,h,p,m,r]);return v==null?null:C.createElement(fr.Provider,{value:c},C.createElement(tu.Provider,{children:n,value:v}))}function fR(t){let{children:e,location:n}=t;return XP(Dh(e),n)}new Promise(()=>{});function Dh(t,e){e===void 0&&(e=[]);let n=[];return C.Children.forEach(t,(i,r)=>{if(!C.isValidElement(i))return;let s=[...e,r];if(i.type===C.Fragment){n.push.apply(n,Dh(i.props.children,s));return}i.type!==oi&&it(!1),!i.props.index||!i.props.children||it(!1);let o={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=Dh(i.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Mh(){return Mh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Mh.apply(this,arguments)}function pR(t,e){if(t==null)return{};var n={},i=Object.keys(t),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(n[r]=t[r]);return n}function mR(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function gR(t,e){return t.button===0&&(!e||e==="_self")&&!mR(t)}const vR=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],yR="6";try{window.__reactRouterVersion=yR}catch{}const kR="startTransition",Qg=ux[kR];function SR(t){let{basename:e,children:n,future:i,window:r}=t,s=C.useRef();s.current==null&&(s.current=TP({window:r,v5Compat:!0}));let o=s.current,[a,l]=C.useState({action:o.action,location:o.location}),{v7_startTransition:c}=i||{},u=C.useCallback(d=>{c&&Qg?Qg(()=>l(d)):l(d)},[l,c]);return C.useLayoutEffect(()=>o.listen(u),[o,u]),C.useEffect(()=>dR(i),[i]),C.createElement(hR,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:i})}const bR=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",TR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Wo=C.forwardRef(function(e,n){let{onClick:i,relative:r,reloadDocument:s,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:d}=e,h=pR(e,vR),{basename:p}=C.useContext(fr),m,v=!1;if(typeof c=="string"&&TR.test(c)&&(m=c,bR))try{let S=new URL(window.location.href),k=c.startsWith("//")?new URL(S.protocol+c):new URL(c),b=bp(k.pathname,p);k.origin===S.origin&&b!=null?c=b+k.search+k.hash:v=!0}catch{}let T=QP(c,{relative:r}),g=CR(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:r,viewTransition:d});function y(S){i&&i(S),S.defaultPrevented||g(S)}return C.createElement("a",Mh({},h,{href:m||T,onClick:v||s?i:y,ref:n,target:l}))});var Yg;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Yg||(Yg={}));var Xg;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Xg||(Xg={}));function CR(t,e){let{target:n,replace:i,state:r,preventScrollReset:s,relative:o,viewTransition:a}=e===void 0?{}:e,l=Jr(),c=Gr(),u=qS(t,{relative:o});return C.useCallback(d=>{if(gR(d,n)){d.preventDefault();let h=i!==void 0?i:vc(c)===vc(u);l(t,{replace:h,state:r,preventScrollReset:s,relative:o,viewTransition:a})}},[c,l,u,i,r,n,t,s,o,a])}function GS(t,e){return function(){return t.apply(e,arguments)}}const{toString:wR}=Object.prototype,{getPrototypeOf:Ep}=Object,{iterator:nu,toStringTag:JS}=Symbol,iu=(t=>e=>{const n=wR.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Vn=t=>(t=t.toLowerCase(),e=>iu(e)===t),ru=t=>e=>typeof e===t,{isArray:no}=Array,$s=ru("undefined");function Aa(t){return t!==null&&!$s(t)&&t.constructor!==null&&!$s(t.constructor)&&Xt(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const QS=Vn("ArrayBuffer");function xR(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&QS(t.buffer),e}const ER=ru("string"),Xt=ru("function"),YS=ru("number"),Na=t=>t!==null&&typeof t=="object",PR=t=>t===!0||t===!1,_l=t=>{if(iu(t)!=="object")return!1;const e=Ep(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(JS in t)&&!(nu in t)},RR=t=>{if(!Na(t)||Aa(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},_R=Vn("Date"),IR=Vn("File"),AR=Vn("Blob"),NR=Vn("FileList"),OR=t=>Na(t)&&Xt(t.pipe),DR=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Xt(t.append)&&((e=iu(t))==="formdata"||e==="object"&&Xt(t.toString)&&t.toString()==="[object FormData]"))},MR=Vn("URLSearchParams"),[LR,jR,UR,FR]=["ReadableStream","Request","Response","Headers"].map(Vn),BR=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Oa(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let i,r;if(typeof t!="object"&&(t=[t]),no(t))for(i=0,r=t.length;i<r;i++)e.call(null,t[i],i,t);else{if(Aa(t))return;const s=n?Object.getOwnPropertyNames(t):Object.keys(t),o=s.length;let a;for(i=0;i<o;i++)a=s[i],e.call(null,t[a],a,t)}}function XS(t,e){if(Aa(t))return null;e=e.toLowerCase();const n=Object.keys(t);let i=n.length,r;for(;i-- >0;)if(r=n[i],e===r.toLowerCase())return r;return null}const Ir=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ZS=t=>!$s(t)&&t!==Ir;function Lh(){const{caseless:t,skipUndefined:e}=ZS(this)&&this||{},n={},i=(r,s)=>{const o=t&&XS(n,s)||s;_l(n[o])&&_l(r)?n[o]=Lh(n[o],r):_l(r)?n[o]=Lh({},r):no(r)?n[o]=r.slice():(!e||!$s(r))&&(n[o]=r)};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Oa(arguments[r],i);return n}const VR=(t,e,n,{allOwnKeys:i}={})=>(Oa(e,(r,s)=>{n&&Xt(r)?t[s]=GS(r,n):t[s]=r},{allOwnKeys:i}),t),zR=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),WR=(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},qR=(t,e,n,i)=>{let r,s,o;const a={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),s=r.length;s-- >0;)o=r[s],(!i||i(o,t,e))&&!a[o]&&(e[o]=t[o],a[o]=!0);t=n!==!1&&Ep(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},HR=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},$R=t=>{if(!t)return null;if(no(t))return t;let e=t.length;if(!YS(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},KR=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Ep(Uint8Array)),GR=(t,e)=>{const i=(t&&t[nu]).call(t);let r;for(;(r=i.next())&&!r.done;){const s=r.value;e.call(t,s[0],s[1])}},JR=(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},QR=Vn("HTMLFormElement"),YR=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,r){return i.toUpperCase()+r}),Zg=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),XR=Vn("RegExp"),eb=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};Oa(n,(r,s)=>{let o;(o=e(r,s,t))!==!1&&(i[s]=o||r)}),Object.defineProperties(t,i)},ZR=t=>{eb(t,(e,n)=>{if(Xt(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];if(Xt(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},e1=(t,e)=>{const n={},i=r=>{r.forEach(s=>{n[s]=!0})};return no(t)?i(t):i(String(t).split(e)),n},t1=()=>{},n1=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function i1(t){return!!(t&&Xt(t.append)&&t[JS]==="FormData"&&t[nu])}const r1=t=>{const e=new Array(10),n=(i,r)=>{if(Na(i)){if(e.indexOf(i)>=0)return;if(Aa(i))return i;if(!("toJSON"in i)){e[r]=i;const s=no(i)?[]:{};return Oa(i,(o,a)=>{const l=n(o,r+1);!$s(l)&&(s[a]=l)}),e[r]=void 0,s}}return i};return n(t,0)},s1=Vn("AsyncFunction"),o1=t=>t&&(Na(t)||Xt(t))&&Xt(t.then)&&Xt(t.catch),tb=((t,e)=>t?setImmediate:e?((n,i)=>(Ir.addEventListener("message",({source:r,data:s})=>{r===Ir&&s===n&&i.length&&i.shift()()},!1),r=>{i.push(r),Ir.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Xt(Ir.postMessage)),a1=typeof queueMicrotask<"u"?queueMicrotask.bind(Ir):typeof process<"u"&&process.nextTick||tb,l1=t=>t!=null&&Xt(t[nu]),I={isArray:no,isArrayBuffer:QS,isBuffer:Aa,isFormData:DR,isArrayBufferView:xR,isString:ER,isNumber:YS,isBoolean:PR,isObject:Na,isPlainObject:_l,isEmptyObject:RR,isReadableStream:LR,isRequest:jR,isResponse:UR,isHeaders:FR,isUndefined:$s,isDate:_R,isFile:IR,isBlob:AR,isRegExp:XR,isFunction:Xt,isStream:OR,isURLSearchParams:MR,isTypedArray:KR,isFileList:NR,forEach:Oa,merge:Lh,extend:VR,trim:BR,stripBOM:zR,inherits:WR,toFlatObject:qR,kindOf:iu,kindOfTest:Vn,endsWith:HR,toArray:$R,forEachEntry:GR,matchAll:JR,isHTMLForm:QR,hasOwnProperty:Zg,hasOwnProp:Zg,reduceDescriptors:eb,freezeMethods:ZR,toObjectSet:e1,toCamelCase:YR,noop:t1,toFiniteNumber:n1,findKey:XS,global:Ir,isContextDefined:ZS,isSpecCompliantForm:i1,toJSONObject:r1,isAsyncFn:s1,isThenable:o1,setImmediate:tb,asap:a1,isIterable:l1};function ce(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}I.inherits(ce,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const nb=ce.prototype,ib={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{ib[t]={value:t}});Object.defineProperties(ce,ib);Object.defineProperty(nb,"isAxiosError",{value:!0});ce.from=(t,e,n,i,r,s)=>{const o=Object.create(nb);I.toFlatObject(t,o,function(u){return u!==Error.prototype},c=>c!=="isAxiosError");const a=t&&t.message?t.message:"Error",l=e==null&&t?t.code:e;return ce.call(o,a,l,n,i,r),t&&o.cause==null&&Object.defineProperty(o,"cause",{value:t,configurable:!0}),o.name=t&&t.name||"Error",s&&Object.assign(o,s),o};const c1=null;function jh(t){return I.isPlainObject(t)||I.isArray(t)}function rb(t){return I.endsWith(t,"[]")?t.slice(0,-2):t}function ev(t,e,n){return t?t.concat(e).map(function(r,s){return r=rb(r),!n&&s?"["+r+"]":r}).join(n?".":""):e}function u1(t){return I.isArray(t)&&!t.some(jh)}const d1=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function su(t,e,n){if(!I.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=I.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,T){return!I.isUndefined(T[v])});const i=n.metaTokens,r=n.visitor||u,s=n.dots,o=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(r))throw new TypeError("visitor must be a function");function c(m){if(m===null)return"";if(I.isDate(m))return m.toISOString();if(I.isBoolean(m))return m.toString();if(!l&&I.isBlob(m))throw new ce("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(m)||I.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,v,T){let g=m;if(m&&!T&&typeof m=="object"){if(I.endsWith(v,"{}"))v=i?v:v.slice(0,-2),m=JSON.stringify(m);else if(I.isArray(m)&&u1(m)||(I.isFileList(m)||I.endsWith(v,"[]"))&&(g=I.toArray(m)))return v=rb(v),g.forEach(function(S,k){!(I.isUndefined(S)||S===null)&&e.append(o===!0?ev([v],k,s):o===null?v:v+"[]",c(S))}),!1}return jh(m)?!0:(e.append(ev(T,v,s),c(m)),!1)}const d=[],h=Object.assign(d1,{defaultVisitor:u,convertValue:c,isVisitable:jh});function p(m,v){if(!I.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+v.join("."));d.push(m),I.forEach(m,function(g,y){(!(I.isUndefined(g)||g===null)&&r.call(e,g,I.isString(y)?y.trim():y,v,h))===!0&&p(g,v?v.concat(y):[y])}),d.pop()}}if(!I.isObject(t))throw new TypeError("data must be an object");return p(t),e}function tv(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function Pp(t,e){this._pairs=[],t&&su(t,this,e)}const sb=Pp.prototype;sb.append=function(e,n){this._pairs.push([e,n])};sb.toString=function(e){const n=e?function(i){return e.call(this,i,tv)}:tv;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function h1(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ob(t,e,n){if(!e)return t;const i=n&&n.encode||h1;I.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let s;if(r?s=r(e,n):s=I.isURLSearchParams(e)?e.toString():new Pp(e,n).toString(i),s){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class nv{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(i){i!==null&&e(i)})}}const ab={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},f1=typeof URLSearchParams<"u"?URLSearchParams:Pp,p1=typeof FormData<"u"?FormData:null,m1=typeof Blob<"u"?Blob:null,g1={isBrowser:!0,classes:{URLSearchParams:f1,FormData:p1,Blob:m1},protocols:["http","https","file","blob","url","data"]},Rp=typeof window<"u"&&typeof document<"u",Uh=typeof navigator=="object"&&navigator||void 0,v1=Rp&&(!Uh||["ReactNative","NativeScript","NS"].indexOf(Uh.product)<0),y1=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",k1=Rp&&window.location.href||"http://localhost",S1=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Rp,hasStandardBrowserEnv:v1,hasStandardBrowserWebWorkerEnv:y1,navigator:Uh,origin:k1},Symbol.toStringTag,{value:"Module"})),Ot={...S1,...g1};function b1(t,e){return su(t,new Ot.classes.URLSearchParams,{visitor:function(n,i,r,s){return Ot.isNode&&I.isBuffer(n)?(this.append(i,n.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)},...e})}function T1(t){return I.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function C1(t){const e={},n=Object.keys(t);let i;const r=n.length;let s;for(i=0;i<r;i++)s=n[i],e[s]=t[s];return e}function lb(t){function e(n,i,r,s){let o=n[s++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=s>=n.length;return o=!o&&I.isArray(r)?r.length:o,l?(I.hasOwnProp(r,o)?r[o]=[r[o],i]:r[o]=i,!a):((!r[o]||!I.isObject(r[o]))&&(r[o]=[]),e(n,i,r[o],s)&&I.isArray(r[o])&&(r[o]=C1(r[o])),!a)}if(I.isFormData(t)&&I.isFunction(t.entries)){const n={};return I.forEachEntry(t,(i,r)=>{e(T1(i),r,n,0)}),n}return null}function w1(t,e,n){if(I.isString(t))try{return(e||JSON.parse)(t),I.trim(t)}catch(i){if(i.name!=="SyntaxError")throw i}return(n||JSON.stringify)(t)}const Da={transitional:ab,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",r=i.indexOf("application/json")>-1,s=I.isObject(e);if(s&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return r?JSON.stringify(lb(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)||I.isReadableStream(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(i.indexOf("application/x-www-form-urlencoded")>-1)return b1(e,this.formSerializer).toString();if((a=I.isFileList(e))||i.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return su(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return s||r?(n.setContentType("application/json",!1),w1(e)):e}],transformResponse:[function(e){const n=this.transitional||Da.transitional,i=n&&n.forcedJSONParsing,r=this.responseType==="json";if(I.isResponse(e)||I.isReadableStream(e))return e;if(e&&I.isString(e)&&(i&&!this.responseType||r)){const o=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(a){if(o)throw a.name==="SyntaxError"?ce.from(a,ce.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ot.classes.FormData,Blob:Ot.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],t=>{Da.headers[t]={}});const x1=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),E1=t=>{const e={};let n,i,r;return t&&t.split(`
`).forEach(function(o){r=o.indexOf(":"),n=o.substring(0,r).trim().toLowerCase(),i=o.substring(r+1).trim(),!(!n||e[n]&&x1[n])&&(n==="set-cookie"?e[n]?e[n].push(i):e[n]=[i]:e[n]=e[n]?e[n]+", "+i:i)}),e},iv=Symbol("internals");function vo(t){return t&&String(t).trim().toLowerCase()}function Il(t){return t===!1||t==null?t:I.isArray(t)?t.map(Il):String(t)}function P1(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(t);)e[i[1]]=i[2];return e}const R1=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function nd(t,e,n,i,r){if(I.isFunction(i))return i.call(this,e,n);if(r&&(e=n),!!I.isString(e)){if(I.isString(i))return e.indexOf(i)!==-1;if(I.isRegExp(i))return i.test(e)}}function _1(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,i)=>n.toUpperCase()+i)}function I1(t,e){const n=I.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(t,i+n,{value:function(r,s,o){return this[i].call(this,e,r,s,o)},configurable:!0})})}let Zt=class{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function s(a,l,c){const u=vo(l);if(!u)throw new Error("header name must be a non-empty string");const d=I.findKey(r,u);(!d||r[d]===void 0||c===!0||c===void 0&&r[d]!==!1)&&(r[d||l]=Il(a))}const o=(a,l)=>I.forEach(a,(c,u)=>s(c,u,l));if(I.isPlainObject(e)||e instanceof this.constructor)o(e,n);else if(I.isString(e)&&(e=e.trim())&&!R1(e))o(E1(e),n);else if(I.isObject(e)&&I.isIterable(e)){let a={},l,c;for(const u of e){if(!I.isArray(u))throw TypeError("Object iterator must return a key-value pair");a[c=u[0]]=(l=a[c])?I.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}o(a,n)}else e!=null&&s(n,e,i);return this}get(e,n){if(e=vo(e),e){const i=I.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return P1(r);if(I.isFunction(n))return n.call(this,r,i);if(I.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=vo(e),e){const i=I.findKey(this,e);return!!(i&&this[i]!==void 0&&(!n||nd(this,this[i],i,n)))}return!1}delete(e,n){const i=this;let r=!1;function s(o){if(o=vo(o),o){const a=I.findKey(i,o);a&&(!n||nd(i,i[a],a,n))&&(delete i[a],r=!0)}}return I.isArray(e)?e.forEach(s):s(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const s=n[i];(!e||nd(this,this[s],s,e,!0))&&(delete this[s],r=!0)}return r}normalize(e){const n=this,i={};return I.forEach(this,(r,s)=>{const o=I.findKey(i,s);if(o){n[o]=Il(r),delete n[s];return}const a=e?_1(s):String(s).trim();a!==s&&delete n[s],n[a]=Il(r),i[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return I.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&I.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const i=new this(e);return n.forEach(r=>i.set(r)),i}static accessor(e){const i=(this[iv]=this[iv]={accessors:{}}).accessors,r=this.prototype;function s(o){const a=vo(o);i[a]||(I1(r,o),i[a]=!0)}return I.isArray(e)?e.forEach(s):s(e),this}};Zt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(Zt.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(i){this[n]=i}}});I.freezeMethods(Zt);function id(t,e){const n=this||Da,i=e||n,r=Zt.from(i.headers);let s=i.data;return I.forEach(t,function(a){s=a.call(n,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function cb(t){return!!(t&&t.__CANCEL__)}function io(t,e,n){ce.call(this,t??"canceled",ce.ERR_CANCELED,e,n),this.name="CanceledError"}I.inherits(io,ce,{__CANCEL__:!0});function ub(t,e,n){const i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):e(new ce("Request failed with status code "+n.status,[ce.ERR_BAD_REQUEST,ce.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function A1(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function N1(t,e){t=t||10;const n=new Array(t),i=new Array(t);let r=0,s=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=i[s];o||(o=c),n[r]=l,i[r]=c;let d=s,h=0;for(;d!==r;)h+=n[d++],d=d%t;if(r=(r+1)%t,r===s&&(s=(s+1)%t),c-o<e)return;const p=u&&c-u;return p?Math.round(h*1e3/p):void 0}}function O1(t,e){let n=0,i=1e3/e,r,s;const o=(c,u=Date.now())=>{n=u,r=null,s&&(clearTimeout(s),s=null),t(...c)};return[(...c)=>{const u=Date.now(),d=u-n;d>=i?o(c,u):(r=c,s||(s=setTimeout(()=>{s=null,o(r)},i-d)))},()=>r&&o(r)]}const yc=(t,e,n=3)=>{let i=0;const r=N1(50,250);return O1(s=>{const o=s.loaded,a=s.lengthComputable?s.total:void 0,l=o-i,c=r(l),u=o<=a;i=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:c||void 0,estimated:c&&a&&u?(a-o)/c:void 0,event:s,lengthComputable:a!=null,[e?"download":"upload"]:!0};t(d)},n)},rv=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},sv=t=>(...e)=>I.asap(()=>t(...e)),D1=Ot.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,Ot.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(Ot.origin),Ot.navigator&&/(msie|trident)/i.test(Ot.navigator.userAgent)):()=>!0,M1=Ot.hasStandardBrowserEnv?{write(t,e,n,i,r,s,o){if(typeof document>"u")return;const a=[`${t}=${encodeURIComponent(e)}`];I.isNumber(n)&&a.push(`expires=${new Date(n).toUTCString()}`),I.isString(i)&&a.push(`path=${i}`),I.isString(r)&&a.push(`domain=${r}`),s===!0&&a.push("secure"),I.isString(o)&&a.push(`SameSite=${o}`),document.cookie=a.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function L1(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function j1(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function db(t,e,n){let i=!L1(e);return t&&(i||n==!1)?j1(t,e):e}const ov=t=>t instanceof Zt?{...t}:t;function Vr(t,e){e=e||{};const n={};function i(c,u,d,h){return I.isPlainObject(c)&&I.isPlainObject(u)?I.merge.call({caseless:h},c,u):I.isPlainObject(u)?I.merge({},u):I.isArray(u)?u.slice():u}function r(c,u,d,h){if(I.isUndefined(u)){if(!I.isUndefined(c))return i(void 0,c,d,h)}else return i(c,u,d,h)}function s(c,u){if(!I.isUndefined(u))return i(void 0,u)}function o(c,u){if(I.isUndefined(u)){if(!I.isUndefined(c))return i(void 0,c)}else return i(void 0,u)}function a(c,u,d){if(d in e)return i(c,u);if(d in t)return i(void 0,c)}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,u,d)=>r(ov(c),ov(u),d,!0)};return I.forEach(Object.keys({...t,...e}),function(u){const d=l[u]||r,h=d(t[u],e[u],u);I.isUndefined(h)&&d!==a||(n[u]=h)}),n}const hb=t=>{const e=Vr({},t);let{data:n,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:s,headers:o,auth:a}=e;if(e.headers=o=Zt.from(o),e.url=ob(db(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),I.isFormData(n)){if(Ot.hasStandardBrowserEnv||Ot.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(I.isFunction(n.getHeaders)){const l=n.getHeaders(),c=["content-type","content-length"];Object.entries(l).forEach(([u,d])=>{c.includes(u.toLowerCase())&&o.set(u,d)})}}if(Ot.hasStandardBrowserEnv&&(i&&I.isFunction(i)&&(i=i(e)),i||i!==!1&&D1(e.url))){const l=r&&s&&M1.read(s);l&&o.set(r,l)}return e},U1=typeof XMLHttpRequest<"u",F1=U1&&function(t){return new Promise(function(n,i){const r=hb(t);let s=r.data;const o=Zt.from(r.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:c}=r,u,d,h,p,m;function v(){p&&p(),m&&m(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let T=new XMLHttpRequest;T.open(r.method.toUpperCase(),r.url,!0),T.timeout=r.timeout;function g(){if(!T)return;const S=Zt.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),b={data:!a||a==="text"||a==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:S,config:t,request:T};ub(function(E){n(E),v()},function(E){i(E),v()},b),T=null}"onloadend"in T?T.onloadend=g:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(g)},T.onabort=function(){T&&(i(new ce("Request aborted",ce.ECONNABORTED,t,T)),T=null)},T.onerror=function(k){const b=k&&k.message?k.message:"Network Error",x=new ce(b,ce.ERR_NETWORK,t,T);x.event=k||null,i(x),T=null},T.ontimeout=function(){let k=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const b=r.transitional||ab;r.timeoutErrorMessage&&(k=r.timeoutErrorMessage),i(new ce(k,b.clarifyTimeoutError?ce.ETIMEDOUT:ce.ECONNABORTED,t,T)),T=null},s===void 0&&o.setContentType(null),"setRequestHeader"in T&&I.forEach(o.toJSON(),function(k,b){T.setRequestHeader(b,k)}),I.isUndefined(r.withCredentials)||(T.withCredentials=!!r.withCredentials),a&&a!=="json"&&(T.responseType=r.responseType),c&&([h,m]=yc(c,!0),T.addEventListener("progress",h)),l&&T.upload&&([d,p]=yc(l),T.upload.addEventListener("progress",d),T.upload.addEventListener("loadend",p)),(r.cancelToken||r.signal)&&(u=S=>{T&&(i(!S||S.type?new io(null,t,T):S),T.abort(),T=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const y=A1(r.url);if(y&&Ot.protocols.indexOf(y)===-1){i(new ce("Unsupported protocol "+y+":",ce.ERR_BAD_REQUEST,t));return}T.send(s||null)})},B1=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i=new AbortController,r;const s=function(c){if(!r){r=!0,a();const u=c instanceof Error?c:this.reason;i.abort(u instanceof ce?u:new io(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,s(new ce(`timeout ${e} of ms exceeded`,ce.ETIMEDOUT))},e);const a=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(s):c.removeEventListener("abort",s)}),t=null)};t.forEach(c=>c.addEventListener("abort",s));const{signal:l}=i;return l.unsubscribe=()=>I.asap(a),l}},V1=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let i=0,r;for(;i<n;)r=i+e,yield t.slice(i,r),i=r},z1=async function*(t,e){for await(const n of W1(t))yield*V1(n,e)},W1=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:i}=await e.read();if(n)break;yield i}}finally{await e.cancel()}},av=(t,e,n,i)=>{const r=z1(t,e);let s=0,o,a=l=>{o||(o=!0,i&&i(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await r.next();if(c){a(),l.close();return}let d=u.byteLength;if(n){let h=s+=d;n(h)}l.enqueue(new Uint8Array(u))}catch(c){throw a(c),c}},cancel(l){return a(l),r.return()}},{highWaterMark:2})},lv=64*1024,{isFunction:al}=I,q1=(({Request:t,Response:e})=>({Request:t,Response:e}))(I.global),{ReadableStream:cv,TextEncoder:uv}=I.global,dv=(t,...e)=>{try{return!!t(...e)}catch{return!1}},H1=t=>{t=I.merge.call({skipUndefined:!0},q1,t);const{fetch:e,Request:n,Response:i}=t,r=e?al(e):typeof fetch=="function",s=al(n),o=al(i);if(!r)return!1;const a=r&&al(cv),l=r&&(typeof uv=="function"?(m=>v=>m.encode(v))(new uv):async m=>new Uint8Array(await new n(m).arrayBuffer())),c=s&&a&&dv(()=>{let m=!1;const v=new n(Ot.origin,{body:new cv,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!v}),u=o&&a&&dv(()=>I.isReadableStream(new i("").body)),d={stream:u&&(m=>m.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!d[m]&&(d[m]=(v,T)=>{let g=v&&v[m];if(g)return g.call(v);throw new ce(`Response type '${m}' is not supported`,ce.ERR_NOT_SUPPORT,T)})});const h=async m=>{if(m==null)return 0;if(I.isBlob(m))return m.size;if(I.isSpecCompliantForm(m))return(await new n(Ot.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(I.isArrayBufferView(m)||I.isArrayBuffer(m))return m.byteLength;if(I.isURLSearchParams(m)&&(m=m+""),I.isString(m))return(await l(m)).byteLength},p=async(m,v)=>{const T=I.toFiniteNumber(m.getContentLength());return T??h(v)};return async m=>{let{url:v,method:T,data:g,signal:y,cancelToken:S,timeout:k,onDownloadProgress:b,onUploadProgress:x,responseType:E,headers:P,withCredentials:A="same-origin",fetchOptions:O}=hb(m),W=e||fetch;E=E?(E+"").toLowerCase():"text";let J=B1([y,S&&S.toAbortSignal()],k),se=null;const te=J&&J.unsubscribe&&(()=>{J.unsubscribe()});let xe;try{if(x&&c&&T!=="get"&&T!=="head"&&(xe=await p(P,g))!==0){let $=new n(v,{method:"POST",body:g,duplex:"half"}),ee;if(I.isFormData(g)&&(ee=$.headers.get("content-type"))&&P.setContentType(ee),$.body){const[De,pe]=rv(xe,yc(sv(x)));g=av($.body,lv,De,pe)}}I.isString(A)||(A=A?"include":"omit");const q=s&&"credentials"in n.prototype,Re={...O,signal:J,method:T.toUpperCase(),headers:P.normalize().toJSON(),body:g,duplex:"half",credentials:q?A:void 0};se=s&&new n(v,Re);let D=await(s?W(se,O):W(v,Re));const N=u&&(E==="stream"||E==="response");if(u&&(b||N&&te)){const $={};["status","statusText","headers"].forEach(Xe=>{$[Xe]=D[Xe]});const ee=I.toFiniteNumber(D.headers.get("content-length")),[De,pe]=b&&rv(ee,yc(sv(b),!0))||[];D=new i(av(D.body,lv,De,()=>{pe&&pe(),te&&te()}),$)}E=E||"text";let j=await d[I.findKey(d,E)||"text"](D,m);return!N&&te&&te(),await new Promise(($,ee)=>{ub($,ee,{data:j,headers:Zt.from(D.headers),status:D.status,statusText:D.statusText,config:m,request:se})})}catch(q){throw te&&te(),q&&q.name==="TypeError"&&/Load failed|fetch/i.test(q.message)?Object.assign(new ce("Network Error",ce.ERR_NETWORK,m,se),{cause:q.cause||q}):ce.from(q,q&&q.code,m,se)}}},$1=new Map,fb=t=>{let e=t&&t.env||{};const{fetch:n,Request:i,Response:r}=e,s=[i,r,n];let o=s.length,a=o,l,c,u=$1;for(;a--;)l=s[a],c=u.get(l),c===void 0&&u.set(l,c=a?new Map:H1(e)),u=c;return c};fb();const _p={http:c1,xhr:F1,fetch:{get:fb}};I.forEach(_p,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const hv=t=>`- ${t}`,K1=t=>I.isFunction(t)||t===null||t===!1;function G1(t,e){t=I.isArray(t)?t:[t];const{length:n}=t;let i,r;const s={};for(let o=0;o<n;o++){i=t[o];let a;if(r=i,!K1(i)&&(r=_p[(a=String(i)).toLowerCase()],r===void 0))throw new ce(`Unknown adapter '${a}'`);if(r&&(I.isFunction(r)||(r=r.get(e))))break;s[a||"#"+o]=r}if(!r){const o=Object.entries(s).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=n?o.length>1?`since :
`+o.map(hv).join(`
`):" "+hv(o[0]):"as no adapter specified";throw new ce("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r}const pb={getAdapter:G1,adapters:_p};function rd(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new io(null,t)}function fv(t){return rd(t),t.headers=Zt.from(t.headers),t.data=id.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),pb.getAdapter(t.adapter||Da.adapter,t)(t).then(function(i){return rd(t),i.data=id.call(t,t.transformResponse,i),i.headers=Zt.from(i.headers),i},function(i){return cb(i)||(rd(t),i&&i.response&&(i.response.data=id.call(t,t.transformResponse,i.response),i.response.headers=Zt.from(i.response.headers))),Promise.reject(i)})}const mb="1.13.2",ou={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{ou[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}});const pv={};ou.transitional=function(e,n,i){function r(s,o){return"[Axios v"+mb+"] Transitional option '"+s+"'"+o+(i?". "+i:"")}return(s,o,a)=>{if(e===!1)throw new ce(r(o," has been removed"+(n?" in "+n:"")),ce.ERR_DEPRECATED);return n&&!pv[o]&&(pv[o]=!0,console.warn(r(o," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(s,o,a):!0}};ou.spelling=function(e){return(n,i)=>(console.warn(`${i} is likely a misspelling of ${e}`),!0)};function J1(t,e,n){if(typeof t!="object")throw new ce("options must be an object",ce.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const s=i[r],o=e[s];if(o){const a=t[s],l=a===void 0||o(a,s,t);if(l!==!0)throw new ce("option "+s+" must be "+l,ce.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new ce("Unknown option "+s,ce.ERR_BAD_OPTION)}}const Al={assertOptions:J1,validators:ou},$n=Al.validators;let Dr=class{constructor(e){this.defaults=e||{},this.interceptors={request:new nv,response:new nv}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const s=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Vr(this.defaults,n);const{transitional:i,paramsSerializer:r,headers:s}=n;i!==void 0&&Al.assertOptions(i,{silentJSONParsing:$n.transitional($n.boolean),forcedJSONParsing:$n.transitional($n.boolean),clarifyTimeoutError:$n.transitional($n.boolean)},!1),r!=null&&(I.isFunction(r)?n.paramsSerializer={serialize:r}:Al.assertOptions(r,{encode:$n.function,serialize:$n.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),Al.assertOptions(n,{baseUrl:$n.spelling("baseURL"),withXsrfToken:$n.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=s&&I.merge(s.common,s[n.method]);s&&I.forEach(["delete","get","head","post","put","patch","common"],m=>{delete s[m]}),n.headers=Zt.concat(o,s);const a=[];let l=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(n)===!1||(l=l&&v.synchronous,a.unshift(v.fulfilled,v.rejected))});const c=[];this.interceptors.response.forEach(function(v){c.push(v.fulfilled,v.rejected)});let u,d=0,h;if(!l){const m=[fv.bind(this),void 0];for(m.unshift(...a),m.push(...c),h=m.length,u=Promise.resolve(n);d<h;)u=u.then(m[d++],m[d++]);return u}h=a.length;let p=n;for(;d<h;){const m=a[d++],v=a[d++];try{p=m(p)}catch(T){v.call(this,T);break}}try{u=fv.call(this,p)}catch(m){return Promise.reject(m)}for(d=0,h=c.length;d<h;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=Vr(this.defaults,e);const n=db(e.baseURL,e.url,e.allowAbsoluteUrls);return ob(n,e.params,e.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(e){Dr.prototype[e]=function(n,i){return this.request(Vr(i||{},{method:e,url:n,data:(i||{}).data}))}});I.forEach(["post","put","patch"],function(e){function n(i){return function(s,o,a){return this.request(Vr(a||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Dr.prototype[e]=n(),Dr.prototype[e+"Form"]=n(!0)});let Q1=class gb{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(s){n=s});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const o=new Promise(a=>{i.subscribe(a),s=a}).then(r);return o.cancel=function(){i.unsubscribe(s)},o},e(function(s,o,a){i.reason||(i.reason=new io(s,o,a),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new gb(function(r){e=r}),cancel:e}}};function Y1(t){return function(n){return t.apply(null,n)}}function X1(t){return I.isObject(t)&&t.isAxiosError===!0}const Fh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Fh).forEach(([t,e])=>{Fh[e]=t});function vb(t){const e=new Dr(t),n=GS(Dr.prototype.request,e);return I.extend(n,Dr.prototype,e,{allOwnKeys:!0}),I.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return vb(Vr(t,r))},n}const X=vb(Da);X.Axios=Dr;X.CanceledError=io;X.CancelToken=Q1;X.isCancel=cb;X.VERSION=mb;X.toFormData=su;X.AxiosError=ce;X.Cancel=X.CanceledError;X.all=function(e){return Promise.all(e)};X.spread=Y1;X.isAxiosError=X1;X.mergeConfig=Vr;X.AxiosHeaders=Zt;X.formToJSON=t=>lb(I.isHTMLForm(t)?new FormData(t):t);X.getAdapter=pb.getAdapter;X.HttpStatusCode=Fh;X.default=X;const{Axios:tU,AxiosError:nU,CanceledError:iU,isCancel:rU,CancelToken:sU,VERSION:oU,all:aU,Cancel:lU,isAxiosError:cU,spread:uU,toFormData:dU,AxiosHeaders:hU,HttpStatusCode:fU,formToJSON:pU,getAdapter:mU,mergeConfig:gU}=X,yb=C.createContext(),sd="http://localhost:5000/api",ro=()=>{const t=C.useContext(yb);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},Z1=({children:t})=>{const[e,n]=C.useState(null),[i,r]=C.useState(!0),[s,o]=C.useState(localStorage.getItem("token"));C.useEffect(()=>{s?(X.defaults.headers.common.Authorization=`Bearer ${s}`,localStorage.setItem("token",s),a()):(delete X.defaults.headers.common.Authorization,localStorage.removeItem("token"),n(null),r(!1))},[s]);const a=async()=>{try{const h=await X.get(`${sd}/auth/verify`);n(h.data.user)}catch(h){console.error("Token verification failed:",h),o(null),n(null)}finally{r(!1)}},d={user:e,loading:i,register:async(h,p,m)=>{var v,T;try{const g=await X.post(`${sd}/auth/register`,{email:h,password:p,name:m});return o(g.data.token),n(g.data.user),{success:!0}}catch(g){return{success:!1,error:((T=(v=g.response)==null?void 0:v.data)==null?void 0:T.error)||"Registration failed"}}},login:async(h,p)=>{var m,v;try{const T=await X.post(`${sd}/auth/login`,{email:h,password:p});return o(T.data.token),n(T.data.user),{success:!0}}catch(T){return{success:!1,error:((v=(m=T.response)==null?void 0:m.data)==null?void 0:v.error)||"Login failed"}}},logout:()=>{o(null),n(null),delete X.defaults.headers.common.Authorization,localStorage.removeItem("token")},isAuthenticated:!!e};return f.jsx(yb.Provider,{value:d,children:t})};function e_(){const t=Gr(),e=Jr(),{user:n,logout:i}=ro(),r=()=>{i(),e("/login")};return f.jsxs("div",{className:"sidebar",children:[f.jsx("div",{className:"sidebar-header",children:f.jsx("h2",{className:"sidebar-logo",children:"AI Voice Agent"})}),f.jsxs("div",{className:"sidebar-section",children:[f.jsx("div",{className:"section-title",children:"BUILD"}),f.jsxs(Wo,{to:"/",className:`sidebar-link ${t.pathname==="/"?"active":""}`,children:[f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),f.jsx("path",{d:"M9 9h6v6H9z"})]}),f.jsx("span",{children:"Agents"})]}),f.jsxs(Wo,{to:"/knowledge-base",className:`sidebar-link ${t.pathname==="/knowledge-base"?"active":""}`,children:[f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),f.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),f.jsx("span",{children:"Knowledge Base"})]})]}),f.jsxs("div",{className:"sidebar-section",children:[f.jsx("div",{className:"section-title",children:"MONITOR"}),f.jsxs(Wo,{to:"/call-history",className:`sidebar-link ${t.pathname==="/call-history"?"active":""}`,children:[f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("circle",{cx:"12",cy:"12",r:"10"}),f.jsx("polyline",{points:"12 6 12 12 16 14"})]}),f.jsx("span",{children:"Call History"})]})]}),f.jsxs("div",{className:"sidebar-footer",children:[n&&f.jsxs("div",{className:"sidebar-user",children:[f.jsx("div",{className:"user-avatar",children:n.name.charAt(0).toUpperCase()}),f.jsxs("div",{className:"user-info",children:[f.jsx("div",{className:"user-name",children:n.name}),f.jsx("div",{className:"user-email",children:n.email})]})]}),f.jsxs("button",{className:"sidebar-logout",onClick:r,children:[f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),f.jsx("polyline",{points:"16 17 21 12 16 7"}),f.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),f.jsx("span",{children:"Logout"})]})]})]})}const ll="http://localhost:5000/api";function t_(){const t=Jr(),[e,n]=C.useState([]),[i,r]=C.useState(!0),[s,o]=C.useState(!1),[a,l]=C.useState("");C.useEffect(()=>{X.get(`${ll}/health`).then(()=>{c()}).catch(h=>{console.error("Backend server not reachable:",h),alert("Cannot connect to backend server. Please make sure the backend is running on http://localhost:5000/api"),r(!1)})},[]);const c=async()=>{try{const h=await X.get(`${ll}/agents`);return n(h.data),h.data}catch(h){return console.error("Error fetching agents:",h),n([]),[]}finally{r(!1)}},u=async()=>{var h,p;if(!a.trim()){alert("Please enter an agent name");return}try{const m=await X.post(`${ll}/agents`,{name:a.trim(),systemPrompt:""});n([...e,m.data]),o(!1),l(""),t(`/agent/${m.data.id}`)}catch(m){console.error("Error creating agent:",m);let v="Failed to create agent";m.response?v=((h=m.response.data)==null?void 0:h.error)||((p=m.response.data)==null?void 0:p.message)||`Server error: ${m.response.status}`:m.request?v="Cannot connect to server. Please make sure the backend is running on http://localhost:5000/api":v=m.message||"Failed to create agent",alert(v)}},d=async(h,p)=>{if(p.stopPropagation(),!!window.confirm("Are you sure you want to delete this agent?"))try{await X.delete(`${ll}/agents/${h}`),n(e.filter(m=>m.id!==h))}catch(m){console.error("Error deleting agent:",m),alert("Failed to delete agent")}};return i?f.jsx("div",{className:"dashboard-container",children:f.jsx("div",{className:"dashboard-loading",children:"Loading agents..."})}):f.jsxs("div",{className:"dashboard-container",children:[f.jsxs("div",{className:"dashboard-header",children:[f.jsx("h1",{className:"dashboard-title",children:"All Agents"}),f.jsx("div",{className:"dashboard-actions",children:f.jsx("button",{className:"btn-primary",onClick:()=>o(!0),children:"Create an Agent"})})]}),f.jsx("div",{className:"agents-grid",children:e.length===0?f.jsxs("div",{className:"empty-state",children:[f.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),f.jsx("path",{d:"M9 9h6v6H9z"})]}),f.jsx("h3",{children:"No agents yet"}),f.jsx("p",{children:"Create your first agent to get started"}),f.jsx("button",{className:"btn-primary",onClick:()=>o(!0),children:"Create an Agent"})]}):e.map(h=>f.jsxs("div",{className:"agent-card",onClick:()=>{localStorage.setItem("lastSelectedAgentId",h.id),t(`/agent/${h.id}`)},children:[f.jsxs("div",{className:"agent-card-header",children:[f.jsx("div",{className:"agent-icon",children:f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),f.jsx("path",{d:"M9 9h6v6H9z"})]})}),f.jsxs("div",{className:"agent-info",children:[f.jsx("h3",{className:"agent-name",children:h.name}),f.jsx("span",{className:"agent-type",children:"Single Prompt"})]}),f.jsx("button",{className:"agent-delete",onClick:p=>d(h.id,p),children:f.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:f.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})})})]}),f.jsx("div",{className:"agent-card-footer",children:f.jsxs("span",{className:"agent-meta",children:["Edited ",new Date(h.updatedAt).toLocaleDateString()]})})]},h.id))}),s&&f.jsx("div",{className:"modal-overlay",onClick:()=>o(!1),children:f.jsxs("div",{className:"modal-content",onClick:h=>h.stopPropagation(),children:[f.jsx("h2",{children:"Create New Agent"}),f.jsx("input",{type:"text",placeholder:"Agent name",value:a,onChange:h=>l(h.target.value),className:"modal-input",autoFocus:!0,onKeyPress:h=>h.key==="Enter"&&u()}),f.jsxs("div",{className:"modal-actions",children:[f.jsx("button",{className:"btn-secondary",onClick:()=>o(!1),children:"Cancel"}),f.jsx("button",{className:"btn-primary",onClick:u,children:"Create"})]})]})})]})}const kb=C.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),au=C.createContext({}),lu=C.createContext(null),cu=typeof document<"u",Ip=cu?C.useLayoutEffect:C.useEffect,Sb=C.createContext({strict:!1}),Ap=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n_="framerAppearId",bb="data-"+Ap(n_);function i_(t,e,n,i){const{visualElement:r}=C.useContext(au),s=C.useContext(Sb),o=C.useContext(lu),a=C.useContext(kb).reducedMotion,l=C.useRef();i=i||s.renderer,!l.current&&i&&(l.current=i(t,{visualState:e,parent:r,props:n,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:a}));const c=l.current;C.useInsertionEffect(()=>{c&&c.update(n,o)});const u=C.useRef(!!(n[bb]&&!window.HandoffComplete));return Ip(()=>{c&&(c.render(),u.current&&c.animationState&&c.animationState.animateChanges())}),C.useEffect(()=>{c&&(c.updateFeatures(),!u.current&&c.animationState&&c.animationState.animateChanges(),u.current&&(u.current=!1,window.HandoffComplete=!0))}),c}function ks(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function r_(t,e,n){return C.useCallback(i=>{i&&t.mount&&t.mount(i),e&&(i?e.mount(i):e.unmount()),n&&(typeof n=="function"?n(i):ks(n)&&(n.current=i))},[e])}function va(t){return typeof t=="string"||Array.isArray(t)}function uu(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const Np=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Op=["initial",...Np];function du(t){return uu(t.animate)||Op.some(e=>va(t[e]))}function Tb(t){return!!(du(t)||t.variants)}function s_(t,e){if(du(t)){const{initial:n,animate:i}=t;return{initial:n===!1||va(n)?n:void 0,animate:va(i)?i:void 0}}return t.inherit!==!1?e:{}}function o_(t){const{initial:e,animate:n}=s_(t,C.useContext(au));return C.useMemo(()=>({initial:e,animate:n}),[mv(e),mv(n)])}function mv(t){return Array.isArray(t)?t.join(" "):t}const gv={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ya={};for(const t in gv)ya[t]={isEnabled:e=>gv[t].some(n=>!!e[n])};function a_(t){for(const e in t)ya[e]={...ya[e],...t[e]}}const Dp=C.createContext({}),Cb=C.createContext({}),l_=Symbol.for("motionComponentSymbol");function c_({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:i,Component:r}){t&&a_(t);function s(a,l){let c;const u={...C.useContext(kb),...a,layoutId:u_(a)},{isStatic:d}=u,h=o_(a),p=i(a,d);if(!d&&cu){h.visualElement=i_(r,p,u,e);const m=C.useContext(Cb),v=C.useContext(Sb).strict;h.visualElement&&(c=h.visualElement.loadFeatures(u,v,t,m))}return C.createElement(au.Provider,{value:h},c&&h.visualElement?C.createElement(c,{visualElement:h.visualElement,...u}):null,n(r,a,r_(p,h.visualElement,l),p,d,h.visualElement))}const o=C.forwardRef(s);return o[l_]=r,o}function u_({layoutId:t}){const e=C.useContext(Dp).id;return e&&t!==void 0?e+"-"+t:t}function d_(t){function e(i,r={}){return c_(t(i,r))}if(typeof Proxy>"u")return e;const n=new Map;return new Proxy(e,{get:(i,r)=>(n.has(r)||n.set(r,e(r)),n.get(r))})}const h_=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Mp(t){return typeof t!="string"||t.includes("-")?!1:!!(h_.indexOf(t)>-1||/[A-Z]/.test(t))}const kc={};function f_(t){Object.assign(kc,t)}const Ma=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Qr=new Set(Ma);function wb(t,{layout:e,layoutId:n}){return Qr.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!kc[t]||t==="opacity")}const tn=t=>!!(t&&t.getVelocity),p_={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},m_=Ma.length;function g_(t,{enableHardwareAcceleration:e=!0,allowTransformNone:n=!0},i,r){let s="";for(let o=0;o<m_;o++){const a=Ma[o];if(t[a]!==void 0){const l=p_[a]||a;s+=`${l}(${t[a]}) `}}return e&&!t.z&&(s+="translateZ(0)"),s=s.trim(),r?s=r(t,i?"":s):n&&i&&(s="none"),s}const xb=t=>e=>typeof e=="string"&&e.startsWith(t),Eb=xb("--"),Bh=xb("var(--"),v_=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,y_=(t,e)=>e&&typeof t=="number"?e.transform(t):t,or=(t,e,n)=>Math.min(Math.max(n,t),e),Yr={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},qo={...Yr,transform:t=>or(0,1,t)},cl={...Yr,default:1},Ho=t=>Math.round(t*1e5)/1e5,hu=/(-)?([\d]*\.?[\d])+/g,Pb=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,k_=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function La(t){return typeof t=="string"}const ja=t=>({test:e=>La(e)&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Oi=ja("deg"),ei=ja("%"),re=ja("px"),S_=ja("vh"),b_=ja("vw"),vv={...ei,parse:t=>ei.parse(t)/100,transform:t=>ei.transform(t*100)},yv={...Yr,transform:Math.round},Rb={borderWidth:re,borderTopWidth:re,borderRightWidth:re,borderBottomWidth:re,borderLeftWidth:re,borderRadius:re,radius:re,borderTopLeftRadius:re,borderTopRightRadius:re,borderBottomRightRadius:re,borderBottomLeftRadius:re,width:re,maxWidth:re,height:re,maxHeight:re,size:re,top:re,right:re,bottom:re,left:re,padding:re,paddingTop:re,paddingRight:re,paddingBottom:re,paddingLeft:re,margin:re,marginTop:re,marginRight:re,marginBottom:re,marginLeft:re,rotate:Oi,rotateX:Oi,rotateY:Oi,rotateZ:Oi,scale:cl,scaleX:cl,scaleY:cl,scaleZ:cl,skew:Oi,skewX:Oi,skewY:Oi,distance:re,translateX:re,translateY:re,translateZ:re,x:re,y:re,z:re,perspective:re,transformPerspective:re,opacity:qo,originX:vv,originY:vv,originZ:re,zIndex:yv,fillOpacity:qo,strokeOpacity:qo,numOctaves:yv};function Lp(t,e,n,i){const{style:r,vars:s,transform:o,transformOrigin:a}=t;let l=!1,c=!1,u=!0;for(const d in e){const h=e[d];if(Eb(d)){s[d]=h;continue}const p=Rb[d],m=y_(h,p);if(Qr.has(d)){if(l=!0,o[d]=m,!u)continue;h!==(p.default||0)&&(u=!1)}else d.startsWith("origin")?(c=!0,a[d]=m):r[d]=m}if(e.transform||(l||i?r.transform=g_(t.transform,n,u,i):r.transform&&(r.transform="none")),c){const{originX:d="50%",originY:h="50%",originZ:p=0}=a;r.transformOrigin=`${d} ${h} ${p}`}}const jp=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function _b(t,e,n){for(const i in e)!tn(e[i])&&!wb(i,n)&&(t[i]=e[i])}function T_({transformTemplate:t},e,n){return C.useMemo(()=>{const i=jp();return Lp(i,e,{enableHardwareAcceleration:!n},t),Object.assign({},i.vars,i.style)},[e])}function C_(t,e,n){const i=t.style||{},r={};return _b(r,i,t),Object.assign(r,T_(t,e,n)),t.transformValues?t.transformValues(r):r}function w_(t,e,n){const i={},r=C_(t,e,n);return t.drag&&t.dragListener!==!1&&(i.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(i.tabIndex=0),i.style=r,i}const x_=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Sc(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||x_.has(t)}let Ib=t=>!Sc(t);function E_(t){t&&(Ib=e=>e.startsWith("on")?!Sc(e):t(e))}try{E_(require("@emotion/is-prop-valid").default)}catch{}function P_(t,e,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(Ib(r)||n===!0&&Sc(r)||!e&&!Sc(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}function kv(t,e,n){return typeof t=="string"?t:re.transform(e+n*t)}function R_(t,e,n){const i=kv(e,t.x,t.width),r=kv(n,t.y,t.height);return`${i} ${r}`}const __={offset:"stroke-dashoffset",array:"stroke-dasharray"},I_={offset:"strokeDashoffset",array:"strokeDasharray"};function A_(t,e,n=1,i=0,r=!0){t.pathLength=1;const s=r?__:I_;t[s.offset]=re.transform(-i);const o=re.transform(e),a=re.transform(n);t[s.array]=`${o} ${a}`}function Up(t,{attrX:e,attrY:n,attrScale:i,originX:r,originY:s,pathLength:o,pathSpacing:a=1,pathOffset:l=0,...c},u,d,h){if(Lp(t,c,u,h),d){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:p,style:m,dimensions:v}=t;p.transform&&(v&&(m.transform=p.transform),delete p.transform),v&&(r!==void 0||s!==void 0||m.transform)&&(m.transformOrigin=R_(v,r!==void 0?r:.5,s!==void 0?s:.5)),e!==void 0&&(p.x=e),n!==void 0&&(p.y=n),i!==void 0&&(p.scale=i),o!==void 0&&A_(p,o,a,l,!1)}const Ab=()=>({...jp(),attrs:{}}),Fp=t=>typeof t=="string"&&t.toLowerCase()==="svg";function N_(t,e,n,i){const r=C.useMemo(()=>{const s=Ab();return Up(s,e,{enableHardwareAcceleration:!1},Fp(i),t.transformTemplate),{...s.attrs,style:{...s.style}}},[e]);if(t.style){const s={};_b(s,t.style,t),r.style={...s,...r.style}}return r}function O_(t=!1){return(n,i,r,{latestValues:s},o)=>{const l=(Mp(n)?N_:w_)(i,s,o,n),u={...P_(i,typeof n=="string",t),...l,ref:r},{children:d}=i,h=C.useMemo(()=>tn(d)?d.get():d,[d]);return C.createElement(n,{...u,children:h})}}function Nb(t,{style:e,vars:n},i,r){Object.assign(t.style,e,r&&r.getProjectionStyles(i));for(const s in n)t.style.setProperty(s,n[s])}const Ob=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Db(t,e,n,i){Nb(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(Ob.has(r)?r:Ap(r),e.attrs[r])}function Bp(t,e){const{style:n}=t,i={};for(const r in n)(tn(n[r])||e.style&&tn(e.style[r])||wb(r,t))&&(i[r]=n[r]);return i}function Mb(t,e){const n=Bp(t,e);for(const i in t)if(tn(t[i])||tn(e[i])){const r=Ma.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;n[r]=t[i]}return n}function Vp(t,e,n,i={},r={}){return typeof e=="function"&&(e=e(n!==void 0?n:t.custom,i,r)),typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"&&(e=e(n!==void 0?n:t.custom,i,r)),e}function Lb(t){const e=C.useRef(null);return e.current===null&&(e.current=t()),e.current}const bc=t=>Array.isArray(t),D_=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),M_=t=>bc(t)?t[t.length-1]||0:t;function Nl(t){const e=tn(t)?t.get():t;return D_(e)?e.toValue():e}function L_({scrapeMotionValuesFromProps:t,createRenderState:e,onMount:n},i,r,s){const o={latestValues:j_(i,r,s,t),renderState:e()};return n&&(o.mount=a=>n(i,a,o)),o}const jb=t=>(e,n)=>{const i=C.useContext(au),r=C.useContext(lu),s=()=>L_(t,e,i,r);return n?s():Lb(s)};function j_(t,e,n,i){const r={},s=i(t,{});for(const h in s)r[h]=Nl(s[h]);let{initial:o,animate:a}=t;const l=du(t),c=Tb(t);e&&c&&!l&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const d=u?a:o;return d&&typeof d!="boolean"&&!uu(d)&&(Array.isArray(d)?d:[d]).forEach(p=>{const m=Vp(t,p);if(!m)return;const{transitionEnd:v,transition:T,...g}=m;for(const y in g){let S=g[y];if(Array.isArray(S)){const k=u?S.length-1:0;S=S[k]}S!==null&&(r[y]=S)}for(const y in v)r[y]=v[y]}),r}const nt=t=>t;class Sv{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const n=this.order.indexOf(e);n!==-1&&(this.order.splice(n,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function U_(t){let e=new Sv,n=new Sv,i=0,r=!1,s=!1;const o=new WeakSet,a={schedule:(l,c=!1,u=!1)=>{const d=u&&r,h=d?e:n;return c&&o.add(l),h.add(l)&&d&&r&&(i=e.order.length),l},cancel:l=>{n.remove(l),o.delete(l)},process:l=>{if(r){s=!0;return}if(r=!0,[e,n]=[n,e],n.clear(),i=e.order.length,i)for(let c=0;c<i;c++){const u=e.order[c];u(l),o.has(u)&&(a.schedule(u),t())}r=!1,s&&(s=!1,a.process(l))}};return a}const ul=["prepare","read","update","preRender","render","postRender"],F_=40;function B_(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=ul.reduce((d,h)=>(d[h]=U_(()=>n=!0),d),{}),o=d=>s[d].process(r),a=()=>{const d=performance.now();n=!1,r.delta=i?1e3/60:Math.max(Math.min(d-r.timestamp,F_),1),r.timestamp=d,r.isProcessing=!0,ul.forEach(o),r.isProcessing=!1,n&&e&&(i=!1,t(a))},l=()=>{n=!0,i=!0,r.isProcessing||t(a)};return{schedule:ul.reduce((d,h)=>{const p=s[h];return d[h]=(m,v=!1,T=!1)=>(n||l(),p.schedule(m,v,T)),d},{}),cancel:d=>ul.forEach(h=>s[h].cancel(d)),state:r,steps:s}}const{schedule:je,cancel:xi,state:At,steps:od}=B_(typeof requestAnimationFrame<"u"?requestAnimationFrame:nt,!0),V_={useVisualState:jb({scrapeMotionValuesFromProps:Mb,createRenderState:Ab,onMount:(t,e,{renderState:n,latestValues:i})=>{je.read(()=>{try{n.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),je.render(()=>{Up(n,i,{enableHardwareAcceleration:!1},Fp(e.tagName),t.transformTemplate),Db(e,n)})}})},z_={useVisualState:jb({scrapeMotionValuesFromProps:Bp,createRenderState:jp})};function W_(t,{forwardMotionProps:e=!1},n,i){return{...Mp(t)?V_:z_,preloadedFeatures:n,useRender:O_(e),createVisualElement:i,Component:t}}function vi(t,e,n,i={passive:!0}){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}const Ub=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function fu(t,e="page"){return{point:{x:t[e+"X"],y:t[e+"Y"]}}}const q_=t=>e=>Ub(e)&&t(e,fu(e));function ki(t,e,n,i){return vi(t,e,q_(n),i)}const H_=(t,e)=>n=>e(t(n)),er=(...t)=>t.reduce(H_);function Fb(t){let e=null;return()=>{const n=()=>{e=null};return e===null?(e=t,n):!1}}const bv=Fb("dragHorizontal"),Tv=Fb("dragVertical");function Bb(t){let e=!1;if(t==="y")e=Tv();else if(t==="x")e=bv();else{const n=bv(),i=Tv();n&&i?e=()=>{n(),i()}:(n&&n(),i&&i())}return e}function Vb(){const t=Bb(!0);return t?(t(),!1):!0}class pr{constructor(e){this.isMounted=!1,this.node=e}update(){}}function Cv(t,e){const n="pointer"+(e?"enter":"leave"),i="onHover"+(e?"Start":"End"),r=(s,o)=>{if(s.pointerType==="touch"||Vb())return;const a=t.getProps();t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",e),a[i]&&je.update(()=>a[i](s,o))};return ki(t.current,n,r,{passive:!t.getProps()[i]})}class $_ extends pr{mount(){this.unmount=er(Cv(this.node,!0),Cv(this.node,!1))}unmount(){}}class K_ extends pr{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=er(vi(this.node.current,"focus",()=>this.onFocus()),vi(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const zb=(t,e)=>e?t===e?!0:zb(t,e.parentElement):!1;function ad(t,e){if(!e)return;const n=new PointerEvent("pointer"+t);e(n,fu(n))}class G_ extends pr{constructor(){super(...arguments),this.removeStartListeners=nt,this.removeEndListeners=nt,this.removeAccessibleListeners=nt,this.startPointerPress=(e,n)=>{if(this.isPressing)return;this.removeEndListeners();const i=this.node.getProps(),s=ki(window,"pointerup",(a,l)=>{if(!this.checkPressEnd())return;const{onTap:c,onTapCancel:u,globalTapTarget:d}=this.node.getProps();je.update(()=>{!d&&!zb(this.node.current,a.target)?u&&u(a,l):c&&c(a,l)})},{passive:!(i.onTap||i.onPointerUp)}),o=ki(window,"pointercancel",(a,l)=>this.cancelPress(a,l),{passive:!(i.onTapCancel||i.onPointerCancel)});this.removeEndListeners=er(s,o),this.startPress(e,n)},this.startAccessiblePress=()=>{const e=s=>{if(s.key!=="Enter"||this.isPressing)return;const o=a=>{a.key!=="Enter"||!this.checkPressEnd()||ad("up",(l,c)=>{const{onTap:u}=this.node.getProps();u&&je.update(()=>u(l,c))})};this.removeEndListeners(),this.removeEndListeners=vi(this.node.current,"keyup",o),ad("down",(a,l)=>{this.startPress(a,l)})},n=vi(this.node.current,"keydown",e),i=()=>{this.isPressing&&ad("cancel",(s,o)=>this.cancelPress(s,o))},r=vi(this.node.current,"blur",i);this.removeAccessibleListeners=er(n,r)}}startPress(e,n){this.isPressing=!0;const{onTapStart:i,whileTap:r}=this.node.getProps();r&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),i&&je.update(()=>i(e,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!Vb()}cancelPress(e,n){if(!this.checkPressEnd())return;const{onTapCancel:i}=this.node.getProps();i&&je.update(()=>i(e,n))}mount(){const e=this.node.getProps(),n=ki(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),i=vi(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=er(n,i)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Vh=new WeakMap,ld=new WeakMap,J_=t=>{const e=Vh.get(t.target);e&&e(t)},Q_=t=>{t.forEach(J_)};function Y_({root:t,...e}){const n=t||document;ld.has(n)||ld.set(n,{});const i=ld.get(n),r=JSON.stringify(e);return i[r]||(i[r]=new IntersectionObserver(Q_,{root:t,...e})),i[r]}function X_(t,e,n){const i=Y_(e);return Vh.set(t,n),i.observe(t),()=>{Vh.delete(t),i.unobserve(t)}}const Z_={some:0,all:1};class eI extends pr{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:s}=e,o={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:Z_[r]},a=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:d}=this.node.getProps(),h=c?u:d;h&&h(l)};return X_(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(tI(e,n))&&this.startObserver()}unmount(){}}function tI({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const nI={inView:{Feature:eI},tap:{Feature:G_},focus:{Feature:K_},hover:{Feature:$_}};function Wb(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function iI(t){const e={};return t.values.forEach((n,i)=>e[i]=n.get()),e}function rI(t){const e={};return t.values.forEach((n,i)=>e[i]=n.getVelocity()),e}function pu(t,e,n){const i=t.getProps();return Vp(i,e,n!==void 0?n:i.custom,iI(t),rI(t))}let zp=nt;const Mr=t=>t*1e3,Si=t=>t/1e3,sI={current:!1},qb=t=>Array.isArray(t)&&typeof t[0]=="number";function Hb(t){return!!(!t||typeof t=="string"&&$b[t]||qb(t)||Array.isArray(t)&&t.every(Hb))}const Io=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,$b={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Io([0,.65,.55,1]),circOut:Io([.55,0,1,.45]),backIn:Io([.31,.01,.66,-.59]),backOut:Io([.33,1.53,.69,.99])};function Kb(t){if(t)return qb(t)?Io(t):Array.isArray(t)?t.map(Kb):$b[t]}function oI(t,e,n,{delay:i=0,duration:r,repeat:s=0,repeatType:o="loop",ease:a,times:l}={}){const c={[e]:n};l&&(c.offset=l);const u=Kb(a);return Array.isArray(u)&&(c.easing=u),t.animate(c,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:s+1,direction:o==="reverse"?"alternate":"normal"})}function aI(t,{repeat:e,repeatType:n="loop"}){const i=e&&n!=="loop"&&e%2===1?0:t.length-1;return t[i]}const Gb=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,lI=1e-7,cI=12;function uI(t,e,n,i,r){let s,o,a=0;do o=e+(n-e)/2,s=Gb(o,i,r)-t,s>0?n=o:e=o;while(Math.abs(s)>lI&&++a<cI);return o}function Ua(t,e,n,i){if(t===e&&n===i)return nt;const r=s=>uI(s,0,1,t,n);return s=>s===0||s===1?s:Gb(r(s),e,i)}const dI=Ua(.42,0,1,1),hI=Ua(0,0,.58,1),Jb=Ua(.42,0,.58,1),fI=t=>Array.isArray(t)&&typeof t[0]!="number",Qb=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,Yb=t=>e=>1-t(1-e),Wp=t=>1-Math.sin(Math.acos(t)),Xb=Yb(Wp),pI=Qb(Wp),Zb=Ua(.33,1.53,.69,.99),qp=Yb(Zb),mI=Qb(qp),gI=t=>(t*=2)<1?.5*qp(t):.5*(2-Math.pow(2,-10*(t-1))),vI={linear:nt,easeIn:dI,easeInOut:Jb,easeOut:hI,circIn:Wp,circInOut:pI,circOut:Xb,backIn:qp,backInOut:mI,backOut:Zb,anticipate:gI},wv=t=>{if(Array.isArray(t)){zp(t.length===4);const[e,n,i,r]=t;return Ua(e,n,i,r)}else if(typeof t=="string")return vI[t];return t},Hp=(t,e)=>n=>!!(La(n)&&k_.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),eT=(t,e,n)=>i=>{if(!La(i))return i;const[r,s,o,a]=i.match(hu);return{[t]:parseFloat(r),[e]:parseFloat(s),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},yI=t=>or(0,255,t),cd={...Yr,transform:t=>Math.round(yI(t))},Ar={test:Hp("rgb","red"),parse:eT("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:i=1})=>"rgba("+cd.transform(t)+", "+cd.transform(e)+", "+cd.transform(n)+", "+Ho(qo.transform(i))+")"};function kI(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const zh={test:Hp("#"),parse:kI,transform:Ar.transform},Ss={test:Hp("hsl","hue"),parse:eT("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+ei.transform(Ho(e))+", "+ei.transform(Ho(n))+", "+Ho(qo.transform(i))+")"},Mt={test:t=>Ar.test(t)||zh.test(t)||Ss.test(t),parse:t=>Ar.test(t)?Ar.parse(t):Ss.test(t)?Ss.parse(t):zh.parse(t),transform:t=>La(t)?t:t.hasOwnProperty("red")?Ar.transform(t):Ss.transform(t)},He=(t,e,n)=>-n*t+n*e+t;function ud(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function SI({hue:t,saturation:e,lightness:n,alpha:i}){t/=360,e/=100,n/=100;let r=0,s=0,o=0;if(!e)r=s=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=ud(l,a,t+1/3),s=ud(l,a,t),o=ud(l,a,t-1/3)}return{red:Math.round(r*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:i}}const dd=(t,e,n)=>{const i=t*t;return Math.sqrt(Math.max(0,n*(e*e-i)+i))},bI=[zh,Ar,Ss],TI=t=>bI.find(e=>e.test(t));function xv(t){const e=TI(t);let n=e.parse(t);return e===Ss&&(n=SI(n)),n}const tT=(t,e)=>{const n=xv(t),i=xv(e),r={...n};return s=>(r.red=dd(n.red,i.red,s),r.green=dd(n.green,i.green,s),r.blue=dd(n.blue,i.blue,s),r.alpha=He(n.alpha,i.alpha,s),Ar.transform(r))};function CI(t){var e,n;return isNaN(t)&&La(t)&&(((e=t.match(hu))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(Pb))===null||n===void 0?void 0:n.length)||0)>0}const nT={regex:v_,countKey:"Vars",token:"${v}",parse:nt},iT={regex:Pb,countKey:"Colors",token:"${c}",parse:Mt.parse},rT={regex:hu,countKey:"Numbers",token:"${n}",parse:Yr.parse};function hd(t,{regex:e,countKey:n,token:i,parse:r}){const s=t.tokenised.match(e);s&&(t["num"+n]=s.length,t.tokenised=t.tokenised.replace(e,i),t.values.push(...s.map(r)))}function Tc(t){const e=t.toString(),n={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return n.value.includes("var(--")&&hd(n,nT),hd(n,iT),hd(n,rT),n}function sT(t){return Tc(t).values}function oT(t){const{values:e,numColors:n,numVars:i,tokenised:r}=Tc(t),s=e.length;return o=>{let a=r;for(let l=0;l<s;l++)l<i?a=a.replace(nT.token,o[l]):l<i+n?a=a.replace(iT.token,Mt.transform(o[l])):a=a.replace(rT.token,Ho(o[l]));return a}}const wI=t=>typeof t=="number"?0:t;function xI(t){const e=sT(t);return oT(t)(e.map(wI))}const ar={test:CI,parse:sT,createTransformer:oT,getAnimatableNone:xI},aT=(t,e)=>n=>`${n>0?e:t}`;function lT(t,e){return typeof t=="number"?n=>He(t,e,n):Mt.test(t)?tT(t,e):t.startsWith("var(")?aT(t,e):uT(t,e)}const cT=(t,e)=>{const n=[...t],i=n.length,r=t.map((s,o)=>lT(s,e[o]));return s=>{for(let o=0;o<i;o++)n[o]=r[o](s);return n}},EI=(t,e)=>{const n={...t,...e},i={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(i[r]=lT(t[r],e[r]));return r=>{for(const s in i)n[s]=i[s](r);return n}},uT=(t,e)=>{const n=ar.createTransformer(e),i=Tc(t),r=Tc(e);return i.numVars===r.numVars&&i.numColors===r.numColors&&i.numNumbers>=r.numNumbers?er(cT(i.values,r.values),n):aT(t,e)},ka=(t,e,n)=>{const i=e-t;return i===0?1:(n-t)/i},Ev=(t,e)=>n=>He(t,e,n);function PI(t){return typeof t=="number"?Ev:typeof t=="string"?Mt.test(t)?tT:uT:Array.isArray(t)?cT:typeof t=="object"?EI:Ev}function RI(t,e,n){const i=[],r=n||PI(t[0]),s=t.length-1;for(let o=0;o<s;o++){let a=r(t[o],t[o+1]);if(e){const l=Array.isArray(e)?e[o]||nt:e;a=er(l,a)}i.push(a)}return i}function dT(t,e,{clamp:n=!0,ease:i,mixer:r}={}){const s=t.length;if(zp(s===e.length),s===1)return()=>e[0];t[0]>t[s-1]&&(t=[...t].reverse(),e=[...e].reverse());const o=RI(e,i,r),a=o.length,l=c=>{let u=0;if(a>1)for(;u<t.length-2&&!(c<t[u+1]);u++);const d=ka(t[u],t[u+1],c);return o[u](d)};return n?c=>l(or(t[0],t[s-1],c)):l}function _I(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=ka(0,e,i);t.push(He(n,1,r))}}function II(t){const e=[0];return _I(e,t.length-1),e}function AI(t,e){return t.map(n=>n*e)}function NI(t,e){return t.map(()=>e||Jb).splice(0,t.length-1)}function Cc({duration:t=300,keyframes:e,times:n,ease:i="easeInOut"}){const r=fI(i)?i.map(wv):wv(i),s={done:!1,value:e[0]},o=AI(n&&n.length===e.length?n:II(e),t),a=dT(o,e,{ease:Array.isArray(r)?r:NI(e,r)});return{calculatedDuration:t,next:l=>(s.value=a(l),s.done=l>=t,s)}}function hT(t,e){return e?t*(1e3/e):0}const OI=5;function fT(t,e,n){const i=Math.max(e-OI,0);return hT(n-t(i),e-i)}const fd=.001,DI=.01,MI=10,LI=.05,jI=1;function UI({duration:t=800,bounce:e=.25,velocity:n=0,mass:i=1}){let r,s,o=1-e;o=or(LI,jI,o),t=or(DI,MI,Si(t)),o<1?(r=c=>{const u=c*o,d=u*t,h=u-n,p=Wh(c,o),m=Math.exp(-d);return fd-h/p*m},s=c=>{const d=c*o*t,h=d*n+n,p=Math.pow(o,2)*Math.pow(c,2)*t,m=Math.exp(-d),v=Wh(Math.pow(c,2),o);return(-r(c)+fd>0?-1:1)*((h-p)*m)/v}):(r=c=>{const u=Math.exp(-c*t),d=(c-n)*t+1;return-fd+u*d},s=c=>{const u=Math.exp(-c*t),d=(n-c)*(t*t);return u*d});const a=5/t,l=BI(r,s,a);if(t=Mr(t),isNaN(l))return{stiffness:100,damping:10,duration:t};{const c=Math.pow(l,2)*i;return{stiffness:c,damping:o*2*Math.sqrt(i*c),duration:t}}}const FI=12;function BI(t,e,n){let i=n;for(let r=1;r<FI;r++)i=i-t(i)/e(i);return i}function Wh(t,e){return t*Math.sqrt(1-e*e)}const VI=["duration","bounce"],zI=["stiffness","damping","mass"];function Pv(t,e){return e.some(n=>t[n]!==void 0)}function WI(t){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!Pv(t,zI)&&Pv(t,VI)){const n=UI(t);e={...e,...n,mass:1},e.isResolvedFromDuration=!0}return e}function pT({keyframes:t,restDelta:e,restSpeed:n,...i}){const r=t[0],s=t[t.length-1],o={done:!1,value:r},{stiffness:a,damping:l,mass:c,duration:u,velocity:d,isResolvedFromDuration:h}=WI({...i,velocity:-Si(i.velocity||0)}),p=d||0,m=l/(2*Math.sqrt(a*c)),v=s-r,T=Si(Math.sqrt(a/c)),g=Math.abs(v)<5;n||(n=g?.01:2),e||(e=g?.005:.5);let y;if(m<1){const S=Wh(T,m);y=k=>{const b=Math.exp(-m*T*k);return s-b*((p+m*T*v)/S*Math.sin(S*k)+v*Math.cos(S*k))}}else if(m===1)y=S=>s-Math.exp(-T*S)*(v+(p+T*v)*S);else{const S=T*Math.sqrt(m*m-1);y=k=>{const b=Math.exp(-m*T*k),x=Math.min(S*k,300);return s-b*((p+m*T*v)*Math.sinh(x)+S*v*Math.cosh(x))/S}}return{calculatedDuration:h&&u||null,next:S=>{const k=y(S);if(h)o.done=S>=u;else{let b=p;S!==0&&(m<1?b=fT(y,S,k):b=0);const x=Math.abs(b)<=n,E=Math.abs(s-k)<=e;o.done=x&&E}return o.value=o.done?s:k,o}}}function Rv({keyframes:t,velocity:e=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:u}){const d=t[0],h={done:!1,value:d},p=P=>a!==void 0&&P<a||l!==void 0&&P>l,m=P=>a===void 0?l:l===void 0||Math.abs(a-P)<Math.abs(l-P)?a:l;let v=n*e;const T=d+v,g=o===void 0?T:o(T);g!==T&&(v=g-d);const y=P=>-v*Math.exp(-P/i),S=P=>g+y(P),k=P=>{const A=y(P),O=S(P);h.done=Math.abs(A)<=c,h.value=h.done?g:O};let b,x;const E=P=>{p(h.value)&&(b=P,x=pT({keyframes:[h.value,m(h.value)],velocity:fT(S,P,h.value),damping:r,stiffness:s,restDelta:c,restSpeed:u}))};return E(0),{calculatedDuration:null,next:P=>{let A=!1;return!x&&b===void 0&&(A=!0,k(P),E(P)),b!==void 0&&P>b?x.next(P-b):(!A&&k(P),h)}}}const qI=t=>{const e=({timestamp:n})=>t(n);return{start:()=>je.update(e,!0),stop:()=>xi(e),now:()=>At.isProcessing?At.timestamp:performance.now()}},_v=2e4;function Iv(t){let e=0;const n=50;let i=t.next(e);for(;!i.done&&e<_v;)e+=n,i=t.next(e);return e>=_v?1/0:e}const HI={decay:Rv,inertia:Rv,tween:Cc,keyframes:Cc,spring:pT};function wc({autoplay:t=!0,delay:e=0,driver:n=qI,keyframes:i,type:r="keyframes",repeat:s=0,repeatDelay:o=0,repeatType:a="loop",onPlay:l,onStop:c,onComplete:u,onUpdate:d,...h}){let p=1,m=!1,v,T;const g=()=>{T=new Promise($=>{v=$})};g();let y;const S=HI[r]||Cc;let k;S!==Cc&&typeof i[0]!="number"&&(k=dT([0,100],i,{clamp:!1}),i=[0,100]);const b=S({...h,keyframes:i});let x;a==="mirror"&&(x=S({...h,keyframes:[...i].reverse(),velocity:-(h.velocity||0)}));let E="idle",P=null,A=null,O=null;b.calculatedDuration===null&&s&&(b.calculatedDuration=Iv(b));const{calculatedDuration:W}=b;let J=1/0,se=1/0;W!==null&&(J=W+o,se=J*(s+1)-o);let te=0;const xe=$=>{if(A===null)return;p>0&&(A=Math.min(A,$)),p<0&&(A=Math.min($-se/p,A)),P!==null?te=P:te=Math.round($-A)*p;const ee=te-e*(p>=0?1:-1),De=p>=0?ee<0:ee>se;te=Math.max(ee,0),E==="finished"&&P===null&&(te=se);let pe=te,Xe=b;if(s){const ne=Math.min(te,se)/J;let me=Math.floor(ne),de=ne%1;!de&&ne>=1&&(de=1),de===1&&me--,me=Math.min(me,s+1),!!(me%2)&&(a==="reverse"?(de=1-de,o&&(de-=o/J)):a==="mirror"&&(Xe=x)),pe=or(0,1,de)*J}const le=De?{done:!1,value:i[0]}:Xe.next(pe);k&&(le.value=k(le.value));let{done:ct}=le;!De&&W!==null&&(ct=p>=0?te>=se:te<=0);const ue=P===null&&(E==="finished"||E==="running"&&ct);return d&&d(le.value),ue&&D(),le},q=()=>{y&&y.stop(),y=void 0},Re=()=>{E="idle",q(),v(),g(),A=O=null},D=()=>{E="finished",u&&u(),q(),v()},N=()=>{if(m)return;y||(y=n(xe));const $=y.now();l&&l(),P!==null?A=$-P:(!A||E==="finished")&&(A=$),E==="finished"&&g(),O=A,P=null,E="running",y.start()};t&&N();const j={then($,ee){return T.then($,ee)},get time(){return Si(te)},set time($){$=Mr($),te=$,P!==null||!y||p===0?P=$:A=y.now()-$/p},get duration(){const $=b.calculatedDuration===null?Iv(b):b.calculatedDuration;return Si($)},get speed(){return p},set speed($){$===p||!y||(p=$,j.time=Si(te))},get state(){return E},play:N,pause:()=>{E="paused",P=te},stop:()=>{m=!0,E!=="idle"&&(E="idle",c&&c(),Re())},cancel:()=>{O!==null&&xe(O),Re()},complete:()=>{E="finished"},sample:$=>(A=0,xe($))};return j}function $I(t){let e;return()=>(e===void 0&&(e=t()),e)}const KI=$I(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),GI=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),dl=10,JI=2e4,QI=(t,e)=>e.type==="spring"||t==="backgroundColor"||!Hb(e.ease);function YI(t,e,{onUpdate:n,onComplete:i,...r}){if(!(KI()&&GI.has(e)&&!r.repeatDelay&&r.repeatType!=="mirror"&&r.damping!==0&&r.type!=="inertia"))return!1;let o=!1,a,l,c=!1;const u=()=>{l=new Promise(S=>{a=S})};u();let{keyframes:d,duration:h=300,ease:p,times:m}=r;if(QI(e,r)){const S=wc({...r,repeat:0,delay:0});let k={done:!1,value:d[0]};const b=[];let x=0;for(;!k.done&&x<JI;)k=S.sample(x),b.push(k.value),x+=dl;m=void 0,d=b,h=x-dl,p="linear"}const v=oI(t.owner.current,e,d,{...r,duration:h,ease:p,times:m}),T=()=>{c=!1,v.cancel()},g=()=>{c=!0,je.update(T),a(),u()};return v.onfinish=()=>{c||(t.set(aI(d,r)),i&&i(),g())},{then(S,k){return l.then(S,k)},attachTimeline(S){return v.timeline=S,v.onfinish=null,nt},get time(){return Si(v.currentTime||0)},set time(S){v.currentTime=Mr(S)},get speed(){return v.playbackRate},set speed(S){v.playbackRate=S},get duration(){return Si(h)},play:()=>{o||(v.play(),xi(T))},pause:()=>v.pause(),stop:()=>{if(o=!0,v.playState==="idle")return;const{currentTime:S}=v;if(S){const k=wc({...r,autoplay:!1});t.setWithVelocity(k.sample(S-dl).value,k.sample(S).value,dl)}g()},complete:()=>{c||v.finish()},cancel:g}}function XI({keyframes:t,delay:e,onUpdate:n,onComplete:i}){const r=()=>(n&&n(t[t.length-1]),i&&i(),{time:0,speed:1,duration:0,play:nt,pause:nt,stop:nt,then:s=>(s(),Promise.resolve()),cancel:nt,complete:nt});return e?wc({keyframes:[0,1],duration:0,delay:e,onComplete:r}):r()}const ZI={type:"spring",stiffness:500,damping:25,restSpeed:10},eA=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),tA={type:"keyframes",duration:.8},nA={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},iA=(t,{keyframes:e})=>e.length>2?tA:Qr.has(t)?t.startsWith("scale")?eA(e[1]):ZI:nA,qh=(t,e)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(ar.test(e)||e==="0")&&!e.startsWith("url(")),rA=new Set(["brightness","contrast","saturate","opacity"]);function sA(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=n.match(hu)||[];if(!i)return t;const r=n.replace(i,"");let s=rA.has(e)?1:0;return i!==n&&(s*=100),e+"("+s+r+")"}const oA=/([a-z-]*)\(.*?\)/g,Hh={...ar,getAnimatableNone:t=>{const e=t.match(oA);return e?e.map(sA).join(" "):t}},aA={...Rb,color:Mt,backgroundColor:Mt,outlineColor:Mt,fill:Mt,stroke:Mt,borderColor:Mt,borderTopColor:Mt,borderRightColor:Mt,borderBottomColor:Mt,borderLeftColor:Mt,filter:Hh,WebkitFilter:Hh},$p=t=>aA[t];function mT(t,e){let n=$p(t);return n!==Hh&&(n=ar),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const gT=t=>/^0[^.\s]+$/.test(t);function lA(t){if(typeof t=="number")return t===0;if(t!==null)return t==="none"||t==="0"||gT(t)}function cA(t,e,n,i){const r=qh(e,n);let s;Array.isArray(n)?s=[...n]:s=[null,n];const o=i.from!==void 0?i.from:t.get();let a;const l=[];for(let c=0;c<s.length;c++)s[c]===null&&(s[c]=c===0?o:s[c-1]),lA(s[c])&&l.push(c),typeof s[c]=="string"&&s[c]!=="none"&&s[c]!=="0"&&(a=s[c]);if(r&&l.length&&a)for(let c=0;c<l.length;c++){const u=l[c];s[u]=mT(e,a)}return s}function uA({when:t,delay:e,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:s,repeatType:o,repeatDelay:a,from:l,elapsed:c,...u}){return!!Object.keys(u).length}function Kp(t,e){return t[e]||t.default||t}const dA={skipAnimations:!1},Gp=(t,e,n,i={})=>r=>{const s=Kp(i,t)||{},o=s.delay||i.delay||0;let{elapsed:a=0}=i;a=a-Mr(o);const l=cA(e,t,n,s),c=l[0],u=l[l.length-1],d=qh(t,c),h=qh(t,u);let p={keyframes:l,velocity:e.getVelocity(),ease:"easeOut",...s,delay:-a,onUpdate:m=>{e.set(m),s.onUpdate&&s.onUpdate(m)},onComplete:()=>{r(),s.onComplete&&s.onComplete()}};if(uA(s)||(p={...p,...iA(t,p)}),p.duration&&(p.duration=Mr(p.duration)),p.repeatDelay&&(p.repeatDelay=Mr(p.repeatDelay)),!d||!h||sI.current||s.type===!1||dA.skipAnimations)return XI(p);if(!i.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const m=YI(e,t,p);if(m)return m}return wc(p)};function xc(t){return!!(tn(t)&&t.add)}const vT=t=>/^\-?\d*\.?\d+$/.test(t);function Jp(t,e){t.indexOf(e)===-1&&t.push(e)}function Qp(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class Yp{constructor(){this.subscriptions=[]}add(e){return Jp(this.subscriptions,e),()=>Qp(this.subscriptions,e)}notify(e,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,i);else for(let s=0;s<r;s++){const o=this.subscriptions[s];o&&o(e,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const hA=t=>!isNaN(parseFloat(t));class fA{constructor(e,n={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(i,r=!0)=>{this.prev=this.current,this.current=i;const{delta:s,timestamp:o}=At;this.lastUpdated!==o&&(this.timeDelta=s,this.lastUpdated=o,je.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>je.postRender(this.velocityCheck),this.velocityCheck=({timestamp:i})=>{i!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=hA(this.current),this.owner=n.owner}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Yp);const i=this.events[e].add(n);return e==="change"?()=>{i(),je.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,i){this.set(n),this.prev=e,this.timeDelta=i}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?hT(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ks(t,e){return new fA(t,e)}const yT=t=>e=>e.test(t),pA={test:t=>t==="auto",parse:t=>t},kT=[Yr,re,ei,Oi,b_,S_,pA],yo=t=>kT.find(yT(t)),mA=[...kT,Mt,ar],gA=t=>mA.find(yT(t));function vA(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,Ks(n))}function yA(t,e){const n=pu(t,e);let{transitionEnd:i={},transition:r={},...s}=n?t.makeTargetAnimatable(n,!1):{};s={...s,...i};for(const o in s){const a=M_(s[o]);vA(t,o,a)}}function kA(t,e,n){var i,r;const s=Object.keys(e).filter(a=>!t.hasValue(a)),o=s.length;if(o)for(let a=0;a<o;a++){const l=s[a],c=e[l];let u=null;Array.isArray(c)&&(u=c[0]),u===null&&(u=(r=(i=n[l])!==null&&i!==void 0?i:t.readValue(l))!==null&&r!==void 0?r:e[l]),u!=null&&(typeof u=="string"&&(vT(u)||gT(u))?u=parseFloat(u):!gA(u)&&ar.test(c)&&(u=mT(l,c)),t.addValue(l,Ks(u,{owner:t})),n[l]===void 0&&(n[l]=u),u!==null&&t.setBaseTarget(l,u))}}function SA(t,e){return e?(e[t]||e.default||e).from:void 0}function bA(t,e,n){const i={};for(const r in t){const s=SA(r,e);if(s!==void 0)i[r]=s;else{const o=n.getValue(r);o&&(i[r]=o.get())}}return i}function TA({protectedKeys:t,needsAnimating:e},n){const i=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,i}function CA(t,e){const n=t.get();if(Array.isArray(e)){for(let i=0;i<e.length;i++)if(e[i]!==n)return!0}else return n!==e}function ST(t,e,{delay:n=0,transitionOverride:i,type:r}={}){let{transition:s=t.getDefaultTransition(),transitionEnd:o,...a}=t.makeTargetAnimatable(e);const l=t.getValue("willChange");i&&(s=i);const c=[],u=r&&t.animationState&&t.animationState.getState()[r];for(const d in a){const h=t.getValue(d),p=a[d];if(!h||p===void 0||u&&TA(u,d))continue;const m={delay:n,elapsed:0,...Kp(s||{},d)};if(window.HandoffAppearAnimations){const g=t.getProps()[bb];if(g){const y=window.HandoffAppearAnimations(g,d,h,je);y!==null&&(m.elapsed=y,m.isHandoff=!0)}}let v=!m.isHandoff&&!CA(h,p);if(m.type==="spring"&&(h.getVelocity()||m.velocity)&&(v=!1),h.animation&&(v=!1),v)continue;h.start(Gp(d,h,p,t.shouldReduceMotion&&Qr.has(d)?{type:!1}:m));const T=h.animation;xc(l)&&(l.add(d),T.then(()=>l.remove(d))),c.push(T)}return o&&Promise.all(c).then(()=>{o&&yA(t,o)}),c}function $h(t,e,n={}){const i=pu(t,e,n.custom);let{transition:r=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const s=i?()=>Promise.all(ST(t,i,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:u,staggerDirection:d}=r;return wA(t,e,c+l,u,d,n)}:()=>Promise.resolve(),{when:a}=r;if(a){const[l,c]=a==="beforeChildren"?[s,o]:[o,s];return l().then(()=>c())}else return Promise.all([s(),o(n.delay)])}function wA(t,e,n=0,i=0,r=1,s){const o=[],a=(t.variantChildren.size-1)*i,l=r===1?(c=0)=>c*i:(c=0)=>a-c*i;return Array.from(t.variantChildren).sort(xA).forEach((c,u)=>{c.notify("AnimationStart",e),o.push($h(c,e,{...s,delay:n+l(u)}).then(()=>c.notify("AnimationComplete",e)))}),Promise.all(o)}function xA(t,e){return t.sortNodePosition(e)}function EA(t,e,n={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const r=e.map(s=>$h(t,s,n));i=Promise.all(r)}else if(typeof e=="string")i=$h(t,e,n);else{const r=typeof e=="function"?pu(t,e,n.custom):e;i=Promise.all(ST(t,r,n))}return i.then(()=>t.notify("AnimationComplete",e))}const PA=[...Np].reverse(),RA=Np.length;function _A(t){return e=>Promise.all(e.map(({animation:n,options:i})=>EA(t,n,i)))}function IA(t){let e=_A(t);const n=NA();let i=!0;const r=(l,c)=>{const u=pu(t,c);if(u){const{transition:d,transitionEnd:h,...p}=u;l={...l,...p,...h}}return l};function s(l){e=l(t)}function o(l,c){const u=t.getProps(),d=t.getVariantContext(!0)||{},h=[],p=new Set;let m={},v=1/0;for(let g=0;g<RA;g++){const y=PA[g],S=n[y],k=u[y]!==void 0?u[y]:d[y],b=va(k),x=y===c?S.isActive:null;x===!1&&(v=g);let E=k===d[y]&&k!==u[y]&&b;if(E&&i&&t.manuallyAnimateOnMount&&(E=!1),S.protectedKeys={...m},!S.isActive&&x===null||!k&&!S.prevProp||uu(k)||typeof k=="boolean")continue;let A=AA(S.prevProp,k)||y===c&&S.isActive&&!E&&b||g>v&&b,O=!1;const W=Array.isArray(k)?k:[k];let J=W.reduce(r,{});x===!1&&(J={});const{prevResolvedValues:se={}}=S,te={...se,...J},xe=q=>{A=!0,p.has(q)&&(O=!0,p.delete(q)),S.needsAnimating[q]=!0};for(const q in te){const Re=J[q],D=se[q];if(m.hasOwnProperty(q))continue;let N=!1;bc(Re)&&bc(D)?N=!Wb(Re,D):N=Re!==D,N?Re!==void 0?xe(q):p.add(q):Re!==void 0&&p.has(q)?xe(q):S.protectedKeys[q]=!0}S.prevProp=k,S.prevResolvedValues=J,S.isActive&&(m={...m,...J}),i&&t.blockInitialAnimation&&(A=!1),A&&(!E||O)&&h.push(...W.map(q=>({animation:q,options:{type:y,...l}})))}if(p.size){const g={};p.forEach(y=>{const S=t.getBaseTarget(y);S!==void 0&&(g[y]=S)}),h.push({animation:g})}let T=!!h.length;return i&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(T=!1),i=!1,T?e(h):Promise.resolve()}function a(l,c,u){var d;if(n[l].isActive===c)return Promise.resolve();(d=t.variantChildren)===null||d===void 0||d.forEach(p=>{var m;return(m=p.animationState)===null||m===void 0?void 0:m.setActive(l,c)}),n[l].isActive=c;const h=o(u,l);for(const p in n)n[p].protectedKeys={};return h}return{animateChanges:o,setActive:a,setAnimateFunction:s,getState:()=>n}}function AA(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!Wb(e,t):!1}function kr(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function NA(){return{animate:kr(!0),whileInView:kr(),whileHover:kr(),whileTap:kr(),whileDrag:kr(),whileFocus:kr(),exit:kr()}}class OA extends pr{constructor(e){super(e),e.animationState||(e.animationState=IA(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),uu(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){}}let DA=0;class MA extends pr{constructor(){super(...arguments),this.id=DA++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n,custom:i}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const s=this.node.animationState.setActive("exit",!e,{custom:i??this.node.getProps().custom});n&&!e&&s.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const LA={animation:{Feature:OA},exit:{Feature:MA}},Av=(t,e)=>Math.abs(t-e);function jA(t,e){const n=Av(t.x,e.x),i=Av(t.y,e.y);return Math.sqrt(n**2+i**2)}class bT{constructor(e,n,{transformPagePoint:i,contextWindow:r,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=md(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,p=jA(d.offset,{x:0,y:0})>=3;if(!h&&!p)return;const{point:m}=d,{timestamp:v}=At;this.history.push({...m,timestamp:v});const{onStart:T,onMove:g}=this.handlers;h||(T&&T(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),g&&g(this.lastMoveEvent,d)},this.handlePointerMove=(d,h)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=pd(h,this.transformPagePoint),je.update(this.updatePoint,!0)},this.handlePointerUp=(d,h)=>{this.end();const{onEnd:p,onSessionEnd:m,resumeAnimation:v}=this.handlers;if(this.dragSnapToOrigin&&v&&v(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const T=md(d.type==="pointercancel"?this.lastMoveEventInfo:pd(h,this.transformPagePoint),this.history);this.startEvent&&p&&p(d,T),m&&m(d,T)},!Ub(e))return;this.dragSnapToOrigin=s,this.handlers=n,this.transformPagePoint=i,this.contextWindow=r||window;const o=fu(e),a=pd(o,this.transformPagePoint),{point:l}=a,{timestamp:c}=At;this.history=[{...l,timestamp:c}];const{onSessionStart:u}=n;u&&u(e,md(a,this.history)),this.removeListeners=er(ki(this.contextWindow,"pointermove",this.handlePointerMove),ki(this.contextWindow,"pointerup",this.handlePointerUp),ki(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),xi(this.updatePoint)}}function pd(t,e){return e?{point:e(t.point)}:t}function Nv(t,e){return{x:t.x-e.x,y:t.y-e.y}}function md({point:t},e){return{point:t,delta:Nv(t,TT(e)),offset:Nv(t,UA(e)),velocity:FA(e,.1)}}function UA(t){return t[0]}function TT(t){return t[t.length-1]}function FA(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=TT(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>Mr(e)));)n--;if(!i)return{x:0,y:0};const s=Si(r.timestamp-i.timestamp);if(s===0)return{x:0,y:0};const o={x:(r.x-i.x)/s,y:(r.y-i.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function ln(t){return t.max-t.min}function Kh(t,e=0,n=.01){return Math.abs(t-e)<=n}function Ov(t,e,n,i=.5){t.origin=i,t.originPoint=He(e.min,e.max,t.origin),t.scale=ln(n)/ln(e),(Kh(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=He(n.min,n.max,t.origin)-t.originPoint,(Kh(t.translate)||isNaN(t.translate))&&(t.translate=0)}function $o(t,e,n,i){Ov(t.x,e.x,n.x,i?i.originX:void 0),Ov(t.y,e.y,n.y,i?i.originY:void 0)}function Dv(t,e,n){t.min=n.min+e.min,t.max=t.min+ln(e)}function BA(t,e,n){Dv(t.x,e.x,n.x),Dv(t.y,e.y,n.y)}function Mv(t,e,n){t.min=e.min-n.min,t.max=t.min+ln(e)}function Ko(t,e,n){Mv(t.x,e.x,n.x),Mv(t.y,e.y,n.y)}function VA(t,{min:e,max:n},i){return e!==void 0&&t<e?t=i?He(e,t,i.min):Math.max(t,e):n!==void 0&&t>n&&(t=i?He(n,t,i.max):Math.min(t,n)),t}function Lv(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function zA(t,{top:e,left:n,bottom:i,right:r}){return{x:Lv(t.x,n,r),y:Lv(t.y,e,i)}}function jv(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function WA(t,e){return{x:jv(t.x,e.x),y:jv(t.y,e.y)}}function qA(t,e){let n=.5;const i=ln(t),r=ln(e);return r>i?n=ka(e.min,e.max-i,t.min):i>r&&(n=ka(t.min,t.max-r,e.min)),or(0,1,n)}function HA(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Gh=.35;function $A(t=Gh){return t===!1?t=0:t===!0&&(t=Gh),{x:Uv(t,"left","right"),y:Uv(t,"top","bottom")}}function Uv(t,e,n){return{min:Fv(t,e),max:Fv(t,n)}}function Fv(t,e){return typeof t=="number"?t:t[e]||0}const Bv=()=>({translate:0,scale:1,origin:0,originPoint:0}),bs=()=>({x:Bv(),y:Bv()}),Vv=()=>({min:0,max:0}),ot=()=>({x:Vv(),y:Vv()});function pn(t){return[t("x"),t("y")]}function CT({top:t,left:e,right:n,bottom:i}){return{x:{min:e,max:n},y:{min:t,max:i}}}function KA({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function GA(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function gd(t){return t===void 0||t===1}function Jh({scale:t,scaleX:e,scaleY:n}){return!gd(t)||!gd(e)||!gd(n)}function Tr(t){return Jh(t)||wT(t)||t.z||t.rotate||t.rotateX||t.rotateY}function wT(t){return zv(t.x)||zv(t.y)}function zv(t){return t&&t!=="0%"}function Ec(t,e,n){const i=t-n,r=e*i;return n+r}function Wv(t,e,n,i,r){return r!==void 0&&(t=Ec(t,r,i)),Ec(t,n,i)+e}function Qh(t,e=0,n=1,i,r){t.min=Wv(t.min,e,n,i,r),t.max=Wv(t.max,e,n,i,r)}function xT(t,{x:e,y:n}){Qh(t.x,e.translate,e.scale,e.originPoint),Qh(t.y,n.translate,n.scale,n.originPoint)}function JA(t,e,n,i=!1){const r=n.length;if(!r)return;e.x=e.y=1;let s,o;for(let a=0;a<r;a++){s=n[a],o=s.projectionDelta;const l=s.instance;l&&l.style&&l.style.display==="contents"||(i&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Ts(t,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,xT(t,o)),i&&Tr(s.latestValues)&&Ts(t,s.latestValues))}e.x=qv(e.x),e.y=qv(e.y)}function qv(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function ji(t,e){t.min=t.min+e,t.max=t.max+e}function Hv(t,e,[n,i,r]){const s=e[r]!==void 0?e[r]:.5,o=He(t.min,t.max,s);Qh(t,e[n],e[i],o,e.scale)}const QA=["x","scaleX","originX"],YA=["y","scaleY","originY"];function Ts(t,e){Hv(t.x,e,QA),Hv(t.y,e,YA)}function ET(t,e){return CT(GA(t.getBoundingClientRect(),e))}function XA(t,e,n){const i=ET(t,n),{scroll:r}=e;return r&&(ji(i.x,r.offset.x),ji(i.y,r.offset.y)),i}const PT=({current:t})=>t?t.ownerDocument.defaultView:null,ZA=new WeakMap;class eN{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ot(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(fu(u,"page").point)},s=(u,d)=>{const{drag:h,dragPropagation:p,onDragStart:m}=this.getProps();if(h&&!p&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=Bb(h),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),pn(T=>{let g=this.getAxisMotionValue(T).get()||0;if(ei.test(g)){const{projection:y}=this.visualElement;if(y&&y.layout){const S=y.layout.layoutBox[T];S&&(g=ln(S)*(parseFloat(g)/100))}}this.originPoint[T]=g}),m&&je.update(()=>m(u,d),!1,!0);const{animationState:v}=this.visualElement;v&&v.setActive("whileDrag",!0)},o=(u,d)=>{const{dragPropagation:h,dragDirectionLock:p,onDirectionLock:m,onDrag:v}=this.getProps();if(!h&&!this.openGlobalLock)return;const{offset:T}=d;if(p&&this.currentDirection===null){this.currentDirection=tN(T),this.currentDirection!==null&&m&&m(this.currentDirection);return}this.updateAxis("x",d.point,T),this.updateAxis("y",d.point,T),this.visualElement.render(),v&&v(u,d)},a=(u,d)=>this.stop(u,d),l=()=>pn(u=>{var d;return this.getAnimationState(u)==="paused"&&((d=this.getAxisMotionValue(u).animation)===null||d===void 0?void 0:d.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new bT(e,{onSessionStart:r,onStart:s,onMove:o,onSessionEnd:a,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:PT(this.visualElement)})}stop(e,n){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:s}=this.getProps();s&&je.update(()=>s(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,i){const{drag:r}=this.getProps();if(!i||!hl(e,r,this.currentDirection))return;const s=this.getAxisMotionValue(e);let o=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(o=VA(o,this.constraints[e],this.elastic[e])),s.set(o)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,s=this.constraints;n&&ks(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&r?this.constraints=zA(r.layoutBox,n):this.constraints=!1,this.elastic=$A(i),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&pn(o=>{this.getAxisMotionValue(o)&&(this.constraints[o]=HA(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!ks(e))return!1;const i=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const s=XA(i,r.root,this.visualElement.getTransformPagePoint());let o=WA(r.layout.layoutBox,s);if(n){const a=n(KA(o));this.hasMutatedConstraints=!!a,a&&(o=CT(a))}return o}startAnimation(e){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:s,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},c=pn(u=>{if(!hl(u,n,this.currentDirection))return;let d=l&&l[u]||{};o&&(d={min:0,max:0});const h=r?200:1e6,p=r?40:1e7,m={type:"inertia",velocity:i?e[u]:0,bounceStiffness:h,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...s,...d};return this.startAxisValueAnimation(u,m)});return Promise.all(c).then(a)}startAxisValueAnimation(e,n){const i=this.getAxisMotionValue(e);return i.start(Gp(e,i,0,n))}stopAnimation(){pn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){pn(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n="_drag"+e.toUpperCase(),i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){pn(n=>{const{drag:i}=this.getProps();if(!hl(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,s=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[n];s.set(e[n]-He(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!ks(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};pn(o=>{const a=this.getAxisMotionValue(o);if(a){const l=a.get();r[o]=qA({min:l,max:l},this.constraints[o])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),pn(o=>{if(!hl(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:c}=this.constraints[o];a.set(He(l,c,r[o]))})}addListeners(){if(!this.visualElement.current)return;ZA.set(this.visualElement,this);const e=this.visualElement.current,n=ki(e,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),i=()=>{const{dragConstraints:l}=this.getProps();ks(l)&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,s=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),i();const o=vi(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(pn(u=>{const d=this.getAxisMotionValue(u);d&&(this.originPoint[u]+=l[u].translate,d.set(d.get()+l[u].translate))}),this.visualElement.render())});return()=>{o(),n(),s(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:s=!1,dragElastic:o=Gh,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:s,dragElastic:o,dragMomentum:a}}}function hl(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function tN(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class nN extends pr{constructor(e){super(e),this.removeGroupControls=nt,this.removeListeners=nt,this.controls=new eN(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||nt}unmount(){this.removeGroupControls(),this.removeListeners()}}const $v=t=>(e,n)=>{t&&je.update(()=>t(e,n))};class iN extends pr{constructor(){super(...arguments),this.removePointerDownListener=nt}onPointerDown(e){this.session=new bT(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:PT(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:$v(e),onStart:$v(n),onMove:i,onEnd:(s,o)=>{delete this.session,r&&je.update(()=>r(s,o))}}}mount(){this.removePointerDownListener=ki(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function rN(){const t=C.useContext(lu);if(t===null)return[!0,null];const{isPresent:e,onExitComplete:n,register:i}=t,r=C.useId();return C.useEffect(()=>i(r),[]),!e&&n?[!1,()=>n&&n(r)]:[!0]}const Ol={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Kv(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const ko={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(re.test(t))t=parseFloat(t);else return t;const n=Kv(t,e.target.x),i=Kv(t,e.target.y);return`${n}% ${i}%`}},sN={correct:(t,{treeScale:e,projectionDelta:n})=>{const i=t,r=ar.parse(t);if(r.length>5)return i;const s=ar.createTransformer(t),o=typeof r[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;r[0+o]/=a,r[1+o]/=l;const c=He(a,l,.5);return typeof r[2+o]=="number"&&(r[2+o]/=c),typeof r[3+o]=="number"&&(r[3+o]/=c),s(r)}};class oN extends Fc.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:s}=e;f_(aN),s&&(n.group&&n.group.add(s),i&&i.register&&r&&i.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),Ol.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:i,drag:r,isPresent:s}=this.props,o=i.projection;return o&&(o.isPresent=s,r||e.layoutDependency!==n||n===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?o.promote():o.relegate()||je.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function RT(t){const[e,n]=rN(),i=C.useContext(Dp);return Fc.createElement(oN,{...t,layoutGroup:i,switchLayoutGroup:C.useContext(Cb),isPresent:e,safeToRemove:n})}const aN={borderRadius:{...ko,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ko,borderTopRightRadius:ko,borderBottomLeftRadius:ko,borderBottomRightRadius:ko,boxShadow:sN},_T=["TopLeft","TopRight","BottomLeft","BottomRight"],lN=_T.length,Gv=t=>typeof t=="string"?parseFloat(t):t,Jv=t=>typeof t=="number"||re.test(t);function cN(t,e,n,i,r,s){r?(t.opacity=He(0,n.opacity!==void 0?n.opacity:1,uN(i)),t.opacityExit=He(e.opacity!==void 0?e.opacity:1,0,dN(i))):s&&(t.opacity=He(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,i));for(let o=0;o<lN;o++){const a=`border${_T[o]}Radius`;let l=Qv(e,a),c=Qv(n,a);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||Jv(l)===Jv(c)?(t[a]=Math.max(He(Gv(l),Gv(c),i),0),(ei.test(c)||ei.test(l))&&(t[a]+="%")):t[a]=c}(e.rotate||n.rotate)&&(t.rotate=He(e.rotate||0,n.rotate||0,i))}function Qv(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const uN=IT(0,.5,Xb),dN=IT(.5,.95,nt);function IT(t,e,n){return i=>i<t?0:i>e?1:n(ka(t,e,i))}function Yv(t,e){t.min=e.min,t.max=e.max}function fn(t,e){Yv(t.x,e.x),Yv(t.y,e.y)}function Xv(t,e,n,i,r){return t-=e,t=Ec(t,1/n,i),r!==void 0&&(t=Ec(t,1/r,i)),t}function hN(t,e=0,n=1,i=.5,r,s=t,o=t){if(ei.test(e)&&(e=parseFloat(e),e=He(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=He(s.min,s.max,i);t===s&&(a-=e),t.min=Xv(t.min,e,n,a,r),t.max=Xv(t.max,e,n,a,r)}function Zv(t,e,[n,i,r],s,o){hN(t,e[n],e[i],e[r],e.scale,s,o)}const fN=["x","scaleX","originX"],pN=["y","scaleY","originY"];function ey(t,e,n,i){Zv(t.x,e,fN,n?n.x:void 0,i?i.x:void 0),Zv(t.y,e,pN,n?n.y:void 0,i?i.y:void 0)}function ty(t){return t.translate===0&&t.scale===1}function AT(t){return ty(t.x)&&ty(t.y)}function mN(t,e){return t.x.min===e.x.min&&t.x.max===e.x.max&&t.y.min===e.y.min&&t.y.max===e.y.max}function NT(t,e){return Math.round(t.x.min)===Math.round(e.x.min)&&Math.round(t.x.max)===Math.round(e.x.max)&&Math.round(t.y.min)===Math.round(e.y.min)&&Math.round(t.y.max)===Math.round(e.y.max)}function ny(t){return ln(t.x)/ln(t.y)}class gN{constructor(){this.members=[]}add(e){Jp(this.members,e),e.scheduleRender()}remove(e){if(Qp(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const s=this.members[r];if(s.isPresent!==!1){i=s;break}}return i?(this.promote(i),!0):!1}promote(e,n){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,n&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:i}=e;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function iy(t,e,n){let i="";const r=t.x.translate/e.x,s=t.y.translate/e.y;if((r||s)&&(i=`translate3d(${r}px, ${s}px, 0) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),n){const{rotate:l,rotateX:c,rotateY:u}=n;l&&(i+=`rotate(${l}deg) `),c&&(i+=`rotateX(${c}deg) `),u&&(i+=`rotateY(${u}deg) `)}const o=t.x.scale*e.x,a=t.y.scale*e.y;return(o!==1||a!==1)&&(i+=`scale(${o}, ${a})`),i||"none"}const vN=(t,e)=>t.depth-e.depth;class yN{constructor(){this.children=[],this.isDirty=!1}add(e){Jp(this.children,e),this.isDirty=!0}remove(e){Qp(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(vN),this.isDirty=!1,this.children.forEach(e)}}function kN(t,e){const n=performance.now(),i=({timestamp:r})=>{const s=r-n;s>=e&&(xi(i),t(s-e))};return je.read(i,!0),()=>xi(i)}function SN(t){window.MotionDebug&&window.MotionDebug.record(t)}function bN(t){return t instanceof SVGElement&&t.tagName!=="svg"}function TN(t,e,n){const i=tn(t)?t:Ks(t);return i.start(Gp("",i,e,n)),i.animation}const ry=["","X","Y","Z"],CN={visibility:"hidden"},sy=1e3;let wN=0;const Cr={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function OT({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(o={},a=e==null?void 0:e()){this.id=wN++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Cr.totalNodes=Cr.resolvedTargetDeltas=Cr.recalculatedProjection=0,this.nodes.forEach(PN),this.nodes.forEach(NN),this.nodes.forEach(ON),this.nodes.forEach(RN),SN(Cr)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new yN)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Yp),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=bN(o),this.instance=o;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(c||l)&&(this.isLayoutDirty=!0),t){let d;const h=()=>this.root.updateBlockedByResize=!1;t(o,()=>{this.root.updateBlockedByResize=!0,d&&d(),d=kN(h,250),Ol.hasAnimatedSinceResize&&(Ol.hasAnimatedSinceResize=!1,this.nodes.forEach(ay))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeTargetChanged:p,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||u.getDefaultTransition()||UN,{onLayoutAnimationStart:T,onLayoutAnimationComplete:g}=u.getProps(),y=!this.targetLayout||!NT(this.targetLayout,m)||p,S=!h&&p;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||S||h&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(d,S);const k={...Kp(v,"layout"),onPlay:T,onComplete:g};(u.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k)}else h||ay(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,xi(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(DN),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const d=this.path[u];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(oy);return}this.isUpdating||this.nodes.forEach(IN),this.isUpdating=!1,this.nodes.forEach(AN),this.nodes.forEach(xN),this.nodes.forEach(EN),this.clearAllSnapshots();const a=performance.now();At.delta=or(0,1e3/60,a-At.timestamp),At.timestamp=a,At.isProcessing=!0,od.update.process(At),od.preRender.process(At),od.render.process(At),At.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(_N),this.sharedNodes.forEach(MN)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,je.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){je.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ot(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&(this.scroll={animationId:this.root.animationId,phase:o,isRoot:i(this.instance),offset:n(this.instance)})}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform,a=this.projectionDelta&&!AT(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;o&&(a||Tr(this.latestValues)||u)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),FN(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return ot();const a=o.measureViewportBox(),{scroll:l}=this.root;return l&&(ji(a.x,l.offset.x),ji(a.y,l.offset.y)),a}removeElementScroll(o){const a=ot();fn(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:u,options:d}=c;if(c!==this.root&&u&&d.layoutScroll){if(u.isRoot){fn(a,o);const{scroll:h}=this.root;h&&(ji(a.x,-h.offset.x),ji(a.y,-h.offset.y))}ji(a.x,u.offset.x),ji(a.y,u.offset.y)}}return a}applyTransform(o,a=!1){const l=ot();fn(l,o);for(let c=0;c<this.path.length;c++){const u=this.path[c];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Ts(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Tr(u.latestValues)&&Ts(l,u.latestValues)}return Tr(this.latestValues)&&Ts(l,this.latestValues),l}removeTransform(o){const a=ot();fn(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Tr(c.latestValues))continue;Jh(c.latestValues)&&c.updateSnapshot();const u=ot(),d=c.measurePageBox();fn(u,d),ey(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return Tr(this.latestValues)&&ey(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==At.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:d,layoutId:h}=this.options;if(!(!this.layout||!(d||h))){if(this.resolvedRelativeTargetAt=At.timestamp,!this.targetDelta&&!this.relativeTarget){const p=this.getClosestProjectingParent();p&&p.layout&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ot(),this.relativeTargetOrigin=ot(),Ko(this.relativeTargetOrigin,this.layout.layoutBox,p.layout.layoutBox),fn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=ot(),this.targetWithTransforms=ot()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),BA(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):fn(this.target,this.layout.layoutBox),xT(this.target,this.targetDelta)):fn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const p=this.getClosestProjectingParent();p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ot(),this.relativeTargetOrigin=ot(),Ko(this.relativeTargetOrigin,this.target,p.target),fn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Cr.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Jh(this.parent.latestValues)||wT(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===At.timestamp&&(c=!1),c)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;fn(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;JA(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox);const{target:m}=a;if(!m){this.projectionTransform&&(this.projectionDelta=bs(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=bs(),this.projectionDeltaWithTransform=bs());const v=this.projectionTransform;$o(this.projectionDelta,this.layoutCorrected,m,this.latestValues),this.projectionTransform=iy(this.projectionDelta,this.treeScale),(this.projectionTransform!==v||this.treeScale.x!==h||this.treeScale.y!==p)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m)),Cr.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),o){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(o,a=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},d=bs();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=ot(),p=l?l.source:void 0,m=this.layout?this.layout.source:void 0,v=p!==m,T=this.getStack(),g=!T||T.members.length<=1,y=!!(v&&!g&&this.options.crossfade===!0&&!this.path.some(jN));this.animationProgress=0;let S;this.mixTargetDelta=k=>{const b=k/1e3;ly(d.x,o.x,b),ly(d.y,o.y,b),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ko(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),LN(this.relativeTarget,this.relativeTargetOrigin,h,b),S&&mN(this.relativeTarget,S)&&(this.isProjectionDirty=!1),S||(S=ot()),fn(S,this.relativeTarget)),v&&(this.animationValues=u,cN(u,c,this.latestValues,b,y,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=b},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(xi(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=je.update(()=>{Ol.hasAnimatedSinceResize=!0,this.currentAnimation=TN(0,sy,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(sy),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:c,latestValues:u}=o;if(!(!a||!l||!c)){if(this!==o&&this.layout&&c&&DT(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||ot();const d=ln(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+d;const h=ln(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}fn(a,l),Ts(a,u),$o(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new gN),this.sharedNodes.get(o).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.rotate||l.rotateX||l.rotateY||l.rotateZ)&&(a=!0),!a)return;const c={};for(let u=0;u<ry.length;u++){const d="rotate"+ry[u];l[d]&&(c[d]=l[d],o.setStaticValue(d,0))}o.render();for(const u in c)o.setStaticValue(u,c[u]);o.scheduleRender()}getProjectionStyles(o){var a,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return CN;const c={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=Nl(o==null?void 0:o.pointerEvents)||"",c.transform=u?u(this.latestValues,""):"none",c;const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){const v={};return this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=Nl(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!Tr(this.latestValues)&&(v.transform=u?u({},""):"none",this.hasProjected=!1),v}const h=d.animationValues||d.latestValues;this.applyTransformsToTarget(),c.transform=iy(this.projectionDeltaWithTransform,this.treeScale,h),u&&(c.transform=u(h,c.transform));const{x:p,y:m}=this.projectionDelta;c.transformOrigin=`${p.origin*100}% ${m.origin*100}% 0`,d.animationValues?c.opacity=d===this?(l=(a=h.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:c.opacity=d===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const v in kc){if(h[v]===void 0)continue;const{correct:T,applyTo:g}=kc[v],y=c.transform==="none"?h[v]:T(h[v],d);if(g){const S=g.length;for(let k=0;k<S;k++)c[g[k]]=y}else c[v]=y}return this.options.layoutId&&(c.pointerEvents=d===this?Nl(o==null?void 0:o.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(oy),this.root.sharedNodes.clear()}}}function xN(t){t.updateLayout()}function EN(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=t.layout,{animationType:s}=t.options,o=n.source!==t.layout.source;s==="size"?pn(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],p=ln(h);h.min=i[d].min,h.max=h.min+p}):DT(s,n.layoutBox,i)&&pn(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],p=ln(i[d]);h.max=h.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[d].max=t.relativeTarget[d].min+p)});const a=bs();$o(a,i,n.layoutBox);const l=bs();o?$o(l,t.applyTransform(r,!0),n.measuredBox):$o(l,i,n.layoutBox);const c=!AT(a);let u=!1;if(!t.resumeFrom){const d=t.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:h,layout:p}=d;if(h&&p){const m=ot();Ko(m,n.layoutBox,h.layoutBox);const v=ot();Ko(v,i,p.layoutBox),NT(m,v)||(u=!0),d.options.layoutRoot&&(t.relativeTarget=v,t.relativeTargetOrigin=m,t.relativeParent=d)}}}t.notifyListeners("didUpdate",{layout:i,snapshot:n,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeTargetChanged:u})}else if(t.isLead()){const{onExitComplete:i}=t.options;i&&i()}t.options.transition=void 0}function PN(t){Cr.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function RN(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function _N(t){t.clearSnapshot()}function oy(t){t.clearMeasurements()}function IN(t){t.isLayoutDirty=!1}function AN(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function ay(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function NN(t){t.resolveTargetDelta()}function ON(t){t.calcProjection()}function DN(t){t.resetRotation()}function MN(t){t.removeLeadSnapshot()}function ly(t,e,n){t.translate=He(e.translate,0,n),t.scale=He(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function cy(t,e,n,i){t.min=He(e.min,n.min,i),t.max=He(e.max,n.max,i)}function LN(t,e,n,i){cy(t.x,e.x,n.x,i),cy(t.y,e.y,n.y,i)}function jN(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const UN={duration:.45,ease:[.4,0,.1,1]},uy=t=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(t),dy=uy("applewebkit/")&&!uy("chrome/")?Math.round:nt;function hy(t){t.min=dy(t.min),t.max=dy(t.max)}function FN(t){hy(t.x),hy(t.y)}function DT(t,e,n){return t==="position"||t==="preserve-aspect"&&!Kh(ny(e),ny(n),.2)}const BN=OT({attachResizeListener:(t,e)=>vi(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),vd={current:void 0},MT=OT({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!vd.current){const t=new BN({});t.mount(window),t.setOptions({layoutScroll:!0}),vd.current=t}return vd.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),VN={pan:{Feature:iN},drag:{Feature:nN,ProjectionNode:MT,MeasureLayout:RT}},zN=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function WN(t){const e=zN.exec(t);if(!e)return[,];const[,n,i]=e;return[n,i]}function Yh(t,e,n=1){const[i,r]=WN(t);if(!i)return;const s=window.getComputedStyle(e).getPropertyValue(i);if(s){const o=s.trim();return vT(o)?parseFloat(o):o}else return Bh(r)?Yh(r,e,n+1):r}function qN(t,{...e},n){const i=t.current;if(!(i instanceof Element))return{target:e,transitionEnd:n};n&&(n={...n}),t.values.forEach(r=>{const s=r.get();if(!Bh(s))return;const o=Yh(s,i);o&&r.set(o)});for(const r in e){const s=e[r];if(!Bh(s))continue;const o=Yh(s,i);o&&(e[r]=o,n||(n={}),n[r]===void 0&&(n[r]=s))}return{target:e,transitionEnd:n}}const HN=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),LT=t=>HN.has(t),$N=t=>Object.keys(t).some(LT),fy=t=>t===Yr||t===re,py=(t,e)=>parseFloat(t.split(", ")[e]),my=(t,e)=>(n,{transform:i})=>{if(i==="none"||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/);if(r)return py(r[1],e);{const s=i.match(/^matrix\((.+)\)$/);return s?py(s[1],t):0}},KN=new Set(["x","y","z"]),GN=Ma.filter(t=>!KN.has(t));function JN(t){const e=[];return GN.forEach(n=>{const i=t.getValue(n);i!==void 0&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e.length&&t.render(),e}const Gs={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:my(4,13),y:my(5,14)};Gs.translateX=Gs.x;Gs.translateY=Gs.y;const QN=(t,e,n)=>{const i=e.measureViewportBox(),r=e.current,s=getComputedStyle(r),{display:o}=s,a={};o==="none"&&e.setStaticValue("display",t.display||"block"),n.forEach(c=>{a[c]=Gs[c](i,s)}),e.render();const l=e.measureViewportBox();return n.forEach(c=>{const u=e.getValue(c);u&&u.jump(a[c]),t[c]=Gs[c](l,s)}),t},YN=(t,e,n={},i={})=>{e={...e},i={...i};const r=Object.keys(e).filter(LT);let s=[],o=!1;const a=[];if(r.forEach(l=>{const c=t.getValue(l);if(!t.hasValue(l))return;let u=n[l],d=yo(u);const h=e[l];let p;if(bc(h)){const m=h.length,v=h[0]===null?1:0;u=h[v],d=yo(u);for(let T=v;T<m&&h[T]!==null;T++)p?zp(yo(h[T])===p):p=yo(h[T])}else p=yo(h);if(d!==p)if(fy(d)&&fy(p)){const m=c.get();typeof m=="string"&&c.set(parseFloat(m)),typeof h=="string"?e[l]=parseFloat(h):Array.isArray(h)&&p===re&&(e[l]=h.map(parseFloat))}else d!=null&&d.transform&&(p!=null&&p.transform)&&(u===0||h===0)?u===0?c.set(p.transform(u)):e[l]=d.transform(h):(o||(s=JN(t),o=!0),a.push(l),i[l]=i[l]!==void 0?i[l]:e[l],c.jump(h))}),a.length){const l=a.indexOf("height")>=0?window.pageYOffset:null,c=QN(e,t,a);return s.length&&s.forEach(([u,d])=>{t.getValue(u).set(d)}),t.render(),cu&&l!==null&&window.scrollTo({top:l}),{target:c,transitionEnd:i}}else return{target:e,transitionEnd:i}};function XN(t,e,n,i){return $N(e)?YN(t,e,n,i):{target:e,transitionEnd:i}}const ZN=(t,e,n,i)=>{const r=qN(t,e,i);return e=r.target,i=r.transitionEnd,XN(t,e,n,i)},Xh={current:null},jT={current:!1};function eO(){if(jT.current=!0,!!cu)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Xh.current=t.matches;t.addListener(e),e()}else Xh.current=!1}function tO(t,e,n){const{willChange:i}=e;for(const r in e){const s=e[r],o=n[r];if(tn(s))t.addValue(r,s),xc(i)&&i.add(r);else if(tn(o))t.addValue(r,Ks(s,{owner:t})),xc(i)&&i.remove(r);else if(o!==s)if(t.hasValue(r)){const a=t.getValue(r);!a.hasAnimated&&a.set(s)}else{const a=t.getStaticValue(r);t.addValue(r,Ks(a!==void 0?a:s,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const gy=new WeakMap,UT=Object.keys(ya),nO=UT.length,vy=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],iO=Op.length;class rO{constructor({parent:e,props:n,presenceContext:i,reducedMotionConfig:r,visualState:s},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>je.render(this.render,!1,!0);const{latestValues:a,renderState:l}=s;this.latestValues=a,this.baseTarget={...a},this.initialValues=n.initial?{...a}:{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.isControllingVariants=du(n),this.isVariantNode=Tb(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:c,...u}=this.scrapeMotionValuesFromProps(n,{});for(const d in u){const h=u[d];a[d]!==void 0&&tn(h)&&(h.set(a[d],!1),xc(c)&&c.add(d))}}scrapeMotionValuesFromProps(e,n){return{}}mount(e){this.current=e,gy.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),jT.current||eO(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Xh.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){gy.delete(this.current),this.projection&&this.projection.unmount(),xi(this.notifyUpdate),xi(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,n){const i=Qr.has(e),r=n.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&je.update(this.notifyUpdate,!1,!0),i&&this.projection&&(this.projection.isTransformDirty=!0)}),s=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{r(),s()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...n},i,r,s){let o,a;for(let l=0;l<nO;l++){const c=UT[l],{isEnabled:u,Feature:d,ProjectionNode:h,MeasureLayout:p}=ya[c];h&&(o=h),u(n)&&(!this.features[c]&&d&&(this.features[c]=new d(this)),p&&(a=p))}if((this.type==="html"||this.type==="svg")&&!this.projection&&o){this.projection=new o(this.latestValues,this.parent&&this.parent.projection);const{layoutId:l,layout:c,drag:u,dragConstraints:d,layoutScroll:h,layoutRoot:p}=n;this.projection.setOptions({layoutId:l,layout:c,alwaysMeasureLayout:!!u||d&&ks(d),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof c=="string"?c:"both",initialPromotionConfig:s,layoutScroll:h,layoutRoot:p})}return a}updateFeatures(){for(const e in this.features){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ot()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}makeTargetAnimatable(e,n=!0){return this.makeTargetAnimatableFromInstance(e,this.props,n)}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<vy.length;i++){const r=vy[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const s=e["on"+r];s&&(this.propEventSubscriptions[r]=this.on(r,s))}this.prevMotionValues=tO(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const i=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(i.initial=this.props.initial),i}const n={};for(let i=0;i<iO;i++){const r=Op[i],s=this.props[r];(va(s)||s===!1)&&(n[r]=s)}return n}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){n!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,n)),this.values.set(e,n),this.latestValues[e]=n.get()}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&n!==void 0&&(i=Ks(n,{owner:this}),this.addValue(e,i)),i}readValue(e){var n;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(n=this.getBaseTargetFromProps(this.props,e))!==null&&n!==void 0?n:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:i}=this.props,r=typeof i=="string"||typeof i=="object"?(n=Vp(this.props,i))===null||n===void 0?void 0:n[e]:void 0;if(i&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!tn(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new Yp),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class FT extends rO{sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:i}){delete n[e],delete i[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:n,...i},{transformValues:r},s){let o=bA(i,e||{},this);if(r&&(n&&(n=r(n)),i&&(i=r(i)),o&&(o=r(o))),s){kA(this,i,o);const a=ZN(this,i,o,n);n=a.transitionEnd,i=a.target}return{transition:e,transitionEnd:n,...i}}}function sO(t){return window.getComputedStyle(t)}class oO extends FT{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,n){if(Qr.has(n)){const i=$p(n);return i&&i.default||0}else{const i=sO(e),r=(Eb(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return ET(e,n)}build(e,n,i,r){Lp(e,n,i,r.transformTemplate)}scrapeMotionValuesFromProps(e,n){return Bp(e,n)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;tn(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(e,n,i,r){Nb(e,n,i,r)}}class aO extends FT{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Qr.has(n)){const i=$p(n);return i&&i.default||0}return n=Ob.has(n)?n:Ap(n),e.getAttribute(n)}measureInstanceViewportBox(){return ot()}scrapeMotionValuesFromProps(e,n){return Mb(e,n)}build(e,n,i,r){Up(e,n,i,this.isSVGTag,r.transformTemplate)}renderInstance(e,n,i,r){Db(e,n,i,r)}mount(e){this.isSVGTag=Fp(e.tagName),super.mount(e)}}const lO=(t,e)=>Mp(t)?new aO(e,{enableHardwareAcceleration:!1}):new oO(e,{enableHardwareAcceleration:!0}),cO={layout:{ProjectionNode:MT,MeasureLayout:RT}},uO={...LA,...nI,...VN,...cO},Ao=d_((t,e)=>W_(t,e,uO,lO));function BT(){const t=C.useRef(!1);return Ip(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function dO(){const t=BT(),[e,n]=C.useState(0),i=C.useCallback(()=>{t.current&&n(e+1)},[e]);return[C.useCallback(()=>je.postRender(i),[i]),e]}class hO extends C.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const i=this.props.sizeRef.current;i.height=n.offsetHeight||0,i.width=n.offsetWidth||0,i.top=n.offsetTop,i.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function fO({children:t,isPresent:e}){const n=C.useId(),i=C.useRef(null),r=C.useRef({width:0,height:0,top:0,left:0});return C.useInsertionEffect(()=>{const{width:s,height:o,top:a,left:l}=r.current;if(e||!i.current||!s||!o)return;i.current.dataset.motionPopId=n;const c=document.createElement("style");return document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${s}px !important;
            height: ${o}px !important;
            top: ${a}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[e]),C.createElement(hO,{isPresent:e,childRef:i,sizeRef:r},C.cloneElement(t,{ref:i}))}const yd=({children:t,initial:e,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:s,mode:o})=>{const a=Lb(pO),l=C.useId(),c=C.useMemo(()=>({id:l,initial:e,isPresent:n,custom:r,onExitComplete:u=>{a.set(u,!0);for(const d of a.values())if(!d)return;i&&i()},register:u=>(a.set(u,!1),()=>a.delete(u))}),s?void 0:[n]);return C.useMemo(()=>{a.forEach((u,d)=>a.set(d,!1))},[n]),C.useEffect(()=>{!n&&!a.size&&i&&i()},[n]),o==="popLayout"&&(t=C.createElement(fO,{isPresent:n},t)),C.createElement(lu.Provider,{value:c},t)};function pO(){return new Map}function mO(t){return C.useEffect(()=>()=>t(),[])}const wr=t=>t.key||"";function gO(t,e){t.forEach(n=>{const i=wr(n);e.set(i,n)})}function vO(t){const e=[];return C.Children.forEach(t,n=>{C.isValidElement(n)&&e.push(n)}),e}const yO=({children:t,custom:e,initial:n=!0,onExitComplete:i,exitBeforeEnter:r,presenceAffectsLayout:s=!0,mode:o="sync"})=>{const a=C.useContext(Dp).forceRender||dO()[0],l=BT(),c=vO(t);let u=c;const d=C.useRef(new Map).current,h=C.useRef(u),p=C.useRef(new Map).current,m=C.useRef(!0);if(Ip(()=>{m.current=!1,gO(c,p),h.current=u}),mO(()=>{m.current=!0,p.clear(),d.clear()}),m.current)return C.createElement(C.Fragment,null,u.map(y=>C.createElement(yd,{key:wr(y),isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:s,mode:o},y)));u=[...u];const v=h.current.map(wr),T=c.map(wr),g=v.length;for(let y=0;y<g;y++){const S=v[y];T.indexOf(S)===-1&&!d.has(S)&&d.set(S,void 0)}return o==="wait"&&d.size&&(u=[]),d.forEach((y,S)=>{if(T.indexOf(S)!==-1)return;const k=p.get(S);if(!k)return;const b=v.indexOf(S);let x=y;if(!x){const E=()=>{d.delete(S);const P=Array.from(p.keys()).filter(A=>!T.includes(A));if(P.forEach(A=>p.delete(A)),h.current=c.filter(A=>{const O=wr(A);return O===S||P.includes(O)}),!d.size){if(l.current===!1)return;a(),i&&i()}};x=C.createElement(yd,{key:wr(k),isPresent:!1,onExitComplete:E,custom:e,presenceAffectsLayout:s,mode:o},k),d.set(S,x)}u.splice(b,0,x)}),u=u.map(y=>{const S=y.key;return d.has(S)?y:C.createElement(yd,{key:wr(y),isPresent:!0,presenceAffectsLayout:s,mode:o},y)}),C.createElement(C.Fragment,null,d.size?u:u.map(y=>C.cloneElement(y)))};var yy={};function kO(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var SO=Object.defineProperty,bO=(t,e,n)=>e in t?SO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ky=(t,e,n)=>bO(t,typeof e!="symbol"?e+"":e,n);class Bt{constructor(){ky(this,"_locking"),ky(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function Qe(t,e){if(!t)throw new Error(e)}const TO=34028234663852886e22,CO=-34028234663852886e22,wO=4294967295,xO=2147483647,EO=-2147483648;function Dl(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>xO||t<EO)throw new Error("invalid int 32: "+t)}function Zh(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>wO||t<0)throw new Error("invalid uint 32: "+t)}function VT(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>TO||t<CO))throw new Error("invalid float 32: "+t)}const zT=Symbol("@bufbuild/protobuf/enum-type");function PO(t){const e=t[zT];return Qe(e,"missing enum type on enum object"),e}function WT(t,e,n,i){t[zT]=qT(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function qT(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=HT(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function RO(t,e,n){const i={};for(const r of e){const s=HT(r);i[s.localName]=s.no,i[s.no]=s.localName}return WT(i,t,e),i}function HT(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Xp{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function _O(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new Xp),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,l){return new o().fromBinary(a,l)},fromJson(a,l){return new o().fromJson(a,l)},fromJsonString(a,l){return new o().fromJsonString(a,l)},equals(a,l){return t.util.equals(o,a,l)}}),o}function IO(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function kd(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),l=(a?o|128:o)&255;if(n.push(l),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),l=(a?o|128:o)&255;if(n.push(l),!a)return}n.push(e>>>31&1)}}const Ml=4294967296;function Sy(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const l=Number(t.slice(o,a));r*=n,i=i*n+l,i>=Ml&&(r=r+(i/Ml|0),i=i%Ml)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?KT(i,r):Zp(i,r)}function AO(t,e){let n=Zp(t,e);const i=n.hi&2147483648;i&&(n=KT(n.lo,n.hi));const r=$T(n.lo,n.hi);return i?"-"+r:r}function $T(t,e){if({lo:t,hi:e}=NO(t,e),e<=2097151)return String(Ml*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const l=1e7;return s>=l&&(o+=Math.floor(s/l),s%=l),o>=l&&(a+=Math.floor(o/l),o%=l),a.toString()+by(o)+by(s)}function NO(t,e){return{lo:t>>>0,hi:e>>>0}}function Zp(t,e){return{lo:t|0,hi:e|0}}function KT(t,e){return e=~e,t?t=~t+1:e+=1,Zp(t,e)}const by=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Ty(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function OO(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function DO(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof yy!="object"||yy.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>s||c<r)throw new Error("int64 invalid: ".concat(l));return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>a||c<o)throw new Error("uint64 invalid: ".concat(l));return c},enc(l){return t.setBigInt64(0,this.parse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(l){return t.setBigInt64(0,this.uParse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigInt64(0,!0)},uDec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigUint64(0,!0)}}}const n=r=>Qe(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Qe(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Sy(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Sy(r)},dec(r,s){return AO(r,s)},uDec(r,s){return $T(r,s)}}}const ze=DO();var L;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(L||(L={}));var lr;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(lr||(lr={}));function Ai(t,e,n){if(e===n)return!0;if(t==L.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return e==n}return!1}function Js(t,e){switch(t){case L.BOOL:return!1;case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return e==0?ze.zero:"0";case L.DOUBLE:case L.FLOAT:return 0;case L.BYTES:return new Uint8Array(0);case L.STRING:return"";default:return 0}}function GT(t,e){switch(t){case L.BOOL:return e===!1;case L.STRING:return e==="";case L.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var tt;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(tt||(tt={}));class MO{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Zh(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Dl(e),Ty(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){VT(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Zh(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Dl(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Dl(e),e=(e<<1^e>>31)>>>0,Ty(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=ze.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=ze.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=ze.enc(e);return kd(n.lo,n.hi,this.buf),this}sint64(e){let n=ze.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return kd(r,s,this.buf),this}uint64(e){let n=ze.uEnc(e);return kd(n.lo,n.hi,this.buf),this}}class LO{constructor(e,n){this.varint64=IO,this.uint32=OO,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case tt.Varint:for(;this.buf[this.pos++]&128;);break;case tt.Bit64:this.pos+=4;case tt.Bit32:this.pos+=4;break;case tt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case tt.StartGroup:for(;;){const[s,o]=this.tag();if(o===tt.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ze.dec(...this.varint64())}uint64(){return ze.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,ze.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ze.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ze.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function jO(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function JT(t){const e=t.field.localName,n=Object.create(null);return n[e]=UO(t),[n,()=>n[e]]}function UO(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Js(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function FO(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let di="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),mu=[];for(let t=0;t<di.length;t++)mu[di[t].charCodeAt(0)]=t;mu[45]=di.indexOf("+");mu[95]=di.indexOf("/");const QT={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=mu[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=di[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=di[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=di[r|i>>6],e+=di[i&63],n=0;break}return n&&(e+=di[r],e+="=",n==1&&(e+="=")),e}};function BO(t,e,n){XT(e,t);const i=e.runtime.bin.makeReadOptions(n),r=FO(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=JT(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function VO(t,e,n,i){XT(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(YT(t,e)){const c=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of c)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const l=r.readerFactory(o.finish());for(;l.pos<l.len;){const[c,u]=l.tag(),d=l.skip(u,c);t.getType().runtime.bin.onUnknownField(t,c,u,d)}}function YT(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function XT(t,e){Qe(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function ZT(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!GT(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Cy(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Js(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function hi(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Xp.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function eC(t,e){return hi(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}L.DOUBLE,L.FLOAT,L.INT64,L.UINT64,L.INT32,L.UINT32,L.BOOL,L.STRING,L.BYTES;const wy={ignoreUnknownFields:!1},xy={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function zO(t){return t?Object.assign(Object.assign({},wy),t):wy}function WO(t){return t?Object.assign(Object.assign({},xy),t):xy}const Pc=Symbol(),Ll=Symbol();function qO(){return{makeReadOptions:zO,makeWriteOptions:WO,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Qn(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const l=t.fields.findJsonName(o);if(l){if(l.oneof){if(a===null&&l.kind=="scalar")continue;const c=r.get(l.oneof);if(c!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(c,'", "').concat(o,'"'));r.set(l.oneof,o)}Ey(i,a,l,n,t)}else{let c=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){c=!0;const[d,h]=JT(u);Ey(d,a,u.field,n,u),VO(i,u,h(),n)}}if(!c&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!ZT(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!$O(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Py(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&YT(t,a)){const l=BO(t,a,e),c=Py(a.field,l,e);c!==void 0&&(i[a.field.jsonName]=c)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return Go(t,e,n??lr.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||GT(t,e)))return jl(t,e)},debug:Qn}}function Qn(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Ey(t,e,n,i,r){let s=n.localName;if(n.repeated){if(Qe(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qn(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qn(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const l=Sd(n.T,a,i.ignoreUnknownFields,!0);l!==Ll&&o.push(l);break;case"scalar":try{o.push(Go(n.T,a,n.L,!0))}catch(c){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qn(a));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qn(e)));const o=t[s];for(const[a,l]of Object.entries(e)){if(l===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=HO(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qn(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[c]=n.V.T.fromJson(l,i);break;case"enum":const u=Sd(n.V.T,l,i.ignoreUnknownFields,!0);u!==Ll&&(o[c]=u);break;case"scalar":try{o[c]=Go(n.V.T,l,lr.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qn(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];hi(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const l=Sd(n.T,e,i.ignoreUnknownFields,!1);switch(l){case Pc:Cy(n,t);break;case Ll:break;default:t[s]=l;break}break;case"scalar":try{const c=Go(n.T,e,n.L,!1);switch(c){case Pc:Cy(n,t);break;default:t[s]=c;break}}catch(c){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qn(e));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}function HO(t,e){if(t===L.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Go(t,e,lr.BIGINT,!0).toString()}function Go(t,e,n,i){if(e===null)return i?Js(t,n):Pc;switch(t){case L.DOUBLE:case L.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==L.FLOAT&&VT(r),r;case L.INT32:case L.FIXED32:case L.SFIXED32:case L.SINT32:case L.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==L.UINT32||t==L.FIXED32?Zh(s):Dl(s),s;case L.INT64:case L.SFIXED64:case L.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=ze.parse(e);return n?o.toString():o;case L.FIXED64:case L.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=ze.uParse(e);return n?a.toString():a;case L.BOOL:if(typeof e!="boolean")break;return e;case L.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case L.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return QT.dec(e)}throw new Error}function Sd(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Pc;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Ll;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Qn(e)))}function $O(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Py(t,e,n){if(t.kind=="map"){Qe(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=jl(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=bd(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Qe(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(jl(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(bd(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return jl(t.T,e);case"enum":return bd(t.T,e,n.enumAsInteger);case"message":return eC(t.T,e).toJson(n)}}function bd(t,e,n){var i;if(Qe(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function jl(t,e){switch(t){case L.INT32:case L.SFIXED32:case L.SINT32:case L.FIXED32:case L.UINT32:return Qe(typeof e=="number"),e;case L.FLOAT:case L.DOUBLE:return Qe(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case L.STRING:return Qe(typeof e=="string"),e;case L.BOOL:return Qe(typeof e=="boolean"),e;case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return Qe(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case L.BYTES:return Qe(e instanceof Uint8Array),QT.enc(e)}}const rs=Symbol("@bufbuild/protobuf/unknown-fields"),Ry={readUnknownFields:!0,readerFactory:t=>new LO(t)},_y={writeUnknownFields:!0,writerFactory:()=>new MO};function KO(t){return t?Object.assign(Object.assign({},Ry),t):Ry}function GO(t){return t?Object.assign(Object.assign({},_y),t):_y}function JO(){return{makeReadOptions:KO,makeWriteOptions:GO,listUnknownFields(t){var e;return(e=t[rs])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[rs]},writeUnknownFields(t,e){const i=t[rs];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[rs])||(r[rs]=[]),r[rs].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,l;for(;e.pos<o&&([a,l]=e.tag(),!(r===!0&&l==tt.EndGroup));){const c=s.fields.find(a);if(!c){const u=e.skip(l,a);i.readUnknownFields&&this.onUnknownField(t,a,l,u);continue}Iy(t,e,c,l,i)}if(r&&(l!=tt.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Iy,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!ZT(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];Ay(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Ay(t,e,n,i)}}}function Iy(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?L.INT32:n.T;let l=Rc;if(n.kind=="scalar"&&n.L>0&&(l=YO),s){let h=t[o];if(i==tt.LengthDelimited&&a!=L.STRING&&a!=L.BYTES){let m=e.uint32()+e.pos;for(;e.pos<m;)h.push(l(e,a))}else h.push(l(e,a))}else t[o]=l(e,a);break;case"message":const c=n.T;s?t[o].push(Ul(e,new c,r,n)):hi(t[o])?Ul(e,t[o],r,n):(t[o]=Ul(e,new c,r,n),c.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=c.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=QO(n,e,r);t[o][u]=d;break}}function Ul(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function QO(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=Rc(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=Rc(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=Ul(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Js(t.K,lr.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Js(t.V.T,lr.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function YO(t,e){const n=Rc(t,e);return typeof n=="bigint"?n.toString():n}function Rc(t,e){switch(e){case L.STRING:return t.string();case L.BOOL:return t.bool();case L.DOUBLE:return t.double();case L.FLOAT:return t.float();case L.INT32:return t.int32();case L.INT64:return t.int64();case L.UINT64:return t.uint64();case L.FIXED64:return t.fixed64();case L.BYTES:return t.bytes();case L.FIXED32:return t.fixed32();case L.SFIXED32:return t.sfixed32();case L.SFIXED64:return t.sfixed64();case L.SINT64:return t.sint64();case L.UINT32:return t.uint32();case L.SINT32:return t.sint32()}}function Ay(t,e,n,i){Qe(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?L.INT32:t.T;if(r)if(Qe(Array.isArray(e)),t.packed)ZO(n,s,t.no,e);else for(const o of e)Jo(n,s,t.no,o);else Jo(n,s,t.no,e);break;case"message":if(r){Qe(Array.isArray(e));for(const o of e)Ny(n,i,t,o)}else Ny(n,i,t,e);break;case"map":Qe(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))XO(n,i,t,o,a);break}}function XO(t,e,n,i,r){t.tag(n.no,tt.LengthDelimited),t.fork();let s=i;switch(n.K){case L.INT32:case L.FIXED32:case L.UINT32:case L.SFIXED32:case L.SINT32:s=Number.parseInt(i);break;case L.BOOL:Qe(i=="true"||i=="false"),s=i=="true";break}switch(Jo(t,n.K,1,s),n.V.kind){case"scalar":Jo(t,n.V.T,2,r);break;case"enum":Jo(t,L.INT32,2,r);break;case"message":Qe(r!==void 0),t.tag(2,tt.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Ny(t,e,n,i){const r=eC(n.T,i);n.delimited?t.tag(n.no,tt.StartGroup).raw(r.toBinary(e)).tag(n.no,tt.EndGroup):t.tag(n.no,tt.LengthDelimited).bytes(r.toBinary(e))}function Jo(t,e,n,i){Qe(i!==void 0);let[r,s]=tC(e);t.tag(n,r)[s](i)}function ZO(t,e,n,i){if(!i.length)return;t.tag(n,tt.LengthDelimited).fork();let[,r]=tC(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function tC(t){let e=tt.Varint;switch(t){case L.BYTES:case L.STRING:e=tt.LengthDelimited;break;case L.DOUBLE:case L.FIXED64:case L.SFIXED64:e=tt.Bit64;break;case L.FIXED32:case L.SFIXED32:case L.FLOAT:e=tt.Bit32;break}const n=L[t].toLowerCase();return[e,n]}function eD(){return{setEnumType:WT,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const l=i.findField(a);let c=o[r].value;l&&l.kind=="message"&&!hi(c,l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===L.BYTES&&(c=So(c)),s[r]={case:a,value:c};break;case"scalar":case"enum":let u=o[r];i.T===L.BYTES&&(u=i.repeated?u.map(So):So(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===L.BYTES)for(const[p,m]of Object.entries(o[r]))s[r][p]=So(m);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const p of Object.keys(o[r])){let m=o[r][p];h.fieldWrapper||(m=new h(m)),s[r][p]=m}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>hi(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=So(h):s[r]=h:s[r]=hi(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>Ai(i.T,o,s[a]));case"enum":return r.every((o,a)=>Ai(L.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!hi(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!hi(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return Ai(L.INT32,r,s);case"scalar":return Ai(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const l=i.findField(r.case);if(l===void 0)return!0;switch(l.kind){case"message":return l.T.equals(r.value,s.value);case"enum":return Ai(L.INT32,r.value,s.value);case"scalar":return Ai(l.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(l.kind));case"map":const c=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return c.every(h=>u.equals(r[h],s[h]));case"enum":return c.every(h=>Ai(L.INT32,r[h],s[h]));case"scalar":const d=i.V.T;return c.every(h=>Ai(d,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(fl);else if(r.kind=="map"){o=i[r.localName];for(const[a,l]of Object.entries(s))o[a]=fl(l)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:fl(s.value)}:{case:void 0}:o=fl(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function fl(t){if(t===void 0)return t;if(hi(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function So(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function tD(t,e,n){return{syntax:t,json:qO(),bin:JO(),util:Object.assign(Object.assign({},eD()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return _O(this,i,r,s)},makeEnum:RO,makeEnumType:qT,getEnumType:PO,makeExtension(i,r,s){return jO(this,i,r,s)}}}class nD{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function nC(t,e){const n=iC(t);return e?n:lD(aD(n))}function iD(t){return nC(t,!1)}const rD=iC;function iC(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const sD=new Set(["constructor","toString","toJSON","valueOf"]),oD=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),rC=t=>"".concat(t,"$"),aD=t=>oD.has(t)?rC(t):t,lD=t=>sD.has(t)?rC(t):t;class cD{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=iD(e)}addField(e){Qe(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function uD(t,e){var n,i,r,s,o,a;const l=[];let c;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=nC(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:rD(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:lr.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=L.BYTES&&u.T!=L.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!c||c.name!=h)&&(c=new cD(h)),d.oneof=c,c.addField(d)}l.push(d)}return l}const _=tD("proto3",t=>new nD(t,e=>uD(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Js(e.T,e.L);break}}});class $t extends Xp{constructor(e){super(),this.seconds=ze.zero,this.nanos=0,_.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(_.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ze.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return $t.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new $t({seconds:ze.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new $t().fromBinary(e,n)}static fromJson(e,n){return new $t().fromJson(e,n)}static fromJsonString(e,n){return new $t().fromJsonString(e,n)}static equals(e,n){return _.util.equals($t,e,n)}}$t.runtime=_;$t.typeName="google.protobuf.Timestamp";$t.fields=_.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const dD=_.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:$t},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:hD,repeated:!0},{no:5,name:"events",kind:"message",T:pD,repeated:!0}]),hD=_.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:fD,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),fD=_.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:$t},{no:3,name:"value",kind:"scalar",T:2}]),pD=_.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:$t},{no:7,name:"normalized_end_timestamp",kind:"message",T:$t,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),sC=_.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),On=_.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),at=_.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),em=_.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),No=_.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Sa=_.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Ln=_.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),xr=_.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),mD=_.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),vt=_.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),gu=_.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:_c,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:yC}]),_c=_.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),gD=_.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:_.getEnumType(at),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),zr=_.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:_.getEnumType(Ns)},{no:4,name:"tracks",kind:"message",T:Cs,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:gD},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:_.getEnumType(ba)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:_.getEnumType(Ln)},{no:18,name:"kind_details",kind:"enum",T:_.getEnumType(vD),repeated:!0}]),Ns=_.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ba=_.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),vD=_.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),ft=_.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),yD=_.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:tr,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:_.getEnumType(oC)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Cs=_.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:_.getEnumType(On)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:_.getEnumType(at)},{no:10,name:"layers",kind:"message",T:tr,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:yD,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:_.getEnumType(ft)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:yC},{no:19,name:"audio_features",kind:"enum",T:_.getEnumType(vt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:_.getEnumType(sC)}]),tr=_.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:_.getEnumType(em)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),oC=_.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Ut=_.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:_.getEnumType(ge)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:tm,oneof:"value"},{no:3,name:"speaker",kind:"message",T:kD,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:uC,oneof:"value"},{no:7,name:"transcription",kind:"message",T:SD,oneof:"value"},{no:8,name:"metrics",kind:"message",T:dD,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Ic,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:nm,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:im,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:rm,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Ac,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Nc,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Oc,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:aC,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),ge=_.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),aC=_.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:_.getEnumType(ft)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),lC=_.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:tm,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Ic,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:nm,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:im,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:rm,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Ac,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Nc,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Oc,oneof:"value"}]),kD=_.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:cC,repeated:!0}]),cC=_.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),tm=_.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),uC=_.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),SD=_.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:bD,repeated:!0}]),bD=_.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Ic=_.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),nm=_.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),im=_.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),rm=_.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:dC,oneof:"value"}]),dC=_.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),hC=_.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),fC=_.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:_.getEnumType(pC)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),pC=_.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),mC=_.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:_.getEnumType(gC)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),gC=_.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),vC=_.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Oy},{no:2,name:"screen",kind:"message",T:Oy},{no:3,name:"resume_connection",kind:"enum",T:_.getEnumType(Sa)},{no:4,name:"disabled_codecs",kind:"message",T:TD},{no:5,name:"force_relay",kind:"enum",T:_.getEnumType(Sa)}]),Oy=_.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:_.getEnumType(Sa)}]),TD=_.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:_c,repeated:!0},{no:2,name:"publish",kind:"message",T:_c,repeated:!0}]),yC=_.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),ef=_.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),kC=_.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:_.getEnumType(ef)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),SC=_.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Ac=_.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:_.getEnumType(ft)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:kC,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:SC,oneof:"content_header"}],{localName:"DataStream_Header"}),Nc=_.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Oc=_.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),CD=_.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Dn=_.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),tf=_.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),wD=_.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),xD=_.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:cr,oneof:"message"},{no:2,name:"answer",kind:"message",T:cr,oneof:"message"},{no:3,name:"trickle",kind:"message",T:vu,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Ta,oneof:"message"},{no:5,name:"mute",kind:"message",T:yu,oneof:"message"},{no:6,name:"subscription",kind:"message",T:ku,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:bC,oneof:"message"},{no:8,name:"leave",kind:"message",T:Su,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:CC,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:EC,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:cm,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Kn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:am,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:_C,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:om,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:TC,oneof:"message"}]),Dy=_.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:ED,oneof:"message"},{no:2,name:"answer",kind:"message",T:cr,oneof:"message"},{no:3,name:"offer",kind:"message",T:cr,oneof:"message"},{no:4,name:"trickle",kind:"message",T:vu,oneof:"message"},{no:5,name:"update",kind:"message",T:_D,oneof:"message"},{no:6,name:"track_published",kind:"message",T:sm,oneof:"message"},{no:8,name:"leave",kind:"message",T:Su,oneof:"message"},{no:9,name:"mute",kind:"message",T:yu,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:ID,oneof:"message"},{no:11,name:"room_update",kind:"message",T:AD,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:OD,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:MD,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:jD,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:FD,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:RD,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:PD,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:VD,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:qD,oneof:"message"},{no:22,name:"request_response",kind:"message",T:HD,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:$D,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:BD,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:QD,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:UD,oneof:"message"}]),nf=_.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:tr,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:_.getEnumType(oC)}]),Ta=_.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:_.getEnumType(On)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:_.getEnumType(at)},{no:9,name:"layers",kind:"message",T:tr,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:nf,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:_.getEnumType(ft)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:_.getEnumType(sC)},{no:17,name:"audio_features",kind:"enum",T:_.getEnumType(vt),repeated:!0}]),vu=_.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:_.getEnumType(Dn)},{no:3,name:"final",kind:"scalar",T:8}]),yu=_.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),ED=_.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:gu},{no:2,name:"participant",kind:"message",T:zr},{no:3,name:"other_participants",kind:"message",T:zr,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:wC,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:vC},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:fC},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:_c,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),PD=_.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:wC,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:vC},{no:3,name:"server_info",kind:"message",T:fC},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),sm=_.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Cs}]),RD=_.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),cr=_.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),_D=_.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:zr,repeated:!0}]),ku=_.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:hC,repeated:!0}]),bC=_.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:_.getEnumType(em)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),om=_.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:_.getEnumType(vt),repeated:!0}]),TC=_.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Su=_.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:_.getEnumType(Ln)},{no:3,name:"action",kind:"enum",T:_.getEnumType(Os)},{no:4,name:"regions",kind:"message",T:zD}]),Os=_.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),CC=_.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:tr,repeated:!0}]),am=_.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),wC=_.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),ID=_.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:cC,repeated:!0}]),AD=_.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:gu}]),ND=_.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:_.getEnumType(No)},{no:3,name:"score",kind:"scalar",T:2}]),OD=_.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:ND,repeated:!0}]),DD=_.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:_.getEnumType(tf)}]),MD=_.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:DD,repeated:!0}]),lm=_.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:_.getEnumType(em)},{no:2,name:"enabled",kind:"scalar",T:8}]),LD=_.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:lm,repeated:!0}]),jD=_.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:lm,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:LD,repeated:!0}]),UD=_.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:CD,repeated:!0}]),xC=_.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),EC=_.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:xC,repeated:!0}]),FD=_.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),BD=_.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:gu},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:zr},{no:4,name:"other_participants",kind:"message",T:zr,repeated:!0}]),cm=_.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:cr},{no:2,name:"subscription",kind:"message",T:ku},{no:3,name:"publish_tracks",kind:"message",T:sm,repeated:!0},{no:4,name:"data_channels",kind:"message",T:RC,repeated:!0},{no:5,name:"offer",kind:"message",T:cr},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:PC,repeated:!0}]),PC=_.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),RC=_.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:_.getEnumType(Dn)}]),Kn=_.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:_.getEnumType(wD),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),_C=_.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),VD=_.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),zD=_.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:WD,repeated:!0}]),WD=_.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),qD=_.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:_.getEnumType(mD)}]),HD=_.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:_.getEnumType(um)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:vu,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Ta,oneof:"request"},{no:6,name:"mute",kind:"message",T:yu,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:am,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:om,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:TC,oneof:"request"}]),um=_.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),$D=_.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),IC=_.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),KD=_.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:mC},{no:2,name:"connection_settings",kind:"message",T:IC},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Ta,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:cr},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:_.getEnumType(xr)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:cm}]),GD=_.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:_.getEnumType(JD)},{no:2,name:"join_request",kind:"scalar",T:12}]),JD=_.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),QD=_.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function YD(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Fl={exports:{}},XD=Fl.exports,My;function ZD(){return My||(My=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(XD,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(v,T){var g=v[T];if(typeof g.bind=="function")return g.bind(v);try{return Function.prototype.bind.call(g,v)}catch{return function(){return Function.prototype.apply.apply(g,[v,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&i?l:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function u(){for(var v=this.getLevel(),T=0;T<r.length;T++){var g=r[T];this[g]=T<v?e:this.methodFactory(g,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function d(v){return function(){typeof console!==n&&(u.call(this),this[v].apply(this,arguments))}}function h(v,T,g){return c(v)||d.apply(this,arguments)}function p(v,T){var g=this,y,S,k,b="loglevel";typeof v=="string"?b+=":"+v:typeof v=="symbol"&&(b=void 0);function x(W){var J=(r[W]||"silent").toUpperCase();if(!(typeof window===n||!b)){try{window.localStorage[b]=J;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+J+";"}catch{}}}function E(){var W;if(!(typeof window===n||!b)){try{W=window.localStorage[b]}catch{}if(typeof W===n)try{var J=window.document.cookie,se=encodeURIComponent(b),te=J.indexOf(se+"=");te!==-1&&(W=/^([^;]+)/.exec(J.slice(te+se.length+1))[1])}catch{}return g.levels[W]===void 0&&(W=void 0),W}}function P(){if(!(typeof window===n||!b)){try{window.localStorage.removeItem(b)}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function A(W){var J=W;if(typeof J=="string"&&g.levels[J.toUpperCase()]!==void 0&&(J=g.levels[J.toUpperCase()]),typeof J=="number"&&J>=0&&J<=g.levels.SILENT)return J;throw new TypeError("log.setLevel() called with invalid level: "+W)}g.name=v,g.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},g.methodFactory=T||h,g.getLevel=function(){return k??S??y},g.setLevel=function(W,J){return k=A(W),J!==!1&&x(k),u.call(g)},g.setDefaultLevel=function(W){S=A(W),E()||g.setLevel(W,!1)},g.resetLevel=function(){k=null,P(),u.call(g)},g.enableAll=function(W){g.setLevel(g.levels.TRACE,W)},g.disableAll=function(W){g.setLevel(g.levels.SILENT,W)},g.rebuild=function(){if(o!==g&&(y=A(o.getLevel())),u.call(g),o===g)for(var W in s)s[W].rebuild()},y=A(o?o.getLevel():"WARN");var O=E();O!=null&&(k=A(O)),u.call(g)}o=new p,o.getLogger=function(T){if(typeof T!="symbol"&&typeof T!="string"||T==="")throw new TypeError("You must supply a name when creating a logger.");var g=s[T];return g||(g=s[T]=new p(T,o.methodFactory)),g};var m=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=m),o},o.getLoggers=function(){return s},o.default=o,o})}(Fl)),Fl.exports}var bu=ZD(),rf;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(rf||(rf={}));var Bn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Bn||(Bn={}));let he=bu.getLogger("livekit");Object.values(Bn).map(t=>bu.getLogger(t));he.setDefaultLevel(rf.info);function Ei(t){const e=bu.getLogger(t);return e.setDefaultLevel(he.getLevel()),e}const eM=bu.getLogger("lk-e2ee"),bo=7e3,tM=[0,300,2*2*300,3*3*300,4*4*300,bo,bo,bo,bo,bo];class nM{constructor(e){this._retryDelays=e!==void 0?[...e]:tM}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function iM(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function w(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}function Ly(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function fi(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ly=="function"?Ly(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),r(a,l,o.done,o.value)})}}function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}var pl={exports:{}},jy;function rM(){if(jy)return pl.exports;jy=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(b,x,E){return Function.prototype.apply.call(b,x,E)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:n=function(b){return Object.getOwnPropertyNames(b)};function i(k){console&&console.warn&&console.warn(k)}var r=Number.isNaN||function(b){return b!==b};function s(){s.init.call(this)}pl.exports=s,pl.exports.once=g,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(k){if(typeof k!="number"||k<0||r(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");o=k}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function l(k){return k._maxListeners===void 0?s.defaultMaxListeners:k._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(b){for(var x=[],E=1;E<arguments.length;E++)x.push(arguments[E]);var P=b==="error",A=this._events;if(A!==void 0)P=P&&A.error===void 0;else if(!P)return!1;if(P){var O;if(x.length>0&&(O=x[0]),O instanceof Error)throw O;var W=new Error("Unhandled error."+(O?" ("+O.message+")":""));throw W.context=O,W}var J=A[b];if(J===void 0)return!1;if(typeof J=="function")e(J,this,x);else for(var se=J.length,te=m(J,se),E=0;E<se;++E)e(te[E],this,x);return!0};function c(k,b,x,E){var P,A,O;if(a(x),A=k._events,A===void 0?(A=k._events=Object.create(null),k._eventsCount=0):(A.newListener!==void 0&&(k.emit("newListener",b,x.listener?x.listener:x),A=k._events),O=A[b]),O===void 0)O=A[b]=x,++k._eventsCount;else if(typeof O=="function"?O=A[b]=E?[x,O]:[O,x]:E?O.unshift(x):O.push(x),P=l(k),P>0&&O.length>P&&!O.warned){O.warned=!0;var W=new Error("Possible EventEmitter memory leak detected. "+O.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");W.name="MaxListenersExceededWarning",W.emitter=k,W.type=b,W.count=O.length,i(W)}return k}s.prototype.addListener=function(b,x){return c(this,b,x,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(b,x){return c(this,b,x,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(k,b,x){var E={fired:!1,wrapFn:void 0,target:k,type:b,listener:x},P=u.bind(E);return P.listener=x,E.wrapFn=P,P}s.prototype.once=function(b,x){return a(x),this.on(b,d(this,b,x)),this},s.prototype.prependOnceListener=function(b,x){return a(x),this.prependListener(b,d(this,b,x)),this},s.prototype.removeListener=function(b,x){var E,P,A,O,W;if(a(x),P=this._events,P===void 0)return this;if(E=P[b],E===void 0)return this;if(E===x||E.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete P[b],P.removeListener&&this.emit("removeListener",b,E.listener||x));else if(typeof E!="function"){for(A=-1,O=E.length-1;O>=0;O--)if(E[O]===x||E[O].listener===x){W=E[O].listener,A=O;break}if(A<0)return this;A===0?E.shift():v(E,A),E.length===1&&(P[b]=E[0]),P.removeListener!==void 0&&this.emit("removeListener",b,W||x)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(b){var x,E,P;if(E=this._events,E===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete E[b]),this;if(arguments.length===0){var A=Object.keys(E),O;for(P=0;P<A.length;++P)O=A[P],O!=="removeListener"&&this.removeAllListeners(O);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=E[b],typeof x=="function")this.removeListener(b,x);else if(x!==void 0)for(P=x.length-1;P>=0;P--)this.removeListener(b,x[P]);return this};function h(k,b,x){var E=k._events;if(E===void 0)return[];var P=E[b];return P===void 0?[]:typeof P=="function"?x?[P.listener||P]:[P]:x?T(P):m(P,P.length)}s.prototype.listeners=function(b){return h(this,b,!0)},s.prototype.rawListeners=function(b){return h(this,b,!1)},s.listenerCount=function(k,b){return typeof k.listenerCount=="function"?k.listenerCount(b):p.call(k,b)},s.prototype.listenerCount=p;function p(k){var b=this._events;if(b!==void 0){var x=b[k];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function m(k,b){for(var x=new Array(b),E=0;E<b;++E)x[E]=k[E];return x}function v(k,b){for(;b+1<k.length;b++)k[b]=k[b+1];k.pop()}function T(k){for(var b=new Array(k.length),x=0;x<b.length;++x)b[x]=k[x].listener||k[x];return b}function g(k,b){return new Promise(function(x,E){function P(O){k.removeListener(b,A),E(O)}function A(){typeof k.removeListener=="function"&&k.removeListener("error",P),x([].slice.call(arguments))}S(k,b,A,{once:!0}),b!=="error"&&y(k,P,{once:!0})})}function y(k,b,x){typeof k.on=="function"&&S(k,"error",b,x)}function S(k,b,x,E){if(typeof k.on=="function")E.once?k.once(b,x):k.on(b,x);else if(typeof k.addEventListener=="function")k.addEventListener(b,function P(A){E.once&&k.removeEventListener(b,P),x(A)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}return pl.exports}var ri=rM();let AC=!0,NC=!0;function Oo(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Xr(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const l=c=>{const u=n(c);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),r.apply(this,[o,l])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function sM(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(AC=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function oM(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(NC=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function OC(){if(typeof window=="object"){if(AC)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function dm(t,e){NC&&console.warn(t+" is deprecated, please use "+e+" instead.")}function aM(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Oo(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Oo(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Oo(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Oo(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Uy(t){return Object.prototype.toString.call(t)==="[object Object]"}function DC(t){return Uy(t)?Object.keys(t).reduce(function(e,n){const i=Uy(t[n]),r=i?DC(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function sf(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?sf(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{sf(t,t.get(r),n)})}))}function Fy(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&sf(t,a,r)})}),r}const By=OC;function MC(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof a[c]=="object"?a[c]:{ideal:a[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,p){return h?h+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){l.optional=l.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",c)]=u.ideal,l.optional.push(h),h={},h[d("max",c)]=u.ideal,l.optional.push(h)):(h[d("",c)]=u.ideal,l.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(h,c)]=u[h])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},r=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(m=>m.kind==="videoinput");let p=h.find(m=>d.some(v=>m.label.toLowerCase().includes(v)));return!p&&h.length&&d.includes("back")&&(p=h[h.length-1]),p&&(a.video.deviceId=c.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),By("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return By("chrome: "+JSON.stringify(a)),l(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){r(a,u=>{n.webkitGetUserMedia(u,l,d=>{c&&c(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,c=>a(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function LC(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function jC(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Xr(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function UC(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){let c=r.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function FC(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>Fy(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Xr(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>Fy(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function BC(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function VC(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return BC(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(v=>v===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[d.id];if(m)m.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([u]);this._streams[d.id]=v,this._reverseStreams[v.id]=d,this.addStream(v)}return this.getSenders().find(v=>v.track===u)};function s(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const p=c._reverseStreams[h],m=c._streams[p.id];d=d.replace(new RegExp(m.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const p=c._reverseStreams[h],m=c._streams[p.id];d=d.replace(new RegExp(p.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],d={[c](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[m=>{const v=s(this,m);h[0].apply(null,[v])},m=>{h[1]&&h[1].apply(null,m)},arguments[2]]):u.apply(this,arguments).then(m=>s(this,m))}};t.RTCPeerConnection.prototype[c]=d[c]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(v=>u.track===v)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function of(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function zC(t,e){Xr(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Vy=Object.freeze({__proto__:null,fixNegotiationNeeded:zC,shimAddTrackRemoveTrack:VC,shimAddTrackRemoveTrackWithNative:BC,shimGetSendersWithDtmf:UC,shimGetUserMedia:MC,shimMediaStream:LC,shimOnTrack:jC,shimPeerConnection:of,shimSenderReceiverGetStats:FC});function WC(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){dm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function lM(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function qC(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function af(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return l}).then(o,a)}}function HC(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function $C(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Xr(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function KC(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){dm("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function GC(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function JC(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function QC(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function YC(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function XC(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var zy=Object.freeze({__proto__:null,shimAddTransceiver:JC,shimCreateAnswer:XC,shimCreateOffer:YC,shimGetDisplayMedia:lM,shimGetParameters:QC,shimGetUserMedia:WC,shimOnTrack:qC,shimPeerConnection:af,shimRTCDataChannel:GC,shimReceiverGetStats:$C,shimRemoveStream:KC,shimSenderGetStats:HC});function ZC(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function ew(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function tw(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h},e.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h};let a=function(l,c,u){const d=r.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(l,c,u){const d=o.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.addIceCandidate=a}function nw(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(iw(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function iw(t){return t&&t.video!==void 0?Object.assign({},t,{video:DC(t.video)}):t}function rw(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(dm("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function sw(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ow(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function aw(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Wy=Object.freeze({__proto__:null,shimAudioContext:aw,shimCallbacksAPI:tw,shimConstraints:iw,shimCreateOfferLegacy:ow,shimGetUserMedia:nw,shimLocalStreamsAPI:ZC,shimRTCIceServerUrls:rw,shimRemoteStreamsAPI:ew,shimTrackEventTransceiver:sw}),Td={exports:{}},qy;function cM(){return qy||(qy=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const l=s[a],c=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(c){const u=e.parseRtpMap(c),d=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(l=>{a.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||a.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),l=a.length>0&&a[0].ssrc;let c;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(m=>parseInt(m,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let p={ssrc:l,codecPayloadType:parseInt(h.parameters.apt,10)};l&&c&&(p.rtx={ssrc:c}),i.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&l&&i.push({ssrc:l});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const l=a[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Td)),Td.exports}var lw=cM(),Ds=YD(lw),uM=kO({__proto__:null,default:Ds},[lw]);function Bl(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=Ds.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Xr(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function lf(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Xr(t,"icecandidate",e=>{if(e.candidate){const n=Ds.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Vl(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const l=Ds.splitSections(a.sdp);return l.shift(),l.some(c=>{const u=Ds.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},r=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},s=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=Ds.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),c=r(l),u=s(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function zl(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Xr(t,"datachannel",i=>(e(i.channel,i.target),i))}function cf(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function uf(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function Wl(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ql(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var dM=Object.freeze({__proto__:null,removeExtmapAllowMixed:uf,shimAddIceCandidateNullOrEmpty:Wl,shimConnectionState:cf,shimMaxMessageSize:Vl,shimParameterlessSetLocalDescription:ql,shimRTCIceCandidate:Bl,shimRTCIceCandidateRelayProtocol:lf,shimSendThrowTypeError:zl});function hM(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=OC,i=aM(t),r={browserDetails:i,commonShim:dM,extractVersion:Oo,disableLog:sM,disableWarnings:oM,sdp:uM};switch(i.browser){case"chrome":if(!Vy||!of||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Vy,Wl(t,i),ql(t),MC(t,i),LC(t),of(t,i),jC(t),VC(t,i),UC(t),FC(t),zC(t,i),Bl(t),lf(t),cf(t),Vl(t,i),zl(t),uf(t,i);break;case"firefox":if(!zy||!af||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=zy,Wl(t,i),ql(t),WC(t,i),af(t,i),qC(t),KC(t),HC(t),$C(t),GC(t),JC(t),QC(t),YC(t),XC(t),Bl(t),cf(t),Vl(t,i),zl(t);break;case"safari":if(!Wy||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Wy,Wl(t,i),ql(t),rw(t),ow(t),tw(t),ZC(t),ew(t),sw(t),nw(t),aw(t),Bl(t),lf(t),Vl(t,i),zl(t),uf(t,i);break;default:n("Unsupported browser!");break}return r}hM({window:typeof window>"u"?void 0:window});const fM=/version\/(\d+(\.?_?\d+)+)/i;let Cd;function en(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Cd===void 0||e){const i=pM.find(r=>{let{test:s}=r;return s.test(n)});Cd=i==null?void 0:i.describe(n)}return Cd}const pM=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Hl(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:wd(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Hl(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:wd(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Hl(fM,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:wd(t)}}}];function Hl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function wd(t){return t.includes("mac os")?Hl(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var mM="2.16.1";const gM=mM,vM=16;class si extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var Fe;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket"})(Fe||(Fe={}));class oe extends si{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=Fe[n]}static notAllowed(e,n,i){return new oe(e,Fe.NotAllowed,n,i)}static timeout(e){return new oe(e,Fe.Timeout)}static leaveRequest(e,n){return new oe(e,Fe.LeaveRequest,void 0,n)}static internal(e,n){return new oe(e,Fe.InternalError,void 0,n)}static cancelled(e){return new oe(e,Fe.Cancelled)}static serverUnreachable(e,n){return new oe(e,Fe.ServerUnreachable,n)}static websocket(e,n,i){return new oe(e,Fe.WebSocket,n,i)}}class hm extends si{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class pi extends si{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class yM extends si{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class dt extends si{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class df extends si{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Hy extends si{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class $y extends si{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:um[n]}}var jt;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(jt||(jt={}));class gn extends si{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=jt[n]}}class ss extends si{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Dc;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Dc||(Dc={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Dc||(Dc={}));class wt{}wt.setTimeout=function(){return setTimeout(...arguments)};wt.setInterval=function(){return setInterval(...arguments)};wt.clearTimeout=function(){return clearTimeout(...arguments)};wt.clearInterval=function(){return clearInterval(...arguments)};var U;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(U||(U={}));var K;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(K||(K={}));var H;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(H||(H={}));var B;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(B||(B={}));function kM(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class Ne{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const SM=["vp8","h264"],bM=["vp8","h264","vp9","av1","h265"];function TM(t){return!!SM.find(e=>e===t)}const CM=TM;var Ky;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Ky||(Ky={}));var hf;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(hf||(hf={}));const Ca={h90:new Ne(160,90,9e4,20),h180:new Ne(320,180,16e4,20),h216:new Ne(384,216,18e4,20),h360:new Ne(640,360,45e4,20),h540:new Ne(960,540,8e5,25),h720:new Ne(1280,720,17e5,30),h1080:new Ne(1920,1080,3e6,30),h1440:new Ne(2560,1440,5e6,30),h2160:new Ne(3840,2160,8e6,30)},ff={h120:new Ne(160,120,7e4,20),h180:new Ne(240,180,125e3,20),h240:new Ne(320,240,14e4,20),h360:new Ne(480,360,33e4,20),h480:new Ne(640,480,5e5,20),h540:new Ne(720,540,6e5,25),h720:new Ne(960,720,13e5,30),h1080:new Ne(1440,1080,23e5,30),h1440:new Ne(1920,1440,38e5,30)},fm={h360fps3:new Ne(640,360,2e5,3,"medium"),h360fps15:new Ne(640,360,4e5,15,"medium"),h720fps5:new Ne(1280,720,8e5,5,"medium"),h720fps15:new Ne(1280,720,15e5,15,"medium"),h720fps30:new Ne(1280,720,2e6,30,"medium"),h1080fps15:new Ne(1920,1080,25e5,15,"medium"),h1080fps30:new Ne(1920,1080,5e6,30,"medium"),original:new Ne(0,0,7e6,30,"medium")};function cw(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:l,videoProcessor:c}=hw(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(pf(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(l||u)&&(h.audio.processor=l??u)),h.video&&(pf(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(c||d)&&(h.video.processor=c??d)),h}function pf(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function pm(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,l=t.video;Object.keys(l).forEach(c=>{switch(c){case"resolution":pf(a,l.resolution);break;default:a[c]=l[c]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function uw(t){return w(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=dw();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield xt(n),r.getByteTimeDomainData(o);const l=o.some(c=>c!==128&&c!==0);return i.close(),!l}return!1}()})}function dw(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>w(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function wM(t){return t==="audioinput"?M.Source.Microphone:t==="videoinput"?M.Source.Camera:M.Source.Unknown}function mf(t){return t===M.Source.Microphone?"audioinput":t===M.Source.Camera?"videoinput":void 0}function xM(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,qr()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Qo(t){return t.split("/")[1].toLowerCase()}function EM(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new sm({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function ye(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?ye(t.track):{})}}function PM(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function RM(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function hw(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:kM(e)}}function _M(t){switch(t){case at.CAMERA:return M.Source.Camera;case at.MICROPHONE:return M.Source.Microphone;case at.SCREEN_SHARE:return M.Source.ScreenShare;case at.SCREEN_SHARE_AUDIO:return M.Source.ScreenShareAudio;default:return M.Source.Unknown}}function Gy(t,e){return t.width*t.height<e.width*e.height}function IM(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const AM=5e3,To=[];var sn;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(sn||(sn={}));class M extends ri.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=M.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=he,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),AM):this.handleAppVisibilityChanged()},this.log=Ei((r=i.loggerName)!==null&&r!==void 0?r:Bn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=M.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),ye(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===M.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===M.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(To.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&To.splice(To.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),ws(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?B.AudioPlaybackStarted:B.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?B.AudioPlaybackFailed:B.VideoPlaybackFailed,s):s.name==="AbortError"?he.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):he.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(B.ElementAttached,e),e}detach(e){try{if(e){Ms(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(B.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{Ms(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(B.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Ei(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),To.forEach(i=>{i.parentElement||(n=!1)}),n&&To.push(e)}}handleAppVisibilityChanged(){return w(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===M.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Gt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Gt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function ws(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!qr()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(qr()||Wr())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Ms(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(c){switch(c){case e.Audio:return On.AUDIO;case e.Video:return On.VIDEO;default:return On.DATA}}t.kindToProto=r;function s(c){switch(c){case On.AUDIO:return e.Audio;case On.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(c){switch(c){case n.Camera:return at.CAMERA;case n.Microphone:return at.MICROPHONE;case n.ScreenShare:return at.SCREEN_SHARE;case n.ScreenShareAudio:return at.SCREEN_SHARE_AUDIO;default:return at.UNKNOWN}}t.sourceToProto=o;function a(c){switch(c){case at.CAMERA:return n.Camera;case at.MICROPHONE:return n.Microphone;case at.SCREEN_SHARE:return n.ScreenShare;case at.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function l(c){switch(c){case tf.ACTIVE:return i.Active;case tf.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=l})(M||(M={}));const NM="|",Jy="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function OM(t){const e=t.split(NM);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function xt(t){return w(this,void 0,void 0,function*(){return new Promise(e=>wt.setTimeout(e,t))})}function gf(){return"addTransceiver"in RTCPeerConnection.prototype}function vf(){return"addTrack"in RTCPeerConnection.prototype}function DM(){if(!("getCapabilities"in RTCRtpSender)||qr()||Wr())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function MM(){if(!("getCapabilities"in RTCRtpSender)||Wr())return!1;if(qr()){const n=en();if(n!=null&&n.version&&ii(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&ii(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Mn(t){return t==="av1"||t==="vp9"}function yf(t){return!document||wa()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function LM(){return typeof RTCPeerConnection>"u"?!1:gf()||vf()}function Wr(){var t;return((t=en())===null||t===void 0?void 0:t.name)==="Firefox"}function Qy(){const t=en();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function qr(){var t;return((t=en())===null||t===void 0?void 0:t.name)==="Safari"}function wa(){const t=en();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function jM(){const t=en();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&ii(t.osVersion,"17")>=0}function UM(t){return t||(t=en()),(t==null?void 0:t.name)==="Safari"&&ii(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&ii(t.osVersion,"18.3")>0}function fw(){var t,e;return Gt()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function FM(){const t=en(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&ii(t.osVersion,e)>=0?!0:t.name==="Safari"&&ii(t.version,e)>=0}function Gt(){return typeof document<"u"}function ni(){return navigator.product=="ReactNative"}function Qs(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function xd(t){return Qs(t)?t.hostname.split(".")[0]:null}function pw(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function mw(){if(!ni())return;let t=pw();if(t)return t.platform}function Yy(){if(Gt())return window.devicePixelRatio;if(ni()){let t=pw();if(t)return t.devicePixelRatio}return 1}function ii(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function BM(t){for(const e of t)e.target.handleResize(e)}function VM(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Ed=null;const Xy=()=>(Ed||(Ed=new ResizeObserver(BM)),Ed);let Pd=null;const Zy=()=>(Pd||(Pd=new IntersectionObserver(VM,{root:null,rootMargin:"0px"})),Pd);function zM(){var t;const e=new mC({sdk:gC.JS,protocol:vM,version:gM});return ni()&&(e.os=(t=mw())!==null&&t!==void 0?t:""),e}function e0(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Co;function Rd(){if(!Co){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Co]=i.stream.getAudioTracks(),!Co)throw Error("Could not get empty media stream audio track");Co.enabled=!1}return Co.clone()}class Sn{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>w(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function WM(t){return bM.includes(t)}function nr(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function qM(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function xa(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function HM(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:l}=n;var c;const u=(c=e.get(i))!==null&&c!==void 0?c:Date.now(),d=Date.now();return l?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:l,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function $M(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function t0(t){switch(t.reason){case Fe.LeaveRequest:return t.context;case Fe.Cancelled:return Ln.CLIENT_INITIATED;case Fe.NotAllowed:return Ln.USER_REJECTED;case Fe.ServerUnreachable:return Ln.JOIN_FAILURE;default:return Ln.UNKNOWN_REASON}}function $l(t){return t!==void 0?Number(t):void 0}function Er(t){return t!==void 0?BigInt(t):void 0}function Ls(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function ti(t){return!!t&&t.kind==M.Kind.Audio}function mr(t){return!!t&&t.kind==M.Kind.Video}function Ni(t){return Ls(t)&&mr(t)}function ai(t){return Ls(t)&&ti(t)}function kf(t){return!!t&&!t.isLocal}function KM(t){return!!t&&!t.isLocal}function _d(t){return kf(t)&&mr(t)}function GM(t){return t.isLocal}function JM(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function QM(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function YM(t,e){const n=new URL(qM(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),vw(n,"rtc")}function XM(t){const e=new URL(xa(t));return vw(e,"validate")}function gw(t){return t.endsWith("/")?t:"".concat(t,"/")}function vw(t,e){return t.pathname="".concat(gw(t.pathname)).concat(e),t.toString()}function n0(t){if(typeof t=="string")return Dy.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return Dy.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function ZM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const eL=10,wo="lk_e2ee",tL="LKFrameEncryptionKey",nL={sharedKey:!1,ratchetSalt:tL,ratchetWindowSize:8,failureTolerance:eL,keyringSize:16};var ir;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(ir||(ir={}));var i0;(function(t){t.KeyRatcheted="keyRatcheted"})(i0||(i0={}));var qi;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(qi||(qi={}));var r0;(function(t){t.Error="cryptorError"})(r0||(r0={}));function iL(){return rL()||Sf()}function Sf(){return typeof window.RTCRtpScriptTransform<"u"}function rL(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function sL(t){var e,n,i,r,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new lC({value:t.value})}class yU extends ri.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{he.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},nL),e),this.on(ir.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(ir.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(ir.RatchetRequest,e,n)}}var s0;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(s0||(s0={}));class oL extends ri.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,s;const{kind:o,data:a}=i.data;switch(o){case"error":if(he.error(a.error.message),a.uuid){const u=this.decryptDataRequests.get(a.uuid);if(u!=null&&u.reject){u.reject(a.error);break}const d=this.encryptDataRequests.get(a.uuid);if(d!=null&&d.reject){d.reject(a.error);break}}this.emit(qi.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(qi.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const u=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(qi.ParticipantEncryptionStatusChanged,a.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(ir.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const l=this.decryptDataRequests.get(a.uuid);l!=null&&l.resolve&&l.resolve(a);break;case"encryptDataResponse":const c=this.encryptDataRequests.get(a.uuid);c!=null&&c.resolve&&c.resolve(a);break}},this.onWorkerError=i=>{he.error("e2ee worker encountered an error:",{error:i.error}),this.emit(qi.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!iL())throw new hm("tried to setup end-to-end encryption on an unsupported browser");if(he.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:eM.getLevel()}};this.worker&&(he.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){he.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?he.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(H.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(U.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==ft.NONE,r.identity)),e.on(U.ConnectionStateChanged,i=>{i===we.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==ft.NONE,r.identity)})})}).on(U.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(U.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(U.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(K.LocalSenderCreated,(i,r)=>w(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(K.LocalTrackPublished,i=>{if(!mr(i.track)||!wa())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Qo(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(ir.SetKey,i=>this.postKey(i)).on(ir.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return w(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Sn;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:r}},a=new Sn;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Qo(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Ls(e)||!n){n||he.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return w(this,void 0,void 0,function*(){if(this.worker){if(Sf()&&!Qy()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(wo in e&&r){const l={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(l);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const l=e.createEncodedStreams();e.writableStream=l.writable,s=l.writable,e.readableStream=l.readable,o=l.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:wo in e}};this.worker.postMessage(a,[o,s])}e[wo]=!0}})}handleSender(e,n,i){var r;if(!(wo in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Sf()&&!Qy()){he.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{he.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[wo]=!0}}}const aL=500,lL=15e3;class js{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new js),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=xd(i);if(!r)return;let s=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,s+1),this.backOffPromises.set(r,xt(Math.min(aL*Math.pow(2,s),lL)))}getBackOffPromise(e){const n=new URL(e),i=n&&xd(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&xd(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}js._instance=null;const Id="default";class yt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new yt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=yt.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){he.debug("awaiting getUserMedia promise");try{n?yield yt.userMediaPromiseMap.get(n):yield Promise.all(yt.userMediaPromiseMap.values())}catch{he.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(qr()&&i.hasDeviceInUse(n))&&(o.filter(l=>l.kind===n).length===0||o.some(l=>{const c=l.label==="",u=n?l.kind===n:!0;return c&&u}))){const l={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},c=yield navigator.mediaDevices.getUserMedia(l);o=yield navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return w(this,void 0,void 0,function*(){if(n!==Id)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===Id);if(!s){he.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==Id&&a.groupId===(i??s.groupId));if(!o){he.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?yt.userMediaPromiseMap.has(e):yt.userMediaPromiseMap.size>0}}yt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];yt.userMediaPromiseMap=new Map;var Yo;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Yo||(Yo={}));class cL{constructor(){this.pendingTasks=new Map,this.taskMutex=new Bt,this.nextTaskIndex=0}run(e){return w(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Yo.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Yo.RUNNING,yield e()}finally{n.status=Yo.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return w(this,void 0,void 0,function*(){return this.run(()=>w(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class uL{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:l}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,l)};this.opened=new Promise((a,l)=>{s.onopen=()=>{a({readable:new ReadableStream({start(c){s.onmessage=u=>{let{data:d}=u;return c.enqueue(d)},s.onerror=u=>c.error(u)},cancel:o}),writable:new WritableStream({write(c){s.send(c)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",l)},s.addEventListener("error",l)}),this.closed=new Promise((a,l)=>{const c=()=>w(this,void 0,void 0,function*(){const u=new Promise(h=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",p=>{h(p)},{once:!0})}),d=yield Promise.race([xt(250),u]);d?a(d):l(new Error("Encountered unspecified websocket error without a timely close event"))});s.onclose=u=>{let{code:d,reason:h}=u;a({closeCode:d,reason:h}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}const dL=["syncState","trickle","offer","answer","simulate","leave"];function hL(t){const e=dL.indexOf(t.case)>=0;return he.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var Oe;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(Oe||(Oe={}));const fL=250;class mm{get currentState(){return this.state}get isDisconnected(){return this.state===Oe.DISCONNECTING||this.state===Oe.DISCONNECTED}get isEstablishingConnection(){return this.state===Oe.CONNECTING||this.state===Oe.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=Oe.DISCONNECTED,this.log=he,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Ei((i=n.loggerName)!==null&&i!==void 0?i:Bn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new cL,this.queuedRequests=[],this.closingLock=new Bt,this.connectionLock=new Bt,this.state=Oe.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return w(this,void 0,void 0,function*(){return this.state=Oe.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return w(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Oe.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return w(this,void 0,void 0,function*(){const s=yield this.connectionLock.lock();this.connectOptions=i;const o=zM(),a=i.singlePeerConnection?mL(n,o,i):pL(n,o,i),l=YM(e,a),c=XM(l);return new Promise((u,d)=>w(this,void 0,void 0,function*(){var h,p;try{let m=!1;const v=k=>w(this,void 0,void 0,function*(){if(m)return;m=!0;const b=k instanceof Event?k.currentTarget:k,x=ZM(b,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(x)).catch(E=>{this.log.error(E),this.close()}):this.close(),T(),d(oe.cancelled(x))});r==null||r.addEventListener("abort",v);const T=()=>{clearTimeout(g),r==null||r.removeEventListener("abort",v)},g=setTimeout(()=>{v(oe.timeout("room connection has timed out (signal)"))},i.websocketTimeout),y=(k,b)=>{this.handleSignalConnected(k,g,b)},S=new URL(l);S.searchParams.has("access_token")&&S.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(S),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new uL(l);try{this.ws.closed.then(O=>{var W;this.isEstablishingConnection&&d(oe.internal("Websocket got closed during a (re)connection attempt: ".concat(O.reason))),O.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:O.reason,code:O.closeCode,wasClean:O.closeCode===1e3,state:this.state})),this.state===Oe.CONNECTED&&this.handleOnClose((W=O.reason)!==null&&W!==void 0?W:"Unexpected WS error"))}).catch(O=>{this.isEstablishingConnection&&d(oe.internal("Websocket error during a (re)connection attempt: ".concat(O)))});const k=yield this.ws.opened.catch(O=>w(this,void 0,void 0,function*(){if(this.state!==Oe.CONNECTED){this.state=Oe.DISCONNECTED,clearTimeout(g);const W=yield this.handleConnectionError(O,c);d(W);return}this.handleWSError(O),d(O)}));if(clearTimeout(g),!k)return;const b=k.readable.getReader();this.streamWriter=k.writable.getWriter();const x=yield b.read();if(b.releaseLock(),!x.value)throw oe.internal("no message received as first message");const E=n0(x.value),P=this.validateFirstMessage(E,(h=i.reconnect)!==null&&h!==void 0?h:!1);if(!P.isValid){d(P.error);return}((p=E.message)===null||p===void 0?void 0:p.case)==="join"&&(this.pingTimeoutDuration=E.message.value.pingTimeout,this.pingIntervalDuration=E.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const A=P.shouldProcessFirstMessage?E:void 0;y(k,A),u(P.response)}catch(k){d(k)}finally{T()}}finally{s()}}))})}startReadingLoop(e,n){return w(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield xt(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const s=n0(r);this.handleSignalResponse(s)}})}close(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([Oe.DISCONNECTING||Oe.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Oe.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,xt(fL)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=Oe.DISCONNECTED),r()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:xs(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:xs(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new vu({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new yu({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return w(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new am({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new CC({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new EC({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ze.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new _C({timestamp:ze.parse(Date.now()),rtt:ze.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new om({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Su({reason:Ln.CLIENT_INITIATED,action:Os.DISCONNECT})})}sendRequest(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!hL(n)&&i.state===Oe.RECONNECTING){i.queuedRequests.push(()=>w(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield xt(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new xD({message:n});try{i.useJSON?yield i.streamWriter.write(o.toJsonString()):yield i.streamWriter.write(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=o0(r.value);this.onAnswer&&this.onAnswer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const o=o0(r.value);this.onOffer&&this.onOffer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return w(this,void 0,void 0,function*(){if(this.state===Oe.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=wt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&wt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=wt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&wt.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=Oe.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,s,o,a;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===Oe.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:oe.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:oe.internal("Unexpected first message")}:{isValid:!1,error:oe.internal("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"))}}handleConnectionError(e,n){return w(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return oe.notAllowed(r,i.status)}else return e instanceof oe?e:oe.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof oe?i:oe.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function o0(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function xs(t,e){return new cr({sdp:t.sdp,type:t.type,id:e})}function pL(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",ni()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function mL(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new KD({clientInfo:e,connectionSettings:new IC({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const s=new GD({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),i}class a0{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class gL{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Rn={},Ad={},Nd={exports:{}},l0;function gm(){if(l0)return Nd.exports;l0=1;var t=Nd.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Nd.exports}var c0;function vL(){return c0||(c0=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,l,c,u){if(u&&!c)l[u]=e(a[1]);else for(var d=0;d<c.length;d+=1)a[d+1]!=null&&(l[c[d]]=e(a[d+1]))},i=function(a,l,c){var u=a.name&&a.names;a.push&&!l[a.push]?l[a.push]=[]:u&&!l[a.name]&&(l[a.name]={});var d=a.push?{}:u?l[a.name]:l;n(c.match(a.reg),d,a.names,a.name),a.push&&l[a.push].push(d)},r=gm(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var l={},c=[],u=l;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],p=d.slice(2);h==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var m=0;m<(r[h]||[]).length;m+=1){var v=r[h][m];if(v.reg.test(p))return i(v,u,p)}}),l.media=c,l};var o=function(a,l){var c=l.split(/=(.+)/,2);return c.length===2?a[c[0]]=e(c[1]):c.length===1&&l.length>1&&(a[c[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var l=[],c=a.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},t.parseImageAttributes=function(a){return a.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(l){return l.split(",").map(function(c){var u,d=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),d=!0),{scid:u,paused:d}})})}}(Ad)),Ad}var Od,u0;function yL(){if(u0)return Od;u0=1;var t=gm(),e=/%[sdv%]/g,n=function(o){var a=1,l=arguments,c=l.length;return o.replace(e,function(u){if(a>=c)return u;var d=l[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,l){var c=a.format instanceof Function?a.format(a.push?l:l[a.name]):a.format,u=[o+"="+c];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(l[a.name][h]):u.push(l[a.names[d]])}else u.push(l[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Od=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var l=a.outerOrder||r,c=a.innerOrder||s,u=[];return l.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(p){u.push(i(d,h,p))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),c.forEach(function(h){t[h].forEach(function(p){p.name in d&&d[p.name]!=null?u.push(i(h,p,d)):p.push in d&&d[p.push]!=null&&d[p.push].forEach(function(m){u.push(i(h,p,m))})})})}),u.join(`\r
`)+`\r
`},Od}var d0;function kL(){if(d0)return Rn;d0=1;var t=vL(),e=yL(),n=gm();return Rn.grammar=n,Rn.write=e,Rn.parse=t.parse,Rn.parseParams=t.parseParams,Rn.parseFmtpConfig=t.parseFmtpConfig,Rn.parsePayloads=t.parsePayloads,Rn.parseRemoteCandidates=t.parseRemoteCandidates,Rn.parseImageAttributes=t.parseImageAttributes,Rn.parseSimulcastStreamList=t.parseSimulcastStreamList,Rn}var Di=kL();function vm(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,l=n.maxWait,c=Date.now(),u=[];function d(){if(l!==void 0){var p=Date.now()-c;if(p+e>=l)return l-p}return e}var h=function(){var p=[].slice.call(arguments),m=this;return new Promise(function(v,T){var g=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,c=Date.now(),!o){var S=t.apply(m,p);a&&a(S),u.forEach(function(k){return(0,k.resolve)(S)}),u=[]}},d()),g){var y=t.apply(m,p);return a&&a(y),v(y)}u.push({resolve:v,reject:T})})};return h.cancel=function(p){s!==void 0&&clearTimeout(s),u.forEach(function(m){return(0,m.reject)(p)}),u=[]},h}const SL=.7,bL=20,Us={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class h0 extends ri.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=he,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=vm(r=>w(this,void 0,void 0,function*(){this.emit(Us.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),bL),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Ei((i=n.loggerName)!==null&&i!==void 0?i:Bn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Bt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return w(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return w(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=TL(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Di.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{const a=ym(o.mid);o.type==="audio"&&this.trackBitrates.some(l=>{if(!l.transceiver||a!=l.transceiver.mid)return!1;let c=0;if(o.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0)return!0;let u=!1;for(const d of o.fmtp)if(d.payload===c){d.config=d.config.split(";").filter(h=>!h.includes("maxaveragebitrate")).join(";"),l.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(l.maxbr*1e3)),u=!0;break}return u||l.maxbr>0&&o.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(l.maxbr*1e3)}),!0})}),r=Di.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Us.NegotiationComplete),e.sdp&&Di.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Us.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return w(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Di.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{p0(a),a.type==="audio"?f0(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(l=>{if(!a.msid||!l.cid||!a.msid.includes(l.cid))return!1;let c=0;if(a.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0||(Mn(l.codec)&&!qr()&&this.ensureVideoDDExtensionForSVC(a,o),!Mn(l.codec)))return!0;const u=Math.round(l.maxbr*SL);for(const d of a.fmtp)if(d.payload===c){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Di.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return w(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Di.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{p0(r),r.type==="audio"&&f0(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Di.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new dt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new dt("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return w(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return w(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new df(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===Jy))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var l;a.type==="video"&&((l=a.ext)===null||l===void 0||l.forEach(c=>{c.value>o&&(o=c.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Jy})}}}function f0(t,e,n){const i=ym(t.mid);let r=0;t.rtp.some(s=>s.codec==="opus"?(r=s.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===r&&s.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===r?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function TL(t){var e;const n=[],i=[],r=Di.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;const l=ym(o.mid);o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(l),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(l),!0):!1))}),{stereoMids:n,nackMids:i}}function p0(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function ym(t){return typeof t=="number"?t.toFixed(0):t}const bf="vp8",CL={audioPreset:hf.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:fm.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:bf,backupCodec:!0,preConnectBuffer:!1},yw={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},kw={deviceId:{ideal:"default"},resolution:Ca.h720.resolution},wL={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new nM,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},km={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Ge;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Ge||(Ge={}));class xL{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=km.peerConnectionTimeout,this.log=he,this.updateState=()=>{var s,o;const a=this.state,l=this.requiredTransports.map(c=>c.getConnectionState());l.every(c=>c==="connected")?this.state=Ge.CONNECTED:l.some(c=>c==="failed")?this.state=Ge.FAILED:l.some(c=>c==="connecting")?this.state=Ge.CONNECTING:l.every(c=>c==="closed")?this.state=Ge.CLOSED:l.some(c=>c==="closed")?this.state=Ge.CLOSING:l.every(c=>c==="new")&&(this.state=Ge.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(Ge[a]," to ").concat(Ge[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=Ei((r=i.loggerName)!==null&&r!==void 0?r:Bn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new h0(e,i),n!=="publisher-only"&&(this.subscriber=new h0(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Dn.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Dn.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=Ge.NEW,this.connectionLock=new Bt,this.remoteOfferLock=new Bt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return w(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return w(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return w(this,void 0,void 0,function*(){var i;n===Dn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return w(this,void 0,void 0,function*(){var i,r,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return w(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return w(this,void 0,void 0,function*(){return new Promise((n,i)=>w(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Us.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Us.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Dn.PUBLISHER?this.publisher.getConnectedAddress():e===Dn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return w(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((l,c)=>w(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),wt.clearTimeout(d),c(oe.cancelled("room connection has been cancelled"))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=wt.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),c(oe.internal("could not establish pc connection"))},o);for(;this.state!==Ge.CONNECTED;)if(yield xt(50),r!=null&&r.signal.aborted){c(oe.cancelled("room connection has been cancelled"));return}wt.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),l()}))}()})}}const Sw=5e3,EL=3e4;class Te{static fetchRegionSettings(e,n,i){return w(this,void 0,void 0,function*(){const r=yield Te.fetchLock.lock();try{const s=yield fetch("".concat(PL(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(s.ok){const o=QM(s.headers),a=o?o*1e3:Sw;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw s.status===401?oe.notAllowed("Could not fetch region settings: ".concat(s.statusText),s.status):oe.internal("Could not fetch region settings: ".concat(s.statusText))}catch(s){throw s instanceof oe?s:i!=null&&i.aborted?oe.cancelled("Region fetching was aborted"):oe.serverUnreachable("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s))}finally{r()}})}static scheduleRefetch(e,n,i){return w(this,void 0,void 0,function*(){const r=Te.settingsTimeouts.get(e.hostname);clearTimeout(r),Te.settingsTimeouts.set(e.hostname,setTimeout(()=>w(this,void 0,void 0,function*(){try{const s=yield Te.fetchRegionSettings(e,n);Te.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof oe&&s.reason===Fe.NotAllowed){he.debug("token is not valid, cancelling auto region refresh");return}he.debug("auto refetching of region settings failed",{error:s}),Te.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){Te.cache.set(e.hostname,i),Te.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=Te.settingsTimeouts.get(e);n&&(clearTimeout(n),Te.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=Te.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=Te.connectionTrackers.get(e);i&&i.connectionCount===0&&(he.debug("stopping region refetch after disconnect delay",{hostname:e}),Te.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},EL))}static cancelCleanup(e){const n=Te.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=Te.connectionTrackers.get(e);n||(n={connectionCount:0},Te.connectionTrackers.set(e,n)),n.connectionCount++,Te.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=Te.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&Te.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Qs(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return w(this,void 0,void 0,function*(){return Te.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return w(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=Te.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),Te.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(s=>s.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),he.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Te.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Te.cache=new Map;Te.settingsTimeouts=new Map;Te.connectionTrackers=new Map;Te.fetchLock=new Bt;function PL(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Ye extends Error{constructor(e,n,i){super(n),this.code=e,this.message=m0(n,Ye.MAX_MESSAGE_BYTES),this.data=i?m0(i,Ye.MAX_DATA_BYTES):void 0}static fromProto(e){return new Ye(e.code,e.message,e.data)}toProto(){return new dC({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Ye(Ye.ErrorCode[e],Ye.ErrorMessage[e],n)}}Ye.MAX_MESSAGE_BYTES=256;Ye.MAX_DATA_BYTES=15360;Ye.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Ye.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const bw=15360;function Sm(t){return new TextEncoder().encode(t).length}function m0(t,e){if(Sm(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const bm=2e3;function Tu(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Tm=typeof MediaRecorder<"u";class RL{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const _L=Tm?MediaRecorder:RL;class IL extends _L{constructor(e,n){if(!Tm)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=l=>{r==null||r.error(l),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:l=>{r=l,i=c=>w(this,void 0,void 0,function*(){let u;if(c.data.arrayBuffer){const d=yield c.data.arrayBuffer();u=new Uint8Array(d)}else if(c.data.byteArray)u=c.data.byteArray;else throw new Error("no data available!");s()||l.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function AL(){return Tm}const NL=1e3,OL=1e4;class Tw extends M{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=vm(()=>w(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>w(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(B.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Bt,this.pauseUpstreamLock=new Bt,this.trackChangeLock=new Bt,this.trackChangeLock.lock().then(o=>w(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==M.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return w(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Ms(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(ws(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{ws(r??e,s)}))})}waitForDimensions(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:NL;return function*(){var i;if(e.kind===M.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=en())===null||i===void 0?void 0:i.os)==="iOS"&&(yield xt(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield xt(50)}throw new pi("unable to get track dimensions after timeout")}()})}setDeviceId(e){return w(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===nr(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),nr(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===M.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===M.Kind.Audio?"audioinput":"videoinput";return n?yt.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return w(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return w(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return w(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new pi("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return w(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=iM(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===M.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(c=>{Ms(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const l=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===M.Kind.Video&&(yield l.applyConstraints(s)),l.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(l),this._constraints=e,this.emit(B.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?B.Muted:B.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return w(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),fw()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return w(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(B.UpstreamPaused,this);const i=en();if((i==null?void 0:i.name)==="Safari"&&ii(i.version,"12.0")<0)throw new hm("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return w(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(B.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return w(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),l={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(l),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(ws(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(c=>{c instanceof DOMException&&c.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:c})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:c}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const c of i.attachedElements)c!==i.processorElement&&r&&(Ms(i._mediaStreamTrack,c),ws(i.processor.processedTrack,c));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(B.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(B.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!AL()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new IL(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},OL)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Mc extends Tw{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,M.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>w(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=Tu(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(B.AudioTrackFeatureUpdate,this,vt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(B.AudioTrackFeatureUpdate,this,vt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===M.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==nr(this._constraints.deviceId);return this.source===M.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return w(this,void 0,void 0,function*(){let n;if(e){const i=pm({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return w(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){Gt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},bm)))}setProcessor(e){return w(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!ni()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(B.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return w(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return w(this,void 0,void 0,function*(){const e=yield uw(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(B.AudioSilenceDetected)),e})}}function DL(t,e,n){switch(t.kind){case"audio":return new Mc(t,e,!1,void 0,n);case"video":return new Lc(t,e,!1,n);default:throw new pi("unsupported track type: ".concat(t.kind))}}const ML=Object.values(Ca),LL=Object.values(ff),jL=Object.values(fm),UL=[Ca.h180,Ca.h360],FL=[ff.h180,ff.h360],BL=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new Ne(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),Tf=["q","h","f"];function Cf(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,l=i==null?void 0:i.scalabilityMode,c=i==null?void 0:i.videoCodec;if(!o&&!a&&!l||!e||!n)return[{}];o||(o=zL(t,e,n,c),he.debug("using video encoding",o));const u=o.maxFramerate,d=new Ne(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(l&&Mn(c)){const m=new Cw(l),v=[];if(m.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const T=en();if(wa()||ni()||(T==null?void 0:T.name)==="Chrome"&&ii(T==null?void 0:T.version,"113")<0){const g=m.suffix=="h"?2:3,y=UM(T);for(let S=0;S<m.spatial;S+=1)v.push({rid:Tf[2-S],maxBitrate:o.maxBitrate/Math.pow(g,S),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:y?Math.pow(2,S):void 0});v[0].scalabilityMode=l}else v.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(v[0].priority=d.encoding.priority,v[0].networkPriority=d.encoding.priority),he.debug("using svc encoding",{encodings:v}),v}if(!a)return[o];let h=[];t?h=(r=v0(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:g0(t,d):h=(s=v0(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:g0(t,d);let p;if(h.length>0){const m=h[0];h.length>1&&([,p]=h);const v=Math.max(e,n);if(v>=960&&p)return Dd(e,n,[m,p,d],u);if(v>=480)return Dd(e,n,[m,d],u)}return Dd(e,n,[d])}function VL(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&he.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),l=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,c=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===M.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Cf(t.source===M.Source.ScreenShare,l,c,n)}function zL(t,e,n,i){const r=WL(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const l=r[a];if(s=l.encoding,l.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function WL(t,e,n){if(t)return jL;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?ML:LL}function g0(t,e){if(t)return BL(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?UL:FL}function Dd(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=Tf.length)return;const a=Math.min(t,e),c={rid:Tf[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(c.maxFramerate=u);const d=Wr()||o===0;s.encoding.priority&&d&&(c.priority=s.encoding.priority,c.networkPriority=s.encoding.priority),r.push(c)}),ni()&&mw()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var l;a.maxFramerate!=s&&(o&&(o=!1,he.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),he.info('Setting framerate of encoding "'.concat((l=a.rid)!==null&&l!==void 0?l:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function v0(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class Cw{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function qL(t){return t.source===M.Source.ScreenShare||t.constraints.height&&nr(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const HL=5e3;class Lc extends Tw{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,M.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>w(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(l){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}const o=new Map(s.map(l=>[l.rid,l])),a=s.some(l=>l.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(B.CpuConstrained)),this.prevStats){let l=0;o.forEach((c,u)=>{var d;const h=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);l+=Tu(c,h)}),this._currentBitrate=l}this.prevStats=o}),this.senderLock=new Bt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Gt())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},bm))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return w(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,l=fi(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0)s=c.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return w(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,l=fi(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0){s=c.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===M.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===M.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return w(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=sn.LOW;i<=sn.HIGH;i+=1)n.push(new lm({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Mn(this.codec),n)}restartTrack(e){return w(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=pm({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var l=!0,c=fi(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;l=!0){s=u.value,l=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return w(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,l,c,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,p=fi(r.simulcastCodecs.values()),m;m=yield p.next(),o=m.done,!o;h=!0)c=m.value,h=!1,yield(d=c.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(v){a={error:v}}finally{try{!h&&!o&&(l=p.return)&&(yield l.call(p))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return w(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},HL))}setPublishingCodecs(e){return w(this,void 0,void 0,function*(){var n,i,r,s,o,a,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Mn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(n=!0,i=fi(e);r=yield i.next(),s=r.done,!s;n=!0){l=r.value,n=!1;const u=l;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(Mn(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){c.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield y0(d.sender,d.encodings,u.qualities,this.senderLock,Mn(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return c})}setPublishingLayers(e,n){return w(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield y0(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return w(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&Mn(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return w(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),fw()&&this.isInBackground&&this.source===M.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function y0(t,e,n,i,r,s,o){return w(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const l=t.getParameters(),{encodings:c}=l;if(!c)return;if(c.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:c,senderEncodings:e}));return}let u=!1;!1&&c[0].scalabilityMode||(r&&n.some(p=>p.enabled)&&n.forEach(p=>p.enabled=!0),c.forEach((h,p)=>{var m;let v=(m=h.rid)!==null&&m!==void 0?m:"";v===""&&(v="q");const T=ww(v),g=n.find(y=>y.quality===T);g&&h.active!==g.enabled&&(u=!0,h.active=g.enabled,s.debug("setting layer ".concat(g.quality," to ").concat(h.active?"enabled":"disabled"),o),Wr()&&(g.enabled?(h.scaleResolutionDownBy=e[p].scaleResolutionDownBy,h.maxBitrate=e[p].maxBitrate,h.maxFrameRate=e[p].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(l.encodings=c,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:l.encodings})),yield t.setParameters(l))}finally{a()}})}function ww(t){switch(t){case"f":return sn.HIGH;case"h":return sn.MEDIUM;case"q":return sn.LOW;default:return sn.HIGH}}function k0(t,e,n,i){if(!n)return[new tr({quality:sn.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new Cw(r),o=[],a=s.suffix=="h"?1.5:2,l=s.suffix=="h"?2:3;for(let c=0;c<s.spatial;c+=1)o.push(new tr({quality:Math.min(sn.HIGH,s.spatial-1)-c,width:Math.ceil(t/Math.pow(a,c)),height:Math.ceil(e/Math.pow(a,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(l,c)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const l=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let c=ww((o=r.rid)!==null&&o!==void 0?o:"");return new tr({quality:c,width:Math.ceil(t/l),height:Math.ceil(e/l),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const S0="_lossy",b0="_reliable",$L=2*1e3,Md="leave-reconnect",KL=3e4,GL=8*1024,JL=256*1024;var mn;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(mn||(mn={}));class QL extends ri.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=km.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=mn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=he,this.reliableDataSequence=1,this.reliableMessageBuffer=new a0,this.reliableReceivedState=new gL(KL),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>w(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===b0)s.reliableDCSub=o;else if(o.label===S0)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>w(this,void 0,void 0,function*(){var r,s,o,a,l;const c=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const d=Ut.fromBinary(new Uint8Array(u));if(d.sequence>0&&d.participantSid!==""){const h=this.reliableReceivedState.get(d.participantSid);if(h&&d.sequence<=h)return;this.reliableReceivedState.set(d.participantSid,d.sequence)}if(((r=d.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(H.ActiveSpeakersUpdate,d.value.value.speakers);else if(((s=d.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const h=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(d.value.value.encryptedValue,d.value.value.iv,d.participantIdentity,d.value.value.keyIndex),p=lC.fromBinary(h.payload),m=new Ut({value:p.value,participantIdentity:d.participantIdentity,participantSid:d.participantSid});((a=m.value)===null||a===void 0?void 0:a.case)==="user"&&T0(m,m.value.value),this.emit(H.DataPacketReceived,m,d.value.value.encryptionType)}else((l=d.value)===null||l===void 0?void 0:l.case)==="user"&&T0(d,d.value.value),this.emit(H.DataPacketReceived,d,ft.NONE)}finally{c()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?ge.LOSSY:ge.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(H.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===Md&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=wt.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===mn.Connected&&i();const s=()=>{this.off(H.Disconnected,o),i()},o=()=>{this.off(H.Restarted,s),r()};this.once(H.Restarted,s),this.once(H.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{if(i===ge.RELIABLE){const s=this.dataChannelForKind(i);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(H.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>w(this,void 0,void 0,function*(){!this.url||!(yield fetch(xa(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Oe.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Oe.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(xr.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>w(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(xa(this.url),{method:"HEAD"}),xt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Ei((n=e.loggerName)!==null&&n!==void 0?n:Bn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new mm(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Bt,this.dataProcessLock=new Bt,this.dcBufferStatus=new Map([[ge.LOSSY,!0],[ge.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(H.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(H.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(H.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(H.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(H.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(H.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(H.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(H.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return w(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate().catch(o=>{he.error(o,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=s.clientConfiguration,this.emit(H.SignalConnected,s),s}catch(s){if(s instanceof oe&&s.reason===Fe.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return w(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(H.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return w(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new a0,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return w(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new pi("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(oe.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return w(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return w(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==Ge.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new xL(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(H.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>w(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===Ge.CONNECTED){const u=this.pcState===mn.New;this.pcState=mn.Connected,u&&this.emit(H.Connected,e)}else s===Ge.FAILED&&(this.pcState===mn.Connected||this.pcState===mn.Reconnecting)&&(this.pcState=mn.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?xr.RR_SUBSCRIBER_FAILED:xr.RR_PUBLISHER_FAILED));const l=this.client.isDisconnected||this.client.currentState===Oe.RECONNECTING,c=[Ge.FAILED,Ge.CLOSING,Ge.CLOSED].includes(s);l&&c&&!this._isClosed&&this.emit(H.Offline)}),this.pcManager.onTrack=s=>{s.streams.length!==0&&this.emit(H.MediaTrackAdded,s.track,s.streams[0],s.receiver)},YL((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>w(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>w(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(H.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(H.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(H.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(H.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(H.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let s=0;s<e.numVideos;s++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",xr.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Sw,regionSettings:e.regions})),e.action){case Os.DISCONNECT:this.emit(H.Disconnected,e==null?void 0:e.reason),this.close();break;case Os.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Md);break;case Os.RESUME:this.handleDisconnect(Md)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Sa.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(S0,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(b0,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(ge.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,GL),JL)}},1e3))}createSender(e,n,i){return w(this,void 0,void 0,function*(){if(gf())return yield this.createTransceiverRTCRtpSender(e,n,i);if(vf())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new dt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return w(this,void 0,void 0,function*(){if(gf())return this.createSimulcastTransceiverSender(e,n,i,r);if(vf())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new dt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),mr(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return w(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){he.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Sa.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:Ge.NEW)===Ge.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof dt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof ss||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",xr.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(H.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return w(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new dt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(H.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new ss;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof oe&&o.reason===Fe.NotAllowed?new dt("could not reconnect, token might be expired"):new ss}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(H.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==Oe.CONNECTED)throw new ss("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(H.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return w(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new dt("could not reconnect, url or token not saved");if(!this.pcManager)throw new dt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(H.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof oe&&r.reason===Fe.NotAllowed?new dt("could not reconnect, token might be expired"):r instanceof oe&&r.reason===Fe.LeaveRequest?r:new ss(s)}if(this.emit(H.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Oe.CONNECTED)throw new ss("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(H.Resumed)})}waitForPCInitialConnection(e,n){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return w(this,void 0,void 0,function*(){this.pcState=mn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield xt($L),!this.pcManager)throw new dt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=mn.Connected}catch(e){throw this.pcState=mn.Disconnected,oe.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return w(this,void 0,void 0,function*(){const s=new Ut({destinationIdentities:[e],kind:ge.RELIABLE,value:{case:"rpcResponse",value:new rm({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,ge.RELIABLE)})}publishRpcAck(e,n){return w(this,void 0,void 0,function*(){const i=new Ut({destinationIdentities:[e],kind:ge.RELIABLE,value:{case:"rpcAck",value:new im({requestId:n})}});yield this.sendDataPacket(i,ge.RELIABLE)})}sendDataPacket(e,n){return w(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=sL(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new aC({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===ge.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===ge.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return w(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(ge.RELIABLE);const n=this.dataChannelForKind(ge.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(ge.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>w(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(H.Closing,r);!this.dcBufferStatus.get(e);)yield xt(10);this.off(H.Closing,r),n()}}))}ensureDataTransportConnected(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new dt("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw oe.internal("".concat(a," connection not set"));let l=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),l=!0),!l&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&i.negotiate().catch(d=>{he.error(d,i.logContext)});const c=i.dataChannelForKind(n,r);if((c==null?void 0:c.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield xt(50)}throw oe.internal("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()))}()})}ensurePublisherConnected(e){return w(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Ge.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return w(this,void 0,void 0,function*(){return new Promise((e,n)=>w(this,void 0,void 0,function*(){if(!this.pcManager){n(new df("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(H.Closing,r),this.pcManager.publisher.once(Us.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const l=a.codec.toLowerCase();WM(l)&&o.set(a.payload,l)}),this.emit(H.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof df&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",xr.RR_UNKNOWN),n(s)}finally{this.off(H.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===ge.LOSSY)return this.lossyDCSub;if(e===ge.RELIABLE)return this.reliableDCSub}else{if(e===ge.LOSSY)return this.lossyDC;if(e===ge.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),l=this.pcManager.publisher.getRemoteDescription(),c=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),d=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,h=new Array,p=new Array;e.forEach(m=>{m.isDesired!==d&&h.push(m.trackSid),m.isEnabled||p.push(m.trackSid)}),this.client.sendSyncState(new cm({answer:this.options.singlePeerConnection?l?xs({sdp:l.sdp,type:l.type}):void 0:u?xs({sdp:u.sdp,type:u.type}):void 0,offer:this.options.singlePeerConnection?a?xs({sdp:a.sdp,type:a.type}):void 0:c?xs({sdp:c.sdp,type:c.type}):void 0,subscription:new ku({trackSids:h,subscribe:!d,participantTracks:[]}),publishTracks:EM(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:p,datachannelReceiveStates:this.reliableReceivedState.map((m,v)=>new PC({publisherSid:v,lastSeq:m}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new RC({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(ge.LOSSY),Dn.PUBLISHER),n(this.dataChannelForKind(ge.RELIABLE),Dn.PUBLISHER),n(this.dataChannelForKind(ge.LOSSY,!0),Dn.SUBSCRIBER),n(this.dataChannelForKind(ge.RELIABLE,!0),Dn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&wt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Gt()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Gt()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===i});if(r)return r[1]}}}function YL(t){return t!==void 0&&t>13}function T0(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class xw{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new gn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),jt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new gn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),jt.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class XL extends xw{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Sn,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>w(this,void 0,void 0,function*(){var o,a;try{const{done:l,value:c}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return l?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(c),{done:!1,value:c.content})}catch(l){throw s(),l}}),return(){return w(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=fi(l),d;d=yield u.next(),i=d.done,!i;c=!0){o=d.value,c=!1;const h=o;a.add(h)}}catch(h){r={error:h}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class ZL extends xw{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=$l(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Sn,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var l;(l=i.reject)===null||l===void 0||l.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>w(this,void 0,void 0,function*(){var a,l;try{const{done:c,value:u}=yield Promise.race([e.read(),i.promise,(l=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);if(c)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(h){throw new gn("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(h),jt.DecodeFailed)}return{done:!1,value:d}}}catch(c){throw o(),c}}),return(){return w(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=fi(l),d;d=yield u.next(),i=d.done,!i;c=!0)o=d.value,c=!1,a+=o}catch(h){r={error:h}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return a}()})}}class ej{constructor(){this.log=he,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new gn('A text stream handler for topic "'.concat(e,'" has already been set.'),jt.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new gn('A byte stream handler for topic "'.concat(e,'" has already been set.'),jt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const l=new gn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),jt.AbnormalEnd);for(const[c,u]of a)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,l),this.byteStreamControllers.delete(c);for(const[c,u]of o)(s=(r=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,l),this.textStreamControllers.delete(c)}}handleDataStreamPacket(e,n){return w(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return w(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new Sn;a.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:$l(e.timestamp),attributes:e.attributes,encryptionType:i},c=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new gn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),jt.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:l,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new XL(l,c,$l(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new Sn;a.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},c=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new gn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),jt.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:l,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new ZL(l,c,$l(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new gn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),jt.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new gn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),jt.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new gn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),jt.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new gn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),jt.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class Ew{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return w(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class tj extends Ew{}class nj extends Ew{}const C0=15e3;class ij{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return w(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),l=new Array(a?a.length+1:1).fill(0),c=(d,h)=>{var p;l[h]=d;const m=l.reduce((v,T)=>v+T,0);(p=n==null?void 0:n.onProgress)===null||p===void 0||p.call(n,m)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),c(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>w(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:p=>{c(p,h+1)}})})))),u.info})}streamText(e){return w(this,void 0,void 0,function*(){var n,i,r;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?ft.GCM:ft.NONE},a=new Ac({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:Er(o.timestamp),totalLength:Er(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new kC({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?ef.UPDATE:ef.CREATE})}}),l=e==null?void 0:e.destinationIdentities,c=new Ut({destinationIdentities:l,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(c,ge.RELIABLE);let u=0;const d=this.engine,h=new WritableStream({write(v){return w(this,void 0,void 0,function*(){for(const T of JM(v,C0)){const g=new Nc({content:T,streamId:s,chunkIndex:Er(u)}),y=new Ut({destinationIdentities:l,value:{case:"streamChunk",value:g}});yield d.sendDataPacket(y,ge.RELIABLE),u+=1}})},close(){return w(this,void 0,void 0,function*(){const v=new Oc({streamId:s}),T=new Ut({destinationIdentities:l,value:{case:"streamTrailer",value:v}});yield d.sendDataPacket(T,ge.RELIABLE)})},abort(v){console.log("Sink error:",v)}});let p=()=>w(this,void 0,void 0,function*(){yield m.close()});d.once(H.Closing,p);const m=new tj(h,o,()=>this.engine.off(H.Closing,p));return m})}sendFile(e,n){return w(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return w(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:l}=yield o.read();if(a)break;yield s.write(l)}return yield s.close(),s.info})}streamBytes(e){return w(this,void 0,void 0,function*(){var n,i,r,s,o,a;const l=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,u={id:l,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?ft.GCM:ft.NONE},d=new Ac({totalLength:Er((a=u.size)!==null&&a!==void 0?a:0),mimeType:u.mimeType,streamId:l,topic:u.topic,timestamp:Er(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new SC({name:u.name})}}),h=new Ut({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(h,ge.RELIABLE);let p=0;const m=new Bt,v=this.engine,T=this.log,g=new WritableStream({write(S){return w(this,void 0,void 0,function*(){const k=yield m.lock();let b=0;try{for(;b<S.byteLength;){const x=S.slice(b,b+C0),E=new Ut({destinationIdentities:c,value:{case:"streamChunk",value:new Nc({content:x,streamId:l,chunkIndex:Er(p)})}});yield v.sendDataPacket(E,ge.RELIABLE),p+=1,b+=x.byteLength}}finally{k()}})},close(){return w(this,void 0,void 0,function*(){const S=new Oc({streamId:l}),k=new Ut({destinationIdentities:c,value:{case:"streamTrailer",value:S}});yield v.sendDataPacket(k,ge.RELIABLE)})},abort(S){T.error("Sink error:",S)}});return new nj(g,u)})}}class Pw extends M{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?B.Muted:B.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(B.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return w(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),bm)),PM()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(B.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class rj extends Pw{constructor(e,n,i,r,s,o){super(e,n,M.Kind.Audio,i,o),this.monitorReceiver=()=>w(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Tu(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;ni()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(ni())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return w(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(yf(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&yf(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(B.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(B.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return w(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const Ld=100;class sj extends Pw{constructor(e,n,i,r,s){super(e,n,M.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>w(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=Tu(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=vm(()=>{this.updateDimensions()},Ld),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===M.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Ms(this._mediaStreamTrack,n):ws(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new oj(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return w(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return w(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((l,c)=>Math.max(l,c.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(l=>l.pictureInPicture),a=this.elementInfos.some(l=>l.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-r<Ld){wt.setTimeout(()=>{this.updateVisibility()},Ld);return}this.lastVisible=a,this.emit(B.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,l=o.height()*s;a+l>i+r&&(i=a,r=l)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(B.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Yy():n||(Yy()>2?2:1)}}class oj{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=xo(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=xo(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=xo(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??wf(e),this.isPiP=Gt()&&xo(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=wf(this.element),this.isPiP=xo(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Zy().observe(this.element),Xy().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=Zy())===null||e===void 0||e.unobserve(this.element),(n=Xy())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function xo(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?wf(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function wf(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:l}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&l!=="none"}class ui extends ri.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=ft.NONE,this.log=he,this.handleMuted=()=>{this.emit(B.Muted)},this.handleUnmuted=()=>{this.emit(B.Unmuted)},this.log=Ei((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:Bn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=M.Source.Unknown}setTrack(e){this.track&&(this.track.off(B.Muted,this.handleMuted),this.track.off(B.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(B.Muted,this.handleMuted),e.on(B.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),ye(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==ft.NONE}get audioTrack(){if(ti(this.track))return this.track}get videoTrack(){if(mr(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=M.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===M.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(ui||(ui={}));class xf extends ui{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(B.Ended)},this.handleCpuConstrained=()=>{this.track&&mr(this.track)&&this.emit(B.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(B.Ended,this.handleTrackEnded),this.track.off(B.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(B.Ended,this.handleTrackEnded),e.on(B.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return w(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return w(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return w(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return w(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ti(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(vt.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(vt.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(vt.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(vt.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(vt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(vt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Cu(t,e){return w(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=hw(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const l=cw(s,yw,kw),c=pm(l),u=navigator.mediaDevices.getUserMedia(c);s.audio&&(yt.userMediaPromiseMap.set("audioinput",u),u.catch(()=>yt.userMediaPromiseMap.delete("audioinput"))),s.video&&(yt.userMediaPromiseMap.set("videoinput",u),u.catch(()=>yt.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>w(this,void 0,void 0,function*(){const p=h.kind==="audio";let m=p?l.audio:l.video;(typeof m=="boolean"||!m)&&(m={});let v;const T=p?c.audio:c.video;typeof T!="boolean"&&(v=T);const g=h.getSettings().deviceId;v!=null&&v.deviceId&&nr(v.deviceId)!==g?v.deviceId=g:v||(v={deviceId:g});const y=DL(h,v,e);return y.kind===M.Kind.Video?y.source=M.Source.Camera:y.kind===M.Kind.Audio&&(y.source=M.Source.Microphone),y.mediaStream=d,ti(y)&&i?yield y.setProcessor(i):mr(y)&&r&&(yield y.setProcessor(r)),y})))}catch(d){if(!n)throw d;return Cu(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function aj(t){return w(this,void 0,void 0,function*(){return(yield Cu({audio:!1,video:!0}))[0]})}function Cm(t){return w(this,void 0,void 0,function*(){return(yield Cu({audio:t??!0,video:!1}))[0]})}var Bi;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Bi||(Bi={}));function lj(t){switch(t){case No.EXCELLENT:return Bi.Excellent;case No.GOOD:return Bi.Good;case No.POOR:return Bi.Poor;case No.LOST:return Bi.Lost;default:return Bi.Unknown}}class Rw extends ri.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===ba.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Ns.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ba.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Bi.Unknown,this.log=he,this.log=Ei((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:Bn.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Sn,this.once(K.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(M.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(M.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(M.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Ns.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Ns.ACTIVE&&this.emit(K.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(K.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(K.ParticipantNameChanged,e)}_setAttributes(e){const n=RM(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(K.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const l=this.permissions,c=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit(K.ParticipantPermissionsChanged,l),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(K.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=lj(e),n!==this._connectionQuality&&this.emit(K.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>ti(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(B.Muted,()=>{this.emit(K.TrackMuted,e)}),e.on(B.Unmuted,()=>{this.emit(K.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case M.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case M.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function cj(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new xC({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class uj extends Rw{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ft.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Sn)},this.handleReconnected=()=>{var a,l;(l=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||l===void 0||l.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,l,c,u,d,h;this.reconnectFuture&&(this.reconnectFuture.promise.catch(p=>this.log.warn(p.message,this.logContext)),(l=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||l===void 0||l.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(c=this.signalConnectedFuture).reject)===null||u===void 0||u.call(c,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(h=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||h===void 0||h.call(d,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var l,c;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Sn),(c=(l=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(l)},this.handleSignalRequestResponse=a=>{const{requestId:l,reason:c,message:u}=a,d=this.pendingSignalRequests.get(l);d&&(c!==um.OK&&d.reject(new $y(u,c)),this.pendingSignalRequests.delete(l))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let l=a.value.value,c=null,u=null;l.value.case==="payload"?c=l.value.value:l.value.case==="error"&&(u=Ye.fromProto(l.value.value)),this.handleIncomingRpcResponse(l.requestId,c,u);break;case"rpcAck":let d=a.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>cj(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,l)=>{if(l===void 0&&(l=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),ye(a)));return}this.engine.updateMuteStatus(a.sid,l)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),ye(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),ye(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const l=this.audioTrackPublications.get(a.sid);if(!l){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(l.trackSid,l.getTrackFeatures())},this.onTrackCpuConstrained=(a,l)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),ye(l))),this.emit(K.LocalTrackCpuConstrained,a,l)},this.handleSubscribedQualityUpdate=a=>w(this,void 0,void 0,function*(){var l,c,u,d,h;if(!(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast))return;const p=this.videoTrackPublications.get(a.trackSid);if(!p){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!p.videoTrack)return;const m=yield p.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var v=!0,T=fi(m),g;g=yield T.next(),l=g.done,!l;v=!0){d=g.value,v=!1;const y=d;CM(y)&&(this.log.debug("publish ".concat(y," for ").concat(p.videoTrack.sid),Object.assign(Object.assign({},this.logContext),ye(p))),yield this.publishAdditionalCodecForTrack(p.videoTrack,y,p.options))}}catch(y){c={error:y}}finally{try{!v&&!l&&(u=T.return)&&(yield u.call(T))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=a=>{const l=this.trackPublications.get(a.trackSid);if(!l){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(l.track)},this.handleTrackEnded=a=>w(this,void 0,void 0,function*(){if(a.source===M.Source.ScreenShare||a.source===M.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),ye(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(ai(a)||Ni(a))try{if(Gt())try{const l=yield navigator==null?void 0:navigator.permissions.query({name:a.source===M.Source.Camera?"camera":"microphone"});if(l&&l.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),ye(a))),l.onchange=()=>{l.state!=="denied"&&(a.isMuted||a.restartTrack(),l.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),ye(a))),ai(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),ye(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ft.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(H.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(H.Connected,this.handleReconnected).on(H.SignalConnected,this.handleSignalConnected).on(H.SignalRestarted,this.handleReconnected).on(H.SignalResumed,this.handleReconnected).on(H.Restarting,this.handleReconnecting).on(H.Resuming,this.handleReconnecting).on(H.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(H.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(H.Closing,this.handleClosing).on(H.SignalRequestResponse,this.handleSignalRequestResponse).on(H.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return w(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return w(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return w(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return w(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,l)=>w(i,void 0,void 0,function*(){var c,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((c=r??this.metadata)!==null&&c!==void 0?c:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),p=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:m=>{l(m),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-p<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(m=>{let[v,T]=m;return this.attributes[v]===T||T===""&&!this.attributes[v]}))){this.pendingSignalRequests.delete(h),a();return}yield xt(50)}l(new $y("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&l(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(M.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(M.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(M.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return w(this,void 0,void 0,function*(){this.encryptionType=e?ft.GCM:ft.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return w(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let l;if(this.pendingPublishing.has(e)){const c=yield this.waitForPendingPublicationOfSource(e);return c||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield c==null?void 0:c.unmute(),c}this.pendingPublishing.add(e);try{switch(e){case M.Source.Camera:l=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case M.Source.Microphone:l=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case M.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},i));break;default:throw new pi(e)}}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c instanceof Error&&this.emit(K.MediaDevicesError,c,mf(e)),this.pendingPublishing.delete(e),c}for(const c of l){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===M.Source.Microphone&&ti(c)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),c.startPreConnectBuffer())}try{const c=[];for(const d of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),ye(d))),c.push(this.publishTrack(d,r));[a]=yield Promise.all(c)}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===M.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const l=this.getTrackPublication(M.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return w(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(M.Source.Camera)||this.pendingPublishing.has(M.Source.Microphone))){this.pendingPublishing.add(M.Source.Camera),this.pendingPublishing.add(M.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(M.Source.Camera),this.pendingPublishing.delete(M.Source.Microphone)}}})}createTracks(e){return w(this,void 0,void 0,function*(){var n,i;e??(e={});const r=cw(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Cu(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(ti(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=M.Source.Microphone,this.emit(K.AudioStreamAcquired)),mr(a)&&(this.cameraError=void 0,a.source=M.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return w(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new hm("getDisplayMedia not supported");e.resolution===void 0&&!jM()&&(e.resolution=fm.h1080fps30.resolution);const n=xM(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new pi("no video track found");const s=new Lc(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=M.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(K.AudioStreamAcquired);const a=new Mc(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=M.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return w(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return w(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,l,c,u;ai(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),Ls(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let g;switch(i.source){case M.Source.Microphone:g="audioinput";break;case M.Source.Camera:g="videoinput"}g&&s.activeDeviceMap.has(g)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(g)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Mc(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Lc(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new pi("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(g=>{g.track&&g.track===i&&(h=g)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),ye(h))),h;const p=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r),m="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,v=(l=p.forceStereo)!==null&&l!==void 0?l:m;v&&(p.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),ye(i))),p.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(c=p.dtx)!==null&&c!==void 0||(p.dtx=!1),(u=p.red)!==null&&u!==void 0||(p.red=!1)),!FM()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),p.simulcast=!1),p.source&&(i.source=p.source);const T=new Promise((g,y)=>w(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Oe.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:ye(i)}));let S=!1;const k=setTimeout(()=>{S=!0,i.stop(),y(new Hy("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(k),S)return;const b=yield this.publish(i,p,v);g(b)}else try{const S=yield this.publish(i,p,v);g(S)}catch(S){y(S)}}catch(S){y(S)}}));s.pendingPublishPromises.set(i,T);try{return yield T}catch(g){throw g}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Sn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),ye(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>_M(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),ye(e))),!1)}publish(e,n,i){return w(this,void 0,void 0,function*(){var r,s,o,a,l,c,u,d,h,p;if(!this.hasPermissionsToPublish(e))throw new Hy("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(A=>Ls(e)&&A.source===e.source)&&e.source!==M.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),ye(e))),n.stopMicTrackOnMute&&ti(e)&&(e.stopOnMute=!0),e.source===M.Source.ScreenShare&&Wr()&&(n.simulcast=!1),n.videoCodec==="av1"&&!DM()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!MM()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=bf),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(A=>n.videoCodec===Qo(A.mime))||(n.videoCodec=Qo(this.enabledPublishVideoCodecs[0].mime)));const v=n.videoCodec;e.on(B.Muted,this.onTrackMuted),e.on(B.Unmuted,this.onTrackUnmuted),e.on(B.Ended,this.handleTrackEnded),e.on(B.UpstreamPaused,this.onTrackUpstreamPaused),e.on(B.UpstreamResumed,this.onTrackUpstreamResumed),e.on(B.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const T=[],g=!(!((r=n.dtx)!==null&&r!==void 0)||r),y=e.getSourceTrackSettings();y.autoGainControl&&T.push(vt.TF_AUTO_GAIN_CONTROL),y.echoCancellation&&T.push(vt.TF_ECHO_CANCELLATION),y.noiseSuppression&&T.push(vt.TF_NOISE_SUPPRESSION),y.channelCount&&y.channelCount>1&&T.push(vt.TF_STEREO),g&&T.push(vt.TF_NO_DTX),ai(e)&&e.hasPreConnectBuffer&&T.push(vt.TF_PRECONNECT_BUFFER);const S=new Ta({cid:e.mediaStreamTrack.id,name:n.name,type:M.kindToProto(e.kind),muted:e.isMuted,source:M.sourceToProto(e.source),disableDtx:g,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:T});let k;if(e.kind===M.Kind.Video){let A={width:0,height:0};try{A=yield e.waitForDimensions()}catch{const W=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Ca.h720.resolution;A={width:W.width,height:W.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),ye(e)),{dims:A}))}S.width=A.width,S.height=A.height,Ni(e)&&(Mn(v)&&(e.source===M.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),ye(e))))),n.scalabilityMode=(l=n.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),S.simulcastCodecs=[new nf({codec:v,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:bf}),n.backupCodec&&v!==n.backupCodec.codec&&S.encryption===ft.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new nf({codec:n.backupCodec.codec,cid:""})))),k=Cf(e.source===M.Source.ScreenShare,S.width,S.height,n),S.layers=k0(S.width,S.height,k,Mn(n.videoCodec))}else e.kind===M.Kind.Audio&&(k=[{maxBitrate:(c=n.audioPreset)===null||c===void 0?void 0:c.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(p=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&p!==void 0?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new dt("cannot publish track when not connected");const b=()=>w(this,void 0,void 0,function*(){var A,O,W;if(!this.engine.pcManager)throw new dt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,k),this.emit(K.LocalSenderCreated,e.sender,e),Ni(e)&&((A=n.degradationPreference)!==null&&A!==void 0||(n.degradationPreference=qL(e)),e.setDegradationPreference(n.degradationPreference)),k)if(Wr()&&e.kind===M.Kind.Audio){let J;for(const se of this.engine.pcManager.publisher.getTransceivers())if(se.sender===e.sender){J=se;break}J&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:J,codec:"opus",maxbr:!((O=k[0])===null||O===void 0)&&O.maxBitrate?k[0].maxBitrate/1e3:0})}else e.codec&&Mn(e.codec)&&(!((W=k[0])===null||W===void 0)&&W.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:k[0].maxBitrate/1e3});yield this.engine.negotiate()});let x;const E=new Promise((A,O)=>w(this,void 0,void 0,function*(){var W;try{x=yield this.engine.addTrack(S),A(x)}catch(J){e.sender&&(!((W=this.engine.pcManager)===null||W===void 0)&&W.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(se=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),ye(e)),{error:se}))})),O(J)}}));if(this.enabledPublishVideoCodecs.length>0)x=(yield Promise.all([E,b()]))[0];else{x=yield E;let A;if(x.codecs.forEach(O=>{A===void 0&&(A=O.mimeType)}),A&&e.kind===M.Kind.Video){const O=Qo(A);O!==v&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),ye(e)),{codec:O})),n.videoCodec=O,k=Cf(e.source===M.Source.ScreenShare,S.width,S.height,n))}yield b()}const P=new xf(e.kind,x,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(P.on(B.CpuConstrained,A=>this.onTrackCpuConstrained(A,P)),P.options=n,e.sid=x.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:k,trackInfo:x})),Ni(e)?e.startMonitor(this.engine.client):ai(e)&&e.startMonitor(),this.addTrackPublication(P),this.emit(K.LocalTrackPublished,P),ai(e)&&x.audioFeatures.includes(vt.TF_PRECONNECT_BUFFER)){const A=e.getPreConnectBuffer(),O=e.getPreConnectBufferMimeType();this.on(K.LocalTrackSubscribed,W=>{if(W.trackSid===x.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),ye(e))),e.stopPreConnectBuffer()}}),A&&new Promise((J,se)=>w(this,void 0,void 0,function*(){var te,xe,q,Re,D,N;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),ye(e)));const De=setTimeout(()=>{se(new Error("agent not active within 10 seconds"))},1e4),pe=yield this.waitUntilActiveAgentPresent();clearTimeout(De),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),ye(e)));const Xe=yield this.streamBytes({name:"preconnect-buffer",mimeType:O,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[pe.identity],attributes:{trackId:P.trackSid,sampleRate:String((D=y.sampleRate)!==null&&D!==void 0?D:"48000"),channels:String((N=y.channelCount)!==null&&N!==void 0?N:"1")}});try{for(var j=!0,$=fi(A),ee;ee=yield $.next(),te=ee.done,!te;j=!0){Re=ee.value,j=!1;const le=Re;yield Xe.write(le)}}catch(le){xe={error:le}}finally{try{!j&&!te&&(q=$.return)&&(yield q.call($))}finally{if(xe)throw xe.error}}yield Xe.close(),J()}catch(De){se(De)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),ye(e)))}).catch(J=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),ye(e)),{error:J}))})}return P})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return w(this,void 0,void 0,function*(){var r;if(this.encryptionType!==ft.NONE)return;let s;if(this.trackPublications.forEach(p=>{p.track&&p.track===e&&(s=p)}),!s)throw new pi("track is not published");if(!Ni(e))throw new pi("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=VL(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),ye(e)));return}const l=e.addSimulcastTrack(n,a);if(!l)return;const c=new Ta({cid:l.mediaStreamTrack.id,type:M.kindToProto(e.kind),muted:e.isMuted,source:M.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:l.mediaStreamTrack.id}]});if(c.layers=k0(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new dt("cannot publish track when not connected");const u=()=>w(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,l,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(c),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return w(this,void 0,void 0,function*(){var i,r;if(Ls(e)){const c=this.pendingPublishPromises.get(e);c&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),ye(e))),yield c)}const s=this.getPublicationForTrack(e),o=s?ye(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(B.Muted,this.onTrackMuted),e.off(B.Unmuted,this.onTrackUnmuted),e.off(B.Ended,this.handleTrackEnded),e.off(B.UpstreamPaused,this.onTrackUpstreamPaused),e.off(B.UpstreamResumed,this.onTrackUpstreamResumed),e.off(B.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const l=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Ge.FAILED&&l)try{for(const c of this.engine.pcManager.publisher.getTransceivers())c.sender===l&&(c.direction="inactive",a=!0);if(this.engine.removeTrack(l)&&(a=!0),Ni(e)){for(const[,c]of e.simulcastCodecs)c.sender&&(this.engine.removeTrack(c.sender)&&(a=!0),c.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:c}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case M.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case M.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(K.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return w(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>w(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(l=>{l.track&&(n&&(l.options=Object.assign(Object.assign({},l.options),n)),a.push(l))}),yield Promise.all(a.map(l=>w(this,void 0,void 0,function*(){const c=l.track;yield this.unpublishTrack(c,!1),r&&!c.isMuted&&c.source!==M.Source.ScreenShare&&c.source!==M.Source.ScreenShareAudio&&(ai(c)||Ni(c))&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:l.trackSid})),yield c.restartTrack()),yield this.publishOrRepublishTrack(c,l.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return w(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?ge.RELIABLE:ge.LOSSY,o=r.destinationIdentities,a=r.topic;let l=new tm({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const c=new Ut({kind:s,value:{case:"user",value:l}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return w(this,void 0,void 0,function*(){const i=new Ut({kind:ge.RELIABLE,value:{case:"sipDtmf",value:new uC({code:e,digit:n})}});yield this.engine.sendDataPacket(i,ge.RELIABLE)})}sendChatMessage(e,n){return w(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new Ut({value:{case:"chatMessage",value:new Ic(Object.assign(Object.assign({},i),{timestamp:ze.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,ge.RELIABLE),this.emit(K.ChatMessage,i),i})}editChatMessage(e,n){return w(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Ut({value:{case:"chatMessage",value:new Ic(Object.assign(Object.assign({},i),{timestamp:ze.parse(i.timestamp),editTimestamp:ze.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,ge.RELIABLE),this.emit(K.ChatMessage,i),i})}sendText(e,n){return w(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return w(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return w(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return w(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return w(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=15e3}=n;return function*(){return new Promise((u,d)=>w(i,void 0,void 0,function*(){var h,p,m,v;if(Sm(o)>bw){d(Ye.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((p=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||p===void 0)&&p.version&&ii((v=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||v===void 0?void 0:v.version,"1.8.0")<0){d(Ye.builtIn("UNSUPPORTED_SERVER"));return}const T=Math.max(a,8e3),g=crypto.randomUUID();yield this.publishRpcRequest(r,g,s,o,T);const y=setTimeout(()=>{this.pendingAcks.delete(g),d(Ye.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(g),clearTimeout(S)},7e3);this.pendingAcks.set(g,{resolve:()=>{clearTimeout(y)},participantIdentity:r});const S=setTimeout(()=>{this.pendingResponses.delete(g),d(Ye.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(g,{resolve:(k,b)=>{clearTimeout(S),this.pendingAcks.has(g)&&(this.log.warn("RPC response received before ack",g),this.pendingAcks.delete(g),clearTimeout(y)),b?d(b):u(k??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return w(this,void 0,void 0,function*(){const o=new Ut({destinationIdentities:[e],kind:ge.RELIABLE,value:{case:"rpcRequest",value:new nm({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,ge.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Ye.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),ye(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Sn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(ai(r)||Ni(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return w(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield xt(20)}})}}class dj extends ui{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(B.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new ku({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new hC({participantSid:"",trackSids:[this.trackSid]})]});this.emit(B.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?ui.SubscriptionStatus.Unsubscribed:super.isSubscribed?ui.SubscriptionStatus.Subscribed:ui.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?ui.PermissionStatus.Allowed:ui.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(_d(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&_d(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:sn.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(B.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(B.VisibilityChanged,this.handleVisibilityChange),r.off(B.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(B.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(B.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(B.VisibilityChanged,this.handleVisibilityChange),e.on(B.Ended,this.handleEnded),this.emit(B.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(B.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?B.Muted:B.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(B.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(B.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return _d(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new bC({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===M.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Gy(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=IM(this.trackInfo,this.requestedMaxQuality);i&&Gy(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:sn.HIGH})),e.quality=sn.HIGH)}this.emit(B.UpdateSettings,e)}}class jc extends Rw{static fromParticipantInfo(e,n,i){return new jc(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:ba.STANDARD;super(n,i||"",r,s,o,a,l),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(B.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),ye(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(B.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(B.SubscriptionPermissionChanged,n=>{this.emit(K.TrackSubscriptionPermissionChanged,e,n)}),e.on(B.SubscriptionStatusChanged,n=>{this.emit(K.TrackSubscriptionStatusChanged,e,n)}),e.on(B.Subscribed,n=>{this.emit(K.TrackSubscribed,n,e)}),e.on(B.Unsubscribed,n=>{this.emit(K.TrackUnsubscribed,n,e)}),e.on(B.SubscriptionFailed,n=>{this.emit(K.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:M.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:M.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(K.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),ye(a))),this.emit(K.TrackSubscriptionFailed,n);return}const l=e.kind==="video";let c;return l?c=new sj(e,n,r,s):c=new rj(e,n,r,this.audioContext,this.audioOutput),c.source=a.source,c.isMuted=a.isMuted,c.setMediaStream(i),c.start(),a.setTrack(c),this.volumeMap.has(a.source)&&kf(c)&&ti(c)&&c.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const l=M.kindFromProto(r.type);if(!l)return;a=new dj(l,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const c=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));c&&a.source!==M.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:ye(c),newTrack:ye(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),ye(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(K.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case M.Kind.Audio:this.audioTrackPublications.delete(e);break;case M.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(K.TrackUnpublished,i)}setAudioOutput(e){return w(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;ti(i.track)&&kf(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var we;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(we||(we={}));const hj=4*1e3;class Hr extends ri.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,s;if(super(),n=this,this.state=we.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=he,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,a,l)=>w(this,void 0,void 0,function*(){var c;if(!LM())throw ni()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===we.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(we.Connecting),((c=this.regionUrlProvider)===null||c===void 0?void 0:c.getServerUrl().toString())!==gw(o)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Qs(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Te(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(p=>{var m;(m=this.regionUrlProvider)===null||m===void 0||m.setServerReportedRegions(p)}).catch(p=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:p}))}));const d=(p,m,v)=>w(this,void 0,void 0,function*(){var T,g;this.abortController&&this.abortController.abort();const y=new AbortController;this.abortController=y,u==null||u();try{if(yield js.getInstance().getBackOffPromise(o),y.signal.aborted)throw oe.cancelled("Connection attempt aborted");yield this.attemptConnection(v??o,a,l,y),this.abortController=void 0,p()}catch(S){if(this.regionUrlProvider&&S instanceof oe&&S.reason!==Fe.Cancelled&&S.reason!==Fe.NotAllowed){let k=null;try{this.log.debug("Fetching next region"),k=yield this.regionUrlProvider.getNextBestRegionUrl((T=this.abortController)===null||T===void 0?void 0:T.signal)}catch(b){if(b instanceof oe&&(b.status===401||b.reason===Fe.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),m(b);return}}[Fe.InternalError,Fe.ServerUnreachable,Fe.Timeout].includes(S.reason)&&(this.log.debug("Adding failed connection attempt to back off"),js.getInstance().addFailedConnectionAttempt(o)),k&&!(!((g=this.abortController)===null||g===void 0)&&g.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(S.message,". Retrying with another region: ").concat(k),this.logContext),this.recreateEngine(),yield d(p,m,k)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t0(S)),m(S))}else{let k=Ln.UNKNOWN_REASON;S instanceof oe&&(k=t0(S)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,k),m(S)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Sn((p,m)=>{d(p,m,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,l,c,u,d)=>w(this,void 0,void 0,function*(){var h,p,m;const v=yield l.join(o,a,{autoSubscribe:c.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:c.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:c.websocketTimeout,singlePeerConnection:u.singlePeerConnection},d.signal);let T=v.serverInfo;if(T||(T={version:v.serverVersion,region:v.serverRegion}),this.serverInfo=T,this.log.debug("connected to Livekit Server ".concat(Object.entries(T).map(g=>{let[y,S]=g;return"".concat(y,": ").concat(S)}).join(", ")),{room:(h=v.room)===null||h===void 0?void 0:h.name,roomSid:(p=v.room)===null||p===void 0?void 0:p.sid,identity:(m=v.participant)===null||m===void 0?void 0:m.identity}),!T.version)throw new yM("unknown server version");return T.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),v}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(l){this.log.error(l instanceof Error?l.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:l}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,l,c)=>w(this,void 0,void 0,function*(){var u,d;this.state===we.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},km),l),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,c);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(U.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const p=c.signal.aborted?oe.cancelled("Signal connection aborted"):oe.serverUnreachable("could not establish signal connection");throw h instanceof Error&&(p.message="".concat(p.message,": ").concat(h.message)),h instanceof oe&&(p.reason=h.reason,p.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),p}if(c.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),oe.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,c)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}Gt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Gt()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(we.Connected),this.emit(U.Connected),js.getInstance().resetFailedConnectionAttempts(o),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return w(n,[...a],void 0,function(){var c=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,p;const m=yield c.disconnectLock.lock();try{if(c.state===we.Disconnected){c.log.debug("already disconnected",c.logContext);return}if(c.log.info("disconnect from room",Object.assign({},c.logContext)),c.state===we.Connecting||c.state===we.Reconnecting||c.isResuming){const v="Abort connection attempt due to user initiated disconnect";c.log.warn(v,c.logContext),(d=c.abortController)===null||d===void 0||d.abort(v),(p=(h=c.connectFuture)===null||h===void 0?void 0:h.reject)===null||p===void 0||p.call(h,oe.cancelled("Client initiated disconnect")),c.connectFuture=void 0}c.engine&&(c.engine.client.isDisconnected||(yield c.engine.client.sendLeave()),yield c.engine.close()),c.handleDisconnect(u,Ln.CLIENT_INITIATED),c.engine=void 0}finally{m()}}()})},this.onPageLeave=()=>w(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>w(this,void 0,void 0,function*(){const o=[],a=en();if(a&&a.os==="iOS"){const l="livekit-dummy-audio-el";let c=document.getElementById(l);if(!c){c=document.createElement("audio"),c.id=l,c.autoplay=!0,c.hidden=!0;const u=Rd();u.enabled=!0;const d=new MediaStream([u]);c.srcObject=d,document.addEventListener("visibilitychange",()=>{c&&(c.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(c),this.once(U.Disconnected,()=>{c==null||c.remove(),c=null})}o.push(c)}this.remoteParticipants.forEach(l=>{l.audioTrackPublications.forEach(c=>{c.track&&c.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(l=>(l.muted=!1,l.play()))]),this.handleAudioPlaybackStarted()}catch(l){throw this.handleAudioPlaybackFailed(l),l}}),this.startVideo=()=>w(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(l=>{var c;(c=l.track)===null||c===void 0||c.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(we.Reconnecting)&&this.emit(U.Reconnecting)},this.handleSignalRestarted=o=>w(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(we.Connected),this.emit(U.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var l;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(l=this.sidToIdentity.get(a.sid))!==null&&l!==void 0?l:"");let c=this.remoteParticipants.get(a.identity);a.state===Ns.DISCONNECTED?this.handleParticipantDisconnected(a.identity,c):c=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],l={};o.forEach(c=>{if(l[c.sid]=!0,c.sid===this.localParticipant.sid)this.localParticipant.audioLevel=c.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(c.sid);u&&(u.audioLevel=c.level,u.setIsSpeaking(!0),a.push(u))}}),l[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(c=>{l[c.sid]||(c.audioLevel=0,c.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(U.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(c=>{const u=this.remoteParticipants.get(c.identity);u&&u.sid!==c.sid||a.set(c.sid,c)}),o.forEach(c=>{let u=this.getRemoteParticipantBySid(c.sid);c.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=c.level,u.setIsSpeaking(c.active),c.active?a.set(c.sid,u):a.delete(c.sid))});const l=Array.from(a.values());l.sort((c,u)=>u.audioLevel-c.audioLevel),this.activeSpeakers=l,this.emitWhenConnected(U.ActiveSpeakersChanged,l)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const l=this.getRemoteParticipantBySid(a.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);if(!c||!c.track)return;const u=M.streamStateFromProto(a.state);c.track.setStreamState(u),u!==c.track.streamState&&(l.emit(K.TrackStreamStateChanged,c,c.track.streamState),this.emitWhenConnected(U.TrackStreamStateChanged,c,c.track.streamState,l))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const l=a.getTrackPublicationBySid(o.trackSid);l&&l.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(c=>c.trackPublications.has(o.trackSid));if(!a)return;const l=a.getTrackPublicationBySid(o.trackSid);l&&l.setSubscriptionError(o.err)},this.handleDataPacket=(o,a)=>{const l=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(l,o.value.value,o.kind,a);else if(o.value.case==="transcription")this.handleTranscription(l,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(l,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(l,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,l);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,a);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,a,l,c)=>{this.emit(U.DataReceived,a.payload,o,l,a.topic,c),o==null||o.emit(K.DataReceived,a.payload,l,c)},this.handleSipDtmf=(o,a)=>{this.emit(U.SipDTMFReceived,a,o),o==null||o.emit(K.SipDTMFReceived,a)},this.handleTranscription=(o,a)=>{const l=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),c=l==null?void 0:l.trackPublications.get(a.trackId),u=HM(a,this.transcriptionReceivedTimes);c==null||c.emit(B.TranscriptionReceived,u),l==null||l.emit(K.TranscriptionReceived,u,c),this.emit(U.TranscriptionReceived,u,l,c)},this.handleChatMessage=(o,a)=>{const l=$M(a);this.emit(U.ChatMessage,l,o)},this.handleMetrics=(o,a)=>{this.emit(U.MetricsReceived,o,a)},this.handleDataStream=(o,a)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,a)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(U.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(U.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(U.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(U.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>w(this,void 0,void 0,function*(){var o;((o=en())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(U.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(U.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(U.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const l=this.getRemoteParticipantBySid(a.participantSid);l&&l.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(U.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(U.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(U.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(U.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(U.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>w(this,void 0,void 0,function*(){var a,l,c,u,d,h;(a=o.track)===null||a===void 0||a.on(B.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=o.track)===null||l===void 0||l.on(B.Restarted,this.onLocalTrackRestarted),(d=(u=(c=o.track)===null||c===void 0?void 0:c.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(U.LocalTrackPublished,o,this.localParticipant),ai(o.track)&&(yield o.track.checkForSilence())&&this.emit(U.LocalAudioSilenceDetected,o);const p=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),m=mf(o.source);m&&p&&p!==this.localParticipant.activeDeviceMap.get(m)&&(this.localParticipant.activeDeviceMap.set(m,p),this.emit(U.ActiveDeviceChanged,m,p))}),this.onLocalTrackUnpublished=o=>{var a,l;(a=o.track)===null||a===void 0||a.off(B.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=o.track)===null||l===void 0||l.off(B.Restarted,this.onLocalTrackRestarted),this.emit(U.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>w(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),l=mf(o.source);l&&a&&a!==this.localParticipant.activeDeviceMap.get(l)&&(this.log.debug("local track restarted, setting ".concat(l," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(l,a),this.emit(U.ActiveDeviceChanged,l,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(U.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(U.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(U.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(U.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},wL),e),this.log=Ei((i=this.options.loggerName)!==null&&i!==void 0?i:Bn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},yw),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},kw),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},CL),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new ej,this.outgoingDataStreamManager=new ij(this.engine,this.log),this.disconnectLock=new Bt,this.localParticipant=new uj("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",nr(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",nr(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",nr(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),Gt()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),Hr.cleanupRegistry&&Hr.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return w(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new oL(i,n),this.e2eeManager.on(qi.ParticipantEncryptionStatusChanged,(r,s)=>{GM(s)&&(this.isE2EEEnabled=r),this.emit(U.ParticipantEncryptionStatusChanged,r,s)}),this.e2eeManager.on(qi.EncryptionError,(r,s)=>{const o=s?this.getParticipantByIdentity(s):void 0;this.emit(U.EncryptionError,r,o)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return w(this,void 0,void 0,function*(){return this.state===we.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(H.RoomUpdate,i),e(r.sid))};this.engine.on(H.RoomUpdate,i),this.once(U.Disconnected,()=>{this.engine.off(H.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new QL(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(H.ParticipantUpdate,this.handleParticipantUpdates).on(H.RoomUpdate,this.handleRoomUpdate).on(H.SpeakersChanged,this.handleSpeakersChanged).on(H.StreamStateChanged,this.handleStreamStateUpdate).on(H.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(H.SubscriptionError,this.handleSubscriptionError).on(H.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(H.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(H.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(H.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(H.DataPacketReceived,this.handleDataPacket).on(H.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(we.SignalReconnecting)&&this.emit(U.SignalReconnecting)}).on(H.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(we.Connected)&&this.emit(U.Reconnected)}).on(H.SignalResumed,()=>{this.bufferedEvents=[],(this.state===we.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(H.Restarting,this.handleRestarting).on(H.SignalRestarted,this.handleSignalRestarted).on(H.Offline,()=>{this.setAndEmitConnectionState(we.Reconnecting)&&this.emit(U.Reconnecting)}).on(H.DCBufferStatusChanged,(e,n)=>{this.emit(U.DCBufferStatusChanged,e,n)}).on(H.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(K.LocalTrackSubscribed,n),this.emitWhenConnected(U.LocalTrackSubscribed,n,this.localParticipant)}).on(H.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(U.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return yt.getInstance().getDevices(e,n)}prepareConnection(e,n){return w(this,void 0,void 0,function*(){if(this.state===we.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Qs(new URL(e))&&n){this.regionUrlProvider=new Te(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===we.Disconnected&&(this.regionUrl=i,yield fetch(xa(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(xa(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return w(this,void 0,void 0,function*(){let i=()=>w(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Kn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Kn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Kn({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Kn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>w(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Kn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>w(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Kn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Kn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>w(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new Su({reason:Ln.CLIENT_INITIATED,action:Os.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Kn({scenario:{case:"subscriberBandwidth",value:Er(n)}});break;case"leave-full-reconnect":r=new Kn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return w(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,l,c,u,d,h,p;let m=!0,v=!1;const T=o?{exact:r}:r;if(i==="audioinput"){v=s.localParticipant.audioTrackPublications.size===0;const g=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=T;const y=Array.from(s.localParticipant.audioTrackPublications.values()).filter(k=>k.source===M.Source.Microphone);try{m=(yield Promise.all(y.map(k=>{var b;return(b=k.audioTrack)===null||b===void 0?void 0:b.setDeviceId(T)}))).every(k=>k===!0)}catch(k){throw s.options.audioCaptureDefaults.deviceId=g,k}const S=y.some(k=>{var b,x;return(x=(b=k.track)===null||b===void 0?void 0:b.isMuted)!==null&&x!==void 0?x:!1});m&&S&&(v=!0)}else if(i==="videoinput"){v=s.localParticipant.videoTrackPublications.size===0;const g=(l=s.getActiveDevice(i))!==null&&l!==void 0?l:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=T;const y=Array.from(s.localParticipant.videoTrackPublications.values()).filter(k=>k.source===M.Source.Camera);try{m=(yield Promise.all(y.map(k=>{var b;return(b=k.videoTrack)===null||b===void 0?void 0:b.setDeviceId(T)}))).every(k=>k===!0)}catch(k){throw s.options.videoCaptureDefaults.deviceId=g,k}const S=y.some(k=>{var b,x;return(x=(b=k.track)===null||b===void 0?void 0:b.isMuted)!==null&&x!==void 0?x:!1});m&&S&&(v=!0)}else if(i==="audiooutput"){if(v=!0,!yf()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(c=yield yt.getInstance().normalizeDeviceId("audiooutput",r))!==null&&c!==void 0?c:""),(u=(p=s.options).audioOutput)!==null&&u!==void 0||(p.audioOutput={});const g=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(y=>y.setAudioOutput({deviceId:r})))}catch(y){throw s.options.audioOutput.deviceId=g,y}}return v&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(U.ActiveDeviceChanged,i,r)),m}()})}setupLocalParticipantEvents(){this.localParticipant.on(K.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(K.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(K.AttributesChanged,this.onLocalAttributesChanged).on(K.TrackMuted,this.onLocalTrackMuted).on(K.TrackUnmuted,this.onLocalTrackUnmuted).on(K.LocalTrackPublished,this.onLocalTrackPublished).on(K.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(K.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(K.MediaDevicesError,this.onMediaDevicesError).on(K.AudioStreamAcquired,this.startAudio).on(K.ChatMessage,this.onLocalChatMessageSent).on(K.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===we.Connecting||this.state===we.Reconnecting){const d=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(p=>p.id)}),this.onTrackAdded(e,n,i),h()},h=()=>{this.off(U.Reconnected,d),this.off(U.Connected,d),this.off(U.Disconnected,h)};this.once(U.Reconnected,d),this.once(U.Connected,d),this.once(U.Disconnected,h);return}if(this.state===we.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=OM(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const d=this.engine.getTrackIdForReceiver(i);if(!d){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=d}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let c;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?c=this.options.adaptiveStream:c={});const u=l.addSubscribedMediaTrack(e,a,n,i,c);u!=null&&u.isEncrypted&&!this.e2eeManager&&this.emit(U.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(l.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==we.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(K.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(K.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(K.AttributesChanged,this.onLocalAttributesChanged).off(K.TrackMuted,this.onLocalTrackMuted).off(K.TrackUnmuted,this.onLocalTrackUnmuted).off(K.LocalTrackPublished,this.onLocalTrackPublished).off(K.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(K.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(K.MediaDevicesError,this.onMediaDevicesError).off(K.AudioStreamAcquired,this.startAudio).off(K.ChatMessage,this.onLocalChatMessageSent).off(K.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Gt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(we.Disconnected),this.emit(U.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(U.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return w(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Ye.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,Ye.builtIn("UNSUPPORTED_METHOD"));return}let l=null,c=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});Sm(u)>bw?(l=Ye.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):c=u}catch(u){u instanceof Ye?l=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),l=Ye.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,c,l)})}selectDefaultDevices(){return w(this,void 0,void 0,function*(){var e,n,i;const r=yt.getInstance().previousDevices,s=yield yt.getInstance().getDevices(void 0,!1),o=en();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let l of s){const c=r.find(u=>u.deviceId===l.deviceId);c&&c.label!==""&&c.kind===l.kind&&c.label!==l.label&&this.getActiveDevice(l.kind)==="default"&&this.emit(U.ActiveDeviceChanged,l.kind,l.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let l of a){const c=wM(l),u=this.localParticipant.getTrackPublication(c);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(p=>p.kind===l),h=this.getActiveDevice(l);if(h===((n=r.filter(p=>p.kind===l)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(l,d[0].deviceId);continue}l==="audioinput"&&!wa()||l==="videoinput"||d.length>0&&!d.find(p=>p.deviceId===this.getActiveDevice(l))&&(l!=="audiooutput"||!wa())&&(yield this.switchActiveDevice(l,d[0].deviceId))}})}acquireAudioContext(){return w(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=dw())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),xt(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(U.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=jc.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new jc(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(U.ParticipantConnected,i),i.on(K.TrackPublished,r=>{this.emitWhenConnected(U.TrackPublished,r,i)}).on(K.TrackSubscribed,(r,s)=>{r.kind===M.Kind.Audio?(r.on(B.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(B.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===M.Kind.Video&&(r.on(B.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(B.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(U.TrackSubscribed,r,s,i)}).on(K.TrackUnpublished,r=>{this.emit(U.TrackUnpublished,r,i)}).on(K.TrackUnsubscribed,(r,s)=>{this.emit(U.TrackUnsubscribed,r,s,i)}).on(K.TrackMuted,r=>{this.emitWhenConnected(U.TrackMuted,r,i)}).on(K.TrackUnmuted,r=>{this.emitWhenConnected(U.TrackUnmuted,r,i)}).on(K.ParticipantMetadataChanged,r=>{this.emitWhenConnected(U.ParticipantMetadataChanged,r,i)}).on(K.ParticipantNameChanged,r=>{this.emitWhenConnected(U.ParticipantNameChanged,r,i)}).on(K.AttributesChanged,r=>{this.emitWhenConnected(U.ParticipantAttributesChanged,r,i)}).on(K.ConnectionQualityChanged,r=>{this.emitWhenConnected(U.ConnectionQualityChanged,r,i)}).on(K.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(U.ParticipantPermissionsChanged,r,i)}).on(K.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(U.TrackSubscriptionStatusChanged,r,s,i)}).on(K.TrackSubscriptionFailed,(r,s)=>{this.emit(U.TrackSubscriptionFailed,r,i,s)}).on(K.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(U.TrackSubscriptionPermissionChanged,r,s,i)}).on(K.Active,()=>{this.emitWhenConnected(U.ParticipantActive,i),i.kind===ba.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&KM(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=wt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ln.STATE_MISMATCH))):e=0},hj)}clearConnectionReconcile(){this.connectionReconcileInterval&&wt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(U.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===we.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===we.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return w(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new gu({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ze.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new zr({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(U.SignalConnected),this.emit(U.Connected),this.setAndEmitConnectionState(we.Connected),r.video){const o=new xf(M.Kind.Video,new Cs({source:at.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:On.AUDIO,name:"video-dummy"}),new Lc(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:e0(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(K.LocalTrackPublished,o)}if(r.audio){const o=new xf(M.Kind.Audio,new Cs({source:at.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:On.AUDIO}),new Mc(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Rd(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(K.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new zr({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:Ns.ACTIVE,tracks:[],joinedAt:ze.parse(Date.now())});const l=this.getOrCreateParticipant(a.identity,a);if(s.video){const c=e0(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new Cs({source:at.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:On.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const c=Rd(),u=new Cs({source:at.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:On.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}l.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==U.ActiveSpeakersChanged&&e!==U.TranscriptionReceived){const s=_w(i).filter(o=>o!==void 0);(e===U.TrackSubscribed||e===U.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Hr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function _w(t){return t.map(e=>{if(e)return Array.isArray(e)?_w(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var An;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(An||(An={}));class gr extends ri.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=An.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Hr(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return w(this,void 0,void 0,function*(){if(this.status!==An.IDLE)throw Error("check is running already");this.setStatus(An.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==An.SKIPPED&&this.setStatus(this.isSuccess()?An.SUCCESS:An.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return w(this,void 0,void 0,function*(){return this.room.state===we.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return w(this,void 0,void 0,function*(){this.room&&this.room.state!==we.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(An.SKIPPED)}switchProtocol(e){return w(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(U.Reconnecting,()=>{n=!0}),this.room.once(U.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield xt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class fj extends gr{get description(){return"Cloud regions"}perform(){return w(this,void 0,void 0,function*(){const e=new Te(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return w(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,l=1e6/o,c="A".repeat(o),u=Date.now();for(let m=0;m<l;m++)yield s.write(c);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),p={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(m=>{m.type==="candidate-pair"&&m.nominated&&(p.rtt=m.currentRoundTripTime*1e3)}),yield this.disconnect(),p})}}const jd=1e4;class pj extends gr{get description(){return"Connection via UDP vs TCP"}perform(){return w(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(jd/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(jd/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return w(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],c=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>w(this,void 0,void 0,function*(){const h=yield c.getRTCStatsReport();h==null||h.forEach(p=>{p.type==="outbound-rtp"?(u.packetsSent=p.packetsSent,u.qualityLimitationDurations=p.qualityLimitationDurations,u.bitrateTotal+=p.targetBitrate,u.count++):p.type==="remote-inbound-rtp"&&(u.packetsLost=p.packetsLost,u.rttTotal+=p.roundTripTime,u.jitterTotal+=p.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,jd)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class mj extends gr{get description(){return"Can publish audio"}perform(){return w(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield Cm();if(yield uw(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class gj extends gr{get description(){return"Can publish video"}perform(){return w(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield aj();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return w(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,l;const c=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(l=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&l!==void 0?l:720;c.width=d,c.height=h;const p=c.getContext("2d");p.drawImage(i,0,0);const v=p.getImageData(0,0,c.width,c.height).data;let T=!0;for(let g=0;g<v.length;g+=4)if(v[g]!==0||v[g+1]!==0||v[g+2]!==0){T=!1;break}T?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class vj extends gr{get description(){return"Resuming connection after interruption"}perform(){return w(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(c=>{setTimeout(c,5e3),s=c}),a=()=>{i=!0};n.on(U.SignalReconnecting,a).on(U.Reconnecting,a).on(U.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const l=n.engine.client.onClose;if(l&&l(""),yield o,i){if(!r||n.state!==we.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class yj extends gr{get description(){return"Can connect via TURN"}perform(){return w(this,void 0,void 0,function*(){var e,n,i;Qs(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new Te(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new mm,s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let o=!1,a=!1,l=!1;for(let c of s.iceServers)for(let u of c.urls)u.startsWith("turn:")?(a=!0,l=!0):u.startsWith("turns:")&&(a=!0,l=!0,o=!0),u.startsWith("stun:")&&(l=!0);l?a&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class kj extends gr{get description(){return"Establishing WebRTC connection"}perform(){return w(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(U.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let l="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(Sj(a.address)?l+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,l+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(l)}r&&r(s,o)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),he.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function Sj(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class bj extends gr{get description(){return"Connecting to signal connection via WebSocket"}perform(){return w(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new mm,s;try{s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(o){if(Qs(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(o.message,". Retrying with region fallback"));const l=yield new Te(this.url,this.token).getNextBestRegionUrl();l&&(s=yield r.join(l,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}s?(this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===pC.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class kU extends ri.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:An.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==An.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return w(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(bj)})}checkWebRTC(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(kj)})}checkTURN(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(yj)})}checkReconnect(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(vj)})}checkPublishAudio(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(mj)})}checkPublishVideo(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(gj)})}checkConnectionProtocol(){return w(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(pj);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(fj)})}}function ke(t,e,n){return(e=Cj(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Tj(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Cj(t){var e=Tj(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Wt extends Error{constructor(e,n){var i;super(e,n),ke(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}ke(Wt,"code","ERR_JOSE_GENERIC");class wj extends Wt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),ke(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),ke(this,"claim",void 0),ke(this,"reason",void 0),ke(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}ke(wj,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class xj extends Wt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),ke(this,"code","ERR_JWT_EXPIRED"),ke(this,"claim",void 0),ke(this,"reason",void 0),ke(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}ke(xj,"code","ERR_JWT_EXPIRED");class Ej extends Wt{constructor(){super(...arguments),ke(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}ke(Ej,"code","ERR_JOSE_ALG_NOT_ALLOWED");class Pj extends Wt{constructor(){super(...arguments),ke(this,"code","ERR_JOSE_NOT_SUPPORTED")}}ke(Pj,"code","ERR_JOSE_NOT_SUPPORTED");class Rj extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ke(this,"code","ERR_JWE_DECRYPTION_FAILED")}}ke(Rj,"code","ERR_JWE_DECRYPTION_FAILED");class _j extends Wt{constructor(){super(...arguments),ke(this,"code","ERR_JWE_INVALID")}}ke(_j,"code","ERR_JWE_INVALID");class Ij extends Wt{constructor(){super(...arguments),ke(this,"code","ERR_JWS_INVALID")}}ke(Ij,"code","ERR_JWS_INVALID");class Aj extends Wt{constructor(){super(...arguments),ke(this,"code","ERR_JWT_INVALID")}}ke(Aj,"code","ERR_JWT_INVALID");class Nj extends Wt{constructor(){super(...arguments),ke(this,"code","ERR_JWK_INVALID")}}ke(Nj,"code","ERR_JWK_INVALID");class Oj extends Wt{constructor(){super(...arguments),ke(this,"code","ERR_JWKS_INVALID")}}ke(Oj,"code","ERR_JWKS_INVALID");class Dj extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ke(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}ke(Dj,"code","ERR_JWKS_NO_MATCHING_KEY");class Mj extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ke(this,Symbol.asyncIterator,void 0),ke(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}ke(Mj,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class Lj extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),ke(this,"code","ERR_JWKS_TIMEOUT")}}ke(Lj,"code","ERR_JWKS_TIMEOUT");class jj extends Wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ke(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}ke(jj,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");const ml="http://localhost:5000/api";function Uj({isOpen:t,onClose:e,onSelect:n,currentSettings:i}){const[r,s]=C.useState("elevenlabs"),[o,a]=C.useState([]),[l,c]=C.useState([]),[u,d]=C.useState(!1),[h,p]=C.useState(!1),[m,v]=C.useState({name:"",voiceId:"",description:"",provider:"elevenlabs"}),[T,g]=C.useState({gender:"",accent:"",type:""}),[y,S]=C.useState(""),[k,b]=C.useState(null),[x,E]=C.useState(null),[P,A]=C.useState(null),O=()=>{x&&(x.pause(),x.currentTime=0,x.onended=null,x.onerror=null,x.oncanplaythrough=null,x.onloadstart=null,x.onloadeddata=null),P&&P.startsWith("blob:")&&URL.revokeObjectURL(P),E(null),A(null)};C.useEffect(()=>(t&&W(),()=>{O(),b(null)}),[t]);const W=async()=>{var N;d(!0);try{const j=await X.get(`${ml}/voices/predefined`);console.log(" Predefined voices loaded:",j.data),a(j.data||[])}catch(j){console.error(" Error fetching predefined voices:",j),console.error("Error response:",(N=j.response)==null?void 0:N.data),a([])}try{const j=await X.get(`${ml}/voices`);console.log(" Custom voices loaded:",j.data),c(j.data||[])}catch(j){console.error(" Error fetching custom voices:",j),c([])}d(!1)},J=async()=>{if(!m.name||!m.voiceId){alert("Please provide name and voice ID");return}try{const N=await X.post(`${ml}/voices`,m);c([...l,N.data]),p(!1),v({name:"",voiceId:"",description:"",provider:"elevenlabs"}),alert("Custom voice added successfully")}catch(N){console.error("Error adding custom voice:",N),alert("Failed to add custom voice")}},se=N=>{const j=N.id||N.voiceId;console.log(" Voice selected in modal:",{voice:N,selectedVoiceId:j,voiceName:N.name,hasId:!!N.id,hasVoiceId:!!N.voiceId});const $={...i,voiceId:j,voiceName:N.name||N.voiceName,voiceProvider:N.provider||N.voiceProvider||"elevenlabs"};console.log(" Calling onSelect with:",$),n($),e()},te=async(N,j)=>{var De,pe,Xe,le,ct,ue,ne;j.stopPropagation();const $=N.id||N.voiceId,ee=N.name;if(k===$){O(),b(null);return}O(),b($);try{console.log(` Previewing voice: ${ee} (${$})`);const me=await X.post(`${ml}/voices/preview`,{voiceId:$,voiceName:ee},{responseType:"arraybuffer"}),de=new Blob([me.data],{type:"audio/mpeg"}),z=URL.createObjectURL(de);A(z),console.log(" Playing preview audio from blob URL");const fe=new Audio(z);E(fe),fe.onended=()=>{console.log(" Preview finished"),b(null),O()},fe.onerror=St=>{console.error(" Error playing preview audio:",St),b(null),O(),alert("Failed to play voice preview. Please try again.")},fe.oncanplaythrough=async()=>{try{await fe.play(),console.log(" Preview started playing")}catch(St){console.error(" Error starting playback:",St),b(null),O(),alert("Failed to start playback. Please check browser console.")}},fe.onloadstart=()=>console.log(" Audio loading started"),fe.onloadeddata=()=>console.log(" Audio data loaded"),fe.load()}catch(me){console.error(" Error previewing voice:",me),console.error("Error details:",{message:me.message,response:(De=me.response)==null?void 0:De.data,status:(pe=me.response)==null?void 0:pe.status,statusText:(Xe=me.response)==null?void 0:Xe.statusText}),b(null);const de=((ct=(le=me.response)==null?void 0:le.data)==null?void 0:ct.error)||((ne=(ue=me.response)==null?void 0:ue.data)==null?void 0:ne.details)||me.message||"Failed to preview voice";alert(`Failed to preview voice: ${de}`)}},xe=[...o||[],...l||[]];console.log("All voices for filtering:",xe.length,"predefined:",o.length,"custom:",l.length);const q=xe.filter(N=>{var j,$;if(r==="elevenlabs"&&N.provider!=="elevenlabs")return!1;if(r!=="all"){if(N.provider!==r)return!1}return!(y&&!N.name.toLowerCase().includes(y.toLowerCase())&&!(N.description&&N.description.toLowerCase().includes(y.toLowerCase()))||T.gender&&((j=N.traits)==null?void 0:j.gender)!==T.gender||T.accent&&(($=N.traits)==null?void 0:$.accent)!==T.accent)}),Re=[...new Set([...o,...l].map(N=>{var j;return(j=N.traits)==null?void 0:j.gender}).filter(Boolean))],D=[...new Set([...o,...l].map(N=>{var j;return(j=N.traits)==null?void 0:j.accent}).filter(Boolean))];return t?f.jsx("div",{className:"voice-modal-overlay",onClick:e,children:f.jsxs(Ao.div,{className:"voice-modal",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},onClick:N=>N.stopPropagation(),children:[f.jsxs("div",{className:"voice-modal-header",children:[f.jsx("h2",{children:"Select Voice"}),f.jsx("button",{className:"voice-modal-close",onClick:e,children:""})]}),f.jsxs("div",{className:"voice-modal-tabs",children:[f.jsx("button",{className:r==="elevenlabs"?"active":"",onClick:()=>s("elevenlabs"),children:"ElevenLabs"}),f.jsx("button",{className:r==="all"?"active":"",onClick:()=>s("all"),children:"All Voices"})]}),f.jsxs("div",{className:"voice-modal-actions",children:[f.jsx("button",{className:"btn-add-custom",onClick:()=>p(!h),children:"+ Add custom voice"}),f.jsxs("div",{className:"voice-filters",children:[f.jsxs("select",{value:T.gender,onChange:N=>g({...T,gender:N.target.value}),children:[f.jsx("option",{value:"",children:"Gender"}),Re.map(N=>f.jsx("option",{value:N,children:N},N))]}),f.jsxs("select",{value:T.accent,onChange:N=>g({...T,accent:N.target.value}),children:[f.jsx("option",{value:"",children:"Accent"}),D.map(N=>f.jsx("option",{value:N,children:N},N))]}),f.jsx("input",{type:"text",placeholder:"Search...",value:y,onChange:N=>S(N.target.value),className:"voice-search"})]})]}),h&&f.jsxs("div",{className:"custom-voice-form",children:[f.jsx("h3",{children:"Add Custom Voice"}),f.jsx("input",{type:"text",placeholder:"Voice Name",value:m.name,onChange:N=>v({...m,name:N.target.value})}),f.jsx("input",{type:"text",placeholder:"Voice ID",value:m.voiceId,onChange:N=>v({...m,voiceId:N.target.value})}),f.jsx("input",{type:"text",placeholder:"Description (optional)",value:m.description,onChange:N=>v({...m,description:N.target.value})}),f.jsxs("div",{className:"custom-voice-actions",children:[f.jsx("button",{className:"btn-secondary",onClick:()=>p(!1),children:"Cancel"}),f.jsx("button",{className:"btn-primary",onClick:J,children:"Add Voice"})]})]}),u?f.jsx("div",{className:"voice-modal-loading",children:"Loading voices..."}):f.jsx(f.Fragment,{children:q.length>0?f.jsx("div",{className:"voice-list",children:q.map(N=>{var ee,De,pe;const j=N.id||N.voiceId,$=(i==null?void 0:i.voiceId)===j;return f.jsxs("div",{className:`voice-item ${$?"selected":""}`,onClick:()=>se(N),children:[f.jsx("div",{className:"voice-avatar",children:N.name.charAt(0).toUpperCase()}),f.jsxs("div",{className:"voice-info",children:[f.jsx("div",{className:"voice-name",children:N.name}),f.jsx("div",{className:"voice-description",children:N.description||(N.traits?`${((ee=N.traits)==null?void 0:ee.accent)||""}  ${((De=N.traits)==null?void 0:De.age)||""}  ${((pe=N.traits)==null?void 0:pe.gender)||""}`.replace(/^  |  $/g,""):"Voice")}),f.jsxs("div",{className:"voice-id",children:["ID: ",j]})]}),f.jsx("button",{className:`voice-play-btn ${k===j?"playing":""}`,onClick:Xe=>te(N,Xe),title:k===j?"Stop preview":"Preview voice",children:k===j?f.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:[f.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),f.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]}):f.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:f.jsx("polygon",{points:"5 3 19 12 5 21"})})}),$&&f.jsx("div",{className:"voice-selected-check",children:f.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:f.jsx("polyline",{points:"20 6 9 17 4 12"})})})]},j)})}):f.jsxs("div",{className:"voice-modal-empty",children:[f.jsx("p",{children:"No voices found. Try adjusting your filters or add a custom voice."}),xe.length===0&&!u&&f.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"#9ca3af"},children:"Predefined voices should appear here. If they don't, check your backend connection."}),xe.length>0&&q.length===0&&f.jsxs("p",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"#9ca3af"},children:[xe.length," voice(s) available, but filtered out. Clear filters to see them."]})]})})]})}):null}const ut="http://localhost:5000/api";function Fj(){try{const t=new URL(ut).origin;if(t.includes("localhost")||t.includes("127.0.0.1"))throw new Error("Invalid API origin (localhost)");return t}catch{try{const{protocol:e,hostname:n}=window.location;return n.startsWith("dashboard.")?`${e}//api.${n.slice(10)}`:n.startsWith("api.")?`${e}//${n}`:window.location.origin}catch{return window.location.origin}}}function Bj(t){if(!t)return null;const e=String(t);if(!e)return null;if(e.startsWith("http://")||e.startsWith("https://"))return e;let n=e;return n.startsWith("/.rapidcallai.com/")&&(n=n.replace("/.rapidcallai.com","")),n=n.replace("/api/api/","/api/"),n.startsWith("/")||(n=`/${n}`),n}function Ud(t){const e=Bj(t);return e?e.startsWith("http://")||e.startsWith("https://")?e:`${Fj()}${e}`:null}const Vj=[{id:"gpt-4",name:"GPT-4"},{id:"gpt-4-turbo",name:"GPT-4 Turbo"},{id:"gpt-4o",name:"GPT-4o"},{id:"gpt-4o-mini",name:"GPT-4o Mini"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo"},{id:"gpt-4-1106-preview",name:"GPT-4 1106 Preview"},{id:"gpt-4-0125-preview",name:"GPT-4 0125 Preview"}],zj=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"fr",name:"French"},{code:"de",name:"German"},{code:"it",name:"Italian"},{code:"pt",name:"Portuguese"},{code:"zh",name:"Chinese"},{code:"ja",name:"Japanese"},{code:"ko",name:"Korean"},{code:"ru",name:"Russian"},{code:"ar",name:"Arabic"},{code:"hi",name:"Hindi"}];function Wj(){var Nm,Om,Dm;const{id:t}=WS(),e=Jr(),[n,i]=C.useState(null),[r,s]=C.useState(""),[o,a]=C.useState(!1),[l,c]=C.useState(!1),[u,d]=C.useState(null),[h,p]=C.useState([]),[m,v]=C.useState(!1),[T,g]=C.useState(""),[y,S]=C.useState(""),[k,b]=C.useState(null),[x,E]=C.useState(null),[P,A]=C.useState(null),[O,W]=C.useState([]),[J,se]=C.useState(""),[te,xe]=C.useState({knowledgeBase:!0,speechSettings:!1,callSettings:!1,functions:!1}),[q,Re]=C.useState([]),[D,N]=C.useState({voiceId:"21m00Tcm4TlvDq8ikWAM",voiceName:"",voiceProvider:"elevenlabs",modelId:"eleven_turbo_v2",openaiModel:"gpt-4",language:"en",stability:.5,similarityBoost:.75}),[j,$]=C.useState(!1),[ee,De]=C.useState({pauseBeforeSpeaking:0,aiSpeaksFirst:!0}),[pe,Xe]=C.useState("legacy"),[le,ct]=C.useState({status:"idle",roomName:null,identity:null,callId:null,error:null,userSpeaking:!1,agentSpeaking:!1}),[ue,ne]=C.useState(""),[me,de]=C.useState(!1),z=C.useRef(null),fe=C.useRef(null),St=C.useRef(null),Ze=C.useRef(null),We=C.useRef(null),dn=C.useRef({turnId:null,vadEndAt:null}),rt=C.useRef(new Set),ae=C.useRef(null),Ee=C.useRef(pe),Rt=C.useRef(!1),Pe=C.useRef(!1),wn=C.useRef(null),mt=C.useRef(null),ve=C.useRef(!1),zn=C.useRef(!1),bt=C.useRef(null),Fa=C.useRef(!1),Zr=C.useRef(null),es=C.useRef(null),wm=C.useRef(0),xm=C.useRef(0),Em=C.useRef(""),wu=C.useRef(""),so=C.useRef([]),_i=C.useRef(!1),Ba=C.useRef(null),Pm=C.useRef(null),xu=C.useRef(0),oo=C.useRef(""),Va=C.useRef(""),ts=C.useRef(null),Eu=C.useRef(0),Pu=C.useRef(!1),Iw=C.useRef(0),Aw=C.useCallback(R=>{if(!R)return"";let V=String(R);return V=V.replace(/```[\s\S]*?```/g," "),V=V.replace(/`+/g,""),V=V.replace(/[{}\[\]<>]/g," "),V=V.replace(/[*^%$#@|~]/g," "),V=V.replace(/[\u0000-\u001F\u007F]/g," "),V=V.replace(/\s+/g," "),V},[]),vr=C.useCallback(()=>{const R=localStorage.getItem("token");return R?{Authorization:`Bearer ${R}`}:{}},[]),Wn=C.useCallback((R=0)=>{if(!ve.current||Ee.current==="realtime"||!ae.current||Rt.current)return;const V=()=>{if(ve.current&&ae.current&&!Rt.current)try{Rt.current=!0,ae.current.start()}catch{Rt.current=!1}};R>0?setTimeout(V,R):V()},[]),za=C.useCallback(()=>{if(es.current&&(clearTimeout(es.current),es.current=null),Zr.current){try{Zr.current.abort()}catch{}Zr.current=null}wu.current="",b(null)},[]),ao=C.useCallback(()=>{var R,V,Q;Iw.current+=1;try{for(const G of so.current||[])if(G&&typeof G.pause=="function")try{G.pause(),G.currentTime=0,G.src="",(R=G.load)==null||R.call(G)}catch{}}catch{}if(so.current=[],_i.current=!1,z.current){try{z.current.pause(),z.current.currentTime=0,z.current.src="",(Q=(V=z.current).load)==null||Q.call(V)}catch{}z.current=null}},[]),Nw=C.useCallback(()=>{var R,V;if(Pu.current=!0,fe.current){try{fe.current.pause(),fe.current.currentTime=0,fe.current.src="",(V=(R=fe.current).load)==null||V.call(R)}catch{}fe.current=null}if(ao(),ts.current){try{ts.current.abort()}catch{}ts.current=null}Pe.current=!1,v(!1),S(""),oo.current="",xu.current=0,Va.current="",ve.current&&(c(!0),Wn(0))},[Wn,ao]),ns=C.useCallback(()=>{if(!ve.current||_i.current)return;const R=so.current.shift();if(!R)return;_i.current=!0;const V=R&&typeof R.play=="function"?R:(()=>{const Q=Ud(R);if(!Q)return null;const G=new Audio(Q);G.preload="auto";try{G.load()}catch{}return G})();if(!V){_i.current=!1,setTimeout(()=>ns(),0);return}V._isChunkedTts=!0,z.current=V,V.onended=()=>{z.current=null,_i.current=!1,setTimeout(()=>ns(),0)},V.onerror=()=>{z.current=null,_i.current=!1,setTimeout(()=>ns(),0)},ve.current&&(c(!0),Wn(50)),V.play().catch(()=>{z.current=null,_i.current=!1,setTimeout(()=>ns(),0)})},[Wn]),Rm=C.useCallback(R=>{if(!R)return;const V=Ud(R),Q=V?new Audio(V):null;if(Q){Q.preload="auto",Q._isChunkedTts=!0;try{Q.load()}catch{}so.current.push(Q)}else so.current.push(R);_i.current||ns()},[ns]),_m=C.useCallback(async({url:R,body:V,onEvent:Q,signal:G})=>{var Tt,ie;const Z=localStorage.getItem("token"),be=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json",...Z?{Authorization:`Bearer ${Z}`}:{}},body:JSON.stringify(V),signal:G});if(!be.ok){const Me=await be.text().catch(()=>"");throw new Error(Me||`Request failed (${be.status})`)}const xn=(ie=(Tt=be.body)==null?void 0:Tt.getReader)==null?void 0:ie.call(Tt);if(!xn)return;const En=new TextDecoder;let Ie="";for(;;){const{value:Me,done:Ae}=await xn.read();if(Ae)break;Ie+=En.decode(Me,{stream:!0});let hn;for(;(hn=Ie.indexOf(`
`))>=0;){const qn=Ie.slice(0,hn).trim();if(Ie=Ie.slice(hn+1),!!qn)try{const st=JSON.parse(qn);Q==null||Q(st)}catch{}}}},[]),yr=C.useCallback(async()=>{var R,V,Q,G;if(pe==="realtime"){try{try{(V=(R=Ze.current)==null?void 0:R.stop)==null||V.call(R)}catch{}Ze.current=null;try{(G=(Q=St.current)==null?void 0:Q.disconnect)==null||G.call(Q)}catch{}if(St.current=null,We.current&&(We.current.innerHTML=""),le!=null&&le.callId||le!=null&&le.roomName)try{await X.post(`${ut}/realtime/end`,{callId:le.callId,roomName:le.roomName,endReason:"user_hangup"},{headers:vr()})}catch{}}finally{ve.current=!1,Pe.current=!1,a(!1),c(!1),v(!1),g(""),S(""),b(null),E(null),p([]),d(null),ct(Z=>({...Z,status:"ended",userSpeaking:!1,agentSpeaking:!1}))}return}if(ve.current=!1,Pe.current=!1,a(!1),c(!1),v(!1),g(""),za(),ao(),ae.current)try{ae.current.stop(),Rt.current=!1}catch{}if(z.current&&(z.current.pause(),z.current=null),fe.current&&(fe.current.pause(),fe.current=null),A(null),zn.current=!1,bt.current&&(clearTimeout(bt.current),bt.current=null),u)try{await X.post(`${ut}/conversation/${u}/end`,{endReason:"user_hangup"})}catch(Z){console.error("Error ending call:",Z)}},[pe,u,vr,le.callId,le.roomName,za,ao]),Ru=C.useCallback(async()=>{var R,V;if(!r.trim()){alert("Please enter a system prompt for the agent");return}try{await yr(),Pe.current=!0,v(!0);const Q=await X.post(`${ut}/conversation/start`,{systemPrompt:r.trim(),agentId:t,knowledgeBaseId:J||null,aiSpeaksFirst:ee.aiSpeaksFirst||!1});d(Q.data.conversationId),a(!0),ve.current=!0,p([]),g(""),Pe.current=!1,v(!1);const G=()=>{c(!0),setTimeout(()=>{if(ae.current&&ve.current)try{ae.current.start()}catch{}},150)};if(ee.aiSpeaksFirst&&Q.data.initialGreeting&&p(Z=>[...Z,{role:"assistant",content:Q.data.initialGreeting}]),ee.aiSpeaksFirst&&Q.data.initialAudioUrl&&ve.current){const Z=Ud(Q.data.initialAudioUrl),be=Z?new Audio(Z):null;z.current=be,be.onended=()=>{z.current=null,G()},be.onerror=()=>{z.current=null,G()},be==null||be.play().catch(()=>{z.current=null,G()})}else G()}catch(Q){console.error("Legacy start failed:",Q),alert(((V=(R=Q==null?void 0:Q.response)==null?void 0:R.data)==null?void 0:V.error)||Q.message||"Failed to start conversation"),Pe.current=!1,v(!1)}},[r,t,J,ee.aiSpeaksFirst,yr]),Ow=C.useCallback(async()=>{var R;try{await yr(),ct({status:"connecting",roomName:null,identity:null,callId:null,error:null,userSpeaking:!1,agentSpeaking:!1});const V=await X.post(`${ut}/realtime/token`,{agentId:t,provider:"web"},{headers:vr()}),{livekitUrl:Q,accessToken:G,roomName:Z,identity:be}=V.data||{};if(!Q||!G||!Z)throw new Error("Realtime token response missing fields");const En=((R=(await X.post(`${ut}/realtime/start`,{agentId:t,roomName:Z,provider:"web"},{headers:vr()})).data)==null?void 0:R.callId)||null,Ie=new Hr({adaptiveStream:!0,dynacast:!0});St.current=Ie,Ie.on(U.Disconnected,()=>{ct(ie=>({...ie,status:"ended",userSpeaking:!1,agentSpeaking:!1}))}),Ie.on(U.TrackSubscribed,ie=>{var Ae;if((ie==null?void 0:ie.kind)!=="audio")return;const Me=ie.attach();Me.autoplay=!0,Me.controls=!1,Me.setAttribute("data-livekit-audio","true"),Me.onplaying=async()=>{var hn,qn;try{const st=Date.now(),qt=((hn=dn.current)==null?void 0:hn.turnId)||`play_${st}`;if(rt.current.has(qt))return;rt.current.add(qt);const Wa=((qn=dn.current)==null?void 0:qn.vadEndAt)??null,$w=typeof Wa=="number"?st-Wa:null;await X.post(`${ut}/realtime/metrics`,{callId:En,roomName:Z,turn:{turnId:qt,vadEndAt:Wa,clientPlayoutStartAt:st,vadEndToPlayoutStartMs:$w}},{headers:vr()})}catch{}},(Ae=We.current)==null||Ae.appendChild(Me)}),Ie.on(U.TrackUnsubscribed,ie=>{if((ie==null?void 0:ie.kind)==="audio")try{ie.detach().forEach(Me=>Me.remove())}catch{}}),Ie.on(U.ActiveSpeakersChanged,ie=>{var st;const Me=new Set((ie||[]).map(qt=>qt==null?void 0:qt.identity).filter(Boolean)),Ae=(st=Ie.localParticipant)==null?void 0:st.identity,hn=!!(Ae&&Me.has(Ae)),qn=Array.from(Me).some(qt=>qt&&qt!==Ae);ct(qt=>({...qt,userSpeaking:hn,agentSpeaking:qn}))}),Ie.on(U.DataReceived,async ie=>{try{const Me=new TextDecoder().decode(ie),Ae=JSON.parse(Me);if(!Ae||typeof Ae!="object")return;Ae.turnId&&(dn.current.turnId=String(Ae.turnId)),typeof Ae.vadEndAt=="number"&&(dn.current.vadEndAt=Ae.vadEndAt),Ae.turnId&&(typeof Ae.vadEndAt=="number"||typeof Ae.ttsFirstFrameAt=="number"||typeof Ae.llmFirstTokenAt=="number")&&await X.post(`${ut}/realtime/metrics`,{callId:En,roomName:Z,turn:{turnId:String(Ae.turnId),vadEndAt:typeof Ae.vadEndAt=="number"?Ae.vadEndAt:void 0,llmFirstTokenAt:typeof Ae.llmFirstTokenAt=="number"?Ae.llmFirstTokenAt:void 0,ttsFirstFrameAt:typeof Ae.ttsFirstFrameAt=="number"?Ae.ttsFirstFrameAt:void 0}},{headers:vr()})}catch{}}),await Ie.connect(Q,G);const Tt=await Cm({echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0});Ze.current=Tt,await Ie.localParticipant.publishTrack(Tt),ct(ie=>({...ie,status:"connected",roomName:Z,identity:be||null,callId:En})),a(!0),ve.current=!0,c(!0)}catch(V){console.error("Realtime start failed:",V),ct(Q=>{var G,Z;return{...Q,status:"error",error:((Z=(G=V==null?void 0:V.response)==null?void 0:G.data)==null?void 0:Z.error)||(V==null?void 0:V.message)||"Failed to start realtime call"}}),await Ru()}},[ut,vr,t,Ru,yr]);C.useEffect(()=>{Dw(),Mw()},[t]),C.useEffect(()=>{ve.current=o},[o]),C.useEffect(()=>{var R,V;if(Ee.current=pe,pe==="realtime"){try{(V=(R=ae.current)==null?void 0:R.stop)==null||V.call(R),Rt.current=!1}catch{}g("")}},[pe]);const Dw=async()=>{try{const R=await X.get(`${ut}/agents/${t}`);if(i(R.data),s(R.data.systemPrompt||""),se(R.data.knowledgeBaseId||""),localStorage.setItem("lastSelectedAgentId",t),R.data.speechSettings&&(console.log(" Loaded speech settings from agent:",{voiceId:R.data.speechSettings.voiceId,voiceName:R.data.speechSettings.voiceName,language:R.data.speechSettings.language,fullSettings:R.data.speechSettings}),N({voiceId:R.data.speechSettings.voiceId||"21m00Tcm4TlvDq8ikWAM",voiceName:R.data.speechSettings.voiceName||"",voiceProvider:R.data.speechSettings.voiceProvider||"elevenlabs",modelId:R.data.speechSettings.modelId||"eleven_turbo_v2",openaiModel:R.data.speechSettings.openaiModel||"gpt-4",language:R.data.speechSettings.language||"en",stability:R.data.speechSettings.stability??.5,similarityBoost:R.data.speechSettings.similarityBoost??.75})),R.data.callSettings&&De(R.data.callSettings),R.data.functions&&R.data.functions.length>0&&(console.log(" Loaded functions from agent:",R.data.functions),Re(R.data.functions)),R.data.isPublic&&R.data.shareableToken){const V=window.location.origin;ne(`${V}/test/${R.data.shareableToken}`)}else ne("");if(de(R.data.isPublic||!1),!R.data.functions||R.data.functions.length===0){console.log(" No functions found, initializing default end_call function");const V=[{name:"end_call",description:"End the call when user says goodbye, bye, or similar phrases",enabled:!0,triggers:["bye","goodbye","see you","talk later","end call","hang up"],config:{}}];Re(V);try{await X.put(`${ut}/agents/${t}`,{functions:V})}catch(Q){console.error("Error saving default function:",Q)}}}catch(R){console.error("Error fetching agent:",R),e("/")}},Mw=async()=>{try{const R=await X.get(`${ut}/knowledge-bases`);W(R.data)}catch(R){console.error("Error fetching knowledge bases:",R)}},Im=async()=>{try{const R=await X.post(`${ut}/agents/${t}/generate-token`),V=window.location.origin;ne(`${V}/test/${R.data.shareableToken}`),de(!0),i(R.data),alert("Shareable link generated! You can now share this agent publicly.")}catch(R){console.error("Error generating shareable link:",R),alert("Failed to generate shareable link")}},Lw=()=>{ue&&(navigator.clipboard.writeText(ue),alert("Link copied to clipboard!"))},jw=async()=>{try{const R=await X.put(`${ut}/agents/${t}`,{isPublic:!1});ne(""),de(!1),i(R.data),alert("Shareable link removed")}catch(R){console.error("Error removing shareable link:",R),alert("Failed to remove shareable link")}},Uw=async()=>{var R,V,Q,G,Z;try{console.log(" Saving agent with speech settings:",{voiceId:D.voiceId,voiceName:D.voiceName,language:D.language,fullSpeechSettings:D}),D.voiceId||console.warn(" No voiceId in speechSettings, this might cause issues");const be=await X.put(`${ut}/agents/${t}`,{systemPrompt:r,knowledgeBaseId:J||null,speechSettings:D,callSettings:ee,functions:q});console.log(" Agent saved successfully. Response:",{savedVoiceId:(R=be.data.speechSettings)==null?void 0:R.voiceId,savedVoiceName:(V=be.data.speechSettings)==null?void 0:V.voiceName}),be.data.speechSettings&&N(be.data.speechSettings),alert("Agent saved successfully")}catch(be){console.error(" Error saving agent:",be),console.error(" Error details:",(Q=be.response)==null?void 0:Q.data),alert("Failed to save agent: "+(((Z=(G=be.response)==null?void 0:G.data)==null?void 0:Z.error)||be.message))}},Fw=C.useCallback(()=>{z.current&&(z.current.pause(),z.current=null),ve.current&&!Pe.current&&(c(!0),setTimeout(()=>{if(ae.current&&ve.current&&!Pe.current)try{ae.current.start()}catch{console.log("Recognition already running")}},200))},[]),Am=C.useCallback(async R=>{if(!u)return;if(Pe.current){console.log(" Already processing, ignoring duplicate message:",R);return}(Pe.current||z.current&&z.current.currentTime>0)&&(Fa.current=!0),A(null),zn.current=!1,bt.current&&(clearTimeout(bt.current),bt.current=null),z.current&&(z.current.pause(),z.current=null),fe.current&&(fe.current.pause(),fe.current=null),Pe.current=!0,v(!0),g(""),za(),ao(),S(""),b(null),E(null),xu.current=0,oo.current="",Va.current="",Pu.current=!1;const Q=Eu.current+=1;p(G=>[...G,{role:"user",content:R}]);try{const G=new AbortController;ts.current=G;let Z="",be=!1,xn=!1;const En=setTimeout(()=>{if(!xn)try{G.abort()}catch{}},2e4);await _m({url:`${ut}/conversation/chat-stream`,body:{message:R,conversationId:u,agentId:t,clientTimings:Pm.current||void 0},signal:G.signal,onEvent:ie=>{if(Q===Eu.current&&!(!ie||!ie.type)){if(xn=!0,ie.type==="assistant_delta"&&(Z+=ie.delta||"",Va.current=Z),ie.type==="tts_audio"&&ie.audioUrl&&(typeof ie.spokenUpTo=="number"&&Number.isFinite(ie.spokenUpTo)&&(xu.current=ie.spokenUpTo),typeof ie.text=="string"&&ie.text&&(oo.current=(oo.current||"")+Aw(ie.text),S(oo.current.trimStart())),Rm(ie.audioUrl)),ie.type==="latency"&&b(ie.latency||null),ie.type==="rate_limited")try{G.abort()}catch{}ie.type==="final"&&(typeof ie.text=="string"&&(Z=ie.text,Va.current=Z),be=!!ie.shouldEndCall)}}}),clearTimeout(En),ts.current===G&&(ts.current=null);const Ie=Fa.current;Fa.current=!1;const Tt=(Z||"").trim();if(Tt&&p(ie=>[...ie,{role:"assistant",content:Tt}]),S(""),be){console.log(" End call function triggered, stopping conversation immediately"),z.current&&(z.current.pause(),z.current=null),fe.current&&(fe.current.pause(),fe.current=null),await yr();return}ve.current&&(c(!0),setTimeout(()=>{if(ae.current&&ve.current)try{ae.current.start()}catch{}},100))}catch(G){if(Pu.current||(G==null?void 0:G.name)==="AbortError")return;console.error("Error in chat:",G);try{const Z=await X.post(`${ut}/conversation/chat`,{message:R,conversationId:u,agentId:t}),be=Z.data.text,xn=Z.data.audioUrl,En=Z.data.shouldEndCall||!1;if(be&&p(Ie=>[...Ie,{role:"assistant",content:be}]),S(""),En){await yr();return}xn&&ve.current&&Rm(xn)}catch(Z){console.error("Legacy fallback failed:",Z),alert("Failed to get AI response")}ve.current&&(c(!0),setTimeout(()=>{if(ae.current&&ve.current)try{ae.current.start()}catch{console.log("Recognition already running")}},100))}finally{Q===Eu.current&&(Pe.current=!1,v(!1)),Fa.current=!1,ve.current&&(c(!0),setTimeout(()=>{if(ae.current&&ve.current)try{ae.current.start()}catch{console.log("Recognition restart in finally - already running")}},200))}},[u,t,Fw]);C.useEffect(()=>{if(ae.current&&D.language){const R=D.language||"en",V={en:"en-US",es:"es-ES",fr:"fr-FR",de:"de-DE",it:"it-IT",pt:"pt-PT",zh:"zh-CN",ja:"ja-JP",ko:"ko-KR",ru:"ru-RU",ar:"ar-SA",hi:"hi-IN"};ae.current.lang=V[R]||"en-US"}},[D.language]),C.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const R=window.SpeechRecognition||window.webkitSpeechRecognition;ae.current=new R,ae.current.continuous=!0,ae.current.interimResults=!0;const V=D.language||"en",Q={en:"en-US",es:"es-ES",fr:"fr-FR",de:"de-DE",it:"it-IT",pt:"pt-PT",zh:"zh-CN",ja:"ja-JP",ko:"ko-KR",ru:"ru-RU",ar:"ar-SA",hi:"hi-IN"};ae.current.lang=Q[V]||"en-US",ae.current.onstart=()=>{Rt.current=!0},ae.current.onresult=async G=>{if(Ee.current==="realtime")return;let Z="",be="";for(let Ie=G.resultIndex;Ie<G.results.length;Ie++){const Tt=G.results[Ie][0].transcript.trim();G.results[Ie].isFinal?be+=Tt+" ":Z+=Tt}if(Z&&(g(Z),Ba.current==null&&(Ba.current=performance.now()),u&&ve.current&&!Pe.current)){if(Date.now()<wm.current)return;const Ie=Date.now(),Tt=xm.current||0,ie=Em.current||"",Me=Z,Ae=Math.abs(Me.length-ie.length);if(Ie-Tt<800&&Ae<8)return;es.current&&clearTimeout(es.current),es.current=setTimeout(()=>{if(Zr.current)try{Zr.current.abort()}catch{}const hn=new AbortController;Zr.current=hn,xm.current=Date.now(),Em.current=Me;let qn="";_m({url:`${ut}/conversation/prefetch`,body:{conversationId:u,draftText:Z},signal:hn.signal,onEvent:st=>{if(!(!st||!st.type)&&(st.type==="assistant_delta"&&(qn+=st.delta||"",wu.current=qn),st.type==="latency"&&b(st.latency||null),st.type==="rate_limited")){const qt=Number(st.retryAfterMs)||6e3;wm.current=Date.now()+Math.min(3e4,qt+500);try{hn.abort()}catch{}}}}).catch(()=>{})},200)}const xn=z.current&&z.current.currentTime>0,En=Pe.current||xn;if(Z&&En&&!zn.current&&(zn.current=!0,bt.current&&(clearTimeout(bt.current),bt.current=null),A(null),Nw()),(Z||be)&&bt.current&&(clearTimeout(bt.current),bt.current=null),be.trim()){g(""),za();const Ie=performance.now(),Tt=Ba.current??Ie;Pm.current={asr_final_ms:Math.round(Ie-Tt)},Ba.current=null,wu.current="",mt.current&&(clearTimeout(mt.current),mt.current=null);const ie=be.trim();wn.current=ie,mt.current=setTimeout(()=>{const Me=wn.current;wn.current=null,mt.current=null,Me&&(bt.current&&(clearTimeout(bt.current),bt.current=null),A(null),zn.current=!1,Pe.current?console.log(" Ignoring message while processing:",Me):Am(Me))},300)}},ae.current.onerror=G=>{if(Ee.current!=="realtime"){if(G.error==="aborted"){Rt.current=!1;return}G.error==="no-speech"?Rt.current=!1:console.error("Speech recognition error:",G.error),Rt.current=!1,c(!1),g(""),G.error==="no-speech"&&ve.current&&!Pe.current&&setTimeout(()=>{if(ae.current&&ve.current&&!Pe.current)try{Wn()}catch{}},500)}},ae.current.onend=()=>{Ee.current!=="realtime"&&(Rt.current=!1,zn.current&&P&&!Pe.current&&(bt.current=setTimeout(()=>{if(zn.current&&P&&!Pe.current&&ve.current){zn.current=!1;const G=new Audio(P.audioUrl);z.current=G,G.currentTime=P.currentTime,G.onended=()=>{z.current=null,ve.current&&!Pe.current&&(c(!0),setTimeout(()=>{if(ae.current&&ve.current&&!Pe.current)try{Wn()}catch{}},100))},G.onerror=()=>{z.current=null,ve.current&&!Pe.current&&(c(!0),setTimeout(()=>{if(ae.current&&ve.current&&!Pe.current)try{Wn()}catch{}},100))},G.onpause=()=>{},G.play().catch(()=>{z.current=null,ve.current&&!Pe.current&&(c(!0),setTimeout(()=>{if(ae.current&&ve.current&&!Pe.current)try{Wn()}catch{}},100))}),A(null),bt.current=null}},1500)),ve.current&&setTimeout(()=>{if(ae.current&&ve.current)try{Wn()}catch{console.log("Recognition already running in onend")}},100))}}},[l,Am,Wn]),C.useEffect(()=>{if(!o||!u)return;let R=!1;const V=async()=>{try{const G=await X.get(`${ut}/call-history/by-conversation/${u}`);R||E(G.data)}catch{}};V();const Q=setInterval(V,3e3);return()=>{R=!0,clearInterval(Q)}},[o,u]);const Bw=async()=>pe==="realtime"?Ow():Ru();if(!n)return f.jsx("div",{className:"agent-detail-loading",children:"Loading..."});const Vw=(R,V=6)=>{const Q=String(R||"");return Q?Q.length<=V*2?Q:`${Q.slice(0,V)}${Q.slice(-V)}`:""},zw=R=>typeof R!="number"||!Number.isFinite(R)?"":`${Math.round(R)}ms`,Ww=R=>typeof R!="number"||!Number.isFinite(R)?"":`${Math.round(R)} tokens`,qw=R=>typeof R!="number"||!Number.isFinite(R)?"":`$${R.toFixed(2)}/min`,Hw=async()=>{try{await navigator.clipboard.writeText(String(t||""))}catch{const V=document.createElement("textarea");V.value=String(t||""),document.body.appendChild(V),V.select();try{document.execCommand("copy")}catch{}document.body.removeChild(V)}};return f.jsxs("div",{className:"agent-detail-container",children:[f.jsxs("div",{className:"agent-detail-header",children:[f.jsx("div",{className:"agent-detail-title",children:f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",width:"100%",minWidth:"600px",maxWidth:"100%"},children:[ue?f.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",width:"100%",minWidth:"600px"},children:[f.jsx("input",{type:"text",value:ue,readOnly:!0,style:{padding:"0.5rem 0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",background:"white",minWidth:"500px"},placeholder:"No shareable link generated"}),f.jsx("button",{className:"btn-secondary",onClick:Lw,title:"Copy link",style:{padding:"0.5rem",minWidth:"auto"},children:f.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),f.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),f.jsx("button",{className:"btn-secondary",onClick:Im,title:"Generate new link",style:{padding:"0.5rem 0.75rem",fontSize:"0.875rem",whiteSpace:"nowrap"},children:"Regenerate"}),f.jsx("button",{className:"btn-secondary",onClick:jw,title:"Remove link",style:{padding:"0.5rem",minWidth:"auto",color:"#dc2626"},children:f.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("path",{d:"M3 6h18"}),f.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]}):f.jsx("button",{className:"btn-secondary",onClick:Im,style:{fontSize:"0.875rem",padding:"0.5rem 1rem",alignSelf:"flex-start"},children:"Generate Shareable Link"}),f.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",fontSize:"0.875rem",color:"#111827",marginTop:"0.25rem"},children:[f.jsx("span",{style:{opacity:.75},children:"Agent ID:"}),f.jsxs("strong",{style:{display:"inline-flex",alignItems:"center",gap:"0.35rem"},children:[Vw(t,6),f.jsx("button",{className:"btn-secondary",onClick:Hw,title:"Copy Agent ID",style:{padding:"0.25rem 0.4rem",minWidth:"auto",fontSize:"0.75rem"},children:"Copy"})]}),f.jsx("span",{style:{opacity:.5},children:""}),f.jsx("span",{style:{opacity:.75},children:"LLM:"}),f.jsx("strong",{children:(x==null?void 0:x.llmModel)||D.openaiModel||""}),f.jsx("span",{style:{opacity:.5},children:""}),f.jsx("span",{style:{opacity:.75},children:"Cost/min:"}),f.jsx("strong",{children:qw(x==null?void 0:x.costPerMin)}),f.jsx("span",{style:{opacity:.5},children:""}),f.jsx("span",{style:{opacity:.75},children:"Latency:"}),f.jsx("strong",{children:zw((x==null?void 0:x.avgLatencyMs)??((Nm=x==null?void 0:x.lastTurn)==null?void 0:Nm.e2eFirstAudioMs))}),f.jsx("span",{style:{opacity:.5},children:""}),f.jsx("span",{style:{opacity:.75},children:"Tokens:"}),f.jsx("strong",{children:Ww((x==null?void 0:x.avgTokensUsed)??((Om=x==null?void 0:x.tokensRange)==null?void 0:Om.max)??((Dm=x==null?void 0:x.lastTurn)==null?void 0:Dm.tokensUsed))})]})]})}),f.jsxs("div",{className:"agent-detail-actions",children:[f.jsx("button",{className:"btn-secondary",onClick:Uw,children:"Save"}),f.jsx("button",{className:"btn-primary",onClick:()=>e("/"),children:"Back to Agents"})]})]}),f.jsxs("div",{className:"agent-detail-layout",children:[f.jsxs("div",{className:"agent-panel agent-panel-left",children:[f.jsx("div",{className:"prompt-header",children:f.jsxs("div",{className:"prompt-controls",children:[f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"LLM"}),f.jsx("div",{className:"control-select-wrapper",children:f.jsx("select",{value:D.openaiModel||"gpt-4",onChange:R=>N({...D,openaiModel:R.target.value}),className:"control-select",children:Vj.map(R=>f.jsx("option",{value:R.id,children:R.name},R.id))})})]}),f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Voice"}),f.jsx("div",{className:"control-select-wrapper",children:f.jsxs("button",{className:"control-select-btn",onClick:()=>$(!0),children:[D.voiceName||"Select Voice",f.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:f.jsx("polyline",{points:"6 9 12 15 18 9"})})]})})]}),f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Language"}),f.jsx("div",{className:"control-select-wrapper",children:f.jsx("select",{value:D.language||"en",onChange:R=>N({...D,language:R.target.value}),className:"control-select",children:zj.map(R=>f.jsx("option",{value:R.code,children:R.name},R.code))})})]})]})}),f.jsxs("div",{className:"prompt-editor",children:[f.jsx("div",{className:"prompt-label",children:"## ROLE"}),f.jsx("textarea",{className:"prompt-textarea",value:r,onChange:R=>s(R.target.value),placeholder:"You are a helpful AI agent...",rows:30})]})]}),f.jsxs("div",{className:"agent-panel agent-panel-middle",children:[f.jsx("div",{className:"panel-header",children:f.jsx("h2",{children:"Settings"})}),f.jsxs("div",{className:"settings-list",children:[f.jsxs("div",{className:"setting-item",children:[f.jsxs("div",{className:"setting-header",children:[f.jsx("span",{children:"Knowledge Base"}),f.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:f.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),f.jsxs("div",{className:"setting-content",children:[f.jsx("label",{children:"Connect Knowledge Base"}),f.jsxs("select",{value:J,onChange:R=>se(R.target.value),className:"kb-select",children:[f.jsx("option",{value:"",children:"None"}),O.map(R=>f.jsx("option",{value:R.id,children:R.name},R.id))]}),J&&f.jsx("p",{className:"kb-connected",children:"Knowledge base connected"})]})]}),f.jsxs("div",{className:"setting-item",children:[f.jsxs("div",{className:"setting-header",onClick:()=>xe({...te,speechSettings:!te.speechSettings}),style:{cursor:"pointer"},children:[f.jsx("span",{children:"Speech Settings"}),f.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{transform:te.speechSettings?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:f.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),te.speechSettings&&f.jsxs("div",{className:"setting-content",children:[f.jsxs("div",{className:"speech-setting-group",children:[f.jsx("label",{children:"ElevenLabs Model"}),f.jsxs("select",{value:D.modelId||"eleven_turbo_v2",onChange:R=>N({...D,modelId:R.target.value}),className:"model-select",children:[f.jsx("option",{value:"eleven_turbo_v2",children:"Eleven Turbo v2"}),f.jsx("option",{value:"eleven_multilingual_v2",children:"Eleven Multilingual v2"}),f.jsx("option",{value:"eleven_monolingual_v1",children:"Eleven Monolingual v1"})]})]}),f.jsxs("div",{className:"speech-setting-group",children:[f.jsxs("label",{children:["Stability: ",D.stability||.5]}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:D.stability||.5,onChange:R=>N({...D,stability:parseFloat(R.target.value)}),className:"slider"})]}),f.jsxs("div",{className:"speech-setting-group",children:[f.jsxs("label",{children:["Similarity Boost: ",D.similarityBoost||.75]}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:D.similarityBoost||.75,onChange:R=>N({...D,similarityBoost:parseFloat(R.target.value)}),className:"slider"})]})]})]}),f.jsxs("div",{className:"setting-item",children:[f.jsxs("div",{className:"setting-header",onClick:()=>xe({...te,callSettings:!te.callSettings}),style:{cursor:"pointer"},children:[f.jsx("span",{children:"Call Settings"}),f.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{transform:te.callSettings?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:f.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),te.callSettings&&f.jsxs("div",{className:"setting-content",children:[f.jsxs("div",{className:"speech-setting-group",children:[f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:pe==="realtime",onChange:R=>Xe(R.target.checked?"realtime":"legacy"),style:{marginRight:"0.5rem"}}),"Realtime (LiveKit) mode (beta)"]}),f.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:"Uses WebRTC duplex audio instead of browser SpeechRecognition + HTTP TTS."})]}),f.jsxs("div",{className:"speech-setting-group",children:[f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:ee.aiSpeaksFirst||!1,onChange:R=>De({...ee,aiSpeaksFirst:R.target.checked}),style:{marginRight:"0.5rem"}}),"AI Speaks First"]}),f.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:"When enabled, the AI will greet the user first when the conversation starts."})]})]})]}),f.jsxs("div",{className:"setting-item",children:[f.jsxs("div",{className:"setting-header",onClick:()=>xe({...te,functions:!te.functions}),style:{cursor:"pointer"},children:[f.jsx("span",{children:"Functions"}),f.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{transform:te.functions?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:f.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),te.functions&&f.jsxs("div",{className:"setting-content",children:[f.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"1rem"},children:"Enable your agent with capabilities such as calendar bookings, call termination, etc."}),q.map((R,V)=>f.jsxs("div",{className:"function-item",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",background:"#f9fafb",borderRadius:"0.5rem",marginBottom:"0.5rem"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[f.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:f.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})}),f.jsx("span",{style:{fontWeight:500},children:R.name})]}),f.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[f.jsx("button",{className:"btn-icon",onClick:()=>{const Q=[...q];Q[V]={...Q[V],enabled:!Q[V].enabled},Re(Q)},title:R.enabled?"Disable":"Enable",children:f.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:R.enabled?f.jsx("path",{d:"M5 13l4 4L19 7"}):f.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"})})}),f.jsx("button",{className:"btn-icon",onClick:()=>{const Q=q.filter((G,Z)=>Z!==V);Re(Q)},title:"Delete",children:f.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:f.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})})})]})]},V)),f.jsx("button",{className:"btn-secondary",onClick:()=>{const R={name:"end_call",description:"End the call when user says goodbye, bye, or similar phrases",enabled:!0,triggers:["bye","goodbye","see you","talk later","end call","hang up"],config:{}};Re([...q,R])},style:{width:"100%",marginTop:"0.5rem"},children:"+ Add"})]})]})]})]}),f.jsxs("div",{className:"agent-panel agent-panel-right",children:[f.jsx("div",{className:"panel-header",children:f.jsx("h2",{children:"Test Agent"})}),f.jsx("div",{className:"test-agent-content",children:o?f.jsxs("div",{className:"test-active",children:[f.jsx("div",{className:"test-controls-top",children:f.jsx("button",{className:"btn-secondary btn-small",onClick:yr,children:"Stop"})}),f.jsxs("div",{className:"test-conversation",children:[f.jsx("div",{ref:We,style:{display:"none"}}),pe==="realtime"&&f.jsxs("div",{style:{padding:"12px",border:"1px solid #e5e7eb",borderRadius:"8px",marginBottom:"12px"},children:[f.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",fontSize:"14px"},children:[f.jsxs("span",{children:[f.jsx("strong",{children:"Realtime:"})," ",le.status]}),le.roomName&&f.jsxs("span",{children:[f.jsx("strong",{children:"Room:"})," ",le.roomName]}),f.jsxs("span",{children:[f.jsx("strong",{children:"You:"})," ",le.userSpeaking?"speaking":"silent"]}),f.jsxs("span",{children:[f.jsx("strong",{children:"Agent:"})," ",le.agentSpeaking?"speaking":"silent"]})]}),le.status==="error"&&f.jsx("div",{style:{marginTop:"8px",color:"#b91c1c",fontSize:"13px"},children:le.error}),f.jsx("div",{style:{marginTop:"8px",fontSize:"12px",color:"#6b7280"},children:"Tip: you must run the agent-worker for the assistant voice track to exist."})]}),f.jsxs("div",{className:"messages-container",children:[f.jsx(yO,{children:h.map((R,V)=>f.jsx(Ao.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`message ${R.role}`,children:f.jsx("div",{className:"message-content",children:R.content})},V))}),y&&!T&&f.jsx(Ao.div,{initial:{opacity:0},animate:{opacity:1},className:"message assistant draft",children:f.jsxs("div",{className:"message-content",children:[y,f.jsx("span",{className:"typing-cursor",children:"|"}),(k==null?void 0:k.llmFirstTokenMs)!=null&&f.jsxs("div",{style:{fontSize:"12px",opacity:.7,marginTop:"6px"},children:["LLM first token: ",k.llmFirstTokenMs,"ms",k.ttsFirstAudioMs!=null?`  TTS first audio: ${k.ttsFirstAudioMs}ms`:""]})]})}),T&&f.jsx(Ao.div,{initial:{opacity:0},animate:{opacity:1},className:"message user interim",children:f.jsxs("div",{className:"message-content",children:[T,f.jsx("span",{className:"typing-cursor",children:"|"})]})}),m&&f.jsx(Ao.div,{initial:{opacity:0},animate:{opacity:1},className:"message assistant processing",children:f.jsxs("div",{className:"typing-indicator",children:[f.jsx("span",{}),f.jsx("span",{}),f.jsx("span",{})]})})]}),f.jsx("div",{className:"listening-indicator",children:o&&!m?f.jsxs("div",{className:"listening-pulse",children:[f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),f.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"})]}),pe==="realtime"?"Mic live...":"Listening..."]}):f.jsxs("div",{className:"listening-pulse inactive",children:[f.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:f.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})}),m?"Processing...":"Not listening"]})})]})]}):f.jsxs("div",{className:"test-start",children:[f.jsx("div",{className:"test-icon",children:f.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),f.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),f.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),f.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),f.jsx("p",{className:"test-label",children:"Test your agent"}),f.jsx("button",{className:"btn-primary btn-test",onClick:Bw,disabled:m||!r.trim(),children:m?"Starting...":pe==="realtime"?"Call (Realtime)":"Test"})]})})]})]}),f.jsx(Uj,{isOpen:j,onClose:()=>$(!1),onSelect:R=>{console.log(" Voice selected in AgentDetail, received:",R),N(R),console.log(" Updated speech settings in AgentDetail:",R)},currentSettings:D})]})}const os="http://localhost:5000/api";function qj(){const[t,e]=C.useState([]),[n,i]=C.useState(!0),[r,s]=C.useState(!1),[o,a]=C.useState(""),[l,c]=C.useState(null),[u,d]=C.useState(!1);C.useEffect(()=>{h()},[]);const h=async()=>{try{const g=await X.get(`${os}/knowledge-bases`);e(g.data)}catch(g){console.error("Error fetching knowledge bases:",g),e([])}finally{i(!1)}},p=async()=>{var g,y;if(!o.trim()){alert("Please enter a knowledge base name");return}try{const S=await X.post(`${os}/knowledge-bases`,{name:o.trim()});e([...t,S.data]),s(!1),a(""),c(S.data)}catch(S){console.error("Error creating knowledge base:",S);let k="Failed to create knowledge base";S.response?k=((g=S.response.data)==null?void 0:g.error)||((y=S.response.data)==null?void 0:y.message)||`Server error: ${S.response.status}`:S.request?k="Cannot connect to server. Please make sure the backend is running on http://localhost:5000/api":k=S.message||"Failed to create knowledge base",alert(k)}},m=async g=>{if(window.confirm("Are you sure you want to delete this knowledge base?"))try{await X.delete(`${os}/knowledge-bases/${g}`),e(t.filter(y=>y.id!==g)),(l==null?void 0:l.id)===g&&c(null)}catch(y){console.error("Error deleting knowledge base:",y),alert("Failed to delete knowledge base")}},v=async g=>{const y=g.target.files[0];if(!y||!l)return;d(!0);const S=new FormData;S.append("file",y);try{await X.post(`${os}/knowledge-bases/${l.id}/documents`,S,{headers:{"Content-Type":"multipart/form-data"}}),alert("Document uploaded successfully");const k=await X.get(`${os}/knowledge-bases/${l.id}`);c(k.data),h()}catch(k){console.error("Error uploading document:",k),alert("Failed to upload document")}finally{d(!1),g.target.value=""}},T=async g=>{try{const y=await X.get(`${os}/knowledge-bases/${g.id}`);c(y.data)}catch(y){console.error("Error fetching KB details:",y),c(g)}};return n?f.jsx("div",{className:"kb-container",children:f.jsx("div",{className:"kb-loading",children:"Loading knowledge bases..."})}):f.jsxs("div",{className:"kb-container",children:[f.jsxs("div",{className:"kb-header",children:[f.jsx("h1",{className:"kb-title",children:"Knowledge Base"}),f.jsx("button",{className:"btn-primary",onClick:()=>s(!0),children:"Create Knowledge Base"})]}),f.jsxs("div",{className:"kb-layout",children:[f.jsxs("div",{className:"kb-sidebar",children:[f.jsx("h3",{children:"Knowledge Bases"}),t.length===0?f.jsx("div",{className:"kb-empty",children:f.jsx("p",{children:"No knowledge bases yet"})}):f.jsx("div",{className:"kb-list",children:t.map(g=>f.jsxs("div",{className:`kb-item ${(l==null?void 0:l.id)===g.id?"active":""}`,onClick:()=>T(g),children:[f.jsxs("div",{className:"kb-item-content",children:[f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),f.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),f.jsx("span",{children:g.name})]}),f.jsx("button",{className:"kb-delete",onClick:y=>{y.stopPropagation(),m(g.id)},children:f.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:f.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})})})]},g.id))})]}),f.jsx("div",{className:"kb-main",children:l?f.jsxs("div",{className:"kb-detail",children:[f.jsx("div",{className:"kb-detail-header",children:f.jsx("h2",{children:l.name})}),f.jsxs("div",{className:"kb-upload-section",children:[f.jsx("h3",{children:"Upload Documents"}),f.jsx("p",{className:"kb-description",children:"Upload documents (PDF, TXT, DOCX) to add to this knowledge base."}),f.jsxs("label",{className:"kb-upload-label",children:[f.jsx("input",{type:"file",accept:".pdf,.txt,.docx",onChange:v,disabled:u,style:{display:"none"}}),f.jsxs("div",{className:"kb-upload-box",children:[f.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),f.jsx("polyline",{points:"17 8 12 3 7 8"}),f.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),f.jsx("p",{children:u?"Uploading...":"Click to upload or drag and drop"}),f.jsx("p",{className:"kb-upload-hint",children:"PDF, TXT, DOCX up to 10MB"})]})]})]}),f.jsxs("div",{className:"kb-documents",children:[f.jsx("h3",{children:"Documents"}),l.documents&&l.documents.length>0?f.jsx("div",{className:"kb-doc-list",children:l.documents.map((g,y)=>f.jsxs("div",{className:"kb-doc-item",children:[f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),f.jsx("polyline",{points:"14 2 14 8 20 8"})]}),f.jsx("span",{children:g.name||`Document ${y+1}`})]},y))}):f.jsx("p",{className:"kb-empty-docs",children:"No documents uploaded yet"})]})]}):f.jsxs("div",{className:"kb-empty-state",children:[f.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),f.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),f.jsx("h3",{children:"Select a knowledge base"}),f.jsx("p",{children:"Choose a knowledge base from the sidebar to view and manage documents"})]})})]}),r&&f.jsx("div",{className:"modal-overlay",onClick:()=>s(!1),children:f.jsxs("div",{className:"modal-content",onClick:g=>g.stopPropagation(),children:[f.jsx("h2",{children:"Create Knowledge Base"}),f.jsx("input",{type:"text",placeholder:"Knowledge base name",value:o,onChange:g=>a(g.target.value),className:"modal-input",autoFocus:!0,onKeyPress:g=>g.key==="Enter"&&p()}),f.jsxs("div",{className:"modal-actions",children:[f.jsx("button",{className:"btn-secondary",onClick:()=>s(!1),children:"Cancel"}),f.jsx("button",{className:"btn-primary",onClick:p,children:"Create"})]})]})})]})}const Fd="http://localhost:5000/api";function Hj(){var T,g,y,S;const[t,e]=C.useState([]),[n,i]=C.useState(!0),[r,s]=C.useState(null),[o,a]=C.useState(!1);C.useEffect(()=>{l()},[]);const l=async()=>{try{const k=await X.get(`${Fd}/call-history`);e(k.data)}catch(k){console.error("Error fetching call history:",k),e([])}finally{i(!1)}},c=async k=>{try{const b=await X.get(`${Fd}/call-history/${k}`);s(b.data),a(!0)}catch(b){console.error("Error fetching call details:",b)}},u=k=>{if(!k)return"0:00";const b=Math.floor(k/60),x=k%60;return`${b}:${x.toString().padStart(2,"0")}`},d=k=>k?new Date(k).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"",h=k=>{if(k==null)return"";const b=Number(k);return Number.isFinite(b)?`${Math.round(b)}ms`:""},p=(()=>{const k=(t||[]).map(b=>{var x,E,P;return((x=b==null?void 0:b.latencySummary)==null?void 0:x.avgE2eFirstAudioMs)??((P=(E=b==null?void 0:b.latencySummary)==null?void 0:E.lastTurn)==null?void 0:P.e2eFirstAudioMs)}).filter(b=>typeof b=="number"&&Number.isFinite(b));return k.length?Math.round(k.reduce((b,x)=>b+x,0)/k.length):null})(),m=k=>k==="user_hangup"||k==="agent_hangup"?"#10b981":"#6b7280",v=k=>k==="ended"?"#6b7280":k==="active"?"#2563eb":"#ef4444";return n?f.jsx("div",{className:"call-history-container",children:f.jsx("div",{className:"call-history-loading",children:"Loading call history..."})}):f.jsxs("div",{className:"call-history-container",children:[f.jsxs("div",{className:"call-history-header",children:[f.jsx("h1",{className:"call-history-title",children:"Call History"}),f.jsxs("div",{className:"call-history-actions",children:[f.jsxs("div",{style:{fontSize:"12px",opacity:.75,marginRight:"10px"},children:["Avg latency: ",f.jsx("strong",{children:h(p)})]}),f.jsxs("button",{className:"btn-secondary",onClick:l,children:[f.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("polyline",{points:"23 4 23 10 17 10"}),f.jsx("polyline",{points:"1 20 1 14 7 14"}),f.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),"Refresh"]})]})]}),f.jsx("div",{className:"call-history-table-container",children:f.jsxs("table",{className:"call-history-table",children:[f.jsx("thead",{children:f.jsxs("tr",{children:[f.jsx("th",{children:"Time"}),f.jsx("th",{children:"Duration"}),f.jsx("th",{children:"Channel Type"}),f.jsx("th",{children:"Cost"}),f.jsx("th",{children:"Latency"}),f.jsx("th",{children:"Session ID"}),f.jsx("th",{children:"End Reason"}),f.jsx("th",{children:"Session Status"}),f.jsx("th",{children:"Agent"})]})}),f.jsx("tbody",{children:t.length===0?f.jsx("tr",{children:f.jsx("td",{colSpan:"8",className:"empty-state-cell",children:f.jsxs("div",{className:"empty-state",children:[f.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("circle",{cx:"12",cy:"12",r:"10"}),f.jsx("polyline",{points:"12 6 12 12 16 14"})]}),f.jsx("p",{children:"No call history yet"})]})})}):t.map(k=>{var b,x,E;return f.jsxs("tr",{className:"call-row",onClick:()=>c(k.id),children:[f.jsx("td",{children:d(k.startTime)}),f.jsx("td",{children:u(k.duration)}),f.jsx("td",{children:f.jsx("span",{className:"channel-badge",children:k.channelType||"web_call"})}),f.jsxs("td",{children:["$",k.cost.toFixed(3)]}),f.jsx("td",{children:h(((b=k.latencySummary)==null?void 0:b.avgE2eFirstAudioMs)??((E=(x=k.latencySummary)==null?void 0:x.lastTurn)==null?void 0:E.e2eFirstAudioMs))}),f.jsx("td",{children:f.jsxs("span",{className:"session-id",children:[k.id.substring(0,20),"..."]})}),f.jsx("td",{children:f.jsxs("div",{className:"status-cell",children:[f.jsx("span",{className:"status-dot",style:{backgroundColor:m(k.endReason)}}),f.jsx("span",{children:k.endReason||"N/A"})]})}),f.jsx("td",{children:f.jsxs("div",{className:"status-cell",children:[f.jsx("span",{className:"status-dot",style:{backgroundColor:v(k.status)}}),f.jsx("span",{children:k.status})]})}),f.jsx("td",{children:k.agentName||"Unknown"})]},k.id)})})]})}),o&&r&&f.jsx("div",{className:"detail-sidebar-overlay",onClick:()=>a(!1),children:f.jsxs("div",{className:"detail-sidebar",onClick:k=>k.stopPropagation(),children:[f.jsxs("div",{className:"detail-sidebar-header",children:[f.jsx("div",{className:"detail-nav-hint",children:f.jsx("span",{children:"Use   to navigate"})}),f.jsx("button",{className:"detail-close-btn",onClick:()=>a(!1),children:f.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),f.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),f.jsxs("div",{className:"detail-content",children:[f.jsxs("div",{className:"detail-section",children:[f.jsxs("h2",{className:"detail-call-title",children:[d(r.startTime)," ",r.channelType||"web_call"]}),f.jsxs("div",{className:"detail-meta",children:[f.jsxs("div",{className:"detail-meta-item",children:[f.jsx("span",{className:"detail-label",children:"Agent:"}),f.jsx("span",{children:r.agentName||"Unknown"})]}),f.jsxs("div",{className:"detail-meta-item",children:[f.jsx("span",{className:"detail-label",children:"Call ID:"}),f.jsx("span",{className:"call-id-text",children:r.id}),f.jsx("button",{className:"copy-btn",onClick:()=>{navigator.clipboard.writeText(r.id),alert("Call ID copied!")},children:f.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[f.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),f.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})})]}),f.jsxs("div",{className:"detail-meta-item",children:[f.jsx("span",{className:"detail-label",children:"Duration:"}),f.jsxs("span",{children:[d(r.startTime)," - ",d(r.endTime)||"Ongoing"]})]}),r.roomName&&f.jsxs("div",{className:"detail-meta-item",children:[f.jsx("span",{className:"detail-label",children:"Room:"}),f.jsx("span",{className:"call-id-text",children:r.roomName})]}),r.provider&&f.jsxs("div",{className:"detail-meta-item",children:[f.jsx("span",{className:"detail-label",children:"Provider:"}),f.jsx("span",{children:r.provider})]}),f.jsxs("div",{className:"detail-meta-item",children:[f.jsx("span",{className:"detail-label",children:"Cost:"}),f.jsxs("span",{children:["$",r.cost.toFixed(3)]})]})]})]}),f.jsxs("div",{className:"detail-section",children:[f.jsx("h3",{className:"detail-section-title",children:"Conversation Analysis"}),f.jsxs("div",{className:"analysis-grid",children:[f.jsxs("div",{className:"analysis-item",children:[f.jsx("span",{className:"analysis-label",children:"Call Status"}),f.jsxs("div",{className:"analysis-value",children:[f.jsx("span",{className:"status-dot",style:{backgroundColor:v(r.status)}}),f.jsx("span",{children:r.status})]})]}),f.jsxs("div",{className:"analysis-item",children:[f.jsx("span",{className:"analysis-label",children:"End Reason"}),f.jsxs("div",{className:"analysis-value",children:[f.jsx("span",{className:"status-dot",style:{backgroundColor:m(r.endReason)}}),f.jsx("span",{children:r.endReason||"N/A"})]})]}),f.jsxs("div",{className:"analysis-item",children:[f.jsx("span",{className:"analysis-label",children:"Avg Latency (first audio)"}),f.jsx("div",{className:"analysis-value",children:f.jsx("span",{children:h((T=r.latencySummary)==null?void 0:T.avgE2eFirstAudioMs)})})]}),((g=r.metrics)==null?void 0:g.avgVadEndToPlayoutStartMs)!=null&&f.jsxs("div",{className:"analysis-item",children:[f.jsx("span",{className:"analysis-label",children:"Avg Latency (VADPlayout)"}),f.jsx("div",{className:"analysis-value",children:f.jsx("span",{children:h(r.metrics.avgVadEndToPlayoutStartMs)})})]}),f.jsxs("div",{className:"analysis-item",children:[f.jsx("span",{className:"analysis-label",children:"Last Turn Latency"}),f.jsx("div",{className:"analysis-value",children:f.jsx("span",{children:h((S=(y=r.latencySummary)==null?void 0:y.lastTurn)==null?void 0:S.e2eFirstAudioMs)})})]})]})]}),r.audioUrl&&f.jsxs("div",{className:"detail-section",children:[f.jsx("h3",{className:"detail-section-title",children:"Full Conversation Audio"}),f.jsx("div",{className:"audio-player-container",children:f.jsx("audio",{controls:!0,src:r.audioUrl.startsWith("http")?r.audioUrl:`${Fd.replace("/api","")}${r.audioUrl}`,style:{width:"100%"},children:"Your browser does not support the audio element."})})]}),r.recordingUrl&&f.jsxs("div",{className:"detail-section",children:[f.jsx("h3",{className:"detail-section-title",children:"Call Recording (LiveKit)"}),f.jsx("div",{className:"audio-player-container",children:String(r.recordingUrl).startsWith("http")?f.jsx("audio",{controls:!0,src:r.recordingUrl,style:{width:"100%"}}):f.jsx("div",{style:{fontSize:"12px",opacity:.85,wordBreak:"break-all"},children:r.recordingUrl})})]}),f.jsxs("div",{className:"detail-section",children:[f.jsx("h3",{className:"detail-section-title",children:"Transcription"}),f.jsx("div",{className:"transcription-content",children:r.messages&&r.messages.length>0?r.messages.filter(k=>k.role!=="system").map((k,b)=>f.jsxs("div",{className:`transcription-message ${k.role}`,children:[f.jsx("div",{className:"transcription-role",children:k.role==="user"?"User":"Agent"}),f.jsx("div",{className:"transcription-text",children:k.content})]},b)):f.jsx("p",{className:"no-transcription",children:"No transcription available"})})]})]})]})})]})}function $j(){const[t,e]=C.useState(""),[n,i]=C.useState(""),[r,s]=C.useState(""),[o,a]=C.useState(!1),{login:l}=ro(),c=Jr(),u=async d=>{d.preventDefault(),s(""),a(!0);const h=await l(t,n);h.success?c("/"):s(h.error),a(!1)};return f.jsx("div",{className:"auth-container",children:f.jsxs("div",{className:"auth-card",children:[f.jsxs("div",{className:"auth-header",children:[f.jsx("h1",{children:"Welcome Back"}),f.jsx("p",{children:"Sign in to your account"})]}),r&&f.jsx("div",{className:"auth-error",children:r}),f.jsxs("form",{onSubmit:u,className:"auth-form",children:[f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"email",children:"Email"}),f.jsx("input",{type:"email",id:"email",value:t,onChange:d=>e(d.target.value),placeholder:"you@example.com",required:!0,disabled:o})]}),f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"password",children:"Password"}),f.jsx("input",{type:"password",id:"password",value:n,onChange:d=>i(d.target.value),placeholder:"Enter your password",required:!0,disabled:o,minLength:6})]}),f.jsx("button",{type:"submit",className:"btn-primary btn-full",disabled:o,children:o?"Signing in...":"Sign In"})]}),f.jsx("div",{className:"auth-footer",children:f.jsxs("p",{children:["Don't have an account?"," ",f.jsx(Wo,{to:"/register",children:"Sign up"})]})})]})})}function Kj(){const[t,e]=C.useState(""),[n,i]=C.useState(""),[r,s]=C.useState(""),[o,a]=C.useState(""),[l,c]=C.useState(""),[u,d]=C.useState(!1),{register:h}=ro(),p=Jr(),m=async v=>{if(v.preventDefault(),c(""),r!==o){c("Passwords do not match");return}if(r.length<6){c("Password must be at least 6 characters long");return}d(!0);const T=await h(n,r,t);T.success?p("/"):c(T.error),d(!1)};return f.jsx("div",{className:"auth-container",children:f.jsxs("div",{className:"auth-card",children:[f.jsxs("div",{className:"auth-header",children:[f.jsx("h1",{children:"Create Account"}),f.jsx("p",{children:"Sign up to get started"})]}),l&&f.jsx("div",{className:"auth-error",children:l}),f.jsxs("form",{onSubmit:m,className:"auth-form",children:[f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"name",children:"Full Name"}),f.jsx("input",{type:"text",id:"name",value:t,onChange:v=>e(v.target.value),placeholder:"John Doe",required:!0,disabled:u})]}),f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"email",children:"Email"}),f.jsx("input",{type:"email",id:"email",value:n,onChange:v=>i(v.target.value),placeholder:"you@example.com",required:!0,disabled:u})]}),f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"password",children:"Password"}),f.jsx("input",{type:"password",id:"password",value:r,onChange:v=>s(v.target.value),placeholder:"At least 6 characters",required:!0,disabled:u,minLength:6})]}),f.jsxs("div",{className:"form-group",children:[f.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),f.jsx("input",{type:"password",id:"confirmPassword",value:o,onChange:v=>a(v.target.value),placeholder:"Confirm your password",required:!0,disabled:u,minLength:6})]}),f.jsx("button",{type:"submit",className:"btn-primary btn-full",disabled:u,children:u?"Creating account...":"Sign Up"})]}),f.jsx("div",{className:"auth-footer",children:f.jsxs("p",{children:["Already have an account?"," ",f.jsx(Wo,{to:"/login",children:"Sign in"})]})})]})})}const Gn="http://localhost:5000/api";function Gj(){try{const t=new URL(Gn).origin;if(t.includes("localhost")||t.includes("127.0.0.1"))throw new Error("Invalid API origin (localhost)");return t}catch{try{const{protocol:e,hostname:n}=window.location;return n.startsWith("dashboard.")?`${e}//api.${n.slice(10)}`:n.startsWith("api.")?`${e}//${n}`:window.location.origin}catch{return window.location.origin}}}function Jj(t){if(!t)return null;const e=String(t);if(!e)return null;if(e.startsWith("http://")||e.startsWith("https://"))return e;let n=e;return n.startsWith("/.rapidcallai.com/")&&(n=n.replace("/.rapidcallai.com","")),n=n.replace("/api/api/","/api/"),n.startsWith("/")||(n=`/${n}`),n}function w0(t){const e=Jj(t);return e?e.startsWith("http://")||e.startsWith("https://")?e:`${Gj()}${e}`:null}function Qj(){const{token:t}=WS(),[e,n]=C.useState(null),[i,r]=C.useState(!0),[s,o]=C.useState(null),[a,l]=C.useState(!1),[c,u]=C.useState(!1),[d,h]=C.useState(null),[p,m]=C.useState([]),[v,T]=C.useState(!1),[g,y]=C.useState(""),[S,k]=C.useState(null),[b,x]=C.useState("realtime"),[E,P]=C.useState({status:"idle",roomName:null,identity:null,callId:null,error:null,userSpeaking:!1,agentSpeaking:!1}),A=C.useRef(null),O=C.useRef(null),W=C.useRef(null),J=C.useRef(null),se=C.useRef(null),te=C.useRef({turnId:null,vadEndAt:null}),xe=C.useRef(new Set),q=C.useRef(null),Re=C.useRef(b),D=C.useRef(!1);C.useRef(null);const N=C.useRef(null),j=C.useRef(!1),$=C.useRef(!1);C.useRef(null),C.useRef(!1);const ee=C.useRef(null);C.useEffect(()=>{t&&De()},[t]),C.useEffect(()=>{j.current=a},[a]),C.useEffect(()=>{var ue,ne;if(Re.current=b,b==="realtime"){try{(ne=(ue=q.current)==null?void 0:ue.stop)==null||ne.call(ue)}catch{}y("")}},[b]);const De=async()=>{try{r(!0);const ue=await X.get(`${Gn}/public/agent/${t}`);n(ue.data),o(null)}catch(ue){console.error("Error fetching agent:",ue),o("Agent not found or not publicly accessible")}finally{r(!1)}},pe=C.useCallback(async ue=>{if(b!=="realtime"&&!(!d||D.current)&&!(!ue||!ue.trim())){if(D.current=!0,T(!0),y(""),m(ne=>[...ne,{role:"user",content:ue.trim()}]),q.current)try{q.current.stop()}catch{}if(A.current&&!A.current.paused){const ne=A.current.currentTime,me=A.current.src;A.current.pause(),k({currentTime:ne,audioUrl:me})}try{const ne=await X.post(`${Gn}/conversation/chat`,{message:ue,conversationId:d,publicToken:t}),me=ne.data.text;if(m(de=>[...de,{role:"assistant",content:me}]),ne.data.shouldEndCall){await le();return}if(ne.data.audioUrl&&j.current){const de=w0(ne.data.audioUrl),z=de?new Audio(de):null;A.current=z;const fe=Ze=>{if(!z||z.paused)return;let We=!1;for(let dn=Ze.resultIndex;dn<Ze.results.length;dn++)if(Ze.results[dn][0].transcript.trim()){We=!0;break}We&&($.current=!0,z.pause(),q.current&&q.current.stop(),setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{}},100))},St=ee.current;if(St){const Ze=We=>{St(We),fe(We)};q.current.onresult=Ze}z&&(z.onended=()=>{A.current=null,q.current&&ee.current&&(q.current.onresult=ee.current),j.current&&!D.current&&(u(!0),setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{}},100))}),z&&(z.onerror=()=>{A.current=null,q.current&&ee.current&&(q.current.onresult=ee.current),j.current&&!D.current&&(u(!0),setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{}},100))}),z&&(z.onplay=()=>{$.current=!1}),z&&(z.onpause=()=>{$.current&&S&&(z.currentTime=S.currentTime)}),z==null||z.play().catch(()=>{A.current=null,j.current&&!D.current&&(u(!0),setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{}},100))})}else u(!0),setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{}},100)}catch(ne){console.error("Error sending message:",ne),u(!0),setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{}},100)}finally{D.current=!1,T(!1)}}},[b,d,t]);C.useEffect(()=>{var de;if(b==="realtime")return;if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){console.warn("Speech recognition not supported");return}const ue=window.SpeechRecognition||window.webkitSpeechRecognition,ne=new ue;ne.continuous=!0,ne.interimResults=!0,ne.lang=((de=e==null?void 0:e.speechSettings)==null?void 0:de.language)||"en-US",ne.onstart=()=>{u(!0)},ne.onend=()=>{u(!1),j.current&&!D.current&&setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{console.log("Recognition already running")}},100)};const me=z=>{if(Re.current==="realtime")return;let fe="",St="";for(let Ze=z.resultIndex;Ze<z.results.length;Ze++){const We=z.results[Ze][0].transcript;z.results[Ze].isFinal?St+=We+" ":fe+=We}y(fe),St.trim()&&(N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{St.trim()&&!D.current&&pe(St.trim())},500))};return ne.onresult=me,q.current=ne,ee.current=me,ne.onerror=z=>{console.error("Speech recognition error:",z.error),z.error==="no-speech"&&j.current&&!D.current&&setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{}},1e3)},()=>{q.current&&q.current.stop()}},[e,b,pe]);const Xe=async()=>{var ue,ne,me;if(b==="realtime")return ct();if(!e||!((ue=e.systemPrompt)!=null&&ue.trim())){alert("Agent is not properly configured");return}try{D.current=!0,T(!0);const de=await X.post(`${Gn}/conversation/start`,{systemPrompt:e.systemPrompt.trim(),agentId:e.id,knowledgeBaseId:e.knowledgeBaseId||null,aiSpeaksFirst:((ne=e.callSettings)==null?void 0:ne.aiSpeaksFirst)||!1,publicToken:t});if(h(de.data.conversationId),l(!0),j.current=!0,m([]),y(""),D.current=!1,T(!1),(me=e.callSettings)!=null&&me.aiSpeaksFirst&&de.data.initialGreeting)if(m(z=>[...z,{role:"assistant",content:de.data.initialGreeting}]),de.data.initialAudioUrl&&j.current){const z=w0(de.data.initialAudioUrl),fe=z?new Audio(z):null;A.current=fe,fe&&(fe.onended=()=>{A.current=null,j.current&&!D.current&&(u(!0),setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{}},100))}),fe==null||fe.play().catch(()=>{A.current=null,j.current&&!D.current&&u(!0)})}else u(!0);else u(!0),setTimeout(()=>{if(q.current&&j.current)try{q.current.start()}catch{}},300)}catch(de){console.error("Error starting conversation:",de),alert("Failed to start conversation"),D.current=!1,T(!1)}},le=async()=>{var ue,ne,me,de;if(b==="realtime"){try{try{(ne=(ue=J.current)==null?void 0:ue.stop)==null||ne.call(ue)}catch{}J.current=null;try{(de=(me=W.current)==null?void 0:me.disconnect)==null||de.call(me)}catch{}if(W.current=null,se.current&&(se.current.innerHTML=""),E!=null&&E.callId||E!=null&&E.roomName)try{await X.post(`${Gn}/realtime/end`,{callId:E.callId,roomName:E.roomName,endReason:"user_hangup",publicToken:t,agentId:e==null?void 0:e.id})}catch{}}finally{j.current=!1,D.current=!1,l(!1),u(!1),T(!1),y(""),m([]),h(null),P(z=>({...z,status:"ended",userSpeaking:!1,agentSpeaking:!1}))}return}if(j.current=!1,D.current=!1,l(!1),u(!1),T(!1),y(""),q.current)try{q.current.stop()}catch{}if(A.current&&(A.current.pause(),A.current=null),O.current&&(O.current.pause(),O.current=null),k(null),$.current=!1,d)try{await X.post(`${Gn}/conversation/${d}/end`,{endReason:"user_hangup",publicToken:t})}catch(z){console.error("Error ending call:",z)}},ct=C.useCallback(async()=>{var ue;if(!(e!=null&&e.id)){alert("Agent not loaded");return}try{await le(),P({status:"connecting",roomName:null,identity:null,callId:null,error:null,userSpeaking:!1,agentSpeaking:!1});const ne=await X.post(`${Gn}/realtime/token`,{agentId:e.id,publicToken:t,provider:"web"}),{livekitUrl:me,accessToken:de,roomName:z,identity:fe}=ne.data||{};if(!me||!de||!z)throw new Error("Realtime token response missing fields");const Ze=((ue=(await X.post(`${Gn}/realtime/start`,{agentId:e.id,publicToken:t,provider:"web",roomName:z})).data)==null?void 0:ue.callId)||null,We=new Hr({adaptiveStream:!0,dynacast:!0});W.current=We,We.on(U.Disconnected,()=>{P(rt=>({...rt,status:"ended",userSpeaking:!1,agentSpeaking:!1}))}),We.on(U.TrackSubscribed,rt=>{var Ee;if((rt==null?void 0:rt.kind)!=="audio")return;const ae=rt.attach();ae.autoplay=!0,ae.controls=!1,ae.setAttribute("data-livekit-audio","true"),ae.onplaying=async()=>{var Rt,Pe;try{const wn=Date.now(),mt=((Rt=te.current)==null?void 0:Rt.turnId)||`play_${wn}`;if(xe.current.has(mt))return;xe.current.add(mt);const ve=((Pe=te.current)==null?void 0:Pe.vadEndAt)??null,zn=typeof ve=="number"?wn-ve:null;await X.post(`${Gn}/realtime/metrics`,{callId:Ze,roomName:z,agentId:e.id,publicToken:t,turn:{turnId:mt,vadEndAt:ve,clientPlayoutStartAt:wn,vadEndToPlayoutStartMs:zn}})}catch{}},(Ee=se.current)==null||Ee.appendChild(ae)}),We.on(U.TrackUnsubscribed,rt=>{if((rt==null?void 0:rt.kind)==="audio")try{rt.detach().forEach(ae=>ae.remove())}catch{}}),We.on(U.ActiveSpeakersChanged,rt=>{var wn;const ae=new Set((rt||[]).map(mt=>mt==null?void 0:mt.identity).filter(Boolean)),Ee=(wn=We.localParticipant)==null?void 0:wn.identity,Rt=!!(Ee&&ae.has(Ee)),Pe=Array.from(ae).some(mt=>mt&&mt!==Ee);P(mt=>({...mt,userSpeaking:Rt,agentSpeaking:Pe}))}),We.on(U.DataReceived,async rt=>{try{const ae=new TextDecoder().decode(rt),Ee=JSON.parse(ae);if(!Ee||typeof Ee!="object")return;Ee.turnId&&(te.current.turnId=String(Ee.turnId)),typeof Ee.vadEndAt=="number"&&(te.current.vadEndAt=Ee.vadEndAt),Ee.turnId&&(typeof Ee.vadEndAt=="number"||typeof Ee.ttsFirstFrameAt=="number"||typeof Ee.llmFirstTokenAt=="number")&&await X.post(`${Gn}/realtime/metrics`,{callId:Ze,roomName:z,agentId:e.id,publicToken:t,turn:{turnId:String(Ee.turnId),vadEndAt:typeof Ee.vadEndAt=="number"?Ee.vadEndAt:void 0,llmFirstTokenAt:typeof Ee.llmFirstTokenAt=="number"?Ee.llmFirstTokenAt:void 0,ttsFirstFrameAt:typeof Ee.ttsFirstFrameAt=="number"?Ee.ttsFirstFrameAt:void 0}})}catch{}}),await We.connect(me,de);const dn=await Cm({echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0});J.current=dn,await We.localParticipant.publishTrack(dn),P(rt=>({...rt,status:"connected",roomName:z,identity:fe||null,callId:Ze})),l(!0),j.current=!0,u(!0)}catch(ne){console.error("Public realtime start failed:",ne),P(me=>{var de,z;return{...me,status:"error",error:((z=(de=ne==null?void 0:ne.response)==null?void 0:de.data)==null?void 0:z.error)||(ne==null?void 0:ne.message)||"Failed to start realtime call"}}),x("legacy")}},[e==null?void 0:e.id,le,t]);return i?f.jsx("div",{className:"public-agent-container",children:f.jsx("div",{className:"public-agent-loading",children:"Loading agent..."})}):s||!e?f.jsx("div",{className:"public-agent-container",children:f.jsxs("div",{className:"public-agent-error",children:[f.jsx("h2",{children:"Agent Not Found"}),f.jsx("p",{children:s||"The agent you are looking for is not available."})]})}):f.jsxs("div",{className:"public-agent-container",children:[f.jsxs("div",{className:"public-agent-header",children:[f.jsx("h1",{children:e.name}),f.jsx("p",{className:"public-agent-subtitle",children:"Voice Assistant"})]}),f.jsxs("div",{className:"public-agent-content",children:[f.jsx("div",{style:{marginBottom:"12px",display:"flex",gap:"10px",alignItems:"center"},children:f.jsxs("label",{style:{fontSize:"14px"},children:[f.jsx("input",{type:"checkbox",checked:b==="realtime",onChange:ue=>x(ue.target.checked?"realtime":"legacy"),style:{marginRight:"6px"}}),"Realtime (LiveKit) mode"]})}),a?f.jsxs(f.Fragment,{children:[f.jsx("div",{ref:se,style:{display:"none"}}),b==="realtime"&&f.jsxs("div",{style:{padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",marginBottom:"12px"},children:[f.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",fontSize:"14px"},children:[f.jsxs("span",{children:[f.jsx("strong",{children:"Realtime:"})," ",E.status]}),E.roomName&&f.jsxs("span",{children:[f.jsx("strong",{children:"Room:"})," ",E.roomName]}),f.jsxs("span",{children:[f.jsx("strong",{children:"You:"})," ",E.userSpeaking?"speaking":"silent"]}),f.jsxs("span",{children:[f.jsx("strong",{children:"Agent:"})," ",E.agentSpeaking?"speaking":"silent"]})]}),E.status==="error"&&f.jsx("div",{style:{marginTop:"8px",color:"#b91c1c",fontSize:"13px"},children:E.error})]}),f.jsxs("div",{className:"public-agent-messages",children:[p.map((ue,ne)=>f.jsx("div",{className:`public-message ${ue.role}`,children:f.jsx("div",{className:"public-message-content",children:ue.content})},ne)),g&&f.jsx("div",{className:"public-message user interim",children:f.jsx("div",{className:"public-message-content",children:g})})]}),f.jsxs("div",{className:"public-agent-controls",children:[f.jsxs("div",{className:"public-status",children:[c&&!v&&f.jsx("span",{className:"public-status-indicator listening",children:"Listening..."}),v&&f.jsx("span",{className:"public-status-indicator processing",children:"Processing..."}),!c&&!v&&a&&f.jsx("span",{className:"public-status-indicator waiting",children:"Waiting..."})]}),f.jsx("button",{className:"public-stop-btn",onClick:le,children:"End Call"})]})]}):f.jsx("div",{className:"public-agent-start",children:f.jsx("button",{className:"public-start-btn",onClick:Xe,disabled:v,children:v?"Starting...":b==="realtime"?"Start Call (Realtime)":"Start Conversation"})})]})]})}const gl=({children:t})=>{const{isAuthenticated:e,loading:n}=ro();return n?f.jsx("div",{className:"app",children:f.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:f.jsx("div",{children:"Loading..."})})}):e?t:f.jsx(xp,{to:"/login",replace:!0})},x0=({children:t})=>{const{isAuthenticated:e,loading:n}=ro();return n?f.jsx("div",{className:"app",children:f.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:f.jsx("div",{children:"Loading..."})})}):e?f.jsx(xp,{to:"/",replace:!0}):t};function Yj(){const{isAuthenticated:t}=ro(),n=Gr().pathname.startsWith("/test/"),i=t&&!n;return f.jsxs(f.Fragment,{children:[i&&f.jsx(e_,{}),f.jsxs(fR,{children:[f.jsx(oi,{path:"/login",element:f.jsx(x0,{children:f.jsx($j,{})})}),f.jsx(oi,{path:"/register",element:f.jsx(x0,{children:f.jsx(Kj,{})})}),f.jsx(oi,{path:"/test/:token",element:f.jsx(Qj,{})}),f.jsx(oi,{path:"/",element:f.jsx(gl,{children:f.jsx(t_,{})})}),f.jsx(oi,{path:"/agent/:id",element:f.jsx(gl,{children:f.jsx(Wj,{})})}),f.jsx(oi,{path:"/knowledge-base",element:f.jsx(gl,{children:f.jsx(qj,{})})}),f.jsx(oi,{path:"/call-history",element:f.jsx(gl,{children:f.jsx(Hj,{})})}),f.jsx(oi,{path:"*",element:f.jsx(xp,{to:"/login",replace:!0})})]})]})}function Xj(){return f.jsx(Z1,{children:f.jsx(SR,{children:f.jsx("div",{className:"app",children:f.jsx(Yj,{})})})})}Bd.createRoot(document.getElementById("root")).render(f.jsx(Fc.StrictMode,{children:f.jsx(Xj,{})}));
